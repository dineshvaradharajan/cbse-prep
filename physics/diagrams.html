<!DOCTYPE html>
<html lang="en">
<head>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Newsreader:ital,opsz,wght@0,6..72,400;0,6..72,500;0,6..72,600;0,6..72,700;1,6..72,400&family=Lato:wght@400;700;900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="../css/base.css">
<style>
  /* ‚îÄ‚îÄ Chapter color variables ‚îÄ‚îÄ */
  :root {
    --ch1:  #2563eb; --ch1-bg:  #eff6ff; --ch1-border:  #bfdbfe;
    --ch2:  #7c3aed; --ch2-bg:  #f5f3ff; --ch2-border:  #ddd6fe;
    --ch3:  #0891b2; --ch3-bg:  #ecfeff; --ch3-border:  #a5f3fc;
    --ch4:  #059669; --ch4-bg:  #ecfdf5; --ch4-border:  #a7f3d0;
    --ch5:  #dc2626; --ch5-bg:  #fef2f2; --ch5-border:  #fca5a5;
    --ch6:  #ea580c; --ch6-bg:  #fff7ed; --ch6-border:  #fed7aa;
    --ch7:  #d97706; --ch7-bg:  #fffbeb; --ch7-border:  #fde68a;
    --ch9:  #0f766e; --ch9-bg:  #f0fdfa; --ch9-border:  #99f6e4;
    --ch10: #4338ca; --ch10-bg: #eef2ff; --ch10-border: #c7d2fe;
    --ch11: #be185d; --ch11-bg: #fdf2f8; --ch11-border: #f9a8d4;
    --ch12: #b45309; --ch12-bg: #fffbeb; --ch12-border: #fcd34d;
    --ch13: #15803d; --ch13-bg: #f0fdf4; --ch13-border: #86efac;
    --ch14: #9333ea; --ch14-bg: #faf5ff; --ch14-border: #d8b4fe;
  }

  /* ‚îÄ‚îÄ Hero ‚îÄ‚îÄ */
  .hero {
    text-align: center;
    padding: 2.5rem 1rem 2rem;
    border-bottom: 1px solid var(--sand-200);
    margin-bottom: 0;
  }
  .hero .badge {
    display: inline-block;
    background: var(--sand-100);
    border: 1px solid var(--sand-200);
    border-radius: 999px;
    padding: 0.25rem 0.85rem;
    font-size: 0.7rem;
    font-weight: 700;
    letter-spacing: 0.06em;
    text-transform: uppercase;
    color: var(--ink-3);
    margin-bottom: 0.85rem;
  }
  .hero h1 {
    font-family: 'Newsreader', serif;
    font-size: clamp(1.6rem, 3.5vw, 2.2rem);
    font-weight: 700;
    color: var(--ink);
    line-height: 1.2;
    margin-bottom: 0.5rem;
  }
  .hero .sub {
    font-size: 0.84rem;
    color: var(--ink-3);
    max-width: 540px;
    margin: 0 auto 1.25rem;
    line-height: 1.6;
  }

  /* ‚îÄ‚îÄ Mode toggle ‚îÄ‚îÄ */
  .mode-toggle {
    display: inline-flex;
    gap: 0;
    border: 1.5px solid var(--sand-300);
    border-radius: 10px;
    overflow: hidden;
    margin-top: 0.5rem;
  }
  .mode-toggle button {
    padding: 0.45rem 1rem;
    font-size: 0.8rem;
    font-weight: 700;
    font-family: 'Lato', sans-serif;
    background: #fff;
    color: var(--ink-3);
    border: none;
    cursor: pointer;
    transition: all 0.2s;
  }
  .mode-toggle button.active {
    background: var(--sand-900);
    color: #fff;
  }
  .mode-toggle button:not(.active):hover { background: var(--sand-100); }

  /* ‚îÄ‚îÄ Sticky chapter nav ‚îÄ‚îÄ */
  .chapter-nav {
    position: sticky;
    top: 0;
    z-index: 100;
    background: rgba(253, 252, 250, 0.95);
    backdrop-filter: blur(6px);
    border-bottom: 1px solid var(--sand-200);
    padding: 0.5rem 0;
  }
  .chapter-nav-inner {
    max-width: 80%;
    margin: 0 auto;
    padding: 0 1.25rem;
    display: flex;
    gap: 0.4rem;
    overflow-x: auto;
    scrollbar-width: none;
  }
  .chapter-nav-inner::-webkit-scrollbar { display: none; }
  .chapter-nav-inner a {
    display: inline-block;
    padding: 0.3rem 0.7rem;
    font-size: 0.72rem;
    font-weight: 700;
    border-radius: 7px;
    border: 1.5px solid transparent;
    text-decoration: none;
    white-space: nowrap;
    transition: all 0.15s;
  }
  .chapter-nav-inner a:hover { filter: brightness(0.92); }

  /* ‚îÄ‚îÄ Chapter section ‚îÄ‚îÄ */
  .chapter-section { padding: 2rem 0 1rem; }
  .chapter-header {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 1.25rem;
    padding-bottom: 0.75rem;
    border-bottom: 1px solid var(--sand-200);
  }
  .chapter-num {
    width: 36px; height: 36px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.9rem;
    font-weight: 900;
    color: #fff;
    flex-shrink: 0;
  }
  .chapter-title {
    font-family: 'Newsreader', serif;
    font-size: 1.2rem;
    font-weight: 600;
    color: var(--ink);
  }

  /* ‚îÄ‚îÄ Diagram grid ‚îÄ‚îÄ */
  .diagram-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 1.25rem;
  }

  /* ‚îÄ‚îÄ Diagram card ‚îÄ‚îÄ */
  .diagram-card {
    background: #fff;
    border: 1px solid var(--sand-200);
    border-radius: 12px;
    overflow: hidden;
    transition: box-shadow 0.2s;
  }
  .diagram-card:hover { box-shadow: 0 4px 18px rgba(0,0,0,0.07); }
  .svg-wrap {
    padding: 0.75rem;
    background: var(--sand-50);
    border-bottom: 1px solid var(--sand-200);
  }
  .svg-wrap svg {
    width: 100%;
    height: auto;
    display: block;
  }
  .caption {
    padding: 0.75rem 1rem;
  }
  .fig-num {
    font-size: 0.68rem;
    font-weight: 700;
    letter-spacing: 0.04em;
    text-transform: uppercase;
    margin-bottom: 0.2rem;
  }
  .fig-title {
    font-size: 0.84rem;
    font-weight: 600;
    color: var(--ink);
    line-height: 1.4;
  }

  @media (max-width: 640px) {
    .diagram-grid { grid-template-columns: 1fr; }
    .chapter-nav-inner { max-width: 100%; }
  }
</style>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Important Diagrams ‚Äî CBSE Physics XII</title>
</head>
<body>

<!-- HERO -->
<header class="hero">
  <span class="badge">50 Diagrams &middot; 14 Chapters</span>
  <h1>Important Diagrams<br>CBSE Physics XII</h1>
  <p class="sub">Every standard diagram you need for board exams, organized chapter-wise with clear labels and annotations.</p>
  <div class="mode-toggle" id="modeToggle">
    <button id="btn2d" class="active">üìê 2D Static</button>
    <button id="btn3d">‚ú® 3D &amp; Animated</button>
  </div>
</header>

<!-- STICKY NAV -->
<nav class="chapter-nav" id="chapterNav">
<div class="chapter-nav-inner">
  <a href="#ch1" style="color:var(--ch1);border-color:var(--ch1-border);background:var(--ch1-bg)">Ch 1</a>
  <a href="#ch2" style="color:var(--ch2);border-color:var(--ch2-border);background:var(--ch2-bg)">Ch 2</a>
  <a href="#ch3" style="color:var(--ch3);border-color:var(--ch3-border);background:var(--ch3-bg)">Ch 3</a>
  <a href="#ch4" style="color:var(--ch4);border-color:var(--ch4-border);background:var(--ch4-bg)">Ch 4</a>
  <a href="#ch5" style="color:var(--ch5);border-color:var(--ch5-border);background:var(--ch5-bg)">Ch 5</a>
  <a href="#ch6" style="color:var(--ch6);border-color:var(--ch6-border);background:var(--ch6-bg)">Ch 6</a>
  <a href="#ch7" style="color:var(--ch7);border-color:var(--ch7-border);background:var(--ch7-bg)">Ch 7</a>
  <a href="#ch9" style="color:var(--ch9);border-color:var(--ch9-border);background:var(--ch9-bg)">Ch 9</a>
  <a href="#ch10" style="color:var(--ch10);border-color:var(--ch10-border);background:var(--ch10-bg)">Ch 10</a>
  <a href="#ch11" style="color:var(--ch11);border-color:var(--ch11-border);background:var(--ch11-bg)">Ch 11</a>
  <a href="#ch12" style="color:var(--ch12);border-color:var(--ch12-border);background:var(--ch12-bg)">Ch 12</a>
  <a href="#ch13" style="color:var(--ch13);border-color:var(--ch13-border);background:var(--ch13-bg)">Ch 13</a>
  <a href="#ch14" style="color:var(--ch14);border-color:var(--ch14-border);background:var(--ch14-bg)">Ch 14</a>
</div>
</nav>

<main class="container">

<!-- ============================================================ -->
<!-- CHAPTER 1: Electric Charges & Fields -->
<!-- ============================================================ -->
<section class="chapter-section" id="ch1">
<div class="chapter-header">
  <div class="chapter-num" style="background:var(--ch1)">1</div>
  <h2 class="chapter-title">Electric Charges &amp; Fields</h2>
</div>
<div class="diagram-grid">

<!-- Diagram 1: Electric field lines of positive point charge -->
<div class="diagram-card">
<div class="svg-wrap">
<svg viewBox="0 0 400 400" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <marker id="ar1" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto"><polygon points="0,0 8,3 0,6" fill="#2563eb"/></marker>
  </defs>
  <!-- Field lines radiating outward -->
  <g stroke="#2563eb" stroke-width="1.8" fill="none" marker-end="url(#ar1)">
    <line x1="200" y1="200" x2="200" y2="40"/>
    <line x1="200" y1="200" x2="313" y2="87"/>
    <line x1="200" y1="200" x2="360" y2="200"/>
    <line x1="200" y1="200" x2="313" y2="313"/>
    <line x1="200" y1="200" x2="200" y2="360"/>
    <line x1="200" y1="200" x2="87" y2="313"/>
    <line x1="200" y1="200" x2="40" y2="200"/>
    <line x1="200" y1="200" x2="87" y2="87"/>
    <!-- Intermediate lines -->
    <line x1="200" y1="200" x2="257" y2="57"/>
    <line x1="200" y1="200" x2="343" y2="143"/>
    <line x1="200" y1="200" x2="343" y2="257"/>
    <line x1="200" y1="200" x2="257" y2="343"/>
    <line x1="200" y1="200" x2="143" y2="343"/>
    <line x1="200" y1="200" x2="57" y2="257"/>
    <line x1="200" y1="200" x2="57" y2="143"/>
    <line x1="200" y1="200" x2="143" y2="57"/>
  </g>
  <!-- Charge -->
  <circle cx="200" cy="200" r="18" fill="#ef4444" stroke="#fff" stroke-width="2"/>
  <text x="200" y="206" text-anchor="middle" fill="#fff" font-size="16" font-weight="700">+q</text>
  <!-- Labels -->
  <text x="365" y="196" fill="#2563eb" font-size="11" font-weight="600">E</text>
  <text x="200" y="25" fill="#2563eb" font-size="11" font-weight="600" text-anchor="middle">E</text>
  <text x="200" y="388" fill="#64748b" font-size="11" text-anchor="middle" font-style="italic">Field lines radiate outward from +q</text>
</svg>
</div>
<div class="caption">
  <div class="fig-num" style="color:var(--ch1)">Fig 1.1 &middot; Chapter 1</div>
  <div class="fig-title">Electric field lines of a positive point charge</div>
</div>
</div>

<!-- Diagram 2: Electric field lines of a dipole -->
<div class="diagram-card">
<div class="svg-wrap">
<svg viewBox="0 0 480 360" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <marker id="ar2" markerWidth="7" markerHeight="5" refX="7" refY="2.5" orient="auto"><polygon points="0,0 7,2.5 0,5" fill="#2563eb"/></marker>
  </defs>
  <!-- Field lines from + to - -->
  <g stroke="#2563eb" stroke-width="1.5" fill="none" marker-end="url(#ar2)">
    <!-- Top curves -->
    <path d="M 310,180 C 310,100 380,60 380,60"/>
    <path d="M 170,180 C 170,100 100,60 100,60"/>
    <path d="M 310,180 C 310,80 240,30 170,80"/>
    <path d="M 310,180 Q 290,120 240,100 Q 190,80 170,140"/>
    <path d="M 310,180 C 330,130 330,60 240,30 C 150,0 120,70 170,130"/>
    <!-- Bottom curves (mirror) -->
    <path d="M 310,180 C 310,260 380,300 380,300"/>
    <path d="M 170,180 C 170,260 100,300 100,300"/>
    <path d="M 310,180 C 310,280 240,330 170,280"/>
    <path d="M 310,180 Q 290,240 240,260 Q 190,280 170,220"/>
    <path d="M 310,180 C 330,230 330,300 240,330 C 150,360 120,290 170,230"/>
    <!-- Direct line between charges -->
    <line x1="310" y1="180" x2="185" y2="180"/>
  </g>
  <!-- Positive charge -->
  <circle cx="310" cy="180" r="16" fill="#ef4444" stroke="#fff" stroke-width="2"/>
  <text x="310" y="186" text-anchor="middle" fill="#fff" font-size="15" font-weight="700">+</text>
  <!-- Negative charge -->
  <circle cx="170" cy="180" r="16" fill="#3b82f6" stroke="#fff" stroke-width="2"/>
  <text x="170" y="186" text-anchor="middle" fill="#fff" font-size="15" font-weight="700">&minus;</text>
  <!-- Dipole moment arrow -->
  <line x1="170" y1="345" x2="310" y2="345" stroke="#ef4444" stroke-width="2" marker-end="url(#ar2)"/>
  <text x="240" y="340" text-anchor="middle" fill="#ef4444" font-size="11" font-weight="600">p (dipole moment)</text>
  <text x="240" y="20" fill="#64748b" font-size="11" text-anchor="middle" font-style="italic">Field lines from + to &minus;</text>
</svg>
</div>
<div class="caption">
  <div class="fig-num" style="color:var(--ch1)">Fig 1.2 &middot; Chapter 1</div>
  <div class="fig-title">Electric field lines of a dipole</div>
</div>
</div>

<!-- Diagram 3: Uniform field between parallel plates -->
<div class="diagram-card">
<div class="svg-wrap">
<svg viewBox="0 0 440 300" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <marker id="ar3" markerWidth="7" markerHeight="5" refX="7" refY="2.5" orient="auto"><polygon points="0,0 7,2.5 0,5" fill="#2563eb"/></marker>
  </defs>
  <!-- Positive plate (left) -->
  <rect x="60" y="40" width="12" height="220" fill="#ef4444" rx="2"/>
  <text x="40" y="150" text-anchor="middle" fill="#ef4444" font-size="20" font-weight="700">+</text>
  <text x="40" y="100" text-anchor="middle" fill="#ef4444" font-size="20" font-weight="700">+</text>
  <text x="40" y="200" text-anchor="middle" fill="#ef4444" font-size="20" font-weight="700">+</text>
  <!-- Negative plate (right) -->
  <rect x="368" y="40" width="12" height="220" fill="#3b82f6" rx="2"/>
  <text x="400" y="150" text-anchor="middle" fill="#3b82f6" font-size="20" font-weight="700">&minus;</text>
  <text x="400" y="100" text-anchor="middle" fill="#3b82f6" font-size="20" font-weight="700">&minus;</text>
  <text x="400" y="200" text-anchor="middle" fill="#3b82f6" font-size="20" font-weight="700">&minus;</text>
  <!-- Uniform field lines -->
  <g stroke="#2563eb" stroke-width="1.5" marker-end="url(#ar3)">
    <line x1="85" y1="80" x2="355" y2="80"/>
    <line x1="85" y1="120" x2="355" y2="120"/>
    <line x1="85" y1="150" x2="355" y2="150"/>
    <line x1="85" y1="180" x2="355" y2="180"/>
    <line x1="85" y1="220" x2="355" y2="220"/>
  </g>
  <!-- Labels -->
  <text x="220" y="32" text-anchor="middle" fill="#2563eb" font-size="13" font-weight="600">E (uniform)</text>
  <text x="220" y="288" text-anchor="middle" fill="#64748b" font-size="11" font-style="italic">Uniform electric field between parallel plates</text>
  <!-- Sigma labels -->
  <text x="66" y="280" text-anchor="middle" fill="#ef4444" font-size="11">+&#963;</text>
  <text x="374" y="280" text-anchor="middle" fill="#3b82f6" font-size="11">&minus;&#963;</text>
</svg>
</div>
<div class="caption">
  <div class="fig-num" style="color:var(--ch1)">Fig 1.3 &middot; Chapter 1</div>
  <div class="fig-title">Uniform electric field between two parallel plates</div>
</div>
</div>

</div>
</section>

<!-- ============================================================ -->
<!-- CHAPTER 2: Electrostatic Potential & Capacitance -->
<!-- ============================================================ -->
<section class="chapter-section" id="ch2">
<div class="chapter-header">
  <div class="chapter-num" style="background:var(--ch2)">2</div>
  <h2 class="chapter-title">Electrostatic Potential &amp; Capacitance</h2>
</div>
<div class="diagram-grid">

<!-- Diagram 4: Equipotential surfaces -->
<div class="diagram-card">
<div class="svg-wrap">
<svg viewBox="0 0 400 400" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <marker id="ar4" markerWidth="7" markerHeight="5" refX="7" refY="2.5" orient="auto"><polygon points="0,0 7,2.5 0,5" fill="#7c3aed"/></marker>
  </defs>
  <!-- Equipotential circles (dashed) -->
  <circle cx="200" cy="200" r="40" fill="none" stroke="#7c3aed" stroke-width="1.5" stroke-dasharray="6,3"/>
  <circle cx="200" cy="200" r="80" fill="none" stroke="#7c3aed" stroke-width="1.5" stroke-dasharray="6,3"/>
  <circle cx="200" cy="200" r="120" fill="none" stroke="#7c3aed" stroke-width="1.5" stroke-dasharray="6,3"/>
  <circle cx="200" cy="200" r="160" fill="none" stroke="#7c3aed" stroke-width="1.5" stroke-dasharray="6,3"/>
  <!-- Electric field lines (radial, solid) -->
  <g stroke="#2563eb" stroke-width="1.2" marker-end="url(#ar4)">
    <line x1="200" y1="200" x2="200" y2="30"/>
    <line x1="200" y1="200" x2="370" y2="200"/>
    <line x1="200" y1="200" x2="200" y2="370"/>
    <line x1="200" y1="200" x2="30" y2="200"/>
    <line x1="200" y1="200" x2="320" y2="80"/>
    <line x1="200" y1="200" x2="80" y2="320"/>
    <line x1="200" y1="200" x2="320" y2="320"/>
    <line x1="200" y1="200" x2="80" y2="80"/>
  </g>
  <!-- Charge -->
  <circle cx="200" cy="200" r="14" fill="#ef4444" stroke="#fff" stroke-width="2"/>
  <text x="200" y="205" text-anchor="middle" fill="#fff" font-size="13" font-weight="700">+q</text>
  <!-- Voltage labels -->
  <text x="200" y="155" text-anchor="middle" fill="#7c3aed" font-size="10" font-weight="600">V&#8321;</text>
  <text x="200" y="115" text-anchor="middle" fill="#7c3aed" font-size="10" font-weight="600">V&#8322;</text>
  <text x="200" y="75" text-anchor="middle" fill="#7c3aed" font-size="10" font-weight="600">V&#8323;</text>
  <text x="180" y="390" fill="#64748b" font-size="10" font-style="italic">V&#8321; &gt; V&#8322; &gt; V&#8323; &gt; V&#8324;</text>
  <!-- Legend -->
  <line x1="280" y1="375" x2="310" y2="375" stroke="#7c3aed" stroke-width="1.5" stroke-dasharray="6,3"/>
  <text x="315" y="379" fill="#7c3aed" font-size="9">Equipotential</text>
  <line x1="280" y1="390" x2="310" y2="390" stroke="#2563eb" stroke-width="1.2"/>
  <text x="315" y="394" fill="#2563eb" font-size="9">Field lines</text>
</svg>
</div>
<div class="caption">
  <div class="fig-num" style="color:var(--ch2)">Fig 2.1 &middot; Chapter 2</div>
  <div class="fig-title">Equipotential surfaces for a point charge</div>
</div>
</div>

<!-- Diagram 5: Parallel plate capacitor with & without dielectric -->
<div class="diagram-card">
<div class="svg-wrap">
<svg viewBox="0 0 520 320" xmlns="http://www.w3.org/2000/svg">
  <!-- WITHOUT DIELECTRIC -->
  <text x="130" y="20" text-anchor="middle" fill="var(--ink)" font-size="12" font-weight="600">Without Dielectric</text>
  <!-- Plates -->
  <rect x="80" y="40" width="8" height="140" fill="#7c3aed" rx="1"/>
  <rect x="172" y="40" width="8" height="140" fill="#7c3aed" rx="1"/>
  <text x="70" y="115" text-anchor="end" fill="#ef4444" font-size="14" font-weight="700">+</text>
  <text x="195" y="115" fill="#3b82f6" font-size="14" font-weight="700">&minus;</text>
  <!-- Field lines -->
  <g stroke="#7c3aed" stroke-width="1" stroke-dasharray="4,2">
    <line x1="95" y1="70" x2="167" y2="70"/>
    <line x1="95" y1="100" x2="167" y2="100"/>
    <line x1="95" y1="130" x2="167" y2="130"/>
    <line x1="95" y1="160" x2="167" y2="160"/>
  </g>
  <text x="130" y="210" text-anchor="middle" fill="var(--ink-3)" font-size="10">C = &#949;&#8320;A/d</text>
  <!-- Wire and battery -->
  <line x1="84" y1="40" x2="84" y2="25" stroke="#555" stroke-width="1.5"/>
  <line x1="176" y1="40" x2="176" y2="25" stroke="#555" stroke-width="1.5"/>
  <text x="60" y="240" text-anchor="middle" fill="var(--ink-3)" font-size="10">d</text>
  <line x1="84" y1="225" x2="84" y2="235" stroke="#555" stroke-width="1"/>
  <line x1="176" y1="225" x2="176" y2="235" stroke="#555" stroke-width="1"/>
  <line x1="84" y1="230" x2="176" y2="230" stroke="#555" stroke-width="1" marker-start="url(#ar4)" marker-end="url(#ar4)"/>

  <!-- WITH DIELECTRIC -->
  <text x="390" y="20" text-anchor="middle" fill="var(--ink)" font-size="12" font-weight="600">With Dielectric</text>
  <rect x="340" y="40" width="8" height="140" fill="#7c3aed" rx="1"/>
  <rect x="432" y="40" width="8" height="140" fill="#7c3aed" rx="1"/>
  <text x="330" y="115" text-anchor="end" fill="#ef4444" font-size="14" font-weight="700">+</text>
  <text x="455" y="115" fill="#3b82f6" font-size="14" font-weight="700">&minus;</text>
  <!-- Dielectric slab -->
  <rect x="365" y="45" width="50" height="130" fill="#c4b5fd" fill-opacity="0.4" stroke="#7c3aed" stroke-width="1" stroke-dasharray="4,2" rx="3"/>
  <text x="390" y="115" text-anchor="middle" fill="#7c3aed" font-size="11" font-weight="600">K</text>
  <!-- Polarization charges -->
  <text x="368" y="75" fill="#3b82f6" font-size="9">&minus;</text>
  <text x="368" y="95" fill="#3b82f6" font-size="9">&minus;</text>
  <text x="368" y="135" fill="#3b82f6" font-size="9">&minus;</text>
  <text x="368" y="155" fill="#3b82f6" font-size="9">&minus;</text>
  <text x="408" y="75" fill="#ef4444" font-size="9">+</text>
  <text x="408" y="95" fill="#ef4444" font-size="9">+</text>
  <text x="408" y="135" fill="#ef4444" font-size="9">+</text>
  <text x="408" y="155" fill="#ef4444" font-size="9">+</text>
  <!-- Field lines through dielectric -->
  <g stroke="#7c3aed" stroke-width="1" stroke-dasharray="4,2">
    <line x1="355" y1="70" x2="427" y2="70"/>
    <line x1="355" y1="100" x2="427" y2="100"/>
    <line x1="355" y1="130" x2="427" y2="130"/>
    <line x1="355" y1="160" x2="427" y2="160"/>
  </g>
  <text x="390" y="210" text-anchor="middle" fill="var(--ink-3)" font-size="10">C' = K&#949;&#8320;A/d</text>
  <!-- Dielectric label -->
  <text x="390" y="250" text-anchor="middle" fill="#7c3aed" font-size="10" font-weight="500">Dielectric constant K</text>
  <text x="260" y="290" text-anchor="middle" fill="#64748b" font-size="11" font-style="italic">Capacitance increases by factor K with dielectric</text>
</svg>
</div>
<div class="caption">
  <div class="fig-num" style="color:var(--ch2)">Fig 2.2 &middot; Chapter 2</div>
  <div class="fig-title">Parallel plate capacitor with and without dielectric slab</div>
</div>
</div>

<!-- Diagram 6: Capacitors in series and parallel -->
<div class="diagram-card">
<div class="svg-wrap">
<svg viewBox="0 0 500 340" xmlns="http://www.w3.org/2000/svg">
  <!-- SERIES -->
  <text x="250" y="20" text-anchor="middle" fill="var(--ink)" font-size="13" font-weight="600">Capacitors in Series</text>
  <line x1="40" y1="70" x2="120" y2="70" stroke="#555" stroke-width="2"/>
  <!-- C1 -->
  <line x1="120" y1="40" x2="120" y2="100" stroke="#7c3aed" stroke-width="3"/>
  <line x1="135" y1="40" x2="135" y2="100" stroke="#7c3aed" stroke-width="3"/>
  <line x1="135" y1="70" x2="205" y2="70" stroke="#555" stroke-width="2"/>
  <text x="127" y="115" text-anchor="middle" fill="#7c3aed" font-size="11" font-weight="600">C&#8321;</text>
  <!-- C2 -->
  <line x1="205" y1="40" x2="205" y2="100" stroke="#7c3aed" stroke-width="3"/>
  <line x1="220" y1="40" x2="220" y2="100" stroke="#7c3aed" stroke-width="3"/>
  <line x1="220" y1="70" x2="290" y2="70" stroke="#555" stroke-width="2"/>
  <text x="212" y="115" text-anchor="middle" fill="#7c3aed" font-size="11" font-weight="600">C&#8322;</text>
  <!-- C3 -->
  <line x1="290" y1="40" x2="290" y2="100" stroke="#7c3aed" stroke-width="3"/>
  <line x1="305" y1="40" x2="305" y2="100" stroke="#7c3aed" stroke-width="3"/>
  <line x1="305" y1="70" x2="380" y2="70" stroke="#555" stroke-width="2"/>
  <text x="297" y="115" text-anchor="middle" fill="#7c3aed" font-size="11" font-weight="600">C&#8323;</text>
  <!-- Battery symbols at ends -->
  <text x="35" y="74" text-anchor="end" fill="#555" font-size="11">A</text>
  <text x="390" y="74" fill="#555" font-size="11">B</text>
  <!-- Formula -->
  <text x="210" y="140" text-anchor="middle" fill="var(--ink-2)" font-size="11">1/C = 1/C&#8321; + 1/C&#8322; + 1/C&#8323;</text>

  <!-- PARALLEL -->
  <text x="250" y="185" text-anchor="middle" fill="var(--ink)" font-size="13" font-weight="600">Capacitors in Parallel</text>
  <!-- Main bus lines -->
  <line x1="80" y1="220" x2="80" y2="320" stroke="#555" stroke-width="2"/>
  <line x1="420" y1="220" x2="420" y2="320" stroke="#555" stroke-width="2"/>
  <!-- C1 branch -->
  <line x1="80" y1="230" x2="220" y2="230" stroke="#555" stroke-width="1.5"/>
  <line x1="220" y1="215" x2="220" y2="245" stroke="#7c3aed" stroke-width="3"/>
  <line x1="235" y1="215" x2="235" y2="245" stroke="#7c3aed" stroke-width="3"/>
  <line x1="235" y1="230" x2="420" y2="230" stroke="#555" stroke-width="1.5"/>
  <text x="227" y="210" text-anchor="middle" fill="#7c3aed" font-size="11" font-weight="600">C&#8321;</text>
  <!-- C2 branch -->
  <line x1="80" y1="270" x2="220" y2="270" stroke="#555" stroke-width="1.5"/>
  <line x1="220" y1="255" x2="220" y2="285" stroke="#7c3aed" stroke-width="3"/>
  <line x1="235" y1="255" x2="235" y2="285" stroke="#7c3aed" stroke-width="3"/>
  <line x1="235" y1="270" x2="420" y2="270" stroke="#555" stroke-width="1.5"/>
  <text x="227" y="250" text-anchor="middle" fill="#7c3aed" font-size="11" font-weight="600">C&#8322;</text>
  <!-- C3 branch -->
  <line x1="80" y1="310" x2="220" y2="310" stroke="#555" stroke-width="1.5"/>
  <line x1="220" y1="295" x2="220" y2="325" stroke="#7c3aed" stroke-width="3"/>
  <line x1="235" y1="295" x2="235" y2="325" stroke="#7c3aed" stroke-width="3"/>
  <line x1="235" y1="310" x2="420" y2="310" stroke="#555" stroke-width="1.5"/>
  <text x="227" y="290" text-anchor="middle" fill="#7c3aed" font-size="11" font-weight="600">C&#8323;</text>
  <!-- Labels -->
  <text x="65" y="270" text-anchor="end" fill="#555" font-size="11">A</text>
  <text x="435" y="270" fill="#555" font-size="11">B</text>
  <text x="250" y="340" text-anchor="middle" fill="var(--ink-2)" font-size="11">C = C&#8321; + C&#8322; + C&#8323;</text>
</svg>
</div>
<div class="caption">
  <div class="fig-num" style="color:var(--ch2)">Fig 2.3 &middot; Chapter 2</div>
  <div class="fig-title">Capacitors in series and parallel combinations</div>
</div>
</div>

</div>
</section>

<!-- ============================================================ -->
<!-- CHAPTER 3: Current Electricity -->
<!-- ============================================================ -->
<section class="chapter-section" id="ch3">
<div class="chapter-header">
  <div class="chapter-num" style="background:var(--ch3)">3</div>
  <h2 class="chapter-title">Current Electricity</h2>
</div>
<div class="diagram-grid">

<!-- Diagram 7: Wheatstone Bridge -->
<div class="diagram-card">
<div class="svg-wrap">
<svg viewBox="0 0 400 400" xmlns="http://www.w3.org/2000/svg">
  <!-- Diamond shape -->
  <g stroke="#d97706" stroke-width="2" fill="none">
    <!-- Top-right arm P -->
    <line x1="200" y1="60" x2="330" y2="200"/>
    <!-- Top-left arm Q -->
    <line x1="200" y1="60" x2="70" y2="200"/>
    <!-- Bottom-right arm R -->
    <line x1="330" y1="200" x2="200" y2="340"/>
    <!-- Bottom-left arm S -->
    <line x1="70" y1="200" x2="200" y2="340"/>
  </g>
  <!-- Galvanometer (center) -->
  <line x1="70" y1="200" x2="330" y2="200" stroke="#d97706" stroke-width="1.5"/>
  <circle cx="200" cy="200" r="18" fill="#fffbeb" stroke="#d97706" stroke-width="2"/>
  <text x="200" y="206" text-anchor="middle" fill="#d97706" font-size="16" font-weight="700">G</text>
  <!-- Battery (top-bottom) -->
  <line x1="200" y1="340" x2="200" y2="370" stroke="#555" stroke-width="2"/>
  <line x1="190" y1="370" x2="210" y2="370" stroke="#555" stroke-width="3"/>
  <line x1="195" y1="378" x2="205" y2="378" stroke="#555" stroke-width="2"/>
  <line x1="200" y1="378" x2="200" y2="390" stroke="#555" stroke-width="2"/>
  <!-- Key / battery wire to top -->
  <line x1="200" y1="60" x2="200" y2="30" stroke="#555" stroke-width="2"/>
  <text x="200" y="22" text-anchor="middle" fill="#555" font-size="11">A</text>
  <text x="340" y="204" fill="#555" font-size="11">B</text>
  <text x="200" y="358" text-anchor="middle" fill="#555" font-size="11">C</text>
  <text x="55" y="204" text-anchor="end" fill="#555" font-size="11">D</text>
  <!-- Resistance labels -->
  <rect x="245" y="110" width="30" height="22" rx="4" fill="#fffbeb" stroke="#d97706" stroke-width="1"/>
  <text x="260" y="126" text-anchor="middle" fill="#d97706" font-size="13" font-weight="700">P</text>
  <rect x="110" y="110" width="30" height="22" rx="4" fill="#fffbeb" stroke="#d97706" stroke-width="1"/>
  <text x="125" y="126" text-anchor="middle" fill="#d97706" font-size="13" font-weight="700">Q</text>
  <rect x="245" y="260" width="30" height="22" rx="4" fill="#fffbeb" stroke="#d97706" stroke-width="1"/>
  <text x="260" y="276" text-anchor="middle" fill="#d97706" font-size="13" font-weight="700">R</text>
  <rect x="110" y="260" width="30" height="22" rx="4" fill="#fffbeb" stroke="#d97706" stroke-width="1"/>
  <text x="125" y="276" text-anchor="middle" fill="#d97706" font-size="13" font-weight="700">S</text>
  <!-- Balance condition -->
  <text x="200" y="395" text-anchor="middle" fill="var(--ink-2)" font-size="11" font-weight="500">Balance: P/Q = R/S</text>
</svg>
</div>
<div class="caption">
  <div class="fig-num" style="color:var(--ch3)">Fig 3.1 &middot; Chapter 3</div>
  <div class="fig-title">Wheatstone Bridge circuit diagram</div>
</div>
</div>

<!-- Diagram 8: Meter Bridge -->
<div class="diagram-card">
<div class="svg-wrap">
<svg viewBox="0 0 500 300" xmlns="http://www.w3.org/2000/svg">
  <!-- Wire AB -->
  <line x1="50" y1="200" x2="450" y2="200" stroke="#b45309" stroke-width="3"/>
  <text x="50" y="220" text-anchor="middle" fill="#555" font-size="12" font-weight="600">A</text>
  <text x="450" y="220" text-anchor="middle" fill="#555" font-size="12" font-weight="600">B</text>
  <!-- Scale -->
  <g stroke="#999" stroke-width="0.5">
    <line x1="50" y1="208" x2="50" y2="215"/>
    <line x1="130" y1="208" x2="130" y2="215"/>
    <line x1="210" y1="208" x2="210" y2="215"/>
    <line x1="290" y1="208" x2="290" y2="215"/>
    <line x1="370" y1="208" x2="370" y2="215"/>
    <line x1="450" y1="208" x2="450" y2="215"/>
  </g>
  <text x="50" y="230" text-anchor="middle" fill="#999" font-size="8">0</text>
  <text x="250" y="230" text-anchor="middle" fill="#999" font-size="8">50</text>
  <text x="450" y="230" text-anchor="middle" fill="#999" font-size="8">100</text>
  <!-- Unknown resistance R -->
  <line x1="50" y1="200" x2="50" y2="100" stroke="#555" stroke-width="1.5"/>
  <line x1="50" y1="100" x2="130" y2="100" stroke="#555" stroke-width="1.5"/>
  <rect x="70" y="86" width="60" height="28" rx="4" fill="#fffbeb" stroke="#d97706" stroke-width="1.5"/>
  <text x="100" y="105" text-anchor="middle" fill="#d97706" font-size="13" font-weight="700">R</text>
  <line x1="130" y1="100" x2="250" y2="100" stroke="#555" stroke-width="1.5"/>
  <!-- Known resistance S -->
  <line x1="450" y1="200" x2="450" y2="100" stroke="#555" stroke-width="1.5"/>
  <line x1="450" y1="100" x2="370" y2="100" stroke="#555" stroke-width="1.5"/>
  <rect x="370" y="86" width="60" height="28" rx="4" fill="#fffbeb" stroke="#d97706" stroke-width="1.5"/>
  <text x="400" y="105" text-anchor="middle" fill="#d97706" font-size="13" font-weight="700">S</text>
  <line x1="370" y1="100" x2="250" y2="100" stroke="#555" stroke-width="1.5"/>
  <!-- Galvanometer -->
  <circle cx="250" cy="100" r="14" fill="#fffbeb" stroke="#d97706" stroke-width="1.5"/>
  <text x="250" y="105" text-anchor="middle" fill="#d97706" font-size="12" font-weight="700">G</text>
  <!-- Jockey -->
  <line x1="250" y1="114" x2="280" y2="200" stroke="#555" stroke-width="1.5"/>
  <circle cx="280" cy="200" r="4" fill="#d97706"/>
  <text x="290" y="195" fill="#d97706" font-size="10" font-weight="600">J (Jockey)</text>
  <!-- Length labels -->
  <text x="165" y="250" text-anchor="middle" fill="#2563eb" font-size="11">l cm</text>
  <text x="365" y="250" text-anchor="middle" fill="#2563eb" font-size="11">(100 &minus; l) cm</text>
  <!-- Battery + Key -->
  <line x1="50" y1="200" x2="50" y2="260" stroke="#555" stroke-width="1.5"/>
  <line x1="50" y1="260" x2="450" y2="260" stroke="#555" stroke-width="1.5"/>
  <line x1="450" y1="260" x2="450" y2="200" stroke="#555" stroke-width="1.5"/>
  <!-- Battery -->
  <line x1="230" y1="255" x2="230" y2="265" stroke="#555" stroke-width="3"/>
  <line x1="238" y1="258" x2="238" y2="262" stroke="#555" stroke-width="2"/>
  <text x="234" y="278" text-anchor="middle" fill="#555" font-size="9">E</text>
  <!-- Formula -->
  <text x="250" y="295" text-anchor="middle" fill="var(--ink-2)" font-size="11">R/S = l/(100 &minus; l)</text>
</svg>
</div>
<div class="caption">
  <div class="fig-num" style="color:var(--ch3)">Fig 3.2 &middot; Chapter 3</div>
  <div class="fig-title">Meter Bridge (practical Wheatstone Bridge)</div>
</div>
</div>

<!-- Diagram 9: Potentiometer comparing EMFs -->
<div class="diagram-card">
<div class="svg-wrap">
<svg viewBox="0 0 500 280" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <marker id="ar9" markerWidth="6" markerHeight="4" refX="6" refY="2" orient="auto"><polygon points="0,0 6,2 0,4" fill="#555"/></marker>
  </defs>
  <!-- Potentiometer wire -->
  <line x1="40" y1="80" x2="460" y2="80" stroke="#b45309" stroke-width="3"/>
  <text x="40" y="70" text-anchor="middle" fill="#555" font-size="12" font-weight="600">A</text>
  <text x="460" y="70" text-anchor="middle" fill="#555" font-size="12" font-weight="600">B</text>
  <!-- Driver cell -->
  <line x1="40" y1="80" x2="40" y2="40" stroke="#555" stroke-width="1.5"/>
  <line x1="40" y1="40" x2="460" y2="40" stroke="#555" stroke-width="1.5"/>
  <line x1="460" y1="40" x2="460" y2="80" stroke="#555" stroke-width="1.5"/>
  <!-- Battery E -->
  <line x1="240" y1="35" x2="240" y2="45" stroke="#555" stroke-width="3"/>
  <line x1="248" y1="38" x2="248" y2="42" stroke="#555" stroke-width="1.5"/>
  <text x="244" y="28" text-anchor="middle" fill="#555" font-size="11" font-weight="600">E (Driver)</text>
  <!-- Rheostat symbol -->
  <rect x="140" y="34" width="30" height="12" rx="2" fill="none" stroke="#555" stroke-width="1.5"/>
  <text x="155" y="30" text-anchor="middle" fill="#555" font-size="9">Rh</text>
  <!-- Two-way key / DPDT switch -->
  <line x1="40" y1="80" x2="40" y2="160" stroke="#555" stroke-width="1.5"/>
  <!-- Cell E1 branch -->
  <line x1="40" y1="160" x2="120" y2="160" stroke="#555" stroke-width="1.5"/>
  <line x1="120" y1="155" x2="120" y2="165" stroke="#ef4444" stroke-width="3"/>
  <line x1="128" y1="158" x2="128" y2="162" stroke="#ef4444" stroke-width="1.5"/>
  <text x="124" y="148" text-anchor="middle" fill="#ef4444" font-size="11" font-weight="600">E&#8321;</text>
  <line x1="128" y1="160" x2="200" y2="160" stroke="#555" stroke-width="1.5"/>
  <!-- Cell E2 branch -->
  <line x1="40" y1="200" x2="120" y2="200" stroke="#555" stroke-width="1.5"/>
  <line x1="120" y1="195" x2="120" y2="205" stroke="#3b82f6" stroke-width="3"/>
  <line x1="128" y1="198" x2="128" y2="202" stroke="#3b82f6" stroke-width="1.5"/>
  <text x="124" y="188" text-anchor="middle" fill="#3b82f6" font-size="11" font-weight="600">E&#8322;</text>
  <line x1="128" y1="200" x2="200" y2="200" stroke="#555" stroke-width="1.5"/>
  <!-- Two-way key -->
  <rect x="195" y="148" width="50" height="64" rx="4" fill="#fffbeb" stroke="#d97706" stroke-width="1"/>
  <text x="220" y="184" text-anchor="middle" fill="#d97706" font-size="9" font-weight="600">Two-way Key</text>
  <!-- Galvanometer -->
  <line x1="245" y1="175" x2="310" y2="175" stroke="#555" stroke-width="1.5"/>
  <circle cx="330" cy="175" r="14" fill="#fffbeb" stroke="#d97706" stroke-width="1.5"/>
  <text x="330" y="180" text-anchor="middle" fill="#d97706" font-size="12" font-weight="700">G</text>
  <!-- Jockey line to wire -->
  <line x1="344" y1="175" x2="380" y2="175" stroke="#555" stroke-width="1.5"/>
  <line x1="380" y1="175" x2="380" y2="80" stroke="#555" stroke-width="1.5"/>
  <circle cx="380" cy="80" r="4" fill="#d97706"/>
  <text x="395" y="130" fill="#d97706" font-size="10">Jockey J</text>
  <!-- Null point lengths -->
  <text x="210" y="100" text-anchor="middle" fill="#ef4444" font-size="10">l&#8321;</text>
  <text x="230" y="100" text-anchor="middle" fill="#3b82f6" font-size="10">l&#8322;</text>
  <!-- Vertical connector -->
  <line x1="40" y1="160" x2="40" y2="200" stroke="#555" stroke-width="1.5"/>
  <!-- Formula -->
  <text x="250" y="250" text-anchor="middle" fill="var(--ink-2)" font-size="12" font-weight="500">E&#8321;/E&#8322; = l&#8321;/l&#8322;</text>
  <text x="250" y="270" text-anchor="middle" fill="#64748b" font-size="10" font-style="italic">Null point at l&#8321; for E&#8321;, at l&#8322; for E&#8322;</text>
</svg>
</div>
<div class="caption">
  <div class="fig-num" style="color:var(--ch3)">Fig 3.3 &middot; Chapter 3</div>
  <div class="fig-title">Potentiometer: comparing EMFs of two cells</div>
</div>
</div>

<!-- Diagram 10: V-I Characteristics -->
<div class="diagram-card">
<div class="svg-wrap">
<svg viewBox="0 0 440 320" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <marker id="arAxis" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto"><polygon points="0,0 8,3 0,6" fill="#555"/></marker>
  </defs>
  <!-- Axes -->
  <line x1="60" y1="270" x2="400" y2="270" stroke="#555" stroke-width="1.5" marker-end="url(#arAxis)"/>
  <line x1="60" y1="270" x2="60" y2="30" stroke="#555" stroke-width="1.5" marker-end="url(#arAxis)"/>
  <text x="410" y="275" fill="#555" font-size="12" font-weight="600">V</text>
  <text x="55" y="25" text-anchor="end" fill="#555" font-size="12" font-weight="600">I</text>
  <text x="55" y="278" fill="#555" font-size="10">O</text>
  <!-- Ohmic conductor (straight line) -->
  <line x1="60" y1="270" x2="340" y2="60" stroke="#d97706" stroke-width="2.5"/>
  <text x="280" y="80" fill="#d97706" font-size="11" font-weight="600">Ohmic (Resistor)</text>
  <text x="280" y="95" fill="#d97706" font-size="10">V = IR (linear)</text>
  <!-- Non-ohmic conductor (curved) -->
  <path d="M 60,270 Q 120,265 180,240 Q 280,180 350,50" fill="none" stroke="#2563eb" stroke-width="2.5"/>
  <text x="340" y="35" fill="#2563eb" font-size="11" font-weight="600">Non-ohmic</text>
  <text x="340" y="50" fill="#2563eb" font-size="10">(e.g., Filament)</text>
  <!-- Grid lines (light) -->
  <g stroke="#eee" stroke-width="0.5">
    <line x1="60" y1="210" x2="400" y2="210"/>
    <line x1="60" y1="150" x2="400" y2="150"/>
    <line x1="60" y1="90" x2="400" y2="90"/>
    <line x1="145" y1="270" x2="145" y2="30"/>
    <line x1="230" y1="270" x2="230" y2="30"/>
    <line x1="315" y1="270" x2="315" y2="30"/>
  </g>
  <text x="250" y="310" text-anchor="middle" fill="#64748b" font-size="11" font-style="italic">V-I characteristics: Ohmic vs Non-ohmic conductors</text>
</svg>
</div>
<div class="caption">
  <div class="fig-num" style="color:var(--ch3)">Fig 3.4 &middot; Chapter 3</div>
  <div class="fig-title">V-I characteristics of ohmic and non-ohmic conductors</div>
</div>
</div>

</div>
</section>

<!-- ============================================================ -->
<!-- CHAPTER 4: Moving Charges & Magnetism -->
<!-- ============================================================ -->
<section class="chapter-section" id="ch4">
<div class="chapter-header">
  <div class="chapter-num" style="background:var(--ch4)">4</div>
  <h2 class="chapter-title">Moving Charges &amp; Magnetism</h2>
</div>
<div class="diagram-grid">

<!-- Diagram 11: Magnetic field around straight current-carrying wire -->
<div class="diagram-card">
<div class="svg-wrap">
<svg viewBox="0 0 400 380" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <marker id="arM1" markerWidth="6" markerHeight="4" refX="6" refY="2" orient="auto"><polygon points="0,0 6,2 0,4" fill="#dc2626"/></marker>
  </defs>
  <!-- Wire (vertical, current upward) -->
  <line x1="200" y1="340" x2="200" y2="30" stroke="#555" stroke-width="4"/>
  <!-- Current direction arrow -->
  <polygon points="194,60 200,30 206,60" fill="#555"/>
  <text x="215" y="50" fill="#555" font-size="11" font-weight="600">I (upward)</text>
  <!-- Concentric circles (magnetic field) -->
  <circle cx="200" cy="190" r="50" fill="none" stroke="#dc2626" stroke-width="1.5"/>
  <circle cx="200" cy="190" r="90" fill="none" stroke="#dc2626" stroke-width="1.2"/>
  <circle cx="200" cy="190" r="130" fill="none" stroke="#dc2626" stroke-width="1"/>
  <!-- Direction arrows on circles (counterclockwise from front - right hand rule) -->
  <!-- Inner circle arrows -->
  <polygon points="250,188 248,180 256,184" fill="#dc2626"/>
  <polygon points="150,192 152,200 144,196" fill="#dc2626"/>
  <!-- Middle circle arrows -->
  <polygon points="290,188 288,180 296,184" fill="#dc2626"/>
  <polygon points="110,192 112,200 104,196" fill="#dc2626"/>
  <!-- Outer circle arrows -->
  <polygon points="330,188 328,180 336,184" fill="#dc2626"/>
  <polygon points="70,192 72,200 64,196" fill="#dc2626"/>
  <!-- B label -->
  <text x="260" y="148" fill="#dc2626" font-size="12" font-weight="600">B</text>
  <text x="300" y="148" fill="#dc2626" font-size="12" font-weight="600">B</text>
  <!-- Cross-section view (small inset) -->
  <rect x="10" y="290" width="90" height="80" rx="6" fill="#fef2f2" stroke="#dc2626" stroke-width="1"/>
  <text x="55" y="308" text-anchor="middle" fill="#dc2626" font-size="9" font-weight="600">Cross-section</text>
  <!-- Dot (current out) -->
  <circle cx="35" cy="340" r="10" fill="none" stroke="#555" stroke-width="1.5"/>
  <circle cx="35" cy="340" r="3" fill="#555"/>
  <text x="35" y="362" text-anchor="middle" fill="#555" font-size="8">Out (dot)</text>
  <!-- Cross (current in) -->
  <circle cx="75" cy="340" r="10" fill="none" stroke="#555" stroke-width="1.5"/>
  <line x1="68" y1="333" x2="82" y2="347" stroke="#555" stroke-width="1.5"/>
  <line x1="82" y1="333" x2="68" y2="347" stroke="#555" stroke-width="1.5"/>
  <text x="75" y="362" text-anchor="middle" fill="#555" font-size="8">In (cross)</text>
  <!-- Right hand rule note -->
  <text x="200" y="375" text-anchor="middle" fill="#64748b" font-size="10" font-style="italic">Right-hand thumb rule: Thumb along I, fingers curl along B</text>
</svg>
</div>
<div class="caption">
  <div class="fig-num" style="color:var(--ch4)">Fig 4.1 &middot; Chapter 4</div>
  <div class="fig-title">Magnetic field around a straight current-carrying conductor</div>
</div>
</div>

<!-- Diagram 12: Magnetic field of circular current loop -->
<div class="diagram-card">
<div class="svg-wrap">
<svg viewBox="0 0 460 340" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <marker id="arM2" markerWidth="6" markerHeight="4" refX="6" refY="2" orient="auto"><polygon points="0,0 6,2 0,4" fill="#dc2626"/></marker>
  </defs>
  <!-- Circular loop (as ellipse seen at angle) -->
  <ellipse cx="230" cy="170" rx="120" ry="50" fill="none" stroke="#d97706" stroke-width="3"/>
  <!-- Current direction (arrows on the loop) -->
  <polygon points="350,168 345,156 355,160" fill="#d97706"/>
  <polygon points="110,172 115,184 105,180" fill="#d97706"/>
  <text x="370" y="155" fill="#d97706" font-size="11" font-weight="600">I</text>
  <!-- Field lines through center and looping around -->
  <g stroke="#dc2626" stroke-width="1.3" fill="none">
    <!-- Central axis line -->
    <line x1="230" y1="170" x2="230" y2="20" stroke="#dc2626" stroke-width="1.5" marker-end="url(#arM2)"/>
    <line x1="230" y1="170" x2="230" y2="320" stroke="#dc2626" stroke-width="1" stroke-dasharray="4,3"/>
    <!-- Field lines curving outward -->
    <path d="M 230,120 C 280,100 340,80 360,120 C 380,160 340,200 280,210"/>
    <path d="M 230,120 C 180,100 120,80 100,120 C 80,160 120,200 180,210"/>
    <!-- Outer loops -->
    <path d="M 230,80 C 310,40 420,50 420,170 C 420,290 310,300 230,260"/>
    <path d="M 230,80 C 150,40 40,50 40,170 C 40,290 150,300 230,260"/>
  </g>
  <!-- B label at axis -->
  <text x="242" y="45" fill="#dc2626" font-size="13" font-weight="600">B</text>
  <!-- Axis label -->
  <text x="230" y="15" text-anchor="middle" fill="#dc2626" font-size="10">Axis of loop</text>
  <text x="230" y="335" text-anchor="middle" fill="#64748b" font-size="10" font-style="italic">Field resembles a magnetic dipole at large distances</text>
</svg>
</div>
<div class="caption">
  <div class="fig-num" style="color:var(--ch4)">Fig 4.2 &middot; Chapter 4</div>
  <div class="fig-title">Magnetic field of a circular current loop</div>
</div>
</div>

<!-- Diagram 13: Solenoid magnetic field lines -->
<div class="diagram-card">
<div class="svg-wrap">
<svg viewBox="0 0 500 320" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <marker id="arM3" markerWidth="6" markerHeight="4" refX="6" refY="2" orient="auto"><polygon points="0,0 6,2 0,4" fill="#dc2626"/></marker>
  </defs>
  <!-- Solenoid coil -->
  <rect x="120" y="100" width="260" height="120" rx="6" fill="none" stroke="#d97706" stroke-width="2.5"/>
  <!-- Turns -->
  <g stroke="#d97706" stroke-width="1.5">
    <line x1="155" y1="100" x2="155" y2="220"/>
    <line x1="190" y1="100" x2="190" y2="220"/>
    <line x1="225" y1="100" x2="225" y2="220"/>
    <line x1="260" y1="100" x2="260" y2="220"/>
    <line x1="295" y1="100" x2="295" y2="220"/>
    <line x1="330" y1="100" x2="330" y2="220"/>
    <line x1="365" y1="100" x2="365" y2="220"/>
  </g>
  <!-- Uniform field lines inside (left to right) -->
  <g stroke="#dc2626" stroke-width="1.5" marker-end="url(#arM3)">
    <line x1="130" y1="135" x2="370" y2="135"/>
    <line x1="130" y1="160" x2="370" y2="160"/>
    <line x1="130" y1="185" x2="370" y2="185"/>
  </g>
  <!-- External field lines (like bar magnet) -->
  <g stroke="#dc2626" stroke-width="1" fill="none">
    <path d="M 380,135 C 430,100 470,60 470,160 C 470,260 430,220 380,185" marker-end="url(#arM3)"/>
    <path d="M 120,185 C 70,220 30,260 30,160 C 30,60 70,100 120,135"/>
    <path d="M 380,120 C 450,50 490,30 490,160 C 490,290 450,270 380,200"/>
    <path d="M 120,200 C 50,270 10,290 10,160 C 10,30 50,50 120,120"/>
  </g>
  <!-- N and S labels -->
  <text x="395" y="165" fill="#dc2626" font-size="16" font-weight="700">N</text>
  <text x="95" y="165" text-anchor="end" fill="#3b82f6" font-size="16" font-weight="700">S</text>
  <!-- Current direction -->
  <text x="250" y="90" text-anchor="middle" fill="#d97706" font-size="10" font-weight="600">Current I in coil</text>
  <text x="250" y="250" text-anchor="middle" fill="#dc2626" font-size="11" font-weight="500">B = &#956;&#8320;nI (uniform inside)</text>
  <text x="250" y="310" text-anchor="middle" fill="#64748b" font-size="10" font-style="italic">Field is uniform inside, resembles bar magnet outside</text>
</svg>
</div>
<div class="caption">
  <div class="fig-num" style="color:var(--ch4)">Fig 4.3 &middot; Chapter 4</div>
  <div class="fig-title">Solenoid: uniform magnetic field inside</div>
</div>
</div>

<!-- Diagram 14: Moving Coil Galvanometer -->
<div class="diagram-card">
<div class="svg-wrap">
<svg viewBox="0 0 460 340" xmlns="http://www.w3.org/2000/svg">
  <!-- Permanent magnet poles -->
  <rect x="40" y="80" width="50" height="180" rx="4" fill="#fca5a5" stroke="#dc2626" stroke-width="1.5"/>
  <text x="65" y="175" text-anchor="middle" fill="#dc2626" font-size="16" font-weight="700">N</text>
  <rect x="370" y="80" width="50" height="180" rx="4" fill="#93c5fd" stroke="#3b82f6" stroke-width="1.5"/>
  <text x="395" y="175" text-anchor="middle" fill="#3b82f6" font-size="16" font-weight="700">S</text>
  <!-- Cylindrical soft iron core -->
  <rect x="190" y="110" width="80" height="120" rx="40" fill="#e5e7eb" stroke="#555" stroke-width="1.5"/>
  <text x="230" y="175" text-anchor="middle" fill="#555" font-size="9" font-weight="500">Iron Core</text>
  <!-- Coil (rectangular, around the core) -->
  <rect x="140" y="90" width="180" height="160" rx="4" fill="none" stroke="#d97706" stroke-width="2.5"/>
  <text x="130" y="175" text-anchor="end" fill="#d97706" font-size="10" font-weight="600">Coil</text>
  <!-- Spring (top) -->
  <path d="M 230,90 L 230,50 Q 235,55 240,45 Q 245,35 250,45 Q 255,55 260,50 L 260,30" fill="none" stroke="#059669" stroke-width="1.5"/>
  <text x="275" y="45" fill="#059669" font-size="10" font-weight="600">Spring</text>
  <!-- Pointer -->
  <line x1="230" y1="50" x2="230" y2="20" stroke="#555" stroke-width="2"/>
  <!-- Scale arc -->
  <path d="M 190,20 Q 230,5 270,20" fill="none" stroke="#555" stroke-width="1"/>
  <text x="230" y="14" text-anchor="middle" fill="#555" font-size="9">Scale</text>
  <!-- Terminal connections -->
  <line x1="140" y1="250" x2="140" y2="290" stroke="#555" stroke-width="1.5"/>
  <line x1="320" y1="250" x2="320" y2="290" stroke="#555" stroke-width="1.5"/>
  <text x="140" y="305" text-anchor="middle" fill="#555" font-size="10">T&#8321;</text>
  <text x="320" y="305" text-anchor="middle" fill="#555" font-size="10">T&#8322;</text>
  <!-- Radial magnetic field arrows -->
  <g stroke="#dc2626" stroke-width="1" stroke-dasharray="3,2">
    <line x1="90" y1="140" x2="140" y2="140"/>
    <line x1="90" y1="170" x2="140" y2="170"/>
    <line x1="90" y1="200" x2="140" y2="200"/>
    <line x1="320" y1="140" x2="370" y2="140"/>
    <line x1="320" y1="170" x2="370" y2="170"/>
    <line x1="320" y1="200" x2="370" y2="200"/>
  </g>
  <text x="230" y="330" text-anchor="middle" fill="var(--ink-2)" font-size="10">Torque: &#964; = NIAB; Deflection: &#952; = NIAB/k</text>
</svg>
</div>
<div class="caption">
  <div class="fig-num" style="color:var(--ch4)">Fig 4.4 &middot; Chapter 4</div>
  <div class="fig-title">Moving Coil Galvanometer (schematic)</div>
</div>
</div>

<!-- Diagram 15: Cyclotron -->
<div class="diagram-card">
<div class="svg-wrap">
<svg viewBox="0 0 460 400" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <marker id="arC" markerWidth="6" markerHeight="4" refX="6" refY="2" orient="auto"><polygon points="0,0 6,2 0,4" fill="#dc2626"/></marker>
  </defs>
  <!-- D1 (left half) -->
  <path d="M 230,100 A 130,130 0 0,0 230,360" fill="#fef2f2" stroke="#dc2626" stroke-width="2"/>
  <text x="140" y="240" text-anchor="middle" fill="#dc2626" font-size="16" font-weight="700">D&#8321;</text>
  <!-- D2 (right half) -->
  <path d="M 230,100 A 130,130 0 0,1 230,360" fill="#eff6ff" stroke="#3b82f6" stroke-width="2"/>
  <text x="320" y="240" text-anchor="middle" fill="#3b82f6" font-size="16" font-weight="700">D&#8322;</text>
  <!-- Gap between dees -->
  <rect x="226" y="100" width="8" height="260" fill="#fdfcfa"/>
  <!-- Spiral path of particle -->
  <g stroke="#d97706" stroke-width="1.5" fill="none">
    <path d="M 230,230 A 20,20 0 0,0 230,270"/>
    <path d="M 230,270 A 40,40 0 0,1 230,190"/>
    <path d="M 230,190 A 60,60 0 0,0 230,310"/>
    <path d="M 230,310 A 80,80 0 0,1 230,150"/>
    <path d="M 230,150 A 100,100 0 0,0 230,350"/>
    <path d="M 230,350 A 120,120 0 0,1 230,110"/>
  </g>
  <!-- Particle source at center -->
  <circle cx="230" cy="230" r="5" fill="#d97706"/>
  <text x="230" y="222" text-anchor="middle" fill="#d97706" font-size="9" font-weight="600">Source</text>
  <!-- Exit beam -->
  <line x1="230" y1="110" x2="280" y2="60" stroke="#d97706" stroke-width="2" marker-end="url(#arC)"/>
  <text x="290" y="55" fill="#d97706" font-size="10" font-weight="600">Exit beam</text>
  <!-- B field direction (into page) -->
  <text x="390" y="180" fill="#555" font-size="11" font-weight="600">B (into page)</text>
  <circle cx="400" cy="200" r="10" fill="none" stroke="#555" stroke-width="1.5"/>
  <line x1="393" y1="193" x2="407" y2="207" stroke="#555" stroke-width="1.5"/>
  <line x1="407" y1="193" x2="393" y2="207" stroke="#555" stroke-width="1.5"/>
  <!-- AC source between dees -->
  <text x="230" y="385" text-anchor="middle" fill="#555" font-size="10">Oscillating E field in gap</text>
  <!-- AC symbol -->
  <path d="M 210,375 Q 215,365 220,375 Q 225,385 230,375 Q 235,365 240,375 Q 245,385 250,375" fill="none" stroke="#555" stroke-width="1"/>
  <text x="230" y="398" text-anchor="middle" fill="var(--ink-2)" font-size="10">f = qB/(2&#960;m) (cyclotron frequency)</text>
</svg>
</div>
<div class="caption">
  <div class="fig-num" style="color:var(--ch4)">Fig 4.5 &middot; Chapter 4</div>
  <div class="fig-title">Cyclotron: D-shaped dees with spiral particle path</div>
</div>
</div>

</div>
</section>

<!-- ============================================================ -->
<!-- CHAPTER 5: Magnetism & Matter -->
<!-- ============================================================ -->
<section class="chapter-section" id="ch5">
<div class="chapter-header">
  <div class="chapter-num" style="background:var(--ch5)">5</div>
  <h2 class="chapter-title">Magnetism &amp; Matter</h2>
</div>
<div class="diagram-grid">

<!-- Diagram 16: Bar magnet field lines -->
<div class="diagram-card">
<div class="svg-wrap">
<svg viewBox="0 0 460 320" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <marker id="arMag" markerWidth="6" markerHeight="4" refX="6" refY="2" orient="auto"><polygon points="0,0 6,2 0,4" fill="#be123c"/></marker>
  </defs>
  <!-- Bar magnet -->
  <rect x="160" y="140" width="70" height="40" fill="#fca5a5" stroke="#be123c" stroke-width="1.5" rx="2"/>
  <text x="195" y="165" text-anchor="middle" fill="#be123c" font-size="14" font-weight="700">N</text>
  <rect x="230" y="140" width="70" height="40" fill="#bfdbfe" stroke="#3b82f6" stroke-width="1.5" rx="2"/>
  <text x="265" y="165" text-anchor="middle" fill="#3b82f6" font-size="14" font-weight="700">S</text>
  <!-- Field lines from N to S externally, S to N internally -->
  <g stroke="#be123c" stroke-width="1.3" fill="none" marker-end="url(#arMag)">
    <!-- Top curves -->
    <path d="M 195,140 C 195,90 265,90 265,140"/>
    <path d="M 195,140 C 195,60 265,60 265,140"/>
    <path d="M 195,140 C 190,20 270,20 265,140"/>
    <path d="M 180,140 C 160,-10 300,-10 280,140"/>
    <!-- Bottom curves -->
    <path d="M 195,180 C 195,230 265,230 265,180"/>
    <path d="M 195,180 C 195,260 265,260 265,180"/>
    <path d="M 195,180 C 190,300 270,300 265,180"/>
    <path d="M 180,180 C 160,330 300,330 280,180"/>
    <!-- Extended outer lines -->
    <path d="M 170,140 C 120,-30 340,-30 290,140"/>
    <path d="M 170,180 C 120,350 340,350 290,180"/>
    <!-- Lines going to far left/right -->
    <path d="M 160,160 C 60,160 40,40 230,10"/>
    <path d="M 160,160 C 60,160 40,280 230,310"/>
    <path d="M 300,160 C 400,160 420,40 230,10"/>
    <path d="M 300,160 C 400,160 420,280 230,310"/>
  </g>
  <!-- Internal field line (S to N inside magnet) -->
  <line x1="265" y1="160" x2="195" y2="160" stroke="#be123c" stroke-width="1" stroke-dasharray="3,2" marker-end="url(#arMag)"/>
  <text x="230" y="195" text-anchor="middle" fill="#64748b" font-size="8" font-style="italic">Inside: S to N</text>
</svg>
</div>
<div class="caption">
  <div class="fig-num" style="color:var(--ch5)">Fig 5.1 &middot; Chapter 5</div>
  <div class="fig-title">Bar magnet field lines (N to S externally)</div>
</div>
</div>

<!-- Diagram 17: Bar magnet vs solenoid comparison -->
<div class="diagram-card">
<div class="svg-wrap">
<svg viewBox="0 0 520 340" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <marker id="arComp" markerWidth="5" markerHeight="4" refX="5" refY="2" orient="auto"><polygon points="0,0 5,2 0,4" fill="#be123c"/></marker>
  </defs>
  <!-- LEFT: Bar Magnet -->
  <text x="130" y="20" text-anchor="middle" fill="var(--ink)" font-size="12" font-weight="600">Bar Magnet</text>
  <rect x="90" y="150" width="40" height="30" fill="#fca5a5" stroke="#be123c" stroke-width="1" rx="2"/>
  <text x="110" y="170" text-anchor="middle" fill="#be123c" font-size="11" font-weight="700">N</text>
  <rect x="130" y="150" width="40" height="30" fill="#bfdbfe" stroke="#3b82f6" stroke-width="1" rx="2"/>
  <text x="150" y="170" text-anchor="middle" fill="#3b82f6" font-size="11" font-weight="700">S</text>
  <g stroke="#be123c" stroke-width="1" fill="none" marker-end="url(#arComp)">
    <path d="M 110,150 C 110,110 150,110 150,150"/>
    <path d="M 110,150 C 100,70 160,70 150,150"/>
    <path d="M 100,150 C 70,30 190,30 160,150"/>
    <path d="M 110,180 C 110,220 150,220 150,180"/>
    <path d="M 110,180 C 100,260 160,260 150,180"/>
    <path d="M 100,180 C 70,300 190,300 160,180"/>
  </g>

  <!-- RIGHT: Solenoid -->
  <text x="390" y="20" text-anchor="middle" fill="var(--ink)" font-size="12" font-weight="600">Solenoid</text>
  <rect x="340" y="140" width="100" height="50" rx="4" fill="none" stroke="#d97706" stroke-width="2"/>
  <!-- Turns -->
  <g stroke="#d97706" stroke-width="1">
    <line x1="360" y1="140" x2="360" y2="190"/>
    <line x1="380" y1="140" x2="380" y2="190"/>
    <line x1="400" y1="140" x2="400" y2="190"/>
    <line x1="420" y1="140" x2="420" y2="190"/>
  </g>
  <!-- Field lines (same pattern as bar magnet) -->
  <g stroke="#be123c" stroke-width="1" fill="none" marker-end="url(#arComp)">
    <!-- Internal -->
    <line x1="345" y1="165" x2="430" y2="165"/>
    <!-- External -->
    <path d="M 440,155 C 460,110 460,70 390,50 C 320,30 310,80 340,140"/>
    <path d="M 440,175 C 460,220 460,260 390,280 C 320,300 310,250 340,190"/>
    <path d="M 445,150 C 480,80 480,20 390,10 C 300,-5 290,60 340,135"/>
    <path d="M 445,180 C 480,250 480,310 390,320 C 300,335 290,270 340,195"/>
  </g>
  <text x="450" y="165" fill="#be123c" font-size="10" font-weight="700">N</text>
  <text x="328" y="165" text-anchor="end" fill="#3b82f6" font-size="10" font-weight="700">S</text>

  <!-- Comparison note -->
  <text x="260" y="330" text-anchor="middle" fill="#64748b" font-size="10" font-style="italic">Identical external field patterns</text>
  <!-- VS divider -->
  <line x1="260" y1="40" x2="260" y2="300" stroke="#ddd" stroke-width="1" stroke-dasharray="4,3"/>
  <text x="260" y="170" text-anchor="middle" fill="#999" font-size="11" font-weight="600">vs</text>
</svg>
</div>
<div class="caption">
  <div class="fig-num" style="color:var(--ch5)">Fig 5.2 &middot; Chapter 5</div>
  <div class="fig-title">Bar magnet vs solenoid: field line comparison</div>
</div>
</div>

</div>
</section>

<!-- ============================================================ -->
<!-- CHAPTER 6: Electromagnetic Induction -->
<!-- ============================================================ -->
<section class="chapter-section" id="ch6">
<div class="chapter-header">
  <div class="chapter-num" style="background:var(--ch6)">6</div>
  <h2 class="chapter-title">Electromagnetic Induction</h2>
</div>
<div class="diagram-grid">

<!-- Diagram 18: AC Generator -->
<div class="diagram-card">
<div class="svg-wrap">
<svg viewBox="0 0 500 380" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <marker id="arG" markerWidth="6" markerHeight="4" refX="6" refY="2" orient="auto"><polygon points="0,0 6,2 0,4" fill="#059669"/></marker>
  </defs>
  <!-- Magnet poles -->
  <rect x="40" y="60" width="50" height="160" rx="4" fill="#fca5a5" stroke="#dc2626" stroke-width="1.5"/>
  <text x="65" y="145" text-anchor="middle" fill="#dc2626" font-size="16" font-weight="700">N</text>
  <rect x="350" y="60" width="50" height="160" rx="4" fill="#bfdbfe" stroke="#3b82f6" stroke-width="1.5"/>
  <text x="375" y="145" text-anchor="middle" fill="#3b82f6" font-size="16" font-weight="700">S</text>
  <!-- Rotating coil -->
  <rect x="140" y="80" width="160" height="120" rx="4" fill="none" stroke="#059669" stroke-width="2.5" transform="rotate(15,220,140)"/>
  <text x="220" y="145" text-anchor="middle" fill="#059669" font-size="11" font-weight="600">ABCD coil</text>
  <!-- Rotation arrow -->
  <path d="M 220,70 A 30,30 0 0,1 250,75" fill="none" stroke="#059669" stroke-width="1.5" marker-end="url(#arG)"/>
  <text x="245" y="62" fill="#059669" font-size="9">rotation</text>
  <!-- Axle -->
  <line x1="220" y1="200" x2="220" y2="260" stroke="#555" stroke-width="3"/>
  <!-- Slip rings -->
  <ellipse cx="205" cy="270" rx="12" ry="6" fill="none" stroke="#d97706" stroke-width="2"/>
  <ellipse cx="235" cy="270" rx="12" ry="6" fill="none" stroke="#d97706" stroke-width="2"/>
  <text x="220" y="262" text-anchor="middle" fill="#d97706" font-size="8" font-weight="600">Slip Rings</text>
  <!-- Brushes -->
  <rect x="188" y="280" width="10" height="20" fill="#555" rx="1"/>
  <rect x="242" y="280" width="10" height="20" fill="#555" rx="1"/>
  <text x="178" y="295" text-anchor="end" fill="#555" font-size="8">Brush</text>
  <text x="262" y="295" fill="#555" font-size="8">Brush</text>
  <!-- External circuit -->
  <line x1="193" y1="300" x2="193" y2="340" stroke="#555" stroke-width="1.5"/>
  <line x1="247" y1="300" x2="247" y2="340" stroke="#555" stroke-width="1.5"/>
  <line x1="193" y1="340" x2="210" y2="340" stroke="#555" stroke-width="1.5"/>
  <line x1="230" y1="340" x2="247" y2="340" stroke="#555" stroke-width="1.5"/>
  <!-- Load R -->
  <rect x="210" y="332" width="20" height="16" rx="3" fill="#f0fdf4" stroke="#059669" stroke-width="1.5"/>
  <text x="220" y="344" text-anchor="middle" fill="#059669" font-size="9" font-weight="600">R</text>
  <!-- B field arrows -->
  <g stroke="#dc2626" stroke-width="1" stroke-dasharray="4,2">
    <line x1="90" y1="100" x2="350" y2="100"/>
    <line x1="90" y1="140" x2="350" y2="140"/>
    <line x1="90" y1="180" x2="350" y2="180"/>
  </g>
  <text x="420" y="100" fill="#dc2626" font-size="9">B field</text>
  <!-- EMF equation -->
  <text x="220" y="370" text-anchor="middle" fill="var(--ink-2)" font-size="10">e = NBA&#969; sin(&#969;t) = e&#8320; sin(&#969;t)</text>
</svg>
</div>
<div class="caption">
  <div class="fig-num" style="color:var(--ch6)">Fig 6.1 &middot; Chapter 6</div>
  <div class="fig-title">AC Generator with slip rings and brushes</div>
</div>
</div>

<!-- Diagram 19: Transformer -->
<div class="diagram-card">
<div class="svg-wrap">
<svg viewBox="0 0 480 320" xmlns="http://www.w3.org/2000/svg">
  <!-- Iron core (E-shape, two vertical bars with connecting pieces) -->
  <rect x="100" y="40" width="20" height="240" rx="3" fill="#d1d5db" stroke="#555" stroke-width="1.5"/>
  <rect x="360" y="40" width="20" height="240" rx="3" fill="#d1d5db" stroke="#555" stroke-width="1.5"/>
  <rect x="100" y="40" width="280" height="20" rx="3" fill="#d1d5db" stroke="#555" stroke-width="1.5"/>
  <rect x="100" y="260" width="280" height="20" rx="3" fill="#d1d5db" stroke="#555" stroke-width="1.5"/>
  <text x="240" y="35" text-anchor="middle" fill="#555" font-size="10" font-weight="500">Laminated Iron Core</text>
  <!-- Primary coil (fewer turns - step up) -->
  <g stroke="#059669" stroke-width="2.5" fill="none">
    <path d="M 130,80 C 160,80 160,100 130,100"/>
    <path d="M 130,100 C 160,100 160,120 130,120"/>
    <path d="M 130,120 C 160,120 160,140 130,140"/>
    <path d="M 130,140 C 160,140 160,160 130,160"/>
    <path d="M 130,160 C 160,160 160,180 130,180"/>
  </g>
  <text x="155" y="135" fill="#059669" font-size="10" font-weight="600">N&#8346;</text>
  <!-- Secondary coil (more turns - step up) -->
  <g stroke="#dc2626" stroke-width="2.5" fill="none">
    <path d="M 350,75 C 320,75 320,90 350,90"/>
    <path d="M 350,90 C 320,90 320,105 350,105"/>
    <path d="M 350,105 C 320,105 320,120 350,120"/>
    <path d="M 350,120 C 320,120 320,135 350,135"/>
    <path d="M 350,135 C 320,135 320,150 350,150"/>
    <path d="M 350,150 C 320,150 320,165 350,165"/>
    <path d="M 350,165 C 320,165 320,180 350,180"/>
    <path d="M 350,180 C 320,180 320,195 350,195"/>
    <path d="M 350,195 C 320,195 320,210 350,210"/>
    <path d="M 350,210 C 320,210 320,225 350,225"/>
  </g>
  <text x="310" y="155" fill="#dc2626" font-size="10" font-weight="600">N&#8347;</text>
  <!-- AC source on primary -->
  <line x1="130" y1="80" x2="60" y2="80" stroke="#059669" stroke-width="1.5"/>
  <line x1="130" y1="180" x2="60" y2="180" stroke="#059669" stroke-width="1.5"/>
  <circle cx="60" cy="130" r="20" fill="#f0fdf4" stroke="#059669" stroke-width="1.5"/>
  <path d="M 50,130 Q 55,120 60,130 Q 65,140 70,130" fill="none" stroke="#059669" stroke-width="1.5"/>
  <line x1="60" y1="80" x2="60" y2="110" stroke="#059669" stroke-width="1.5"/>
  <line x1="60" y1="150" x2="60" y2="180" stroke="#059669" stroke-width="1.5"/>
  <text x="60" y="165" text-anchor="middle" fill="#059669" font-size="9">AC</text>
  <!-- Output on secondary -->
  <line x1="350" y1="75" x2="430" y2="75" stroke="#dc2626" stroke-width="1.5"/>
  <line x1="350" y1="225" x2="430" y2="225" stroke="#dc2626" stroke-width="1.5"/>
  <rect x="420" y="120" width="30" height="50" rx="4" fill="#fef2f2" stroke="#dc2626" stroke-width="1.5"/>
  <text x="435" y="150" text-anchor="middle" fill="#dc2626" font-size="10" font-weight="600">Load</text>
  <line x1="435" y1="75" x2="435" y2="120" stroke="#dc2626" stroke-width="1.5"/>
  <line x1="435" y1="170" x2="435" y2="225" stroke="#dc2626" stroke-width="1.5"/>
  <!-- Flux arrows in core -->
  <text x="240" y="165" text-anchor="middle" fill="#555" font-size="10">&#934; (flux)</text>
  <!-- Labels -->
  <text x="60" y="210" text-anchor="middle" fill="#059669" font-size="10" font-weight="600">Primary</text>
  <text x="435" y="245" text-anchor="middle" fill="#dc2626" font-size="10" font-weight="600">Secondary</text>
  <!-- Formula -->
  <text x="240" y="300" text-anchor="middle" fill="var(--ink-2)" font-size="11">V&#8347;/V&#8346; = N&#8347;/N&#8346;  (Step-up: N&#8347; &gt; N&#8346;)</text>
</svg>
</div>
<div class="caption">
  <div class="fig-num" style="color:var(--ch6)">Fig 6.2 &middot; Chapter 6</div>
  <div class="fig-title">Step-up Transformer: primary, iron core, secondary</div>
</div>
</div>

<!-- Diagram 20: Eddy Currents -->
<div class="diagram-card">
<div class="svg-wrap">
<svg viewBox="0 0 400 300" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <marker id="arEddy" markerWidth="5" markerHeight="4" refX="5" refY="2" orient="auto"><polygon points="0,0 5,2 0,4" fill="#059669"/></marker>
  </defs>
  <!-- Metal plate -->
  <rect x="80" y="80" width="240" height="180" rx="8" fill="#e5e7eb" stroke="#555" stroke-width="1.5"/>
  <text x="200" y="275" text-anchor="middle" fill="#555" font-size="11">Metal Conductor Plate</text>
  <!-- Magnetic field entering (crosses - into page) -->
  <g fill="#dc2626" font-size="14">
    <text x="120" y="115" text-anchor="middle">&times;</text>
    <text x="200" y="115" text-anchor="middle">&times;</text>
    <text x="280" y="115" text-anchor="middle">&times;</text>
    <text x="120" y="155" text-anchor="middle">&times;</text>
    <text x="200" y="155" text-anchor="middle">&times;</text>
    <text x="280" y="155" text-anchor="middle">&times;</text>
    <text x="120" y="195" text-anchor="middle">&times;</text>
    <text x="200" y="195" text-anchor="middle">&times;</text>
    <text x="280" y="195" text-anchor="middle">&times;</text>
  </g>
  <text x="330" y="105" fill="#dc2626" font-size="10" font-weight="600">B (into page)</text>
  <!-- Eddy current loops (swirling) -->
  <g stroke="#059669" stroke-width="1.8" fill="none">
    <ellipse cx="160" cy="155" rx="35" ry="25"/>
    <ellipse cx="245" cy="155" rx="35" ry="25"/>
    <ellipse cx="200" cy="210" rx="35" ry="20"/>
  </g>
  <!-- Direction arrows on eddies -->
  <polygon points="195,133 191,127 199,127" fill="#059669"/>
  <polygon points="280,153 276,147 284,147" fill="#059669"/>
  <polygon points="235,192 231,186 239,186" fill="#059669"/>
  <!-- Labels -->
  <text x="160" y="160" text-anchor="middle" fill="#059669" font-size="9" font-weight="600">Eddy</text>
  <text x="245" y="160" text-anchor="middle" fill="#059669" font-size="9" font-weight="600">Eddy</text>
  <!-- Title -->
  <text x="200" y="60" text-anchor="middle" fill="#059669" font-size="12" font-weight="600">Changing B induces swirling eddy currents</text>
  <text x="200" y="295" text-anchor="middle" fill="#64748b" font-size="10" font-style="italic">Eddy currents oppose change in flux (Lenz's Law)</text>
</svg>
</div>
<div class="caption">
  <div class="fig-num" style="color:var(--ch6)">Fig 6.3 &middot; Chapter 6</div>
  <div class="fig-title">Eddy currents in a metal conductor</div>
</div>
</div>

</div>
</section>

<!-- ============================================================ -->
<!-- CHAPTER 7: Alternating Current -->
<!-- ============================================================ -->
<section class="chapter-section" id="ch7">
<div class="chapter-header">
  <div class="chapter-num" style="background:var(--ch7)">7</div>
  <h2 class="chapter-title">Alternating Current</h2>
</div>
<div class="diagram-grid">

<!-- Diagram 21: LCR Series Circuit -->
<div class="diagram-card">
<div class="svg-wrap">
<svg viewBox="0 0 460 280" xmlns="http://www.w3.org/2000/svg">
  <!-- Circuit loop -->
  <!-- Top wire -->
  <line x1="60" y1="60" x2="400" y2="60" stroke="#555" stroke-width="2"/>
  <!-- Right wire -->
  <line x1="400" y1="60" x2="400" y2="220" stroke="#555" stroke-width="2"/>
  <!-- Bottom wire -->
  <line x1="60" y1="220" x2="400" y2="220" stroke="#555" stroke-width="2"/>
  <!-- Left wire -->
  <line x1="60" y1="60" x2="60" y2="220" stroke="#555" stroke-width="2"/>
  <!-- Resistor R -->
  <rect x="120" y="48" width="60" height="24" rx="4" fill="#ecfeff" stroke="#0891b2" stroke-width="2"/>
  <text x="150" y="65" text-anchor="middle" fill="#0891b2" font-size="13" font-weight="700">R</text>
  <!-- Inductor L -->
  <g transform="translate(230,60)">
    <path d="M 0,0 C 10,-15 20,-15 20,0 C 20,-15 30,-15 30,0 C 30,-15 40,-15 40,0 C 40,-15 50,-15 50,0" fill="none" stroke="#0891b2" stroke-width="2"/>
  </g>
  <text x="255" y="48" text-anchor="middle" fill="#0891b2" font-size="13" font-weight="700">L</text>
  <!-- Capacitor C -->
  <line x1="340" y1="48" x2="340" y2="72" stroke="#0891b2" stroke-width="3"/>
  <line x1="355" y1="48" x2="355" y2="72" stroke="#0891b2" stroke-width="3"/>
  <text x="347" y="42" text-anchor="middle" fill="#0891b2" font-size="13" font-weight="700">C</text>
  <!-- AC Source -->
  <circle cx="60" cy="140" r="22" fill="#ecfeff" stroke="#0891b2" stroke-width="2"/>
  <path d="M 48,140 Q 54,128 60,140 Q 66,152 72,140" fill="none" stroke="#0891b2" stroke-width="2"/>
  <text x="30" y="145" text-anchor="end" fill="#0891b2" font-size="11" font-weight="600">V~</text>
  <!-- Current direction -->
  <polygon points="230,55 240,50 240,60" fill="#555"/>
  <text x="235" y="80" text-anchor="middle" fill="#555" font-size="10">I</text>
  <!-- Labels -->
  <text x="230" y="240" text-anchor="middle" fill="var(--ink-2)" font-size="10">V = V&#8320; sin(&#969;t)</text>
  <text x="230" y="260" text-anchor="middle" fill="var(--ink-2)" font-size="10">Z = &#8730;[R&#178; + (X&#8343; &minus; X&#8318;)&#178;]</text>
</svg>
</div>
<div class="caption">
  <div class="fig-num" style="color:var(--ch7)">Fig 7.1 &middot; Chapter 7</div>
  <div class="fig-title">LCR Series Circuit with AC source</div>
</div>
</div>

<!-- Diagram 22: Phasor diagram for series LCR -->
<div class="diagram-card">
<div class="svg-wrap">
<svg viewBox="0 0 400 380" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <marker id="arPh" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto"><polygon points="0,0 8,3 0,6" fill="#0891b2"/></marker>
    <marker id="arPhR" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto"><polygon points="0,0 8,3 0,6" fill="#d97706"/></marker>
    <marker id="arPhL" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto"><polygon points="0,0 8,3 0,6" fill="#dc2626"/></marker>
    <marker id="arPhC" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto"><polygon points="0,0 8,3 0,6" fill="#3b82f6"/></marker>
    <marker id="arPhV" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto"><polygon points="0,0 8,3 0,6" fill="#059669"/></marker>
  </defs>
  <!-- Origin -->
  <circle cx="100" cy="220" r="3" fill="#555"/>
  <text x="90" y="235" fill="#555" font-size="10">O</text>
  <!-- VR along current (horizontal) -->
  <line x1="100" y1="220" x2="280" y2="220" stroke="#d97706" stroke-width="2.5" marker-end="url(#arPhR)"/>
  <text x="285" y="218" fill="#d97706" font-size="12" font-weight="600">V&#7448; = IR</text>
  <!-- Current reference -->
  <text x="195" y="240" text-anchor="middle" fill="#555" font-size="10" font-style="italic">I (reference)</text>
  <!-- VL leading 90 degrees (upward) -->
  <line x1="100" y1="220" x2="100" y2="80" stroke="#dc2626" stroke-width="2.5" marker-end="url(#arPhL)"/>
  <text x="80" y="70" fill="#dc2626" font-size="12" font-weight="600">V&#7463;</text>
  <text x="115" y="80" fill="#dc2626" font-size="10">= IX&#7463;</text>
  <!-- VC lagging 90 degrees (downward) -->
  <line x1="100" y1="220" x2="100" y2="320" stroke="#3b82f6" stroke-width="2.5" marker-end="url(#arPhC)"/>
  <text x="75" y="335" fill="#3b82f6" font-size="12" font-weight="600">V&#7428;</text>
  <text x="115" y="330" fill="#3b82f6" font-size="10">= IX&#7428;</text>
  <!-- VL - VC (net reactive, upward assuming XL > XC) -->
  <line x1="280" y1="220" x2="280" y2="130" stroke="#8b5cf6" stroke-width="1.5" stroke-dasharray="5,3"/>
  <text x="300" y="175" fill="#8b5cf6" font-size="10">V&#7463;&minus;V&#7428;</text>
  <!-- Resultant V -->
  <line x1="100" y1="220" x2="280" y2="130" stroke="#059669" stroke-width="3" marker-end="url(#arPhV)"/>
  <text x="290" y="125" fill="#059669" font-size="13" font-weight="700">V</text>
  <!-- Phase angle -->
  <path d="M 140,220 A 40,40 0 0,1 130,200" fill="none" stroke="#059669" stroke-width="1.5"/>
  <text x="148" y="205" fill="#059669" font-size="11" font-weight="600">&#966;</text>
  <!-- Notes -->
  <text x="200" y="365" text-anchor="middle" fill="var(--ink-2)" font-size="10">tan &#966; = (X&#7463; &minus; X&#7428;)/R</text>
  <text x="200" y="380" text-anchor="middle" fill="#64748b" font-size="9" font-style="italic">Shown: X&#7463; &gt; X&#7428; (inductive circuit, V leads I)</text>
</svg>
</div>
<div class="caption">
  <div class="fig-num" style="color:var(--ch7)">Fig 7.2 &middot; Chapter 7</div>
  <div class="fig-title">Phasor diagram for series LCR circuit</div>
</div>
</div>

<!-- Diagram 23: Resonance curve -->
<div class="diagram-card">
<div class="svg-wrap">
<svg viewBox="0 0 440 300" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <marker id="arAx2" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto"><polygon points="0,0 8,3 0,6" fill="#555"/></marker>
  </defs>
  <!-- Axes -->
  <line x1="60" y1="250" x2="400" y2="250" stroke="#555" stroke-width="1.5" marker-end="url(#arAx2)"/>
  <line x1="60" y1="250" x2="60" y2="30" stroke="#555" stroke-width="1.5" marker-end="url(#arAx2)"/>
  <text x="410" y="260" fill="#555" font-size="11" font-weight="600">&#969; (frequency)</text>
  <text x="50" y="25" text-anchor="end" fill="#555" font-size="11" font-weight="600">I</text>
  <text x="52" y="258" fill="#555" font-size="10">O</text>
  <!-- Sharp resonance curve (low R) -->
  <path d="M 70,245 Q 100,240 140,230 Q 180,200 200,100 Q 210,40 220,40 Q 230,40 240,100 Q 260,200 300,230 Q 340,245 400,248" fill="none" stroke="#0891b2" stroke-width="2.5"/>
  <!-- Broader resonance curve (high R) -->
  <path d="M 70,240 Q 120,230 160,210 Q 190,180 210,130 Q 220,100 220,100 Q 230,130 250,180 Q 280,210 320,230 Q 360,240 400,244" fill="none" stroke="#0891b2" stroke-width="1.5" stroke-dasharray="6,3"/>
  <!-- Resonant frequency marker -->
  <line x1="220" y1="250" x2="220" y2="35" stroke="#dc2626" stroke-width="1" stroke-dasharray="3,3"/>
  <text x="220" y="270" text-anchor="middle" fill="#dc2626" font-size="11" font-weight="600">&#969;&#8320;</text>
  <text x="220" y="285" text-anchor="middle" fill="#dc2626" font-size="9">= 1/&#8730;LC</text>
  <!-- I_max marker -->
  <line x1="55" y1="40" x2="225" y2="40" stroke="#999" stroke-width="0.5" stroke-dasharray="3,3"/>
  <text x="50" y="44" text-anchor="end" fill="#0891b2" font-size="10">I&#8344;&#8345;&#8339;</text>
  <!-- Legend -->
  <line x1="300" y1="60" x2="340" y2="60" stroke="#0891b2" stroke-width="2.5"/>
  <text x="345" y="64" fill="#0891b2" font-size="9">Low R (sharp)</text>
  <line x1="300" y1="78" x2="340" y2="78" stroke="#0891b2" stroke-width="1.5" stroke-dasharray="6,3"/>
  <text x="345" y="82" fill="#0891b2" font-size="9">High R (broad)</text>
</svg>
</div>
<div class="caption">
  <div class="fig-num" style="color:var(--ch7)">Fig 7.3 &middot; Chapter 7</div>
  <div class="fig-title">Resonance curve: current vs frequency in LCR circuit</div>
</div>
</div>

<!-- Diagram 24: Power factor diagram -->
<div class="diagram-card">
<div class="svg-wrap">
<svg viewBox="0 0 400 300" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <marker id="arPow" markerWidth="7" markerHeight="5" refX="7" refY="2.5" orient="auto"><polygon points="0,0 7,2.5 0,5" fill="#0891b2"/></marker>
    <marker id="arPowG" markerWidth="7" markerHeight="5" refX="7" refY="2.5" orient="auto"><polygon points="0,0 7,2.5 0,5" fill="#059669"/></marker>
  </defs>
  <!-- V vector -->
  <line x1="80" y1="200" x2="320" y2="80" stroke="#0891b2" stroke-width="2.5" marker-end="url(#arPow)"/>
  <text x="330" y="80" fill="#0891b2" font-size="13" font-weight="700">V</text>
  <!-- I vector (along horizontal) -->
  <line x1="80" y1="200" x2="340" y2="200" stroke="#059669" stroke-width="2.5" marker-end="url(#arPowG)"/>
  <text x="350" y="202" fill="#059669" font-size="13" font-weight="700">I</text>
  <!-- Phase angle phi -->
  <path d="M 140,200 A 60,60 0 0,1 126,175" fill="none" stroke="#d97706" stroke-width="2"/>
  <text x="150" y="182" fill="#d97706" font-size="14" font-weight="700">&#966;</text>
  <!-- V cos phi projection -->
  <line x1="320" y1="80" x2="320" y2="200" stroke="#999" stroke-width="1" stroke-dasharray="4,3"/>
  <line x1="80" y1="200" x2="320" y2="200" stroke="#d97706" stroke-width="1.5" stroke-dasharray="4,3"/>
  <text x="200" y="218" text-anchor="middle" fill="#d97706" font-size="10">V cos&#966;</text>
  <!-- V sin phi -->
  <text x="335" y="145" fill="#999" font-size="10">V sin&#966;</text>
  <!-- Formulas -->
  <text x="200" y="255" text-anchor="middle" fill="var(--ink-2)" font-size="11">Power Factor = cos &#966; = R/Z</text>
  <text x="200" y="275" text-anchor="middle" fill="var(--ink-2)" font-size="11">P = V&#7522;&#7523;&#7524;&#7525; I&#7522;&#7523;&#7524;&#7525; cos &#966;</text>
  <text x="200" y="295" text-anchor="middle" fill="#64748b" font-size="9" font-style="italic">At resonance: &#966; = 0, cos&#966; = 1, P is maximum</text>
</svg>
</div>
<div class="caption">
  <div class="fig-num" style="color:var(--ch7)">Fig 7.4 &middot; Chapter 7</div>
  <div class="fig-title">Power factor: phase angle between V and I</div>
</div>
</div>

</div>
</section>

<!-- ============================================================ -->
<!-- CHAPTER 9: Ray Optics -->
<!-- ============================================================ -->
<section class="chapter-section" id="ch9">
<div class="chapter-header">
  <div class="chapter-num" style="background:var(--ch9)">9</div>
  <h2 class="chapter-title">Ray Optics &amp; Optical Instruments</h2>
</div>
<div class="diagram-grid">

<!-- Diagram 25: Concave mirror image formation -->
<div class="diagram-card">
<div class="svg-wrap">
<svg viewBox="0 0 500 300" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <marker id="arO1" markerWidth="6" markerHeight="4" refX="6" refY="2" orient="auto"><polygon points="0,0 6,2 0,4" fill="#16a34a"/></marker>
    <marker id="arO1r" markerWidth="6" markerHeight="4" refX="6" refY="2" orient="auto"><polygon points="0,0 6,2 0,4" fill="#dc2626"/></marker>
  </defs>
  <!-- Principal axis -->
  <line x1="20" y1="150" x2="480" y2="150" stroke="#555" stroke-width="1"/>
  <!-- Mirror (concave arc on right) -->
  <path d="M 420,60 Q 450,150 420,240" fill="none" stroke="#16a34a" stroke-width="3"/>
  <!-- F, C, P labels -->
  <circle cx="420" cy="150" r="3" fill="#555"/>
  <text x="420" y="168" text-anchor="middle" fill="#555" font-size="10" font-weight="600">P</text>
  <circle cx="350" cy="150" r="3" fill="#16a34a"/>
  <text x="350" y="168" text-anchor="middle" fill="#16a34a" font-size="10" font-weight="600">F</text>
  <circle cx="280" cy="150" r="3" fill="#16a34a"/>
  <text x="280" y="168" text-anchor="middle" fill="#16a34a" font-size="10" font-weight="600">C</text>
  <!-- Object (beyond C) -->
  <line x1="160" y1="150" x2="160" y2="80" stroke="#2563eb" stroke-width="2.5"/>
  <polygon points="155,82 160,68 165,82" fill="#2563eb"/>
  <text x="160" y="175" text-anchor="middle" fill="#2563eb" font-size="10" font-weight="600">Object</text>
  <!-- Ray 1: parallel to axis, reflects through F -->
  <line x1="160" y1="80" x2="420" y2="80" stroke="#16a34a" stroke-width="1.5" marker-end="url(#arO1)"/>
  <line x1="420" y1="80" x2="310" y2="150" stroke="#dc2626" stroke-width="1.5" stroke-dasharray="1,0" marker-end="url(#arO1r)"/>
  <line x1="310" y1="150" x2="270" y2="175" stroke="#dc2626" stroke-width="1" stroke-dasharray="4,2"/>
  <!-- Ray 2: through C, reflects back -->
  <line x1="160" y1="80" x2="425" y2="195" stroke="#16a34a" stroke-width="1.5"/>
  <line x1="425" y1="195" x2="310" y2="150" stroke="#dc2626" stroke-width="1.5"/>
  <!-- Image (between F and C, inverted) -->
  <line x1="310" y1="150" x2="310" y2="180" stroke="#ef4444" stroke-width="2.5"/>
  <polygon points="305,178 310,192 315,178" fill="#ef4444"/>
  <text x="310" y="205" text-anchor="middle" fill="#ef4444" font-size="10" font-weight="600">Image</text>
  <text x="310" y="218" text-anchor="middle" fill="#ef4444" font-size="8">(real, inverted, diminished)</text>
  <text x="250" y="285" text-anchor="middle" fill="#64748b" font-size="10" font-style="italic">Object beyond C: image between F and C</text>
</svg>
</div>
<div class="caption">
  <div class="fig-num" style="color:var(--ch9)">Fig 9.1 &middot; Chapter 9</div>
  <div class="fig-title">Concave mirror: image formation (object beyond C)</div>
</div>
</div>

<!-- Diagram 26: Convex lens ray diagram -->
<div class="diagram-card">
<div class="svg-wrap">
<svg viewBox="0 0 500 300" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <marker id="arL1" markerWidth="6" markerHeight="4" refX="6" refY="2" orient="auto"><polygon points="0,0 6,2 0,4" fill="#16a34a"/></marker>
    <marker id="arL1r" markerWidth="6" markerHeight="4" refX="6" refY="2" orient="auto"><polygon points="0,0 6,2 0,4" fill="#dc2626"/></marker>
  </defs>
  <!-- Principal axis -->
  <line x1="20" y1="150" x2="480" y2="150" stroke="#555" stroke-width="1"/>
  <!-- Convex lens (double convex shape at center) -->
  <ellipse cx="250" cy="150" rx="8" ry="90" fill="rgba(22,163,106,0.1)" stroke="#16a34a" stroke-width="2.5"/>
  <!-- F1, F2, 2F1, 2F2 -->
  <circle cx="180" cy="150" r="3" fill="#16a34a"/>
  <text x="180" y="168" text-anchor="middle" fill="#16a34a" font-size="9" font-weight="600">F&#8321;</text>
  <circle cx="320" cy="150" r="3" fill="#16a34a"/>
  <text x="320" y="168" text-anchor="middle" fill="#16a34a" font-size="9" font-weight="600">F&#8322;</text>
  <circle cx="110" cy="150" r="3" fill="#16a34a"/>
  <text x="110" y="168" text-anchor="middle" fill="#16a34a" font-size="9" font-weight="600">2F&#8321;</text>
  <circle cx="390" cy="150" r="3" fill="#16a34a"/>
  <text x="390" y="168" text-anchor="middle" fill="#16a34a" font-size="9" font-weight="600">2F&#8322;</text>
  <text x="250" y="168" text-anchor="middle" fill="#555" font-size="9">O</text>
  <!-- Object (beyond 2F1) -->
  <line x1="80" y1="150" x2="80" y2="80" stroke="#2563eb" stroke-width="2.5"/>
  <polygon points="75,82 80,68 85,82" fill="#2563eb"/>
  <text x="80" y="178" text-anchor="middle" fill="#2563eb" font-size="10" font-weight="600">Object</text>
  <!-- Ray 1: parallel to axis, refracts through F2 -->
  <line x1="80" y1="80" x2="250" y2="80" stroke="#16a34a" stroke-width="1.5"/>
  <line x1="250" y1="80" x2="370" y2="150" stroke="#dc2626" stroke-width="1.5"/>
  <line x1="370" y1="150" x2="430" y2="185" stroke="#dc2626" stroke-width="1" stroke-dasharray="4,2"/>
  <!-- Ray 2: through optical center -->
  <line x1="80" y1="80" x2="370" y2="185" stroke="#16a34a" stroke-width="1.5"/>
  <!-- Ray 3: through F1, emerges parallel -->
  <line x1="80" y1="80" x2="250" y2="128" stroke="#16a34a" stroke-width="1.2" stroke-dasharray="5,2"/>
  <line x1="250" y1="128" x2="430" y2="128" stroke="#dc2626" stroke-width="1.2" stroke-dasharray="5,2"/>
  <!-- Image -->
  <line x1="370" y1="150" x2="370" y2="185" stroke="#ef4444" stroke-width="2.5"/>
  <polygon points="365,183 370,197 375,183" fill="#ef4444"/>
  <text x="370" y="210" text-anchor="middle" fill="#ef4444" font-size="10" font-weight="600">Image</text>
  <text x="370" y="223" text-anchor="middle" fill="#ef4444" font-size="8">(real, inverted, diminished)</text>
  <text x="250" y="285" text-anchor="middle" fill="#64748b" font-size="10" font-style="italic">Object beyond 2F: image between F and 2F</text>
</svg>
</div>
<div class="caption">
  <div class="fig-num" style="color:var(--ch9)">Fig 9.2 &middot; Chapter 9</div>
  <div class="fig-title">Convex lens: ray diagram (three standard rays)</div>
</div>
</div>

<!-- Diagram 27: Refraction through prism -->
<div class="diagram-card">
<div class="svg-wrap">
<svg viewBox="0 0 460 340" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <marker id="arPr" markerWidth="6" markerHeight="4" refX="6" refY="2" orient="auto"><polygon points="0,0 6,2 0,4" fill="#16a34a"/></marker>
  </defs>
  <!-- Prism triangle -->
  <polygon points="230,40 100,280 360,280" fill="rgba(22,163,106,0.08)" stroke="#16a34a" stroke-width="2.5"/>
  <!-- Angle A at top -->
  <path d="M 215,75 L 230,40 L 245,75" fill="none" stroke="#d97706" stroke-width="1.5"/>
  <text x="230" y="68" text-anchor="middle" fill="#d97706" font-size="12" font-weight="700">A</text>
  <!-- Normal at first surface -->
  <line x1="155" y1="100" x2="195" y2="260" stroke="#999" stroke-width="1" stroke-dasharray="3,3"/>
  <text x="148" y="100" text-anchor="end" fill="#999" font-size="9">Normal</text>
  <!-- Normal at second surface -->
  <line x1="345" y1="110" x2="275" y2="255" stroke="#999" stroke-width="1" stroke-dasharray="3,3"/>
  <!-- Incident ray -->
  <line x1="40" y1="120" x2="165" y2="180" stroke="#16a34a" stroke-width="2" marker-end="url(#arPr)"/>
  <text x="60" y="115" fill="#16a34a" font-size="10" font-weight="600">Incident ray</text>
  <!-- Refracted ray inside prism -->
  <line x1="165" y1="180" x2="300" y2="210" stroke="#16a34a" stroke-width="2"/>
  <!-- Emergent ray -->
  <line x1="300" y1="210" x2="430" y2="140" stroke="#16a34a" stroke-width="2" marker-end="url(#arPr)"/>
  <text x="400" y="130" fill="#16a34a" font-size="10" font-weight="600">Emergent ray</text>
  <!-- Angle of incidence i -->
  <path d="M 130,145 A 30,30 0 0,1 150,165" fill="none" stroke="#2563eb" stroke-width="1.5"/>
  <text x="122" y="155" fill="#2563eb" font-size="11" font-weight="600">i</text>
  <!-- Angle of emergence e -->
  <path d="M 330,175 A 30,30 0 0,0 315,195" fill="none" stroke="#2563eb" stroke-width="1.5"/>
  <text x="340" y="185" fill="#2563eb" font-size="11" font-weight="600">e</text>
  <!-- Angle r1 -->
  <path d="M 175,200 A 15,15 0 0,0 178,185" fill="none" stroke="#8b5cf6" stroke-width="1"/>
  <text x="188" y="198" fill="#8b5cf6" font-size="9">r&#8321;</text>
  <!-- Angle r2 -->
  <path d="M 290,220 A 15,15 0 0,1 295,207" fill="none" stroke="#8b5cf6" stroke-width="1"/>
  <text x="278" y="222" fill="#8b5cf6" font-size="9">r&#8322;</text>
  <!-- Deviation angle delta -->
  <!-- Extend incident and emergent rays to show deviation -->
  <line x1="165" y1="180" x2="350" y2="255" stroke="#999" stroke-width="1" stroke-dasharray="3,3"/>
  <line x1="300" y1="210" x2="160" y2="250" stroke="#999" stroke-width="1" stroke-dasharray="3,3"/>
  <path d="M 370,230 A 50,50 0 0,0 400,170" fill="none" stroke="#dc2626" stroke-width="2"/>
  <text x="405" y="205" fill="#dc2626" font-size="13" font-weight="700">&#948;</text>
  <text x="230" y="315" text-anchor="middle" fill="var(--ink-2)" font-size="10">&#948; = (i + e) &minus; A</text>
  <text x="230" y="333" text-anchor="middle" fill="var(--ink-2)" font-size="10">A = r&#8321; + r&#8322;</text>
</svg>
</div>
<div class="caption">
  <div class="fig-num" style="color:var(--ch9)">Fig 9.3 &middot; Chapter 9</div>
  <div class="fig-title">Refraction through a prism showing angle of deviation</div>
</div>
</div>

<!-- Diagram 28: Total Internal Reflection -->
<div class="diagram-card">
<div class="svg-wrap">
<svg viewBox="0 0 460 300" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <marker id="arTIR" markerWidth="6" markerHeight="4" refX="6" refY="2" orient="auto"><polygon points="0,0 6,2 0,4" fill="#16a34a"/></marker>
  </defs>
  <!-- Interface -->
  <line x1="30" y1="150" x2="430" y2="150" stroke="#555" stroke-width="2"/>
  <text x="440" y="140" fill="#555" font-size="9">Rarer medium</text>
  <text x="440" y="165" fill="#555" font-size="9">Denser medium</text>
  <!-- Normal -->
  <line x1="230" y1="30" x2="230" y2="280" stroke="#999" stroke-width="1" stroke-dasharray="3,3"/>
  <text x="235" y="28" fill="#999" font-size="9">Normal</text>
  <!-- Ray 1: small angle, refraction -->
  <line x1="170" y1="270" x2="230" y2="150" stroke="#16a34a" stroke-width="1.5" marker-end="url(#arTIR)"/>
  <line x1="230" y1="150" x2="270" y2="60" stroke="#16a34a" stroke-width="1.5" marker-end="url(#arTIR)"/>
  <text x="160" y="270" fill="#16a34a" font-size="9">i &lt; i&#7580;</text>
  <!-- Ray 2: critical angle -->
  <line x1="120" y1="250" x2="230" y2="150" stroke="#d97706" stroke-width="2"/>
  <line x1="230" y1="150" x2="400" y2="150" stroke="#d97706" stroke-width="2" marker-end="url(#arTIR)"/>
  <text x="95" y="255" fill="#d97706" font-size="9" font-weight="600">i = i&#7580;</text>
  <text x="350" y="140" fill="#d97706" font-size="9" font-weight="600">r = 90&#176;</text>
  <!-- Ray 3: TIR -->
  <line x1="80" y1="230" x2="230" y2="150" stroke="#dc2626" stroke-width="2"/>
  <line x1="230" y1="150" x2="380" y2="230" stroke="#dc2626" stroke-width="2" marker-end="url(#arTIR)"/>
  <text x="55" y="230" fill="#dc2626" font-size="9" font-weight="600">i &gt; i&#7580;</text>
  <text x="390" y="225" fill="#dc2626" font-size="9" font-weight="600">TIR</text>
  <!-- Critical angle label -->
  <path d="M 220,180 A 25,25 0 0,0 207,170" fill="none" stroke="#d97706" stroke-width="1.5"/>
  <text x="195" y="185" fill="#d97706" font-size="10" font-weight="600">i&#7580;</text>
  <!-- Formula -->
  <text x="230" y="295" text-anchor="middle" fill="var(--ink-2)" font-size="10">sin i&#7580; = n&#8322;/n&#8321; (n&#8321; &gt; n&#8322;)</text>
</svg>
</div>
<div class="caption">
  <div class="fig-num" style="color:var(--ch9)">Fig 9.4 &middot; Chapter 9</div>
  <div class="fig-title">Total Internal Reflection at critical angle</div>
</div>
</div>

<!-- Diagram 29: Compound Microscope -->
<div class="diagram-card">
<div class="svg-wrap">
<svg viewBox="0 0 520 300" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <marker id="arMic" markerWidth="5" markerHeight="4" refX="5" refY="2" orient="auto"><polygon points="0,0 5,2 0,4" fill="#16a34a"/></marker>
  </defs>
  <!-- Principal axis -->
  <line x1="10" y1="150" x2="510" y2="150" stroke="#555" stroke-width="0.8"/>
  <!-- Objective lens -->
  <ellipse cx="140" cy="150" rx="5" ry="55" fill="rgba(22,163,106,0.1)" stroke="#16a34a" stroke-width="2"/>
  <text x="140" y="215" text-anchor="middle" fill="#16a34a" font-size="9" font-weight="600">Objective</text>
  <text x="140" y="227" text-anchor="middle" fill="#16a34a" font-size="8">(f&#8338; small)</text>
  <!-- Eyepiece lens -->
  <ellipse cx="400" cy="150" rx="5" ry="55" fill="rgba(22,163,106,0.1)" stroke="#16a34a" stroke-width="2"/>
  <text x="400" y="215" text-anchor="middle" fill="#16a34a" font-size="9" font-weight="600">Eyepiece</text>
  <text x="400" y="227" text-anchor="middle" fill="#16a34a" font-size="8">(f&#8337; larger)</text>
  <!-- Object (small, just outside f_o) -->
  <line x1="80" y1="150" x2="80" y2="130" stroke="#2563eb" stroke-width="2.5"/>
  <polygon points="76,132 80,122 84,132" fill="#2563eb"/>
  <text x="80" y="168" text-anchor="middle" fill="#2563eb" font-size="8" font-weight="600">Object</text>
  <!-- F_o -->
  <circle cx="110" cy="150" r="2" fill="#16a34a"/>
  <text x="110" y="170" text-anchor="middle" fill="#16a34a" font-size="7">f&#8338;</text>
  <!-- Intermediate image (real, inverted, magnified) -->
  <line x1="310" y1="150" x2="310" y2="195" stroke="#ef4444" stroke-width="2"/>
  <polygon points="306,193 310,205 314,193" fill="#ef4444"/>
  <text x="310" y="245" text-anchor="middle" fill="#ef4444" font-size="8">Intermediate image</text>
  <text x="310" y="255" text-anchor="middle" fill="#ef4444" font-size="7">(real, inverted)</text>
  <!-- Rays through objective -->
  <line x1="80" y1="130" x2="140" y2="130" stroke="#16a34a" stroke-width="1"/>
  <line x1="140" y1="130" x2="310" y2="195" stroke="#16a34a" stroke-width="1"/>
  <line x1="80" y1="130" x2="140" y2="150" stroke="#16a34a" stroke-width="1"/>
  <line x1="140" y1="150" x2="310" y2="195" stroke="#16a34a" stroke-width="1" stroke-dasharray="3,2"/>
  <!-- F_e -->
  <circle cx="360" cy="150" r="2" fill="#16a34a"/>
  <text x="360" y="170" text-anchor="middle" fill="#16a34a" font-size="7">f&#8337;</text>
  <!-- Rays through eyepiece (diverging, virtual image) -->
  <line x1="310" y1="195" x2="400" y2="195" stroke="#dc2626" stroke-width="1"/>
  <line x1="400" y1="195" x2="500" y2="250" stroke="#dc2626" stroke-width="1" stroke-dasharray="4,2"/>
  <line x1="310" y1="195" x2="400" y2="150" stroke="#dc2626" stroke-width="1"/>
  <line x1="400" y1="150" x2="490" y2="100" stroke="#dc2626" stroke-width="1" stroke-dasharray="4,2"/>
  <!-- Eye -->
  <text x="500" y="155" fill="#555" font-size="10">Eye</text>
  <!-- Formula -->
  <text x="260" y="285" text-anchor="middle" fill="var(--ink-2)" font-size="9">M = m&#8338; &#215; m&#8337; = (L/f&#8338;)(1 + D/f&#8337;)</text>
</svg>
</div>
<div class="caption">
  <div class="fig-num" style="color:var(--ch9)">Fig 9.5 &middot; Chapter 9</div>
  <div class="fig-title">Compound Microscope: objective, eyepiece, image formation</div>
</div>
</div>

<!-- Diagram 30: Astronomical Telescope -->
<div class="diagram-card">
<div class="svg-wrap">
<svg viewBox="0 0 520 280" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <marker id="arTel" markerWidth="5" markerHeight="4" refX="5" refY="2" orient="auto"><polygon points="0,0 5,2 0,4" fill="#16a34a"/></marker>
  </defs>
  <!-- Principal axis -->
  <line x1="10" y1="140" x2="510" y2="140" stroke="#555" stroke-width="0.8"/>
  <!-- Objective lens (large) -->
  <ellipse cx="120" cy="140" rx="6" ry="75" fill="rgba(22,163,106,0.1)" stroke="#16a34a" stroke-width="2.5"/>
  <text x="120" y="225" text-anchor="middle" fill="#16a34a" font-size="9" font-weight="600">Objective</text>
  <text x="120" y="237" text-anchor="middle" fill="#16a34a" font-size="8">(f&#8338; large)</text>
  <!-- Eyepiece lens (small) -->
  <ellipse cx="380" cy="140" rx="4" ry="45" fill="rgba(22,163,106,0.1)" stroke="#16a34a" stroke-width="2"/>
  <text x="380" y="200" text-anchor="middle" fill="#16a34a" font-size="9" font-weight="600">Eyepiece</text>
  <text x="380" y="212" text-anchor="middle" fill="#16a34a" font-size="8">(f&#8337; small)</text>
  <!-- Parallel rays from distant object (slight angle) -->
  <line x1="10" y1="100" x2="120" y2="110" stroke="#16a34a" stroke-width="1.2" marker-end="url(#arTel)"/>
  <line x1="10" y1="80" x2="120" y2="90" stroke="#16a34a" stroke-width="1.2" marker-end="url(#arTel)"/>
  <text x="40" y="72" fill="#16a34a" font-size="9">From distant object</text>
  <!-- Rays converge at common focus -->
  <line x1="120" y1="110" x2="340" y2="165" stroke="#16a34a" stroke-width="1"/>
  <line x1="120" y1="90" x2="340" y2="165" stroke="#16a34a" stroke-width="1"/>
  <!-- Image at F_o = F_e (normal adjustment) -->
  <line x1="340" y1="140" x2="340" y2="165" stroke="#ef4444" stroke-width="2"/>
  <text x="340" y="178" text-anchor="middle" fill="#ef4444" font-size="8">Image at</text>
  <text x="340" y="188" text-anchor="middle" fill="#ef4444" font-size="8">F&#8338; = F&#8337;</text>
  <!-- Rays through eyepiece emerge parallel -->
  <line x1="340" y1="165" x2="380" y2="165" stroke="#dc2626" stroke-width="1"/>
  <line x1="380" y1="165" x2="490" y2="200" stroke="#dc2626" stroke-width="1"/>
  <line x1="340" y1="165" x2="380" y2="140" stroke="#dc2626" stroke-width="1"/>
  <line x1="380" y1="140" x2="490" y2="140" stroke="#dc2626" stroke-width="1"/>
  <!-- Eye -->
  <text x="498" y="170" fill="#555" font-size="10">Eye</text>
  <!-- f_o and f_e distances -->
  <line x1="120" y1="250" x2="340" y2="250" stroke="#555" stroke-width="1"/>
  <text x="230" y="262" text-anchor="middle" fill="#555" font-size="9">f&#8338;</text>
  <line x1="340" y1="250" x2="380" y2="250" stroke="#555" stroke-width="1"/>
  <text x="360" y="262" text-anchor="middle" fill="#555" font-size="9">f&#8337;</text>
  <!-- Formula -->
  <text x="260" y="278" text-anchor="middle" fill="var(--ink-2)" font-size="10">M = f&#8338;/f&#8337;, Length L = f&#8338; + f&#8337;</text>
</svg>
</div>
<div class="caption">
  <div class="fig-num" style="color:var(--ch9)">Fig 9.6 &middot; Chapter 9</div>
  <div class="fig-title">Astronomical Telescope in normal adjustment</div>
</div>
</div>

<!-- Diagram 31: Refraction at spherical surface -->
<div class="diagram-card">
<div class="svg-wrap">
<svg viewBox="0 0 480 280" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <marker id="arSph" markerWidth="5" markerHeight="4" refX="5" refY="2" orient="auto"><polygon points="0,0 5,2 0,4" fill="#16a34a"/></marker>
  </defs>
  <!-- Principal axis -->
  <line x1="20" y1="140" x2="460" y2="140" stroke="#555" stroke-width="1"/>
  <!-- Spherical surface (convex, curve) -->
  <path d="M 240,40 Q 280,140 240,240" fill="none" stroke="#16a34a" stroke-width="2.5"/>
  <!-- Medium labels -->
  <rect x="60" y="50" width="60" height="24" rx="4" fill="#f0fdf4" stroke="#16a34a" stroke-width="1"/>
  <text x="90" y="66" text-anchor="middle" fill="#16a34a" font-size="10" font-weight="600">n&#8321;</text>
  <rect x="360" y="50" width="60" height="24" rx="4" fill="#eff6ff" stroke="#2563eb" stroke-width="1"/>
  <text x="390" y="66" text-anchor="middle" fill="#2563eb" font-size="10" font-weight="600">n&#8322;</text>
  <!-- Object point -->
  <circle cx="80" cy="140" r="4" fill="#2563eb"/>
  <text x="80" y="160" text-anchor="middle" fill="#2563eb" font-size="10" font-weight="600">O</text>
  <!-- Centre of curvature -->
  <circle cx="330" cy="140" r="3" fill="#555"/>
  <text x="330" y="160" text-anchor="middle" fill="#555" font-size="10">C</text>
  <!-- Pole -->
  <circle cx="250" cy="140" r="3" fill="#16a34a"/>
  <text x="250" y="160" text-anchor="middle" fill="#16a34a" font-size="10">P</text>
  <!-- Image point -->
  <circle cx="400" cy="140" r="4" fill="#ef4444"/>
  <text x="400" y="160" text-anchor="middle" fill="#ef4444" font-size="10" font-weight="600">I</text>
  <!-- Incident ray (to surface) -->
  <line x1="80" y1="140" x2="248" y2="100" stroke="#16a34a" stroke-width="1.5" marker-end="url(#arSph)"/>
  <!-- Refracted ray -->
  <line x1="248" y1="100" x2="400" y2="140" stroke="#dc2626" stroke-width="1.5" marker-end="url(#arSph)"/>
  <!-- Axial ray -->
  <line x1="80" y1="140" x2="400" y2="140" stroke="#16a34a" stroke-width="1" stroke-dasharray="4,2"/>
  <!-- Normal at point of incidence (from C) -->
  <line x1="248" y1="100" x2="330" y2="140" stroke="#999" stroke-width="0.8" stroke-dasharray="3,2"/>
  <!-- Angles -->
  <text x="220" y="108" fill="#2563eb" font-size="9">i</text>
  <text x="270" y="108" fill="#dc2626" font-size="9">r</text>
  <!-- Distances -->
  <text x="165" y="185" text-anchor="middle" fill="#2563eb" font-size="9">u</text>
  <text x="325" y="185" text-anchor="middle" fill="#ef4444" font-size="9">v</text>
  <text x="290" y="185" text-anchor="middle" fill="#555" font-size="9">R</text>
  <!-- Formula -->
  <text x="240" y="240" text-anchor="middle" fill="var(--ink-2)" font-size="11">n&#8322;/v &minus; n&#8321;/u = (n&#8322; &minus; n&#8321;)/R</text>
</svg>
</div>
<div class="caption">
  <div class="fig-num" style="color:var(--ch9)">Fig 9.7 &middot; Chapter 9</div>
  <div class="fig-title">Refraction at a convex spherical surface</div>
</div>
</div>

</div>
</section>

<!-- ============================================================ -->
<!-- CHAPTER 10: Wave Optics -->
<!-- ============================================================ -->
<section class="chapter-section" id="ch10">
<div class="chapter-header">
  <div class="chapter-num" style="background:var(--ch10)">10</div>
  <h2 class="chapter-title">Wave Optics</h2>
</div>
<div class="diagram-grid">

<!-- Diagram 32: Young's Double Slit -->
<div class="diagram-card">
<div class="svg-wrap">
<svg viewBox="0 0 500 320" xmlns="http://www.w3.org/2000/svg">
  <!-- Source slit S -->
  <rect x="40" y="100" width="6" height="120" fill="#555"/>
  <rect x="40" y="155" width="6" height="10" fill="#fdfcfa"/>
  <text x="43" y="90" text-anchor="middle" fill="#555" font-size="10" font-weight="600">S</text>
  <!-- Light from source -->
  <line x1="46" y1="160" x2="140" y2="140" stroke="#8b5cf6" stroke-width="1" stroke-dasharray="3,2"/>
  <line x1="46" y1="160" x2="140" y2="180" stroke="#8b5cf6" stroke-width="1" stroke-dasharray="3,2"/>
  <!-- Double slit barrier -->
  <rect x="140" y="60" width="6" height="75" fill="#555"/>
  <rect x="140" y="145" width="6" height="30" fill="#555"/>
  <rect x="140" y="185" width="6" height="75" fill="#555"/>
  <!-- Slits S1, S2 -->
  <text x="155" y="142" fill="#8b5cf6" font-size="10" font-weight="600">S&#8321;</text>
  <text x="155" y="182" fill="#8b5cf6" font-size="10" font-weight="600">S&#8322;</text>
  <!-- Waves from S1 and S2 -->
  <g stroke="#8b5cf6" stroke-width="1" fill="none">
    <path d="M 146,138 C 200,120 250,100 350,80"/>
    <path d="M 146,138 C 200,140 250,150 350,160"/>
    <path d="M 146,138 C 200,145 250,160 350,200"/>
    <path d="M 146,178 C 200,195 250,210 350,240"/>
    <path d="M 146,178 C 200,175 250,165 350,160"/>
    <path d="M 146,178 C 200,170 250,155 350,120"/>
  </g>
  <!-- Screen -->
  <rect x="380" y="40" width="8" height="240" fill="#e5e7eb" stroke="#555" stroke-width="1" rx="2"/>
  <text x="395" y="55" fill="#555" font-size="9" font-weight="600">Screen</text>
  <!-- Interference pattern (bright/dark bands) -->
  <g>
    <rect x="390" y="50" width="15" height="12" fill="#8b5cf6" opacity="0.9" rx="1"/>
    <rect x="390" y="68" width="15" height="12" fill="#8b5cf6" opacity="0.2" rx="1"/>
    <rect x="390" y="86" width="15" height="12" fill="#8b5cf6" opacity="0.8" rx="1"/>
    <rect x="390" y="104" width="15" height="12" fill="#8b5cf6" opacity="0.2" rx="1"/>
    <rect x="390" y="122" width="15" height="12" fill="#8b5cf6" opacity="0.7" rx="1"/>
    <rect x="390" y="140" width="15" height="12" fill="#8b5cf6" opacity="0.15" rx="1"/>
    <rect x="390" y="152" width="15" height="16" fill="#8b5cf6" opacity="1" rx="1"/>
    <rect x="390" y="174" width="15" height="12" fill="#8b5cf6" opacity="0.15" rx="1"/>
    <rect x="390" y="192" width="15" height="12" fill="#8b5cf6" opacity="0.7" rx="1"/>
    <rect x="390" y="210" width="15" height="12" fill="#8b5cf6" opacity="0.2" rx="1"/>
    <rect x="390" y="228" width="15" height="12" fill="#8b5cf6" opacity="0.8" rx="1"/>
    <rect x="390" y="246" width="15" height="12" fill="#8b5cf6" opacity="0.2" rx="1"/>
    <rect x="390" y="264" width="15" height="12" fill="#8b5cf6" opacity="0.9" rx="1"/>
  </g>
  <text x="420" y="163" fill="#8b5cf6" font-size="8" font-weight="600">Central max</text>
  <!-- Distance labels -->
  <text x="143" y="295" text-anchor="middle" fill="#555" font-size="9">d</text>
  <line x1="260" y1="285" x2="260" y2="295" stroke="#555" stroke-width="0.5"/>
  <text x="260" y="305" text-anchor="middle" fill="#555" font-size="9">D</text>
  <!-- Formula -->
  <text x="250" y="315" text-anchor="middle" fill="var(--ink-2)" font-size="10">Fringe width: &#946; = &#955;D/d</text>
</svg>
</div>
<div class="caption">
  <div class="fig-num" style="color:var(--ch10)">Fig 10.1 &middot; Chapter 10</div>
  <div class="fig-title">Young's Double Slit Experiment (YDSE)</div>
</div>
</div>

<!-- Diagram 33: Single slit diffraction -->
<div class="diagram-card">
<div class="svg-wrap">
<svg viewBox="0 0 460 320" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <marker id="arAx3" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto"><polygon points="0,0 8,3 0,6" fill="#555"/></marker>
  </defs>
  <!-- Intensity distribution curve -->
  <!-- Axes -->
  <line x1="60" y1="250" x2="400" y2="250" stroke="#555" stroke-width="1.5" marker-end="url(#arAx3)"/>
  <line x1="230" y1="260" x2="230" y2="20" stroke="#555" stroke-width="1.5" marker-end="url(#arAx3)"/>
  <text x="415" y="255" fill="#555" font-size="10">sin&#952;</text>
  <text x="220" y="18" text-anchor="end" fill="#555" font-size="10">I</text>
  <!-- Diffraction pattern -->
  <path d="M 60,248 Q 80,248 95,245 Q 110,235 118,248 Q 126,235 135,245 Q 148,248 160,245 Q 175,225 185,248 Q 195,225 210,240 Q 220,248 228,100 Q 230,30 232,100 Q 240,248 250,225 Q 260,248 275,225 Q 288,248 305,245 Q 318,248 325,235 Q 335,248 342,235 Q 355,248 370,245 Q 390,248 400,248" fill="none" stroke="#8b5cf6" stroke-width="2.5"/>
  <!-- Central maximum label -->
  <text x="230" y="280" text-anchor="middle" fill="#8b5cf6" font-size="10" font-weight="600">Central Maximum</text>
  <!-- Secondary maxima -->
  <text x="152" y="220" text-anchor="middle" fill="#8b5cf6" font-size="8">2nd</text>
  <text x="310" y="220" text-anchor="middle" fill="#8b5cf6" font-size="8">2nd</text>
  <text x="192" y="230" text-anchor="middle" fill="#8b5cf6" font-size="8">1st</text>
  <text x="268" y="230" text-anchor="middle" fill="#8b5cf6" font-size="8">1st</text>
  <!-- Minima positions -->
  <line x1="120" y1="248" x2="120" y2="255" stroke="#dc2626" stroke-width="1"/>
  <line x1="185" y1="248" x2="185" y2="255" stroke="#dc2626" stroke-width="1"/>
  <line x1="275" y1="248" x2="275" y2="255" stroke="#dc2626" stroke-width="1"/>
  <line x1="340" y1="248" x2="340" y2="255" stroke="#dc2626" stroke-width="1"/>
  <!-- Formula -->
  <text x="230" y="305" text-anchor="middle" fill="var(--ink-2)" font-size="10">Minima: a sin&#952; = n&#955; (n = 1,2,3...)</text>
  <text x="230" y="318" text-anchor="middle" fill="var(--ink-2)" font-size="10">Central max width = 2&#955;D/a</text>
</svg>
</div>
<div class="caption">
  <div class="fig-num" style="color:var(--ch10)">Fig 10.2 &middot; Chapter 10</div>
  <div class="fig-title">Single slit diffraction: intensity distribution</div>
</div>
</div>

<!-- Diagram 34: Wavefront diagrams ‚Äî 3D Interactive -->
<div class="diagram-card" style="overflow:visible" id="wavefront-card">
<div class="svg-wrap">
<svg viewBox="0 0 540 320" xmlns="http://www.w3.org/2000/svg">
  <!-- Spherical wavefront -->
  <circle cx="90" cy="160" r="20" fill="none" stroke="#8b5cf6" stroke-width="1.5" stroke-dasharray="3,3"/>
  <circle cx="90" cy="160" r="45" fill="none" stroke="#8b5cf6" stroke-width="1.5" stroke-dasharray="3,3"/>
  <circle cx="90" cy="160" r="70" fill="none" stroke="#8b5cf6" stroke-width="1.5" stroke-dasharray="3,3"/>
  <circle cx="90" cy="160" r="6" fill="#fbbf24"/>
  <text x="90" y="248" text-anchor="middle" fill="#8b5cf6" font-size="11" font-weight="600">Spherical</text>
  <text x="90" y="262" text-anchor="middle" fill="#78716c" font-size="9">Point source</text>
  <!-- Arrows -->
  <line x1="90" y1="155" x2="90" y2="86" stroke="#8b5cf6" stroke-width="1.2" marker-end="url(#arw10)"/>
  <line x1="95" y1="158" x2="159" y2="158" stroke="#8b5cf6" stroke-width="1.2" marker-end="url(#arw10)"/>
  <defs>
    <marker id="arw10" markerWidth="6" markerHeight="5" refX="6" refY="2.5" orient="auto"><polygon points="0,0 6,2.5 0,5" fill="#8b5cf6"/></marker>
    <marker id="arw10b" markerWidth="6" markerHeight="5" refX="6" refY="2.5" orient="auto"><polygon points="0,0 6,2.5 0,5" fill="#0891b2"/></marker>
    <marker id="arw10c" markerWidth="6" markerHeight="5" refX="6" refY="2.5" orient="auto"><polygon points="0,0 6,2.5 0,5" fill="#16a34a"/></marker>
  </defs>
  <!-- Plane wavefront -->
  <line x1="270" y1="88" x2="270" y2="232" stroke="#0891b2" stroke-width="2" stroke-dasharray="4,3"/>
  <line x1="305" y1="88" x2="305" y2="232" stroke="#0891b2" stroke-width="2" stroke-dasharray="4,3"/>
  <line x1="340" y1="88" x2="340" y2="232" stroke="#0891b2" stroke-width="2" stroke-dasharray="4,3"/>
  <line x1="240" y1="160" x2="360" y2="160" stroke="#0891b2" stroke-width="1" stroke-dasharray="2,4" opacity=".4"/>
  <!-- Arrows -->
  <line x1="270" y1="155" x2="270" y2="108" stroke="#0891b2" stroke-width="1.2" marker-end="url(#arw10b)"/>
  <line x1="305" y1="155" x2="305" y2="108" stroke="#0891b2" stroke-width="1.2" marker-end="url(#arw10b)"/>
  <line x1="340" y1="155" x2="340" y2="108" stroke="#0891b2" stroke-width="1.2" marker-end="url(#arw10b)"/>
  <text x="305" y="248" text-anchor="middle" fill="#0891b2" font-size="11" font-weight="600">Plane</text>
  <text x="305" y="262" text-anchor="middle" fill="#78716c" font-size="9">Distant source</text>
  <!-- Cylindrical wavefront -->
  <ellipse cx="450" cy="160" rx="20" ry="55" fill="none" stroke="#16a34a" stroke-width="1.5" stroke-dasharray="3,3"/>
  <ellipse cx="450" cy="160" rx="42" ry="75" fill="none" stroke="#16a34a" stroke-width="1.5" stroke-dasharray="3,3"/>
  <line x1="450" y1="100" x2="450" y2="220" stroke="#fbbf24" stroke-width="3" stroke-linecap="round"/>
  <text x="450" y="248" text-anchor="middle" fill="#16a34a" font-size="11" font-weight="600">Cylindrical</text>
  <text x="450" y="262" text-anchor="middle" fill="#78716c" font-size="9">Line source</text>
  <!-- Arrows for cylindrical -->
  <line x1="454" y1="155" x2="491" y2="155" stroke="#16a34a" stroke-width="1.2" marker-end="url(#arw10c)"/>
  <line x1="446" y1="155" x2="409" y2="155" stroke="#16a34a" stroke-width="1.2" marker-end="url(#arw10c)"/>
  <!-- Title -->
  <text x="270" y="298" text-anchor="middle" fill="#44403c" font-size="10" font-style="italic">Wavefronts shown as dashed curves; rays are perpendicular to wavefronts</text>
</svg>
</div>
<div class="view-3d" id="wavefront3d-wrap" style="position:relative;background:#0f0c1a;border-radius:0;padding:0!important">
  <canvas id="wavefront3d" class="canvas-3d" style="width:100%;display:block;cursor:grab;height:360px;"></canvas>
  <div style="position:absolute;top:14px;left:0;right:0;display:flex;justify-content:space-around;pointer-events:none;">
    <span style="font-family:'DM Sans',sans-serif;font-size:12px;font-weight:700;color:#c4b5fd;letter-spacing:.06em;text-transform:uppercase;">Spherical</span>
    <span style="font-family:'DM Sans',sans-serif;font-size:12px;font-weight:700;color:#c4b5fd;letter-spacing:.06em;text-transform:uppercase;">Plane</span>
    <span style="font-family:'DM Sans',sans-serif;font-size:12px;font-weight:700;color:#c4b5fd;letter-spacing:.06em;text-transform:uppercase;">Cylindrical</span>
  </div>
  <div class="anim-hint">‚ü≥ Drag to rotate ¬∑ Scroll to zoom</div>
</div>
<div class="caption">
  <div class="fig-num" style="color:var(--ch10)">Fig 10.3 &middot; Chapter 10</div>
  <div class="fig-title">Types of wavefronts: spherical, plane, cylindrical ‚Äî interactive 3D</div>
</div>
</div>

</div>
</section>

<!-- ============================================================ -->
<!-- CHAPTER 11: Dual Nature of Radiation & Matter -->
<!-- ============================================================ -->
<section class="chapter-section" id="ch11">
<div class="chapter-header">
  <div class="chapter-num" style="background:var(--ch11)">11</div>
  <h2 class="chapter-title">Dual Nature of Radiation &amp; Matter</h2>
</div>
<div class="diagram-grid">

<!-- Diagram 35: Photoelectric effect setup -->
<div class="diagram-card">
<div class="svg-wrap">
<svg viewBox="0 0 460 340" xmlns="http://www.w3.org/2000/svg">
  <!-- Evacuated tube -->
  <ellipse cx="230" cy="170" rx="140" ry="100" fill="rgba(234,88,12,0.04)" stroke="#ea580c" stroke-width="2"/>
  <text x="230" y="280" text-anchor="middle" fill="#ea580c" font-size="9">Evacuated glass tube</text>
  <!-- Cathode (emitter plate) -->
  <rect x="120" y="120" width="8" height="100" fill="#ea580c" stroke="#ea580c" stroke-width="1" rx="2"/>
  <text x="110" y="175" text-anchor="end" fill="#ea580c" font-size="10" font-weight="600">C</text>
  <text x="108" y="188" text-anchor="end" fill="#ea580c" font-size="8">(Emitter)</text>
  <!-- Anode (collector plate) -->
  <rect x="330" y="120" width="8" height="100" fill="#ea580c" stroke="#ea580c" stroke-width="1" rx="2"/>
  <text x="350" y="175" fill="#ea580c" font-size="10" font-weight="600">A</text>
  <text x="350" y="188" fill="#ea580c" font-size="8">(Collector)</text>
  <!-- Light (hv) hitting cathode -->
  <g stroke="#d97706" stroke-width="2">
    <line x1="40" y1="100" x2="118" y2="145"/>
    <line x1="40" y1="130" x2="118" y2="165"/>
    <line x1="40" y1="160" x2="118" y2="185"/>
  </g>
  <text x="30" y="90" fill="#d97706" font-size="11" font-weight="700">h&#957;</text>
  <text x="30" y="105" fill="#d97706" font-size="9">(Light)</text>
  <!-- Electrons flying to anode -->
  <g fill="#2563eb" font-size="9">
    <text x="200" y="145">e&#8315;</text>
    <text x="240" y="165">e&#8315;</text>
    <text x="220" y="190">e&#8315;</text>
    <text x="270" y="155">e&#8315;</text>
  </g>
  <!-- External circuit -->
  <line x1="124" y1="120" x2="124" y2="40" stroke="#555" stroke-width="1.5"/>
  <line x1="334" y1="120" x2="334" y2="40" stroke="#555" stroke-width="1.5"/>
  <line x1="124" y1="40" x2="180" y2="40" stroke="#555" stroke-width="1.5"/>
  <line x1="280" y1="40" x2="334" y2="40" stroke="#555" stroke-width="1.5"/>
  <!-- Ammeter -->
  <circle cx="230" cy="40" r="18" fill="#fff7ed" stroke="#ea580c" stroke-width="1.5"/>
  <text x="230" y="45" text-anchor="middle" fill="#ea580c" font-size="12" font-weight="700">A</text>
  <line x1="212" y1="40" x2="180" y2="40" stroke="#555" stroke-width="1.5"/>
  <line x1="248" y1="40" x2="280" y2="40" stroke="#555" stroke-width="1.5"/>
  <!-- Battery (bottom) -->
  <line x1="124" y1="220" x2="124" y2="310" stroke="#555" stroke-width="1.5"/>
  <line x1="334" y1="220" x2="334" y2="310" stroke="#555" stroke-width="1.5"/>
  <line x1="124" y1="310" x2="210" y2="310" stroke="#555" stroke-width="1.5"/>
  <line x1="250" y1="310" x2="334" y2="310" stroke="#555" stroke-width="1.5"/>
  <!-- Battery symbol -->
  <line x1="218" y1="302" x2="218" y2="318" stroke="#555" stroke-width="3"/>
  <line x1="226" y1="306" x2="226" y2="314" stroke="#555" stroke-width="1.5"/>
  <!-- Voltmeter V -->
  <line x1="234" y1="310" x2="250" y2="310" stroke="#555" stroke-width="1.5"/>
  <text x="230" y="335" text-anchor="middle" fill="#555" font-size="9">Variable V</text>
  <!-- Photoelectric equation -->
  <text x="400" y="310" text-anchor="middle" fill="var(--ink-2)" font-size="10">K&#8344;&#8345;&#8339; = h&#957; &minus; &#966;</text>
</svg>
</div>
<div class="caption">
  <div class="fig-num" style="color:var(--ch11)">Fig 11.1 &middot; Chapter 11</div>
  <div class="fig-title">Photoelectric effect experimental setup</div>
</div>
</div>

<!-- Diagram 36: Stopping potential vs frequency -->
<div class="diagram-card">
<div class="svg-wrap">
<svg viewBox="0 0 420 300" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <marker id="arAx4" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto"><polygon points="0,0 8,3 0,6" fill="#555"/></marker>
  </defs>
  <!-- Axes -->
  <line x1="80" y1="220" x2="380" y2="220" stroke="#555" stroke-width="1.5" marker-end="url(#arAx4)"/>
  <line x1="80" y1="220" x2="80" y2="30" stroke="#555" stroke-width="1.5" marker-end="url(#arAx4)"/>
  <text x="390" y="225" fill="#555" font-size="11" font-weight="600">&#957;</text>
  <text x="70" y="25" text-anchor="end" fill="#555" font-size="11" font-weight="600">V&#8320;</text>
  <text x="72" y="228" fill="#555" font-size="10">O</text>
  <!-- Linear graph: V0 = (h/e)v - phi/e -->
  <line x1="160" y1="220" x2="360" y2="60" stroke="#ea580c" stroke-width="2.5"/>
  <!-- Threshold frequency -->
  <circle cx="160" cy="220" r="4" fill="#ea580c"/>
  <text x="160" y="240" text-anchor="middle" fill="#ea580c" font-size="10" font-weight="600">&#957;&#8320;</text>
  <text x="160" y="253" text-anchor="middle" fill="#ea580c" font-size="8">(threshold)</text>
  <!-- Work function from y-intercept -->
  <line x1="160" y1="220" x2="80" y2="270" stroke="#ea580c" stroke-width="1.5" stroke-dasharray="5,3"/>
  <text x="65" y="270" text-anchor="end" fill="#dc2626" font-size="10" font-weight="600">&minus;&#966;/e</text>
  <!-- Slope label -->
  <text x="300" y="100" fill="#ea580c" font-size="11" font-weight="600">slope = h/e</text>
  <!-- Grid -->
  <line x1="80" y1="140" x2="360" y2="140" stroke="#eee" stroke-width="0.5"/>
  <line x1="220" y1="220" x2="220" y2="50" stroke="#eee" stroke-width="0.5"/>
  <!-- Additional metal line (parallel, different threshold) -->
  <line x1="200" y1="220" x2="380" y2="90" stroke="#3b82f6" stroke-width="1.5" stroke-dasharray="6,3"/>
  <text x="370" y="85" fill="#3b82f6" font-size="9">Metal 2</text>
  <text x="345" y="55" fill="#ea580c" font-size="9">Metal 1</text>
  <text x="250" y="290" text-anchor="middle" fill="var(--ink-2)" font-size="10">V&#8320; = (h/e)&#957; &minus; &#966;/e</text>
</svg>
</div>
<div class="caption">
  <div class="fig-num" style="color:var(--ch11)">Fig 11.2 &middot; Chapter 11</div>
  <div class="fig-title">Stopping potential vs frequency graph</div>
</div>
</div>

<!-- Diagram 37: Photocurrent vs collector potential -->
<div class="diagram-card">
<div class="svg-wrap">
<svg viewBox="0 0 440 300" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <marker id="arAx5" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto"><polygon points="0,0 8,3 0,6" fill="#555"/></marker>
  </defs>
  <!-- Axes -->
  <line x1="180" y1="250" x2="400" y2="250" stroke="#555" stroke-width="1.5" marker-end="url(#arAx5)"/>
  <line x1="180" y1="250" x2="40" y2="250" stroke="#555" stroke-width="1.5"/>
  <line x1="180" y1="260" x2="180" y2="30" stroke="#555" stroke-width="1.5" marker-end="url(#arAx5)"/>
  <text x="410" y="255" fill="#555" font-size="10">V</text>
  <text x="170" y="25" text-anchor="end" fill="#555" font-size="10">I</text>
  <text x="172" y="262" fill="#555" font-size="10">O</text>
  <text x="60" y="265" fill="#555" font-size="9">&minus;V&#8320;</text>
  <!-- Negative voltage region label -->
  <text x="110" y="265" fill="#555" font-size="8">Retarding potential</text>
  <!-- High intensity curve (I3) -->
  <path d="M 80,250 Q 120,248 160,230 Q 180,200 220,100 Q 260,65 350,60" fill="none" stroke="#ea580c" stroke-width="2.5"/>
  <text x="355" y="55" fill="#ea580c" font-size="10" font-weight="600">I&#8323; (high)</text>
  <!-- Medium intensity (I2) -->
  <path d="M 80,250 Q 120,248 160,240 Q 180,220 220,150 Q 260,120 350,115" fill="none" stroke="#ea580c" stroke-width="2" stroke-dasharray="6,3"/>
  <text x="355" y="112" fill="#ea580c" font-size="10">I&#8322;</text>
  <!-- Low intensity (I1) -->
  <path d="M 80,250 Q 120,249 160,246 Q 180,238 220,200 Q 260,180 350,175" fill="none" stroke="#ea580c" stroke-width="1.5" stroke-dasharray="3,3"/>
  <text x="355" y="172" fill="#ea580c" font-size="10">I&#8321; (low)</text>
  <!-- Stopping potential marker -->
  <line x1="80" y1="250" x2="80" y2="245" stroke="#dc2626" stroke-width="2"/>
  <circle cx="80" cy="250" r="3" fill="#dc2626"/>
  <text x="80" y="275" text-anchor="middle" fill="#dc2626" font-size="9" font-weight="600">&minus;V&#8320;</text>
  <text x="80" y="288" text-anchor="middle" fill="#dc2626" font-size="8">(same for all)</text>
  <!-- Saturation current labels -->
  <line x1="350" y1="60" x2="390" y2="60" stroke="#999" stroke-width="0.5" stroke-dasharray="3,2"/>
  <line x1="350" y1="115" x2="390" y2="115" stroke="#999" stroke-width="0.5" stroke-dasharray="3,2"/>
  <text x="250" y="292" text-anchor="middle" fill="#64748b" font-size="9" font-style="italic">V&#8320; depends on frequency, not intensity</text>
</svg>
</div>
<div class="caption">
  <div class="fig-num" style="color:var(--ch11)">Fig 11.3 &middot; Chapter 11</div>
  <div class="fig-title">Photocurrent vs collector plate potential (different intensities)</div>
</div>
</div>

</div>
</section>

<!-- ============================================================ -->
<!-- CHAPTER 12: Atoms -->
<!-- ============================================================ -->
<section class="chapter-section" id="ch12">
<div class="chapter-header">
  <div class="chapter-num" style="background:var(--ch12)">12</div>
  <h2 class="chapter-title">Atoms</h2>
</div>
<div class="diagram-grid">

<!-- Diagram 38: Bohr model energy levels -->
<div class="diagram-card">
<div class="svg-wrap">
<svg viewBox="0 0 480 440" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <marker id="arTr" markerWidth="6" markerHeight="4" refX="6" refY="2" orient="auto"><polygon points="0,0 6,2 0,4" fill="#4f46e5"/></marker>
    <marker id="arTrR" markerWidth="6" markerHeight="4" refX="6" refY="2" orient="auto"><polygon points="0,0 6,2 0,4" fill="#dc2626"/></marker>
    <marker id="arTrG" markerWidth="6" markerHeight="4" refX="6" refY="2" orient="auto"><polygon points="0,0 6,2 0,4" fill="#16a34a"/></marker>
    <marker id="arTrO" markerWidth="6" markerHeight="4" refX="6" refY="2" orient="auto"><polygon points="0,0 6,2 0,4" fill="#ea580c"/></marker>
  </defs>
  <!-- Energy levels -->
  <g stroke="#4f46e5" stroke-width="2">
    <line x1="100" y1="400" x2="340" y2="400"/><!-- n=1 -->
    <line x1="100" y1="280" x2="340" y2="280"/><!-- n=2 -->
    <line x1="100" y1="210" x2="340" y2="210"/><!-- n=3 -->
    <line x1="100" y1="165" x2="340" y2="165"/><!-- n=4 -->
    <line x1="100" y1="135" x2="340" y2="135"/><!-- n=5 -->
    <line x1="100" y1="112" x2="340" y2="112"/><!-- n=6 -->
    <line x1="100" y1="60" x2="340" y2="60" stroke-dasharray="6,3"/><!-- n=inf -->
  </g>
  <!-- Level labels -->
  <text x="90" y="404" text-anchor="end" fill="#4f46e5" font-size="10" font-weight="600">n=1</text>
  <text x="90" y="284" text-anchor="end" fill="#4f46e5" font-size="10" font-weight="600">n=2</text>
  <text x="90" y="214" text-anchor="end" fill="#4f46e5" font-size="10" font-weight="600">n=3</text>
  <text x="90" y="169" text-anchor="end" fill="#4f46e5" font-size="10" font-weight="600">n=4</text>
  <text x="90" y="139" text-anchor="end" fill="#4f46e5" font-size="10" font-weight="600">n=5</text>
  <text x="90" y="116" text-anchor="end" fill="#4f46e5" font-size="10" font-weight="600">n=6</text>
  <text x="90" y="64" text-anchor="end" fill="#4f46e5" font-size="10">n=&#8734;</text>
  <!-- Energy values -->
  <text x="350" y="404" fill="#555" font-size="9">&minus;13.6 eV</text>
  <text x="350" y="284" fill="#555" font-size="9">&minus;3.4 eV</text>
  <text x="350" y="214" fill="#555" font-size="9">&minus;1.51 eV</text>
  <text x="350" y="169" fill="#555" font-size="9">&minus;0.85 eV</text>
  <text x="350" y="139" fill="#555" font-size="9">&minus;0.54 eV</text>
  <text x="350" y="64" fill="#555" font-size="9">0 eV</text>
  <!-- Lyman series (UV) - transitions to n=1 -->
  <g marker-end="url(#arTr)">
    <line x1="130" y1="280" x2="130" y2="402" stroke="#4f46e5" stroke-width="1.5"/>
    <line x1="145" y1="210" x2="145" y2="402" stroke="#4f46e5" stroke-width="1.5"/>
    <line x1="160" y1="165" x2="160" y2="402" stroke="#4f46e5" stroke-width="1.5"/>
  </g>
  <text x="145" y="425" text-anchor="middle" fill="#4f46e5" font-size="9" font-weight="600">Lyman (UV)</text>
  <!-- Balmer series (Visible) - transitions to n=2 -->
  <g marker-end="url(#arTrR)">
    <line x1="210" y1="210" x2="210" y2="282" stroke="#dc2626" stroke-width="1.5"/>
    <line x1="225" y1="165" x2="225" y2="282" stroke="#dc2626" stroke-width="1.5"/>
    <line x1="240" y1="135" x2="240" y2="282" stroke="#dc2626" stroke-width="1.5"/>
  </g>
  <text x="225" y="300" text-anchor="middle" fill="#dc2626" font-size="9" font-weight="600">Balmer (Visible)</text>
  <!-- Paschen series (IR) - transitions to n=3 -->
  <g marker-end="url(#arTrG)">
    <line x1="290" y1="165" x2="290" y2="212" stroke="#16a34a" stroke-width="1.5"/>
    <line x1="305" y1="135" x2="305" y2="212" stroke="#16a34a" stroke-width="1.5"/>
    <line x1="320" y1="112" x2="320" y2="212" stroke="#16a34a" stroke-width="1.5"/>
  </g>
  <text x="305" y="230" text-anchor="middle" fill="#16a34a" font-size="9" font-weight="600">Paschen (IR)</text>
  <!-- Title -->
  <text x="240" y="25" text-anchor="middle" fill="var(--ink)" font-size="12" font-weight="600">Hydrogen Atom Energy Levels</text>
  <text x="240" y="438" text-anchor="middle" fill="var(--ink-2)" font-size="9">E&#8345; = &minus;13.6/n&#178; eV</text>
</svg>
</div>
<div class="caption">
  <div class="fig-num" style="color:var(--ch12)">Fig 12.1 &middot; Chapter 12</div>
  <div class="fig-title">Bohr model: energy levels and spectral series</div>
</div>
</div>

<!-- Diagram 39: Rutherford's alpha scattering -->
<div class="diagram-card">
<div class="svg-wrap">
<svg viewBox="0 0 480 340" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <marker id="arAlpha" markerWidth="6" markerHeight="4" refX="6" refY="2" orient="auto"><polygon points="0,0 6,2 0,4" fill="#d97706"/></marker>
  </defs>
  <!-- Alpha source -->
  <rect x="20" y="140" width="40" height="40" rx="4" fill="#fff7ed" stroke="#ea580c" stroke-width="1.5"/>
  <text x="40" y="163" text-anchor="middle" fill="#ea580c" font-size="9" font-weight="600">&#945;</text>
  <text x="40" y="195" text-anchor="middle" fill="#ea580c" font-size="8">Source</text>
  <!-- Collimator/slit -->
  <rect x="80" y="130" width="6" height="60" fill="#555"/>
  <rect x="80" y="155" width="6" height="10" fill="#fdfcfa"/>
  <!-- Gold foil -->
  <rect x="260" y="80" width="4" height="180" fill="#fcd34d" stroke="#d97706" stroke-width="1"/>
  <text x="262" y="72" text-anchor="middle" fill="#d97706" font-size="10" font-weight="600">Gold Foil</text>
  <!-- Nucleus in foil -->
  <circle cx="262" cy="160" r="6" fill="#dc2626"/>
  <text x="262" y="164" text-anchor="middle" fill="#fff" font-size="7" font-weight="700">+</text>
  <!-- Alpha particle paths -->
  <!-- Most pass straight through -->
  <line x1="86" y1="150" x2="420" y2="150" stroke="#d97706" stroke-width="1.5" marker-end="url(#arAlpha)"/>
  <line x1="86" y1="160" x2="420" y2="160" stroke="#d97706" stroke-width="1.5" marker-end="url(#arAlpha)"/>
  <line x1="86" y1="170" x2="420" y2="170" stroke="#d97706" stroke-width="1.5" marker-end="url(#arAlpha)"/>
  <!-- Slightly deflected -->
  <path d="M 86,145 L 250,145 Q 258,144 270,138 L 400,100" fill="none" stroke="#d97706" stroke-width="1.2" marker-end="url(#arAlpha)"/>
  <path d="M 86,175 L 250,175 Q 258,176 270,182 L 400,220" fill="none" stroke="#d97706" stroke-width="1.2" marker-end="url(#arAlpha)"/>
  <!-- Large angle deflection (rare) -->
  <path d="M 86,155 L 230,155 Q 248,155 250,150 Q 258,135 250,120 L 200,70" fill="none" stroke="#dc2626" stroke-width="1.5" marker-end="url(#arAlpha)"/>
  <!-- Nearly back-scattered (very rare) -->
  <path d="M 86,162 L 240,162 Q 250,162 252,158 Q 256,148 248,140 Q 240,132 220,130 L 100,120" fill="none" stroke="#dc2626" stroke-width="1.5" marker-end="url(#arAlpha)"/>
  <!-- Circular detector screen -->
  <path d="M 420,60 Q 460,160 420,260" fill="none" stroke="#555" stroke-width="2" stroke-dasharray="5,3"/>
  <text x="445" y="165" fill="#555" font-size="9">ZnS Screen</text>
  <!-- Annotations -->
  <text x="380" y="145" fill="#d97706" font-size="8">Most pass through</text>
  <text x="160" y="65" fill="#dc2626" font-size="8" font-weight="600">Few deflected</text>
  <text x="100" y="110" fill="#dc2626" font-size="8" font-weight="600">Very few</text>
  <text x="100" y="122" fill="#dc2626" font-size="8">back-scattered</text>
  <!-- Conclusion -->
  <text x="240" y="305" text-anchor="middle" fill="var(--ink-2)" font-size="10">Most of atom is empty space</text>
  <text x="240" y="320" text-anchor="middle" fill="var(--ink-2)" font-size="10">+ve charge concentrated in tiny nucleus</text>
  <text x="240" y="335" text-anchor="middle" fill="#64748b" font-size="9" font-style="italic">b (impact parameter) determines deflection angle</text>
</svg>
</div>
<div class="caption">
  <div class="fig-num" style="color:var(--ch12)">Fig 12.2 &middot; Chapter 12</div>
  <div class="fig-title">Rutherford's alpha particle scattering experiment</div>
</div>
</div>

</div>
</section>

<!-- ============================================================ -->
<!-- CHAPTER 13: Nuclei -->
<!-- ============================================================ -->
<section class="chapter-section" id="ch13">
<div class="chapter-header">
  <div class="chapter-num" style="background:var(--ch13)">13</div>
  <h2 class="chapter-title">Nuclei</h2>
</div>
<div class="diagram-grid">

<!-- Diagram 40: Binding Energy per Nucleon curve -->
<div class="diagram-card">
<div class="svg-wrap">
<svg viewBox="0 0 500 360" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <marker id="arAx6" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto"><polygon points="0,0 8,3 0,6" fill="#555"/></marker>
  </defs>
  <!-- Axes -->
  <line x1="60" y1="300" x2="470" y2="300" stroke="#555" stroke-width="1.5" marker-end="url(#arAx6)"/>
  <line x1="60" y1="300" x2="60" y2="20" stroke="#555" stroke-width="1.5" marker-end="url(#arAx6)"/>
  <text x="480" y="305" fill="#555" font-size="10" font-weight="600">Mass Number A</text>
  <text x="20" y="15" fill="#555" font-size="9" font-weight="600">BE/A</text>
  <text x="20" y="28" fill="#555" font-size="9">(MeV)</text>
  <!-- Y-axis labels -->
  <text x="55" y="300" text-anchor="end" fill="#555" font-size="8">0</text>
  <text x="55" y="260" text-anchor="end" fill="#555" font-size="8">2</text>
  <text x="55" y="220" text-anchor="end" fill="#555" font-size="8">4</text>
  <text x="55" y="180" text-anchor="end" fill="#555" font-size="8">6</text>
  <text x="55" y="140" text-anchor="end" fill="#555" font-size="8">8</text>
  <text x="55" y="100" text-anchor="end" fill="#555" font-size="8">10</text>
  <!-- Grid lines -->
  <g stroke="#eee" stroke-width="0.5">
    <line x1="60" y1="260" x2="460" y2="260"/>
    <line x1="60" y1="220" x2="460" y2="220"/>
    <line x1="60" y1="180" x2="460" y2="180"/>
    <line x1="60" y1="140" x2="460" y2="140"/>
    <line x1="60" y1="100" x2="460" y2="100"/>
  </g>
  <!-- BE/A curve -->
  <path d="M 70,290 Q 80,260 95,200 Q 105,160 120,130 Q 140,110 160,105 Q 190,90 220,85 Q 250,82 270,80 Q 290,82 310,85 Q 340,90 370,100 Q 400,110 430,125 Q 450,135 460,140" fill="none" stroke="#b91c1c" stroke-width="2.5"/>
  <!-- Key element markers -->
  <!-- H-2 -->
  <circle cx="75" cy="285" r="3" fill="#b91c1c"/>
  <text x="75" y="278" text-anchor="middle" fill="#b91c1c" font-size="8">&#178;H</text>
  <!-- He-4 -->
  <circle cx="95" cy="135" r="3" fill="#b91c1c"/>
  <text x="95" y="128" text-anchor="middle" fill="#b91c1c" font-size="8">&#8308;He</text>
  <!-- C-12 -->
  <circle cx="130" cy="115" r="3" fill="#b91c1c"/>
  <text x="130" y="108" text-anchor="middle" fill="#b91c1c" font-size="8">&#185;&#178;C</text>
  <!-- O-16 -->
  <circle cx="150" cy="105" r="3" fill="#b91c1c"/>
  <text x="150" y="98" text-anchor="middle" fill="#b91c1c" font-size="8">&#185;&#8310;O</text>
  <!-- Fe-56 (peak) -->
  <circle cx="270" cy="80" r="5" fill="#b91c1c"/>
  <text x="270" y="70" text-anchor="middle" fill="#b91c1c" font-size="10" font-weight="700">&#8309;&#8310;Fe</text>
  <text x="270" y="60" text-anchor="middle" fill="#b91c1c" font-size="8">(most stable)</text>
  <!-- U-238 -->
  <circle cx="450" cy="137" r="3" fill="#b91c1c"/>
  <text x="450" y="155" text-anchor="middle" fill="#b91c1c" font-size="8">&#178;&#179;&#8312;U</text>
  <!-- Fusion region -->
  <rect x="70" y="32" width="80" height="20" rx="4" fill="#eff6ff" stroke="#2563eb" stroke-width="1"/>
  <text x="110" y="46" text-anchor="middle" fill="#2563eb" font-size="9" font-weight="600">Fusion region</text>
  <path d="M 110,52 L 110,80" stroke="#2563eb" stroke-width="1" stroke-dasharray="3,2" marker-end="url(#arAx6)"/>
  <!-- Fission region -->
  <rect x="360" y="32" width="80" height="20" rx="4" fill="#fef2f2" stroke="#dc2626" stroke-width="1"/>
  <text x="400" y="46" text-anchor="middle" fill="#dc2626" font-size="9" font-weight="600">Fission region</text>
  <path d="M 400,52 L 400,90" stroke="#dc2626" stroke-width="1" stroke-dasharray="3,2" marker-end="url(#arAx6)"/>
  <!-- X-axis labels -->
  <text x="80" y="315" text-anchor="middle" fill="#555" font-size="8">20</text>
  <text x="160" y="315" text-anchor="middle" fill="#555" font-size="8">60</text>
  <text x="270" y="315" text-anchor="middle" fill="#555" font-size="8">120</text>
  <text x="370" y="315" text-anchor="middle" fill="#555" font-size="8">180</text>
  <text x="450" y="315" text-anchor="middle" fill="#555" font-size="8">240</text>
  <text x="260" y="345" text-anchor="middle" fill="#64748b" font-size="9" font-style="italic">Both fusion and fission move toward higher BE/A (Fe-56 peak)</text>
</svg>
</div>
<div class="caption">
  <div class="fig-num" style="color:var(--ch13)">Fig 13.1 &middot; Chapter 13</div>
  <div class="fig-title">Binding Energy per Nucleon vs Mass Number</div>
</div>
</div>

<!-- Diagram 41: Nuclear fission -->
<div class="diagram-card">
<div class="svg-wrap">
<svg viewBox="0 0 500 280" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <marker id="arFis" markerWidth="6" markerHeight="4" refX="6" refY="2" orient="auto"><polygon points="0,0 6,2 0,4" fill="#b91c1c"/></marker>
    <marker id="arN" markerWidth="6" markerHeight="4" refX="6" refY="2" orient="auto"><polygon points="0,0 6,2 0,4" fill="#555"/></marker>
  </defs>
  <!-- Incoming neutron -->
  <circle cx="40" cy="140" r="6" fill="#555"/>
  <text x="40" y="128" text-anchor="middle" fill="#555" font-size="9" font-weight="600">n</text>
  <line x1="48" y1="140" x2="100" y2="140" stroke="#555" stroke-width="1.5" marker-end="url(#arN)"/>
  <!-- U-235 nucleus -->
  <circle cx="130" cy="140" r="28" fill="#fecaca" stroke="#b91c1c" stroke-width="2"/>
  <text x="130" y="136" text-anchor="middle" fill="#b91c1c" font-size="9" font-weight="700">&#178;&#179;&#8309;U</text>
  <text x="130" y="150" text-anchor="middle" fill="#b91c1c" font-size="8">+ n</text>
  <!-- Arrow to excited state -->
  <line x1="160" y1="140" x2="195" y2="140" stroke="#555" stroke-width="1.5" marker-end="url(#arN)"/>
  <!-- Excited U-236 (deformed shape) -->
  <ellipse cx="230" cy="140" rx="30" ry="22" fill="#fecaca" stroke="#b91c1c" stroke-width="2"/>
  <text x="230" y="145" text-anchor="middle" fill="#b91c1c" font-size="8" font-weight="600">&#178;&#179;&#8310;U*</text>
  <!-- Arrow to split -->
  <line x1="265" y1="140" x2="300" y2="140" stroke="#555" stroke-width="1.5" marker-end="url(#arN)"/>
  <!-- Fragment 1 (Ba-141) -->
  <circle cx="360" cy="90" r="22" fill="#bfdbfe" stroke="#2563eb" stroke-width="2"/>
  <text x="360" y="88" text-anchor="middle" fill="#2563eb" font-size="8" font-weight="700">&#185;&#8308;&#185;Ba</text>
  <text x="360" y="100" text-anchor="middle" fill="#2563eb" font-size="7">(Fragment)</text>
  <line x1="300" y1="130" x2="338" y2="100" stroke="#2563eb" stroke-width="1.5" marker-end="url(#arFis)"/>
  <!-- Fragment 2 (Kr-92) -->
  <circle cx="360" cy="195" r="18" fill="#d1fae5" stroke="#16a34a" stroke-width="2"/>
  <text x="360" y="193" text-anchor="middle" fill="#16a34a" font-size="8" font-weight="700">&#8313;&#178;Kr</text>
  <text x="360" y="205" text-anchor="middle" fill="#16a34a" font-size="7">(Fragment)</text>
  <line x1="300" y1="150" x2="342" y2="185" stroke="#16a34a" stroke-width="1.5" marker-end="url(#arFis)"/>
  <!-- Released neutrons -->
  <g fill="#555">
    <circle cx="420" cy="55" r="5"/>
    <text x="430" y="50" font-size="8" font-weight="600">n</text>
    <line x1="382" y1="80" x2="415" y2="58" stroke="#555" stroke-width="1" marker-end="url(#arN)"/>
    <circle cx="430" cy="140" r="5"/>
    <text x="442" y="138" font-size="8" font-weight="600">n</text>
    <line x1="382" y1="110" x2="425" y2="138" stroke="#555" stroke-width="1" marker-end="url(#arN)"/>
    <circle cx="420" cy="235" r="5"/>
    <text x="430" y="243" font-size="8" font-weight="600">n</text>
    <line x1="375" y1="210" x2="416" y2="232" stroke="#555" stroke-width="1" marker-end="url(#arN)"/>
  </g>
  <!-- Energy release -->
  <text x="440" y="155" fill="#dc2626" font-size="10" font-weight="700">+ Energy</text>
  <text x="440" y="168" fill="#dc2626" font-size="8">(~200 MeV)</text>
  <!-- 3 neutrons label -->
  <text x="450" y="100" fill="#555" font-size="9" font-weight="600">3 neutrons</text>
  <!-- Equation -->
  <text x="250" y="260" text-anchor="middle" fill="var(--ink-2)" font-size="10">&#178;&#179;&#8309;U + n &#8594; &#185;&#8308;&#185;Ba + &#8313;&#178;Kr + 3n + Energy</text>
</svg>
</div>
<div class="caption">
  <div class="fig-num" style="color:var(--ch13)">Fig 13.2 &middot; Chapter 13</div>
  <div class="fig-title">Nuclear fission of Uranium-235</div>
</div>
</div>

</div>
</section>

<!-- ============================================================ -->
<!-- CHAPTER 14: Semiconductor Electronics -->
<!-- ============================================================ -->
<section class="chapter-section" id="ch14">
<div class="chapter-header">
  <div class="chapter-num" style="background:var(--ch14)">14</div>
  <h2 class="chapter-title">Semiconductor Electronics</h2>
</div>
<div class="diagram-grid">

<!-- Diagram 42: p-n junction formation -->
<div class="diagram-card">
<div class="svg-wrap">
<svg viewBox="0 0 480 280" xmlns="http://www.w3.org/2000/svg">
  <!-- p-type region -->
  <rect x="40" y="60" width="200" height="120" fill="#fce7f3" stroke="#be185d" stroke-width="1.5" rx="4"/>
  <text x="140" y="50" text-anchor="middle" fill="#be185d" font-size="12" font-weight="700">p-type</text>
  <!-- Holes in p-type -->
  <g fill="none" stroke="#be185d" stroke-width="1">
    <circle cx="80" cy="100" r="6"/><text x="80" y="104" text-anchor="middle" fill="#be185d" font-size="9">+</text>
    <circle cx="120" cy="90" r="6"/><text x="120" y="94" text-anchor="middle" fill="#be185d" font-size="9">+</text>
    <circle cx="100" cy="130" r="6"/><text x="100" y="134" text-anchor="middle" fill="#be185d" font-size="9">+</text>
    <circle cx="140" cy="140" r="6"/><text x="140" y="144" text-anchor="middle" fill="#be185d" font-size="9">+</text>
    <circle cx="70" cy="150" r="6"/><text x="70" y="154" text-anchor="middle" fill="#be185d" font-size="9">+</text>
  </g>
  <!-- Acceptor ions (fixed negative) near junction -->
  <g fill="#3b82f6" font-size="11" font-weight="700">
    <text x="200" y="90">&minus;</text>
    <text x="200" y="115">&minus;</text>
    <text x="200" y="140">&minus;</text>
    <text x="200" y="165">&minus;</text>
    <text x="215" y="100">&minus;</text>
    <text x="215" y="130">&minus;</text>
    <text x="215" y="155">&minus;</text>
  </g>
  <!-- n-type region -->
  <rect x="240" y="60" width="200" height="120" fill="#dbeafe" stroke="#1d4ed8" stroke-width="1.5" rx="4"/>
  <text x="340" y="50" text-anchor="middle" fill="#1d4ed8" font-size="12" font-weight="700">n-type</text>
  <!-- Electrons in n-type -->
  <g fill="#1d4ed8" font-size="9">
    <text x="320" y="104">&minus;</text>
    <text x="360" y="94">&minus;</text>
    <text x="340" y="134">&minus;</text>
    <text x="380" y="124">&minus;</text>
    <text x="400" y="154">&minus;</text>
  </g>
  <!-- Donor ions (fixed positive) near junction -->
  <g fill="#dc2626" font-size="11" font-weight="700">
    <text x="255" y="90">+</text>
    <text x="255" y="115">+</text>
    <text x="255" y="140">+</text>
    <text x="255" y="165">+</text>
    <text x="270" y="100">+</text>
    <text x="270" y="130">+</text>
    <text x="270" y="155">+</text>
  </g>
  <!-- Depletion region -->
  <rect x="195" y="58" width="90" height="124" fill="rgba(255,255,255,0.3)" stroke="#d97706" stroke-width="2" stroke-dasharray="6,3" rx="3"/>
  <text x="240" y="200" text-anchor="middle" fill="#d97706" font-size="10" font-weight="600">Depletion Region</text>
  <!-- Junction line -->
  <line x1="240" y1="55" x2="240" y2="185" stroke="#555" stroke-width="1" stroke-dasharray="4,2"/>
  <!-- Electric field arrow in depletion region -->
  <line x1="270" y1="230" x2="210" y2="230" stroke="#dc2626" stroke-width="2" marker-end="url(#arFis)"/>
  <text x="240" y="248" text-anchor="middle" fill="#dc2626" font-size="10" font-weight="600">E (barrier field)</text>
  <!-- Barrier potential -->
  <text x="240" y="265" text-anchor="middle" fill="var(--ink-2)" font-size="10">V&#7495; &#8776; 0.7V (Si), 0.3V (Ge)</text>
</svg>
</div>
<div class="caption">
  <div class="fig-num" style="color:var(--ch14)">Fig 14.1 &middot; Chapter 14</div>
  <div class="fig-title">p-n junction formation with depletion region</div>
</div>
</div>

<!-- Diagram 43: Forward bias -->
<div class="diagram-card">
<div class="svg-wrap">
<svg viewBox="0 0 460 220" xmlns="http://www.w3.org/2000/svg">
  <!-- p-type -->
  <rect x="80" y="40" width="140" height="90" fill="#fce7f3" stroke="#be185d" stroke-width="1.5" rx="4"/>
  <text x="150" y="75" text-anchor="middle" fill="#be185d" font-size="14" font-weight="700">p</text>
  <!-- n-type -->
  <rect x="240" y="40" width="140" height="90" fill="#dbeafe" stroke="#1d4ed8" stroke-width="1.5" rx="4"/>
  <text x="310" y="75" text-anchor="middle" fill="#1d4ed8" font-size="14" font-weight="700">n</text>
  <!-- Narrow depletion region -->
  <rect x="215" y="38" width="30" height="94" fill="rgba(217,119,6,0.15)" stroke="#d97706" stroke-width="1.5" stroke-dasharray="4,2" rx="2"/>
  <text x="230" y="150" text-anchor="middle" fill="#d97706" font-size="9">Narrow</text>
  <!-- Battery (+ to p, - to n) -->
  <line x1="80" y1="85" x2="40" y2="85" stroke="#555" stroke-width="1.5"/>
  <line x1="40" y1="85" x2="40" y2="170" stroke="#555" stroke-width="1.5"/>
  <line x1="40" y1="170" x2="420" y2="170" stroke="#555" stroke-width="1.5"/>
  <line x1="420" y1="170" x2="420" y2="85" stroke="#555" stroke-width="1.5"/>
  <line x1="420" y1="85" x2="380" y2="85" stroke="#555" stroke-width="1.5"/>
  <!-- Battery symbol -->
  <line x1="220" y1="162" x2="220" y2="178" stroke="#555" stroke-width="3"/>
  <line x1="230" y1="166" x2="230" y2="174" stroke="#555" stroke-width="1.5"/>
  <text x="212" y="188" fill="#dc2626" font-size="10">+</text>
  <text x="234" y="188" fill="#3b82f6" font-size="10">&minus;</text>
  <text x="225" y="205" text-anchor="middle" fill="#555" font-size="10">V (Forward)</text>
  <!-- Current flow arrow -->
  <text x="230" y="30" text-anchor="middle" fill="#0d9488" font-size="11" font-weight="600">Current flows (I)</text>
  <line x1="300" y1="25" x2="160" y2="25" stroke="#0d9488" stroke-width="2" marker-end="url(#arFis)"/>
  <!-- Holes move right, electrons move left -->
  <text x="150" y="100" text-anchor="middle" fill="#be185d" font-size="8">holes &#8594;</text>
  <text x="310" y="100" text-anchor="middle" fill="#1d4ed8" font-size="8">&#8592; e&#8315;</text>
</svg>
</div>
<div class="caption">
  <div class="fig-num" style="color:var(--ch14)">Fig 14.2 &middot; Chapter 14</div>
  <div class="fig-title">Forward bias: depletion region narrows, current flows</div>
</div>
</div>

<!-- Diagram 44: Reverse bias -->
<div class="diagram-card">
<div class="svg-wrap">
<svg viewBox="0 0 460 220" xmlns="http://www.w3.org/2000/svg">
  <!-- p-type -->
  <rect x="80" y="40" width="120" height="90" fill="#fce7f3" stroke="#be185d" stroke-width="1.5" rx="4"/>
  <text x="140" y="75" text-anchor="middle" fill="#be185d" font-size="14" font-weight="700">p</text>
  <!-- n-type -->
  <rect x="260" y="40" width="120" height="90" fill="#dbeafe" stroke="#1d4ed8" stroke-width="1.5" rx="4"/>
  <text x="320" y="75" text-anchor="middle" fill="#1d4ed8" font-size="14" font-weight="700">n</text>
  <!-- Wide depletion region -->
  <rect x="195" y="38" width="70" height="94" fill="rgba(217,119,6,0.2)" stroke="#d97706" stroke-width="2" stroke-dasharray="4,2" rx="2"/>
  <text x="230" y="150" text-anchor="middle" fill="#d97706" font-size="9" font-weight="600">Wide depletion</text>
  <!-- Battery (- to p, + to n) reversed -->
  <line x1="80" y1="85" x2="40" y2="85" stroke="#555" stroke-width="1.5"/>
  <line x1="40" y1="85" x2="40" y2="170" stroke="#555" stroke-width="1.5"/>
  <line x1="40" y1="170" x2="420" y2="170" stroke="#555" stroke-width="1.5"/>
  <line x1="420" y1="170" x2="420" y2="85" stroke="#555" stroke-width="1.5"/>
  <line x1="420" y1="85" x2="380" y2="85" stroke="#555" stroke-width="1.5"/>
  <!-- Battery symbol (reversed) -->
  <line x1="220" y1="162" x2="220" y2="178" stroke="#555" stroke-width="3"/>
  <line x1="230" y1="166" x2="230" y2="174" stroke="#555" stroke-width="1.5"/>
  <text x="212" y="188" fill="#3b82f6" font-size="10">&minus;</text>
  <text x="234" y="188" fill="#dc2626" font-size="10">+</text>
  <text x="225" y="205" text-anchor="middle" fill="#555" font-size="10">V (Reverse)</text>
  <!-- No current (or negligible) -->
  <text x="230" y="28" text-anchor="middle" fill="#dc2626" font-size="11" font-weight="600">No current (negligible I)</text>
  <!-- Holes and electrons move away from junction -->
  <text x="120" y="100" text-anchor="middle" fill="#be185d" font-size="8">&#8592; holes</text>
  <text x="340" y="100" text-anchor="middle" fill="#1d4ed8" font-size="8">e&#8315; &#8594;</text>
</svg>
</div>
<div class="caption">
  <div class="fig-num" style="color:var(--ch14)">Fig 14.3 &middot; Chapter 14</div>
  <div class="fig-title">Reverse bias: depletion region widens, no current</div>
</div>
</div>

<!-- Diagram 45: V-I characteristics of p-n junction diode -->
<div class="diagram-card">
<div class="svg-wrap">
<svg viewBox="0 0 440 320" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <marker id="arAx7" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto"><polygon points="0,0 8,3 0,6" fill="#555"/></marker>
  </defs>
  <!-- Axes -->
  <line x1="200" y1="280" x2="400" y2="280" stroke="#555" stroke-width="1.5" marker-end="url(#arAx7)"/>
  <line x1="200" y1="280" x2="40" y2="280" stroke="#555" stroke-width="1.5"/>
  <line x1="200" y1="290" x2="200" y2="20" stroke="#555" stroke-width="1.5" marker-end="url(#arAx7)"/>
  <line x1="200" y1="280" x2="200" y2="310" stroke="#555" stroke-width="1"/>
  <text x="410" y="278" fill="#555" font-size="10" font-weight="600">V</text>
  <text x="190" y="18" text-anchor="end" fill="#555" font-size="10" font-weight="600">I (mA)</text>
  <text x="192" y="290" fill="#555" font-size="9">O</text>
  <!-- Forward bias curve -->
  <path d="M 200,280 L 250,279 Q 280,275 300,260 Q 320,230 340,160 Q 350,100 360,50" fill="none" stroke="#0d9488" stroke-width="2.5"/>
  <text x="365" y="45" fill="#0d9488" font-size="10" font-weight="600">Forward</text>
  <!-- Knee voltage -->
  <line x1="280" y1="275" x2="280" y2="285" stroke="#d97706" stroke-width="1"/>
  <text x="280" y="298" text-anchor="middle" fill="#d97706" font-size="8" font-weight="600">V&#7498;</text>
  <text x="280" y="310" text-anchor="middle" fill="#d97706" font-size="7">(0.7V Si)</text>
  <!-- Reverse bias region -->
  <path d="M 200,280 L 100,282 Q 80,283 70,283" fill="none" stroke="#0d9488" stroke-width="2"/>
  <text x="100" y="275" text-anchor="middle" fill="#0d9488" font-size="9">Reverse</text>
  <text x="70" y="298" text-anchor="middle" fill="#555" font-size="8">&minus;V</text>
  <!-- Reverse saturation current label -->
  <text x="130" y="292" text-anchor="middle" fill="#555" font-size="7">I&#8347; (&#956;A)</text>
  <!-- Labels -->
  <text x="340" y="290" text-anchor="middle" fill="#555" font-size="8">+V</text>
  <text x="200" y="310" text-anchor="middle" fill="#555" font-size="7">&minus;I</text>
</svg>
</div>
<div class="caption">
  <div class="fig-num" style="color:var(--ch14)">Fig 14.4 &middot; Chapter 14</div>
  <div class="fig-title">V-I characteristics of a p-n junction diode</div>
</div>
</div>

<!-- Diagram 46: Zener diode V-I characteristics -->
<div class="diagram-card">
<div class="svg-wrap">
<svg viewBox="0 0 440 320" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <marker id="arAx8" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto"><polygon points="0,0 8,3 0,6" fill="#555"/></marker>
  </defs>
  <!-- Axes -->
  <line x1="220" y1="200" x2="400" y2="200" stroke="#555" stroke-width="1.5" marker-end="url(#arAx8)"/>
  <line x1="220" y1="200" x2="40" y2="200" stroke="#555" stroke-width="1.5"/>
  <line x1="220" y1="210" x2="220" y2="20" stroke="#555" stroke-width="1.5" marker-end="url(#arAx8)"/>
  <line x1="220" y1="200" x2="220" y2="310" stroke="#555" stroke-width="1.5"/>
  <text x="410" y="198" fill="#555" font-size="10" font-weight="600">V</text>
  <text x="210" y="18" text-anchor="end" fill="#555" font-size="10" font-weight="600">I</text>
  <text x="225" y="215" fill="#555" font-size="9">O</text>
  <!-- Forward (same as normal diode) -->
  <path d="M 220,200 Q 270,198 290,180 Q 310,150 330,60" fill="none" stroke="#0d9488" stroke-width="2"/>
  <text x="340" y="55" fill="#0d9488" font-size="9">Forward</text>
  <!-- Reverse characteristic with sharp breakdown -->
  <path d="M 220,200 L 120,202" fill="none" stroke="#0d9488" stroke-width="2"/>
  <!-- Breakdown -->
  <path d="M 120,202 Q 115,205 110,215 Q 105,240 100,310" fill="none" stroke="#dc2626" stroke-width="2.5"/>
  <!-- Breakdown voltage marker -->
  <line x1="120" y1="200" x2="120" y2="210" stroke="#dc2626" stroke-width="1"/>
  <text x="120" y="225" text-anchor="middle" fill="#dc2626" font-size="9" font-weight="700">&minus;V&#7530;</text>
  <text x="120" y="238" text-anchor="middle" fill="#dc2626" font-size="8">(Breakdown)</text>
  <!-- Sharp increase in reverse current -->
  <text x="80" y="270" fill="#dc2626" font-size="9" font-weight="600">Sharp increase</text>
  <text x="80" y="283" fill="#dc2626" font-size="9">in reverse I</text>
  <!-- Zener diode symbol -->
  <g transform="translate(300,250)">
    <line x1="0" y1="15" x2="40" y2="15" stroke="#0d9488" stroke-width="1.5"/>
    <polygon points="40,5 40,25 60,15" fill="none" stroke="#0d9488" stroke-width="1.5"/>
    <line x1="60" y1="5" x2="60" y2="25" stroke="#0d9488" stroke-width="2"/>
    <line x1="60" y1="5" x2="55" y2="5" stroke="#0d9488" stroke-width="2"/>
    <line x1="60" y1="25" x2="65" y2="25" stroke="#0d9488" stroke-width="2"/>
    <line x1="60" y1="15" x2="100" y2="15" stroke="#0d9488" stroke-width="1.5"/>
  </g>
  <text x="350" y="290" text-anchor="middle" fill="#0d9488" font-size="9">Zener symbol</text>
</svg>
</div>
<div class="caption">
  <div class="fig-num" style="color:var(--ch14)">Fig 14.5 &middot; Chapter 14</div>
  <div class="fig-title">Zener diode V-I characteristics (breakdown region)</div>
</div>
</div>

<!-- Diagram 47: Zener diode as voltage regulator -->
<div class="diagram-card">
<div class="svg-wrap">
<svg viewBox="0 0 440 240" xmlns="http://www.w3.org/2000/svg">
  <!-- Input -->
  <text x="30" y="55" fill="#555" font-size="10" font-weight="600">V&#7522;&#7524;</text>
  <line x1="50" y1="60" x2="120" y2="60" stroke="#555" stroke-width="2"/>
  <line x1="50" y1="180" x2="120" y2="180" stroke="#555" stroke-width="2"/>
  <line x1="50" y1="60" x2="50" y2="180" stroke="#555" stroke-width="2"/>
  <!-- Series resistance R_s -->
  <rect x="120" y="48" width="70" height="24" rx="4" fill="#f0fdfa" stroke="#0d9488" stroke-width="1.5"/>
  <text x="155" y="65" text-anchor="middle" fill="#0d9488" font-size="11" font-weight="700">R&#8347;</text>
  <line x1="190" y1="60" x2="280" y2="60" stroke="#555" stroke-width="2"/>
  <!-- Junction to Zener and Load -->
  <line x1="280" y1="60" x2="280" y2="180" stroke="#555" stroke-width="2"/>
  <line x1="120" y1="180" x2="400" y2="180" stroke="#555" stroke-width="2"/>
  <!-- Zener diode (in reverse bias) -->
  <g transform="translate(265,90)">
    <line x1="15" y1="0" x2="15" y2="20" stroke="#0d9488" stroke-width="1.5"/>
    <polygon points="5,20 25,20 15,40" fill="none" stroke="#0d9488" stroke-width="2"/>
    <line x1="5" y1="40" x2="25" y2="40" stroke="#0d9488" stroke-width="2"/>
    <line x1="5" y1="40" x2="5" y2="45" stroke="#0d9488" stroke-width="2"/>
    <line x1="25" y1="40" x2="25" y2="35" stroke="#0d9488" stroke-width="2"/>
    <line x1="15" y1="40" x2="15" y2="60" stroke="#0d9488" stroke-width="1.5"/>
  </g>
  <text x="255" y="125" text-anchor="end" fill="#0d9488" font-size="10" font-weight="600">Zener</text>
  <text x="255" y="138" text-anchor="end" fill="#0d9488" font-size="9">V&#7530;</text>
  <!-- I_z label -->
  <text x="290" y="105" fill="#0d9488" font-size="9">I&#7530;</text>
  <!-- Load R_L -->
  <line x1="360" y1="60" x2="360" y2="90" stroke="#555" stroke-width="2"/>
  <rect x="346" y="90" width="28" height="55" rx="4" fill="#f0fdfa" stroke="#0d9488" stroke-width="1.5"/>
  <text x="360" y="122" text-anchor="middle" fill="#0d9488" font-size="11" font-weight="700">R&#7463;</text>
  <line x1="360" y1="145" x2="360" y2="180" stroke="#555" stroke-width="2"/>
  <line x1="280" y1="60" x2="360" y2="60" stroke="#555" stroke-width="2"/>
  <!-- Output voltage labels -->
  <text x="400" y="55" fill="#dc2626" font-size="10" font-weight="600">V&#8338;</text>
  <text x="400" y="70" fill="#dc2626" font-size="9">= V&#7530;</text>
  <line x1="390" y1="60" x2="390" y2="180" stroke="#dc2626" stroke-width="1" stroke-dasharray="3,2"/>
  <text x="390" y="128" fill="#dc2626" font-size="8">(constant)</text>
  <!-- Ground -->
  <line x1="220" y1="180" x2="220" y2="195" stroke="#555" stroke-width="1.5"/>
  <line x1="210" y1="195" x2="230" y2="195" stroke="#555" stroke-width="1.5"/>
  <line x1="214" y1="200" x2="226" y2="200" stroke="#555" stroke-width="1"/>
  <line x1="218" y1="205" x2="222" y2="205" stroke="#555" stroke-width="0.5"/>
  <!-- Formula -->
  <text x="220" y="230" text-anchor="middle" fill="var(--ink-2)" font-size="10">V&#8338; = V&#7530; (constant regardless of V&#7522;&#7524; variation)</text>
</svg>
</div>
<div class="caption">
  <div class="fig-num" style="color:var(--ch14)">Fig 14.6 &middot; Chapter 14</div>
  <div class="fig-title">Zener diode as voltage regulator circuit</div>
</div>
</div>

<!-- Diagram 48: CE NPN transistor amplifier -->
<div class="diagram-card">
<div class="svg-wrap">
<svg viewBox="0 0 500 300" xmlns="http://www.w3.org/2000/svg">
  <!-- NPN transistor symbol -->
  <line x1="230" y1="100" x2="230" y2="200" stroke="#0d9488" stroke-width="3"/>
  <line x1="180" y1="150" x2="230" y2="150" stroke="#0d9488" stroke-width="2"/><!-- Base -->
  <line x1="230" y1="120" x2="280" y2="80" stroke="#0d9488" stroke-width="2"/><!-- Collector -->
  <line x1="230" y1="180" x2="280" y2="220" stroke="#0d9488" stroke-width="2"/><!-- Emitter -->
  <!-- Emitter arrow -->
  <polygon points="265,205 275,218 258,214" fill="#0d9488"/>
  <!-- Labels -->
  <text x="170" y="155" text-anchor="end" fill="#0d9488" font-size="11" font-weight="700">B</text>
  <text x="290" y="78" fill="#0d9488" font-size="11" font-weight="700">C</text>
  <text x="290" y="228" fill="#0d9488" font-size="11" font-weight="700">E</text>
  <text x="245" y="155" fill="#555" font-size="8">NPN</text>
  <!-- Input circuit (Base-Emitter) -->
  <line x1="100" y1="150" x2="180" y2="150" stroke="#555" stroke-width="1.5"/>
  <line x1="280" y1="220" x2="280" y2="260" stroke="#555" stroke-width="1.5"/>
  <line x1="100" y1="260" x2="280" y2="260" stroke="#555" stroke-width="1.5"/>
  <line x1="100" y1="150" x2="100" y2="260" stroke="#555" stroke-width="1.5"/>
  <!-- Input signal -->
  <circle cx="100" cy="190" r="14" fill="#f0fdfa" stroke="#0d9488" stroke-width="1.5"/>
  <path d="M 92,190 Q 96,182 100,190 Q 104,198 108,190" fill="none" stroke="#0d9488" stroke-width="1.5"/>
  <text x="75" y="195" text-anchor="end" fill="#0d9488" font-size="9">V&#7522;&#7524;</text>
  <!-- V_BB (base bias) -->
  <line x1="130" y1="252" x2="130" y2="268" stroke="#555" stroke-width="2"/>
  <line x1="138" y1="256" x2="138" y2="264" stroke="#555" stroke-width="1"/>
  <text x="134" y="280" text-anchor="middle" fill="#555" font-size="8">V&#7495;&#7495;</text>
  <!-- Output circuit (Collector-Emitter) -->
  <line x1="280" y1="80" x2="280" y2="40" stroke="#555" stroke-width="1.5"/>
  <line x1="280" y1="40" x2="420" y2="40" stroke="#555" stroke-width="1.5"/>
  <line x1="420" y1="40" x2="420" y2="260" stroke="#555" stroke-width="1.5"/>
  <line x1="280" y1="260" x2="420" y2="260" stroke="#555" stroke-width="1.5"/>
  <!-- R_C (collector resistance) -->
  <rect x="268" y="40" width="24" height="35" rx="3" fill="#f0fdfa" stroke="#0d9488" stroke-width="1.5"/>
  <text x="280" y="62" text-anchor="middle" fill="#0d9488" font-size="9" font-weight="600">R&#7580;</text>
  <!-- V_CC -->
  <line x1="380" y1="32" x2="380" y2="48" stroke="#555" stroke-width="2.5"/>
  <line x1="388" y1="36" x2="388" y2="44" stroke="#555" stroke-width="1.5"/>
  <text x="384" y="25" text-anchor="middle" fill="#555" font-size="10">V&#7580;&#7580;</text>
  <!-- Output -->
  <text x="430" y="130" fill="#dc2626" font-size="10" font-weight="600">V&#8338;</text>
  <line x1="420" y1="80" x2="440" y2="80" stroke="#dc2626" stroke-width="1.5"/>
  <line x1="420" y1="220" x2="440" y2="220" stroke="#dc2626" stroke-width="1.5"/>
  <!-- CE label -->
  <text x="250" y="290" text-anchor="middle" fill="var(--ink-2)" font-size="10">Common Emitter: A&#7525; = &#946;(R&#7580;/R&#7522;&#7524;)</text>
</svg>
</div>
<div class="caption">
  <div class="fig-num" style="color:var(--ch14)">Fig 14.7 &middot; Chapter 14</div>
  <div class="fig-title">Common Emitter NPN transistor amplifier</div>
</div>
</div>

<!-- Diagram 49: CE transistor characteristics -->
<div class="diagram-card">
<div class="svg-wrap">
<svg viewBox="0 0 500 300" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <marker id="arAx9" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto"><polygon points="0,0 8,3 0,6" fill="#555"/></marker>
  </defs>
  <!-- INPUT characteristics (left) -->
  <text x="120" y="20" text-anchor="middle" fill="var(--ink)" font-size="11" font-weight="600">Input Characteristics</text>
  <line x1="30" y1="250" x2="220" y2="250" stroke="#555" stroke-width="1.5" marker-end="url(#arAx9)"/>
  <line x1="30" y1="250" x2="30" y2="40" stroke="#555" stroke-width="1.5" marker-end="url(#arAx9)"/>
  <text x="230" y="255" fill="#555" font-size="9">V&#7495;&#7497;</text>
  <text x="25" y="35" text-anchor="end" fill="#555" font-size="9">I&#7495;</text>
  <!-- Curve (like diode characteristic) -->
  <path d="M 30,248 Q 60,245 90,235 Q 120,210 140,150 Q 155,90 165,50" fill="none" stroke="#0d9488" stroke-width="2"/>
  <text x="170" y="50" fill="#0d9488" font-size="8">V&#7580;&#7497;=const</text>
  <!-- Second curve -->
  <path d="M 30,248 Q 50,245 80,240 Q 100,225 120,170 Q 135,110 145,60" fill="none" stroke="#0d9488" stroke-width="1.5" stroke-dasharray="5,3"/>

  <!-- OUTPUT characteristics (right) -->
  <text x="380" y="20" text-anchor="middle" fill="var(--ink)" font-size="11" font-weight="600">Output Characteristics</text>
  <line x1="270" y1="250" x2="470" y2="250" stroke="#555" stroke-width="1.5" marker-end="url(#arAx9)"/>
  <line x1="270" y1="250" x2="270" y2="40" stroke="#555" stroke-width="1.5" marker-end="url(#arAx9)"/>
  <text x="478" y="255" fill="#555" font-size="9">V&#7580;&#7497;</text>
  <text x="265" y="35" text-anchor="end" fill="#555" font-size="9">I&#7580;</text>
  <!-- Multiple curves for different I_B values -->
  <path d="M 270,245 Q 290,120 310,100 L 460,90" fill="none" stroke="#0d9488" stroke-width="2"/>
  <text x="462" y="88" fill="#0d9488" font-size="8">I&#7495;&#8323;</text>
  <path d="M 270,247 Q 290,160 310,145 L 460,135" fill="none" stroke="#0d9488" stroke-width="1.8"/>
  <text x="462" y="133" fill="#0d9488" font-size="8">I&#7495;&#8322;</text>
  <path d="M 270,248 Q 290,200 310,185 L 460,180" fill="none" stroke="#0d9488" stroke-width="1.5"/>
  <text x="462" y="178" fill="#0d9488" font-size="8">I&#7495;&#8321;</text>
  <path d="M 270,249 Q 290,235 310,225 L 460,220" fill="none" stroke="#0d9488" stroke-width="1.2" stroke-dasharray="5,3"/>
  <text x="462" y="218" fill="#0d9488" font-size="8">I&#7495;=0</text>
  <!-- Regions -->
  <line x1="310" y1="250" x2="310" y2="80" stroke="#999" stroke-width="0.5" stroke-dasharray="3,3"/>
  <text x="290" y="270" text-anchor="middle" fill="#999" font-size="7">Saturation</text>
  <text x="380" y="270" text-anchor="middle" fill="#999" font-size="7">Active region</text>
  <!-- Beta formula -->
  <text x="370" y="295" text-anchor="middle" fill="var(--ink-2)" font-size="10">&#946; = &#916;I&#7580;/&#916;I&#7495; (at const V&#7580;&#7497;)</text>
</svg>
</div>
<div class="caption">
  <div class="fig-num" style="color:var(--ch14)">Fig 14.8 &middot; Chapter 14</div>
  <div class="fig-title">Input and Output characteristics of CE transistor</div>
</div>
</div>

<!-- Diagram 50: Logic gate symbols and truth tables -->
<div class="diagram-card">
<div class="svg-wrap">
<svg viewBox="0 0 520 680" xmlns="http://www.w3.org/2000/svg">
  <!-- AND Gate -->
  <text x="60" y="25" fill="var(--ink)" font-size="12" font-weight="700">AND</text>
  <line x1="20" y1="40" x2="60" y2="40" stroke="#555" stroke-width="1.5"/>
  <line x1="20" y1="60" x2="60" y2="60" stroke="#555" stroke-width="1.5"/>
  <path d="M 60,30 L 60,30 L 90,30 Q 120,30 120,50 Q 120,70 90,70 L 60,70 Z" fill="#f0fdfa" stroke="#0d9488" stroke-width="2"/>
  <line x1="120" y1="50" x2="150" y2="50" stroke="#555" stroke-width="1.5"/>
  <text x="15" y="44" text-anchor="end" fill="#555" font-size="9">A</text>
  <text x="15" y="64" text-anchor="end" fill="#555" font-size="9">B</text>
  <text x="155" y="54" fill="#555" font-size="9">Y=A.B</text>
  <!-- AND truth table -->
  <g font-size="9" fill="#555">
    <text x="260" y="25" font-weight="600">A</text><text x="290" y="25" font-weight="600">B</text><text x="320" y="25" font-weight="600">Y</text>
    <line x1="250" y1="28" x2="340" y2="28" stroke="#ddd" stroke-width="0.5"/>
    <text x="260" y="40">0</text><text x="290" y="40">0</text><text x="320" y="40">0</text>
    <text x="260" y="52">0</text><text x="290" y="52">1</text><text x="320" y="52">0</text>
    <text x="260" y="64">1</text><text x="290" y="64">0</text><text x="320" y="64">0</text>
    <text x="260" y="76">1</text><text x="290" y="76">1</text><text x="320" y="76" fill="#0d9488" font-weight="600">1</text>
  </g>

  <!-- OR Gate -->
  <text x="60" y="115" fill="var(--ink)" font-size="12" font-weight="700">OR</text>
  <line x1="20" y1="130" x2="65" y2="130" stroke="#555" stroke-width="1.5"/>
  <line x1="20" y1="150" x2="65" y2="150" stroke="#555" stroke-width="1.5"/>
  <path d="M 55,120 Q 70,140 55,160 Q 90,160 120,140 Q 90,120 55,120 Z" fill="#f0fdfa" stroke="#0d9488" stroke-width="2"/>
  <line x1="120" y1="140" x2="150" y2="140" stroke="#555" stroke-width="1.5"/>
  <text x="15" y="134" text-anchor="end" fill="#555" font-size="9">A</text>
  <text x="15" y="154" text-anchor="end" fill="#555" font-size="9">B</text>
  <text x="155" y="144" fill="#555" font-size="9">Y=A+B</text>
  <!-- OR truth table -->
  <g font-size="9" fill="#555">
    <text x="260" y="115" font-weight="600">A</text><text x="290" y="115" font-weight="600">B</text><text x="320" y="115" font-weight="600">Y</text>
    <line x1="250" y1="118" x2="340" y2="118" stroke="#ddd" stroke-width="0.5"/>
    <text x="260" y="130">0</text><text x="290" y="130">0</text><text x="320" y="130">0</text>
    <text x="260" y="142">0</text><text x="290" y="142">1</text><text x="320" y="142" fill="#0d9488" font-weight="600">1</text>
    <text x="260" y="154">1</text><text x="290" y="154">0</text><text x="320" y="154" fill="#0d9488" font-weight="600">1</text>
    <text x="260" y="166">1</text><text x="290" y="166">1</text><text x="320" y="166" fill="#0d9488" font-weight="600">1</text>
  </g>

  <!-- NOT Gate -->
  <text x="60" y="205" fill="var(--ink)" font-size="12" font-weight="700">NOT</text>
  <line x1="20" y1="230" x2="60" y2="230" stroke="#555" stroke-width="1.5"/>
  <polygon points="60,215 60,245 100,230" fill="#f0fdfa" stroke="#0d9488" stroke-width="2"/>
  <circle cx="106" cy="230" r="5" fill="#f0fdfa" stroke="#0d9488" stroke-width="2"/>
  <line x1="111" y1="230" x2="150" y2="230" stroke="#555" stroke-width="1.5"/>
  <text x="15" y="234" text-anchor="end" fill="#555" font-size="9">A</text>
  <text x="155" y="234" fill="#555" font-size="9">Y=A'</text>
  <!-- NOT truth table -->
  <g font-size="9" fill="#555">
    <text x="260" y="215" font-weight="600">A</text><text x="310" y="215" font-weight="600">Y</text>
    <line x1="250" y1="218" x2="330" y2="218" stroke="#ddd" stroke-width="0.5"/>
    <text x="260" y="230">0</text><text x="310" y="230" fill="#0d9488" font-weight="600">1</text>
    <text x="260" y="242">1</text><text x="310" y="242">0</text>
  </g>

  <!-- NAND Gate -->
  <text x="60" y="285" fill="var(--ink)" font-size="12" font-weight="700">NAND</text>
  <line x1="20" y1="300" x2="60" y2="300" stroke="#555" stroke-width="1.5"/>
  <line x1="20" y1="320" x2="60" y2="320" stroke="#555" stroke-width="1.5"/>
  <path d="M 60,290 L 60,290 L 90,290 Q 120,290 120,310 Q 120,330 90,330 L 60,330 Z" fill="#f0fdfa" stroke="#0d9488" stroke-width="2"/>
  <circle cx="126" cy="310" r="5" fill="#f0fdfa" stroke="#0d9488" stroke-width="2"/>
  <line x1="131" y1="310" x2="155" y2="310" stroke="#555" stroke-width="1.5"/>
  <text x="15" y="304" text-anchor="end" fill="#555" font-size="9">A</text>
  <text x="15" y="324" text-anchor="end" fill="#555" font-size="9">B</text>
  <text x="160" y="314" fill="#555" font-size="8">Y=(A.B)'</text>
  <!-- NAND truth table -->
  <g font-size="9" fill="#555">
    <text x="260" y="285" font-weight="600">A</text><text x="290" y="285" font-weight="600">B</text><text x="320" y="285" font-weight="600">Y</text>
    <line x1="250" y1="288" x2="340" y2="288" stroke="#ddd" stroke-width="0.5"/>
    <text x="260" y="300" fill="#0d9488" font-weight="600">0</text><text x="290" y="300">0</text><text x="320" y="300" fill="#0d9488" font-weight="600">1</text>
    <text x="260" y="312">0</text><text x="290" y="312">1</text><text x="320" y="312" fill="#0d9488" font-weight="600">1</text>
    <text x="260" y="324">1</text><text x="290" y="324">0</text><text x="320" y="324" fill="#0d9488" font-weight="600">1</text>
    <text x="260" y="336">1</text><text x="290" y="336">1</text><text x="320" y="336">0</text>
  </g>

  <!-- NOR Gate -->
  <text x="60" y="375" fill="var(--ink)" font-size="12" font-weight="700">NOR</text>
  <line x1="20" y1="390" x2="65" y2="390" stroke="#555" stroke-width="1.5"/>
  <line x1="20" y1="410" x2="65" y2="410" stroke="#555" stroke-width="1.5"/>
  <path d="M 55,380 Q 70,400 55,420 Q 90,420 120,400 Q 90,380 55,380 Z" fill="#f0fdfa" stroke="#0d9488" stroke-width="2"/>
  <circle cx="126" cy="400" r="5" fill="#f0fdfa" stroke="#0d9488" stroke-width="2"/>
  <line x1="131" y1="400" x2="155" y2="400" stroke="#555" stroke-width="1.5"/>
  <text x="15" y="394" text-anchor="end" fill="#555" font-size="9">A</text>
  <text x="15" y="414" text-anchor="end" fill="#555" font-size="9">B</text>
  <text x="160" y="404" fill="#555" font-size="8">Y=(A+B)'</text>
  <!-- NOR truth table -->
  <g font-size="9" fill="#555">
    <text x="260" y="375" font-weight="600">A</text><text x="290" y="375" font-weight="600">B</text><text x="320" y="375" font-weight="600">Y</text>
    <line x1="250" y1="378" x2="340" y2="378" stroke="#ddd" stroke-width="0.5"/>
    <text x="260" y="390">0</text><text x="290" y="390">0</text><text x="320" y="390" fill="#0d9488" font-weight="600">1</text>
    <text x="260" y="402">0</text><text x="290" y="402">1</text><text x="320" y="402">0</text>
    <text x="260" y="414">1</text><text x="290" y="414">0</text><text x="320" y="414">0</text>
    <text x="260" y="426">1</text><text x="290" y="426">1</text><text x="320" y="426">0</text>
  </g>

  <!-- XOR Gate -->
  <text x="60" y="465" fill="var(--ink)" font-size="12" font-weight="700">XOR</text>
  <line x1="20" y1="480" x2="65" y2="480" stroke="#555" stroke-width="1.5"/>
  <line x1="20" y1="500" x2="65" y2="500" stroke="#555" stroke-width="1.5"/>
  <path d="M 55,470 Q 70,490 55,510 Q 90,510 120,490 Q 90,470 55,470 Z" fill="#f0fdfa" stroke="#0d9488" stroke-width="2"/>
  <!-- Extra curve for XOR -->
  <path d="M 50,470 Q 65,490 50,510" fill="none" stroke="#0d9488" stroke-width="2"/>
  <line x1="120" y1="490" x2="155" y2="490" stroke="#555" stroke-width="1.5"/>
  <text x="15" y="484" text-anchor="end" fill="#555" font-size="9">A</text>
  <text x="15" y="504" text-anchor="end" fill="#555" font-size="9">B</text>
  <text x="160" y="494" fill="#555" font-size="8">Y=A&#8853;B</text>
  <!-- XOR truth table -->
  <g font-size="9" fill="#555">
    <text x="260" y="465" font-weight="600">A</text><text x="290" y="465" font-weight="600">B</text><text x="320" y="465" font-weight="600">Y</text>
    <line x1="250" y1="468" x2="340" y2="468" stroke="#ddd" stroke-width="0.5"/>
    <text x="260" y="480">0</text><text x="290" y="480">0</text><text x="320" y="480">0</text>
    <text x="260" y="492">0</text><text x="290" y="492">1</text><text x="320" y="492" fill="#0d9488" font-weight="600">1</text>
    <text x="260" y="504">1</text><text x="290" y="504">0</text><text x="320" y="504" fill="#0d9488" font-weight="600">1</text>
    <text x="260" y="516">1</text><text x="290" y="516">1</text><text x="320" y="516">0</text>
  </g>

  <!-- Universal gate note -->
  <rect x="20" y="545" width="480" height="40" rx="6" fill="#f0fdfa" stroke="#0d9488" stroke-width="1"/>
  <text x="260" y="562" text-anchor="middle" fill="#0d9488" font-size="10" font-weight="600">NAND and NOR are Universal Gates</text>
  <text x="260" y="578" text-anchor="middle" fill="#64748b" font-size="9">Any logic circuit can be built using only NAND or only NOR gates</text>

  <!-- Boolean identities -->
  <text x="260" y="610" text-anchor="middle" fill="var(--ink-2)" font-size="9">De Morgan's: (A.B)' = A'+B' and (A+B)' = A'.B'</text>
</svg>
</div>
<div class="caption">
  <div class="fig-num" style="color:var(--ch14)">Fig 14.9 &middot; Chapter 14</div>
  <div class="fig-title">Logic gate symbols with truth tables: AND, OR, NOT, NAND, NOR, XOR</div>
</div>
</div>

</div>
</section>

</main>

<!-- Back to top button -->
<button class="back-top" id="backTop" onclick="window.scrollTo({top:0,behavior:'smooth'})">
<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M18 15l-6-6-6 6"/></svg>
</button>

<script>
// Back to top visibility
const btn = document.getElementById('backTop');
window.addEventListener('scroll', () => {
  btn.classList.toggle('visible', window.scrollY > 400);
});

// ‚îÄ‚îÄ Per-diagram 3D toggle ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
(function() {
  var init3dDone = false;

  // Find card by figure ID and inject .view-3d div
  function injectView3D(figId, height) {
    var cards = document.querySelectorAll('.diagram-card');
    for (var i = 0; i < cards.length; i++) {
      var fn = cards[i].querySelector('.fig-num');
      if (fn && fn.textContent.indexOf(figId) !== -1) {
        if (cards[i].querySelector('.view-3d')) return cards[i].querySelector('.view-3d');
        var wrap = document.createElement('div');
        wrap.className = 'view-3d';
        var caption = cards[i].querySelector('.caption');
        cards[i].insertBefore(wrap, caption);
        return wrap;
      }
    }
    return null;
  }
  window.injectView3D = injectView3D;

  function ensureInit() {
    if (!init3dDone) {
      init3dDone = true;
      if (typeof initAll3D === 'function') initAll3D();
    }
  }

  // Inject a small toggle button into every diagram card
  function injectCardButtons() {
    document.querySelectorAll('.diagram-card').forEach(function(card) {
      if (card.querySelector('.toggle-3d-btn')) return;
      var b = document.createElement('button');
      b.className = 'toggle-3d-btn';
      b.textContent = '‚ú¶ 3D';
      b.title = 'View 3D / animated version';
      b.addEventListener('click', function(e) {
        e.stopPropagation();
        var on = card.classList.toggle('card-3d');
        b.textContent = on ? '‚óß 2D' : '‚ú¶ 3D';
        b.title = on ? 'Back to 2D diagram' : 'View 3D / animated version';
        if (on) ensureInit();
      });
      card.appendChild(b);
    });
  }
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', injectCardButtons);
  } else {
    injectCardButtons();
  }

  // Global hero buttons ‚Äî toggle ALL cards at once
  var btn2d = document.getElementById('btn2d');
  var btn3d = document.getElementById('btn3d');
  if (btn3d) btn3d.addEventListener('click', function() {
    ensureInit();
    document.querySelectorAll('.diagram-card').forEach(function(c){ c.classList.add('card-3d'); });
    document.querySelectorAll('.toggle-3d-btn').forEach(function(b){ b.textContent = '‚óß 2D'; });
    btn3d.classList.add('active'); btn2d.classList.remove('active');
  });
  if (btn2d) btn2d.addEventListener('click', function() {
    document.querySelectorAll('.diagram-card').forEach(function(c){ c.classList.remove('card-3d'); });
    document.querySelectorAll('.toggle-3d-btn').forEach(function(b){ b.textContent = '‚ú¶ 3D'; });
    btn2d.classList.add('active'); btn3d.classList.remove('active');
  });
})();
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script>
// Wavefront 3D is now lazy ‚Äî initialized via register3D after DOM ready
// (canvas was display:none at page load so immediate init gave W=0)
void 0;
</script>
<script>
(function(){
  // Deferred wavefront init ‚Äî runs lazily via register3D
  function initWavefront3D(){
  const canvas = document.getElementById('wavefront3d');
  if (!canvas || typeof THREE === 'undefined') return;
  if (canvas._wf3dDone) return;
  canvas._wf3dDone = true;

  // Use parent container width; fall back to 560 if still hidden
  const W = (canvas.closest('.view-3d') || canvas.parentElement).offsetWidth || 560;
  const H = 360;
  canvas.width  = W * devicePixelRatio;
  canvas.height = H * devicePixelRatio;

  const renderer = new THREE.WebGLRenderer({ canvas, antialias: true, alpha: true });
  renderer.setPixelRatio(devicePixelRatio);
  renderer.setSize(W, H);
  renderer.setClearColor(0x0f0c1a, 1);

  const scene = new THREE.Scene();

  const camera = new THREE.PerspectiveCamera(42, W / H, 0.1, 200);
  camera.position.set(0, 7, 26);
  camera.lookAt(0, 0, 0);

  // Ambient + two directional lights for subtle shading on solid pieces
  scene.add(new THREE.AmbientLight(0xffffff, 0.6));
  const dLight = new THREE.DirectionalLight(0xc4b5fd, 1.2);
  dLight.position.set(5, 10, 8);
  scene.add(dLight);

  const C_FRONT  = 0x8b5cf6;  // wavefront purple
  const C_BRIGHT = 0xa78bfa;  // brighter purple
  const C_SRC    = 0xf59e0b;  // amber source
  const C_RAY    = 0x7dd3fc;  // light blue rays

  // ‚îÄ‚îÄ‚îÄ helpers ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function wireSphere(r, opacity) {
    const g = new THREE.SphereGeometry(r, 32, 20);
    return new THREE.Mesh(g, new THREE.MeshBasicMaterial({
      color: C_FRONT, wireframe: true, transparent: true, opacity
    }));
  }

  function addArrow(scene, from, to, color) {
    const dir = new THREE.Vector3().subVectors(to, from).normalize();
    const len = from.distanceTo(to);
    const arrow = new THREE.ArrowHelper(dir, from, len, color, 0.35, 0.18);
    scene.add(arrow);
  }

  // ‚îÄ‚îÄ‚îÄ GROUP 1: Spherical wavefront (left) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const gSph = new THREE.Group();
  gSph.position.set(-10, 0, 0);

  [1.8, 3.2, 4.6].forEach((r, i) => {
    const m = wireSphere(r, 0.55 - i * 0.12);
    gSph.add(m);
  });

  // Point source
  const srcGeo = new THREE.SphereGeometry(0.18, 12, 8);
  const srcMat = new THREE.MeshBasicMaterial({ color: C_SRC });
  gSph.add(new THREE.Mesh(srcGeo, srcMat));

  // Rays from source
  const O = new THREE.Vector3(0, 0, 0);
  const rayDirs = [
    new THREE.Vector3(1,0,0), new THREE.Vector3(0,1,0),
    new THREE.Vector3(0,0,1), new THREE.Vector3(-1,0,0),
    new THREE.Vector3(0.7,0.7,0).normalize(),
    new THREE.Vector3(0.7,0,0.7).normalize(),
  ];
  rayDirs.forEach(d => {
    addArrow(gSph, O.clone(), d.clone().multiplyScalar(5.2), C_RAY);
  });

  scene.add(gSph);

  // ‚îÄ‚îÄ‚îÄ GROUP 2: Plane wavefront (centre) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const gPln = new THREE.Group();
  gPln.position.set(0, 0, 0);

  [-2.5, 0, 2.5].forEach((x, i) => {
    const planeGeo = new THREE.PlaneGeometry(6, 6, 8, 8);
    const planeMat = new THREE.MeshBasicMaterial({
      color: C_FRONT, wireframe: true, transparent: true, opacity: 0.6
    });
    const plane = new THREE.Mesh(planeGeo, planeMat);
    plane.rotation.y = Math.PI / 2;   // faces along X axis (wavefronts ‚ä• to propagation)
    plane.position.x = x;
    gPln.add(plane);
  });

  // Parallel rays going in +x direction
  for (let y = -2; y <= 2; y += 2) {
    for (let z = -2; z <= 2; z += 2) {
      addArrow(gPln,
        new THREE.Vector3(-4, y, z),
        new THREE.Vector3( 4, y, z),
        C_RAY);
    }
  }

  // "Distant source" label sphere (dim, far left)
  const dSrc = new THREE.Mesh(
    new THREE.SphereGeometry(0.12, 8, 6),
    new THREE.MeshBasicMaterial({ color: C_SRC })
  );
  dSrc.position.set(-5, 0, 0);
  gPln.add(dSrc);

  scene.add(gPln);

  // ‚îÄ‚îÄ‚îÄ GROUP 3: Cylindrical wavefront (right) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const gCyl = new THREE.Group();
  gCyl.position.set(10, 0, 0);

  [1.4, 2.6, 3.8].forEach((r, i) => {
    const g = new THREE.CylinderGeometry(r, r, 6, 32, 4, true);
    const m = new THREE.Mesh(g, new THREE.MeshBasicMaterial({
      color: C_FRONT, wireframe: true, transparent: true, opacity: 0.55 - i * 0.1
    }));
    gCyl.add(m);
  });

  // Line source (vertical rod)
  const rodGeo = new THREE.CylinderGeometry(0.09, 0.09, 6.2, 12);
  const rodMat = new THREE.MeshBasicMaterial({ color: C_SRC });
  gCyl.add(new THREE.Mesh(rodGeo, rodMat));

  // Radial rays from line source outward in XZ plane at several heights
  [-2, 0, 2].forEach(y => {
    [0, 60, 120, 180, 240, 300].forEach(deg => {
      const rad = deg * Math.PI / 180;
      const from = new THREE.Vector3(0, y, 0);
      const to   = new THREE.Vector3(Math.cos(rad) * 4.5, y, Math.sin(rad) * 4.5);
      addArrow(gCyl, from, to, C_RAY);
    });
  });

  scene.add(gCyl);

  // ‚îÄ‚îÄ‚îÄ Subtle grid floor ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const grid = new THREE.GridHelper(36, 18, 0x2d1f4e, 0x1e1535);
  grid.position.y = -4;
  scene.add(grid);

  // ‚îÄ‚îÄ‚îÄ Orbit control (manual) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  let isDragging = false;
  let prevX = 0, prevY = 0;
  let rotX = 0.22, rotY = 0;   // initial tilt
  let zoom = 26;
  const pivot = new THREE.Group();
  scene.add(pivot);
  pivot.add(gSph); pivot.add(gPln); pivot.add(gCyl); pivot.add(grid);
  scene.remove(gSph); scene.remove(gPln); scene.remove(gCyl); scene.remove(grid);

  function applyOrbit() {
    pivot.rotation.x = rotX;
    pivot.rotation.y = rotY;
    camera.position.set(0, 0, zoom);
    camera.lookAt(0, 0, 0);
  }
  applyOrbit();

  // Auto-rotate when idle
  let autoRotate = true;
  let idleTimer;

  canvas.addEventListener('mousedown', e => {
    isDragging = true; autoRotate = false;
    prevX = e.clientX; prevY = e.clientY;
    canvas.style.cursor = 'grabbing';
  });
  window.addEventListener('mouseup', () => {
    isDragging = false;
    canvas.style.cursor = 'grab';
    clearTimeout(idleTimer);
    idleTimer = setTimeout(() => { autoRotate = true; }, 3000);
  });
  window.addEventListener('mousemove', e => {
    if (!isDragging) return;
    rotY += (e.clientX - prevX) * 0.008;
    rotX += (e.clientY - prevY) * 0.006;
    rotX = Math.max(-1.1, Math.min(1.1, rotX));
    prevX = e.clientX; prevY = e.clientY;
    applyOrbit();
  });

  // Touch
  canvas.addEventListener('touchstart', e => {
    if (e.touches.length === 1) {
      isDragging = true; autoRotate = false;
      prevX = e.touches[0].clientX; prevY = e.touches[0].clientY;
    }
  }, { passive: true });
  canvas.addEventListener('touchmove', e => {
    if (!isDragging || e.touches.length !== 1) return;
    rotY += (e.touches[0].clientX - prevX) * 0.008;
    rotX += (e.touches[0].clientY - prevY) * 0.006;
    rotX = Math.max(-1.1, Math.min(1.1, rotX));
    prevX = e.touches[0].clientX; prevY = e.touches[0].clientY;
    applyOrbit();
    e.preventDefault();
  }, { passive: false });
  canvas.addEventListener('touchend', () => {
    isDragging = false;
    clearTimeout(idleTimer);
    idleTimer = setTimeout(() => { autoRotate = true; }, 3000);
  });

  // Scroll to zoom
  canvas.addEventListener('wheel', e => {
    zoom += e.deltaY * 0.04;
    zoom = Math.max(10, Math.min(45, zoom));
    applyOrbit();
    e.preventDefault();
  }, { passive: false });

  // Resize
  window.addEventListener('resize', () => {
    const w = canvas.offsetWidth, h = canvas.offsetHeight || 360;
    renderer.setSize(w, h);
    camera.aspect = w / h;
    camera.updateProjectionMatrix();
  });

  // ‚îÄ‚îÄ‚îÄ Render loop (also auto-resizes if canvas became visible after init) ‚îÄ‚îÄ
  var dpr = window.devicePixelRatio || 1;
  function animate() {
    requestAnimationFrame(animate);
    // Re-size if element became visible after 0-width init
    var cW = canvas.offsetWidth, cH = canvas.offsetHeight || 360;
    if (cW > 0 && Math.abs(renderer.domElement.width - cW * dpr) > 2) {
      renderer.setSize(cW, cH);
      camera.aspect = cW / cH;
      camera.updateProjectionMatrix();
    }
    if (autoRotate) {
      rotY += 0.004;
      applyOrbit();
    }
    renderer.render(scene, camera);
  }
  animate();
  } // end initWavefront3D

  // Hook: run when wavefront card is first toggled to 3D
  var wfCard = document.getElementById('wavefront-card');
  if (wfCard) {
    new MutationObserver(function(muts) {
      if (wfCard.classList.contains('card-3d')) initWavefront3D();
    }).observe(wfCard, { attributes: true, attributeFilter: ['class'] });
  }
  // Also hook global initAll3D so it triggers for wavefront too
  var _wfOrigInit = window.initAll3D;
  window._wfHook = initWavefront3D;
})();
</script>

<!-- ‚îÄ‚îÄ 3D/Animation Registry ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<script>
var _3dInitFns = [];
function register3D(fn) { _3dInitFns.push(fn); }
function initAll3D() {
  _3dInitFns.forEach(function(fn) {
    try { fn(); } catch(e) { console.warn('3D init error:', e); }
  });
  // Also trigger wavefront 3D if its card is visible
  if (typeof window._wfHook === 'function') {
    var wfc = document.getElementById('wavefront-card');
    if (wfc && wfc.classList.contains('card-3d')) window._wfHook();
  }
}

// Helper: make canvas 2D ‚Äî canvas rendered at native resolution, displayed via max-width
function make2DCanvas(wrap, w, h) {
  wrap.style.background = 'transparent';
  var c = document.createElement('canvas');
  c.width = w || 520; c.height = h || 340;
  // Let CSS handle sizing: max-width:100% height:auto keeps aspect ratio and avoids blurriness
  c.style.cssText = 'max-width:100%;height:auto;display:block;';
  wrap.appendChild(c);
  var hint = document.createElement('div');
  hint.className = 'anim-hint';
  hint.textContent = '‚óè Animated';
  wrap.style.position = 'relative';
  wrap.appendChild(hint);
  return c;
}
</script>

<!-- ‚îÄ‚îÄ GROUP A: Ch1 (1.1‚Äì1.3) + Ch2 (2.1‚Äì2.3) 3D/Anim scenes ‚îÄ‚îÄ‚îÄ -->
<script>
/* ================================================================
   Fig 1.1 ‚Äì Electric field lines of positive point charge
   Canvas 2D, 520√ó340, dark bg
================================================================ */
register3D(function() {
  var wrap = injectView3D('Fig 1.1', 340);
  if (!wrap) return;
  var c = make2DCanvas(wrap, 520, 340);
  var ctx = c.getContext('2d');
  var W = c.width, H = c.height;
  var cx = W / 2, cy = H / 2;
  var N_LINES = 16;
  var CHARGE_R = 18;
  var LINE_LEN = 145;

  /* Three test charges on lines at 45¬∞, 165¬∞, 285¬∞ (120¬∞ apart) */
  var charges = [
    { angle: 45  * Math.PI / 180, phase: 0       },
    { angle: 165 * Math.PI / 180, phase: 2 * Math.PI / 3 },
    { angle: 285 * Math.PI / 180, phase: 4 * Math.PI / 3 }
  ];

  var startT = null;
  var PERIOD = 2200; /* ms for one full outward journey */

  function drawArrowHead(x, y, angle, color) {
    var al = 9, aw = 4;
    ctx.save();
    ctx.translate(x, y);
    ctx.rotate(angle);
    ctx.beginPath();
    ctx.moveTo(0, 0);
    ctx.lineTo(-al, -aw);
    ctx.lineTo(-al, aw);
    ctx.closePath();
    ctx.fillStyle = color;
    ctx.fill();
    ctx.restore();
  }

  function frame(ts) {
    if (!startT) startT = ts;
    var elapsed = ts - startT;

    /* ‚îÄ‚îÄ background ‚îÄ‚îÄ */
    ctx.fillStyle = '#0d0d18';
    ctx.fillRect(0, 0, W, H);

    /* ‚îÄ‚îÄ 16 radial field lines ‚îÄ‚îÄ */
    for (var i = 0; i < N_LINES; i++) {
      var ang = (i / N_LINES) * 2 * Math.PI;
      var endX = cx + (LINE_LEN + 10) * Math.cos(ang);
      var endY = cy + (LINE_LEN + 10) * Math.sin(ang);
      /* line */
      ctx.beginPath();
      ctx.moveTo(cx + CHARGE_R * Math.cos(ang), cy + CHARGE_R * Math.sin(ang));
      ctx.lineTo(endX, endY);
      ctx.strokeStyle = '#2563eb';
      ctx.lineWidth = 1.6;
      ctx.stroke();
      /* arrowhead at end */
      drawArrowHead(endX, endY, ang, '#2563eb');
    }

    /* ‚îÄ‚îÄ +q charge ‚îÄ‚îÄ */
    ctx.beginPath();
    ctx.arc(cx, cy, CHARGE_R, 0, 2 * Math.PI);
    ctx.fillStyle = '#ef4444';
    ctx.fill();
    ctx.strokeStyle = '#fff';
    ctx.lineWidth = 2;
    ctx.stroke();

    ctx.fillStyle = '#fff';
    ctx.font = 'bold 13px DM Sans, sans-serif';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillText('+q', cx, cy + 1);

    /* ‚îÄ‚îÄ E label ‚îÄ‚îÄ */
    ctx.fillStyle = '#2563eb';
    ctx.font = 'bold 11px DM Sans, sans-serif';
    ctx.textAlign = 'left';
    ctx.fillText('E', cx + LINE_LEN + 14, cy + 4);

    /* ‚îÄ‚îÄ animated test charges ‚îÄ‚îÄ */
    for (var j = 0; j < charges.length; j++) {
      var ch = charges[j];
      var t = ((elapsed / PERIOD) + ch.phase / (2 * Math.PI)) % 1; /* 0..1 */
      /* fade: in 0‚Äì0.15, solid 0.15‚Äì0.8, fade out 0.8‚Äì1 */
      var alpha;
      if (t < 0.15) alpha = t / 0.15;
      else if (t < 0.8) alpha = 1;
      else alpha = 1 - (t - 0.8) / 0.2;
      alpha = Math.max(0, Math.min(1, alpha));

      var dist = CHARGE_R + 12 + (LINE_LEN - CHARGE_R - 12) * t;
      var tx = cx + dist * Math.cos(ch.angle);
      var ty = cy + dist * Math.sin(ch.angle);

      /* glow */
      var grd = ctx.createRadialGradient(tx, ty, 0, tx, ty, 10);
      grd.addColorStop(0, 'rgba(253,224,71,' + (alpha * 0.9) + ')');
      grd.addColorStop(1, 'rgba(253,224,71,0)');
      ctx.beginPath();
      ctx.arc(tx, ty, 10, 0, 2 * Math.PI);
      ctx.fillStyle = grd;
      ctx.fill();

      /* test charge dot */
      ctx.beginPath();
      ctx.arc(tx, ty, 4.5, 0, 2 * Math.PI);
      ctx.fillStyle = 'rgba(253,224,71,' + alpha + ')';
      ctx.fill();
      ctx.strokeStyle = 'rgba(255,255,255,' + (alpha * 0.7) + ')';
      ctx.lineWidth = 1;
      ctx.stroke();
    }

    /* ‚îÄ‚îÄ caption text ‚îÄ‚îÄ */
    ctx.fillStyle = 'rgba(148,163,184,0.7)';
    ctx.font = '10px DM Sans, sans-serif';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'alphabetic';
    ctx.fillText('Field lines radiate outward from +q', cx, H - 10);

    requestAnimationFrame(frame);
  }
  requestAnimationFrame(frame);
});

/* ================================================================
   Fig 1.2 ‚Äì Electric field lines of a dipole
   Canvas 2D, 520√ó340, dark bg
================================================================ */
register3D(function() {
  var wrap = injectView3D('Fig 1.2', 340);
  if (!wrap) return;
  var c = make2DCanvas(wrap, 520, 340);
  var ctx = c.getContext('2d');
  var W = c.width, H = c.height;

  /* charge positions */
  var pX = 335, pY = 170;  /* +q */
  var nX = 185, nY = 170;  /* -q */

  /* 8 bezier field lines (cp1, cp2, end) ‚Äî from +q reaching toward or past -q
     We parameterise t=0 at +q, t=1 at -q.
     Store as {cp1x, cp1y, cp2x, cp2y} ‚Äî start=pX,pY  end=nX,nY */
  var lines = [
    /* direct horizontal */
    { cp1x: pX,        cp1y: pY,        cp2x: nX,        cp2y: nY        },
    /* tight top arc */
    { cp1x: pX - 10,   cp1y: pY - 60,   cp2x: nX + 10,   cp2y: nY - 60  },
    /* medium top arc */
    { cp1x: pX + 20,   cp1y: pY - 130,  cp2x: nX - 20,   cp2y: nY - 130 },
    /* wide top arc */
    { cp1x: pX + 60,   cp1y: pY - 200,  cp2x: nX - 60,   cp2y: nY - 200 },
    /* tight bottom arc */
    { cp1x: pX - 10,   cp1y: pY + 60,   cp2x: nX + 10,   cp2y: nY + 60  },
    /* medium bottom arc */
    { cp1x: pX + 20,   cp1y: pY + 130,  cp2x: nX - 20,   cp2y: nY + 130 },
    /* wide bottom arc */
    { cp1x: pX + 60,   cp1y: pY + 200,  cp2x: nX - 60,   cp2y: nY + 200 },
    /* extra top-right splay */
    { cp1x: pX + 100,  cp1y: pY - 100,  cp2x: nX - 100,  cp2y: nY - 100 }
  ];

  /* Evaluate cubic bezier at t */
  function bezier(t, p0x, p0y, cp1x, cp1y, cp2x, cp2y, p1x, p1y) {
    var mt = 1 - t;
    return {
      x: mt*mt*mt*p0x + 3*mt*mt*t*cp1x + 3*mt*t*t*cp2x + t*t*t*p1x,
      y: mt*mt*mt*p0y + 3*mt*mt*t*cp1y + 3*mt*t*t*cp2y + t*t*t*p1y
    };
  }

  /* Test charges: one on top arc (line index 2), one on bottom arc (line index 5) */
  var testCharges = [
    { lineIdx: 2, phase: 0   },
    { lineIdx: 5, phase: 0.5 }
  ];

  var startT = null;
  var PERIOD = 3000;

  function drawArrowAt(x, y, tx2, ty2) {
    var ang = Math.atan2(ty2 - y, tx2 - x);
    var al = 8, aw = 3.5;
    ctx.save();
    ctx.translate(x, y);
    ctx.rotate(ang);
    ctx.beginPath();
    ctx.moveTo(0, 0);
    ctx.lineTo(-al, -aw);
    ctx.lineTo(-al, aw);
    ctx.closePath();
    ctx.fillStyle = '#2563eb';
    ctx.fill();
    ctx.restore();
  }

  function frame(ts) {
    if (!startT) startT = ts;
    var elapsed = ts - startT;

    ctx.fillStyle = '#0d0d18';
    ctx.fillRect(0, 0, W, H);

    /* ‚îÄ‚îÄ draw all field lines ‚îÄ‚îÄ */
    for (var i = 0; i < lines.length; i++) {
      var l = lines[i];
      ctx.beginPath();
      ctx.moveTo(pX, pY);
      ctx.bezierCurveTo(l.cp1x, l.cp1y, l.cp2x, l.cp2y, nX, nY);
      ctx.strokeStyle = '#2563eb';
      ctx.lineWidth = 1.5;
      ctx.stroke();

      /* arrowhead at t=0.5 along each line */
      var pa = bezier(0.48, pX, pY, l.cp1x, l.cp1y, l.cp2x, l.cp2y, nX, nY);
      var pb = bezier(0.52, pX, pY, l.cp1x, l.cp1y, l.cp2x, l.cp2y, nX, nY);
      drawArrowAt(pb.x, pb.y, pb.x + (pb.x - pa.x), pb.y + (pb.y - pa.y));
    }

    /* ‚îÄ‚îÄ charges ‚îÄ‚îÄ */
    /* +q */
    ctx.beginPath();
    ctx.arc(pX, pY, 15, 0, 2*Math.PI);
    ctx.fillStyle = '#ef4444';
    ctx.fill();
    ctx.strokeStyle = '#fff';
    ctx.lineWidth = 2;
    ctx.stroke();
    ctx.fillStyle = '#fff';
    ctx.font = 'bold 13px DM Sans, sans-serif';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillText('+', pX, pY + 1);

    /* -q */
    ctx.beginPath();
    ctx.arc(nX, nY, 15, 0, 2*Math.PI);
    ctx.fillStyle = '#3b82f6';
    ctx.fill();
    ctx.strokeStyle = '#fff';
    ctx.lineWidth = 2;
    ctx.stroke();
    ctx.fillStyle = '#fff';
    ctx.fillText('\u2212', nX, nY + 1);

    /* dipole arrow */
    ctx.beginPath();
    ctx.moveTo(nX, H - 32);
    ctx.lineTo(pX - 4, H - 32);
    ctx.strokeStyle = '#ef4444';
    ctx.lineWidth = 1.8;
    ctx.stroke();
    /* arrowhead */
    ctx.beginPath();
    ctx.moveTo(pX - 4, H - 32);
    ctx.lineTo(pX - 13, H - 28);
    ctx.lineTo(pX - 13, H - 36);
    ctx.closePath();
    ctx.fillStyle = '#ef4444';
    ctx.fill();

    ctx.fillStyle = '#ef4444';
    ctx.font = 'bold 11px DM Sans, sans-serif';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'alphabetic';
    ctx.fillText('p (dipole moment)', (nX + pX) / 2, H - 38);

    /* ‚îÄ‚îÄ animated test charges ‚îÄ‚îÄ */
    for (var j = 0; j < testCharges.length; j++) {
      var tc = testCharges[j];
      var l2 = lines[tc.lineIdx];
      var t = ((elapsed / PERIOD) + tc.phase) % 1;
      var alpha;
      if (t < 0.12) alpha = t / 0.12;
      else if (t < 0.85) alpha = 1;
      else alpha = 1 - (t - 0.85) / 0.15;
      alpha = Math.max(0, Math.min(1, alpha));

      var pos = bezier(t, pX, pY, l2.cp1x, l2.cp1y, l2.cp2x, l2.cp2y, nX, nY);

      /* glow */
      var grd = ctx.createRadialGradient(pos.x, pos.y, 0, pos.x, pos.y, 11);
      grd.addColorStop(0, 'rgba(255,255,255,' + (alpha * 0.85) + ')');
      grd.addColorStop(1, 'rgba(255,255,255,0)');
      ctx.beginPath();
      ctx.arc(pos.x, pos.y, 11, 0, 2*Math.PI);
      ctx.fillStyle = grd;
      ctx.fill();

      ctx.beginPath();
      ctx.arc(pos.x, pos.y, 4, 0, 2*Math.PI);
      ctx.fillStyle = 'rgba(255,255,255,' + alpha + ')';
      ctx.fill();
    }

    /* caption */
    ctx.fillStyle = 'rgba(148,163,184,0.7)';
    ctx.font = '10px DM Sans, sans-serif';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'alphabetic';
    ctx.fillText('Field lines from + to \u2212', W / 2, 18);

    requestAnimationFrame(frame);
  }
  requestAnimationFrame(frame);
});

/* ================================================================
   Fig 1.3 ‚Äì Uniform electric field between parallel plates
   Canvas 2D, 520√ó280, WHITE bg
================================================================ */
register3D(function() {
  var wrap = injectView3D('Fig 1.3', 280);
  if (!wrap) return;
  var c = make2DCanvas(wrap, 520, 280);
  var ctx = c.getContext('2d');
  var W = c.width, H = c.height;

  /* plate geometry (horizontal plates, field downward) */
  var plateX1 = 60, plateX2 = 460;
  var topY    = 50;
  var botY    = 230;
  var gapH    = botY - topY;   /* 180 px */

  /* 5 E-field arrows */
  var arrowXs = [110, 185, 260, 335, 410];

  /* test charge animation */
  var PERIOD = 2400; /* ms for one fall */
  var startT = null;

  function drawDownArrow(x, y1, y2, color, lw) {
    ctx.beginPath();
    ctx.moveTo(x, y1);
    ctx.lineTo(x, y2);
    ctx.strokeStyle = color;
    ctx.lineWidth = lw || 1.8;
    ctx.stroke();
    /* head */
    ctx.beginPath();
    ctx.moveTo(x, y2);
    ctx.lineTo(x - 5, y2 - 9);
    ctx.lineTo(x + 5, y2 - 9);
    ctx.closePath();
    ctx.fillStyle = color;
    ctx.fill();
  }

  function frame(ts) {
    if (!startT) startT = ts;
    var elapsed = ts - startT;

    /* white background */
    ctx.fillStyle = '#ffffff';
    ctx.fillRect(0, 0, W, H);

    /* top plate ‚Äì positive */
    ctx.fillStyle = '#ef4444';
    ctx.fillRect(plateX1, topY - 8, plateX2 - plateX1, 8);

    /* bottom plate ‚Äì negative */
    ctx.fillStyle = '#3b82f6';
    ctx.fillRect(plateX1, botY, plateX2 - plateX1, 8);

    /* + charges on top plate */
    ctx.fillStyle = '#ef4444';
    ctx.font = 'bold 14px DM Sans, sans-serif';
    ctx.textBaseline = 'middle';
    ctx.textAlign = 'center';
    var plusXs = [100, 160, 220, 280, 340, 400];
    for (var i = 0; i < plusXs.length; i++) ctx.fillText('+', plusXs[i], topY - 20);

    /* ‚àí charges on bottom plate */
    ctx.fillStyle = '#3b82f6';
    var minXs = [100, 160, 220, 280, 340, 400];
    for (var i = 0; i < minXs.length; i++) ctx.fillText('\u2212', minXs[i], botY + 22);

    /* 5 uniform downward E arrows */
    for (var i = 0; i < arrowXs.length; i++) {
      drawDownArrow(arrowXs[i], topY + 15, botY - 15, '#2563eb', 1.8);
    }

    /* E label */
    ctx.fillStyle = '#2563eb';
    ctx.font = 'bold 13px DM Sans, sans-serif';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'alphabetic';
    ctx.fillText('E (uniform)', W / 2, topY - 32);

    /* +œÉ / ‚àíœÉ labels */
    ctx.fillStyle = '#ef4444';
    ctx.font = '11px DM Sans, sans-serif';
    ctx.textAlign = 'left';
    ctx.fillText('+\u03C3', plateX1 - 28, topY - 3);
    ctx.fillStyle = '#3b82f6';
    ctx.fillText('\u2212\u03C3', plateX1 - 30, botY + 5);

    /* ‚îÄ‚îÄ animated test charge (positive) falling downward ‚îÄ‚îÄ */
    var t = (elapsed % PERIOD) / PERIOD; /* 0..1 linear time */
    /* accelerate: use easing y = t^1.7 to mimic constant-force acceleration */
    var ease = Math.pow(t, 1.7);
    var chargeY = topY + 20 + (gapH - 40) * ease;
    var chargeX = 260;

    /* velocity arrow ‚Äì grows as charge accelerates */
    var vLen = 8 + 38 * ease;
    ctx.beginPath();
    ctx.moveTo(chargeX + 14, chargeY);
    ctx.lineTo(chargeX + 14 + vLen, chargeY);
    ctx.strokeStyle = '#f59e0b';
    ctx.lineWidth = 2;
    ctx.stroke();
    /* v arrowhead */
    ctx.beginPath();
    ctx.moveTo(chargeX + 14 + vLen, chargeY);
    ctx.lineTo(chargeX + 14 + vLen - 7, chargeY - 4);
    ctx.lineTo(chargeX + 14 + vLen - 7, chargeY + 4);
    ctx.closePath();
    ctx.fillStyle = '#f59e0b';
    ctx.fill();

    ctx.fillStyle = '#f59e0b';
    ctx.font = 'bold 10px DM Sans, sans-serif';
    ctx.textAlign = 'left';
    ctx.textBaseline = 'middle';
    ctx.fillText('v', chargeX + 16 + vLen + 2, chargeY);

    /* position dots trail */
    var nDots = 5;
    for (var d = 0; d < nDots; d++) {
      var dotT = Math.max(0, t - (nDots - d) * 0.07);
      var dotEase = Math.pow(dotT, 1.7);
      var dotY = topY + 20 + (gapH - 40) * dotEase;
      var dotAlpha = (d + 1) / (nDots + 1);
      ctx.beginPath();
      ctx.arc(chargeX, dotY, 2.5, 0, 2*Math.PI);
      ctx.fillStyle = 'rgba(239,68,68,' + dotAlpha * 0.4 + ')';
      ctx.fill();
    }

    /* test charge circle */
    ctx.beginPath();
    ctx.arc(chargeX, chargeY, 7, 0, 2*Math.PI);
    ctx.fillStyle = '#ef4444';
    ctx.fill();
    ctx.strokeStyle = '#fff';
    ctx.lineWidth = 1.5;
    ctx.stroke();
    ctx.fillStyle = '#fff';
    ctx.font = 'bold 9px DM Sans, sans-serif';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillText('+', chargeX, chargeY + 1);

    /* caption */
    ctx.fillStyle = '#64748b';
    ctx.font = 'italic 10px DM Sans, sans-serif';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'alphabetic';
    ctx.fillText('Test charge accelerates downward (F = qE)', W / 2, H - 8);

    requestAnimationFrame(frame);
  }
  requestAnimationFrame(frame);
});

/* ================================================================
   Fig 2.1 ‚Äì Equipotential surfaces for point charge
   Canvas 2D, 520√ó340, dark bg
================================================================ */
register3D(function() {
  var wrap = injectView3D('Fig 2.1', 340);
  if (!wrap) return;
  var c = make2DCanvas(wrap, 520, 340);
  var ctx = c.getContext('2d');
  var W = c.width, H = c.height;
  var cx = W / 2, cy = H / 2;

  /* 4 equipotential rings */
  var rings = [
    { r: 38,  label: 'V\u2081', baseColor: '#a78bfa' },
    { r: 76,  label: 'V\u2082', baseColor: '#8b5cf6' },
    { r: 114, label: 'V\u2083', baseColor: '#7c3aed' },
    { r: 152, label: 'V\u2084', baseColor: '#6d28d9' }
  ];

  /* 8 radial field lines */
  var N_FL = 8;
  var FL_LEN = 158;

  var CYCLE = 1500;    /* ms per ring highlight */
  var FADE_DUR = 400;  /* ms transition */
  var startT = null;

  /* label text cycle */
  var labelAlpha = 0;
  var labelPhase = 0; /* 0..1 across full 4-ring cycle */

  function drawArrowHead(x, y, angle) {
    var al = 9, aw = 4;
    ctx.save();
    ctx.translate(x, y);
    ctx.rotate(angle);
    ctx.beginPath();
    ctx.moveTo(0, 0);
    ctx.lineTo(-al, -aw);
    ctx.lineTo(-al, aw);
    ctx.closePath();
    ctx.fillStyle = '#3b82f6';
    ctx.fill();
    ctx.restore();
  }

  function frame(ts) {
    if (!startT) startT = ts;
    var elapsed = ts - startT;

    ctx.fillStyle = '#0d0d18';
    ctx.fillRect(0, 0, W, H);

    /* which ring is highlighted */
    var totalCycle = CYCLE * rings.length;
    var ringPhase  = (elapsed % totalCycle) / CYCLE;   /* 0..4 float */
    var activeIdx  = Math.floor(ringPhase) % rings.length;
    var frac       = ringPhase - Math.floor(ringPhase); /* 0..1 within ring */

    /* glow pulse value: ramp up 0-0.25 of frac, sustain, ramp down 0.75-1 */
    var glowT;
    if (frac < 0.25) glowT = frac / 0.25;
    else if (frac < 0.75) glowT = 1;
    else glowT = 1 - (frac - 0.75) / 0.25;

    /* ‚îÄ‚îÄ field lines ‚îÄ‚îÄ */
    for (var i = 0; i < N_FL; i++) {
      var ang = (i / N_FL) * 2 * Math.PI;
      var ex  = cx + FL_LEN * Math.cos(ang);
      var ey  = cy + FL_LEN * Math.sin(ang);
      ctx.beginPath();
      ctx.moveTo(cx + 14 * Math.cos(ang), cy + 14 * Math.sin(ang));
      ctx.lineTo(ex, ey);
      ctx.strokeStyle = '#2563eb';
      ctx.lineWidth = 1.2;
      ctx.stroke();
      drawArrowHead(ex, ey, ang);
    }

    /* ‚îÄ‚îÄ equipotential rings (dashed) ‚îÄ‚îÄ */
    for (var ri = 0; ri < rings.length; ri++) {
      var ring = rings[ri];
      var isActive = ri === activeIdx;
      var glow = isActive ? glowT : 0;

      /* outer glow when active */
      if (glow > 0) {
        ctx.save();
        ctx.shadowColor = '#c4b5fd';
        ctx.shadowBlur  = 16 * glow;
        ctx.beginPath();
        ctx.arc(cx, cy, ring.r, 0, 2*Math.PI);
        ctx.strokeStyle = '#e9d5ff';
        ctx.lineWidth = 2.5;
        ctx.setLineDash([6, 3]);
        ctx.stroke();
        ctx.restore();
      }

      /* normal ring */
      ctx.beginPath();
      ctx.arc(cx, cy, ring.r, 0, 2*Math.PI);
      ctx.strokeStyle = isActive
        ? ('rgba(196,181,253,' + (0.6 + 0.4 * glow) + ')')
        : ring.baseColor;
      ctx.lineWidth = isActive ? 2 : 1.4;
      ctx.setLineDash([6, 3]);
      ctx.stroke();
      ctx.setLineDash([]);

      /* ring label at top */
      var lblX = cx;
      var lblY = cy - ring.r - 6;
      ctx.fillStyle = isActive
        ? ('rgba(221,214,254,' + (0.7 + 0.3 * glow) + ')')
        : 'rgba(167,139,250,0.7)';
      ctx.font = (isActive ? 'bold ' : '') + '10px DM Sans, sans-serif';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'alphabetic';
      ctx.fillText(ring.label, lblX, lblY);
    }

    /* ‚îÄ‚îÄ central charge ‚îÄ‚îÄ */
    ctx.beginPath();
    ctx.arc(cx, cy, 13, 0, 2*Math.PI);
    ctx.fillStyle = '#fbbf24';
    ctx.fill();
    ctx.strokeStyle = '#fff';
    ctx.lineWidth = 1.5;
    ctx.stroke();
    ctx.fillStyle = '#1c1917';
    ctx.font = 'bold 10px DM Sans, sans-serif';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillText('+q', cx, cy + 1);

    /* ‚îÄ‚îÄ cycling label banner ‚îÄ‚îÄ */
    /* fades in over the whole 4-ring cycle */
    var bannerAlpha = Math.min(1, elapsed / 1200);
    ctx.fillStyle = 'rgba(167,139,250,' + (0.75 * bannerAlpha) + ')';
    ctx.font = '11px DM Sans, sans-serif';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'alphabetic';
    ctx.fillText('V\u2081 > V\u2082 > V\u2083 > V\u2084   (closer \u2192 higher potential)', cx, H - 10);

    /* legend */
    ctx.setLineDash([6, 3]);
    ctx.beginPath();
    ctx.moveTo(cx - 148, H - 28);
    ctx.lineTo(cx - 118, H - 28);
    ctx.strokeStyle = 'rgba(167,139,250,0.7)';
    ctx.lineWidth = 1.4;
    ctx.stroke();
    ctx.setLineDash([]);
    ctx.fillStyle = 'rgba(167,139,250,0.7)';
    ctx.font = '9px DM Sans, sans-serif';
    ctx.textAlign = 'left';
    ctx.fillText('Equipotential', cx - 115, H - 24);

    ctx.beginPath();
    ctx.moveTo(cx + 60, H - 28);
    ctx.lineTo(cx + 90, H - 28);
    ctx.strokeStyle = 'rgba(59,130,246,0.7)';
    ctx.lineWidth = 1.2;
    ctx.stroke();
    ctx.fillStyle = 'rgba(59,130,246,0.7)';
    ctx.fillText('Field lines', cx + 92, H - 24);

    requestAnimationFrame(frame);
  }
  requestAnimationFrame(frame);
});

/* ================================================================
   Fig 2.2 ‚Äì Capacitor with dielectric (animated 3-phase cycle)
   Canvas 2D, 520√ó280, WHITE bg
================================================================ */
register3D(function() {
  var wrap = injectView3D('Fig 2.2', 280);
  if (!wrap) return;
  var c = make2DCanvas(wrap, 520, 280);
  var ctx = c.getContext('2d');
  var W = c.width, H = c.height;

  /* geometry */
  var plateX1 = 80, plateX2 = 440;
  var topY    = 55, botY = 215;
  var gapH    = botY - topY;  /* 160 px */
  var slabW   = plateX2 - plateX1;

  /* E arrows */
  var arrowXs = [120, 180, 240, 300, 360, 400];

  /* Phases:
     0: air only, E‚ÇÄ arrows                   (0‚Äì1 s)
     1: slab sliding in from right             (1‚Äì2 s)
     2: slab in, dipoles visible, E=E‚ÇÄ/K      (2‚Äì3.5 s)
     3: slab sliding out to right              (3.5‚Äì4.5 s)
     then repeat
  */
  var TOTAL = 4500;
  var PHASES = [
    { start: 0,    end: 1000  },  /* 0 air */
    { start: 1000, end: 2000  },  /* 1 slide in */
    { start: 2000, end: 3500  },  /* 2 with slab */
    { start: 3500, end: 4500  }   /* 3 slide out */
  ];

  var startT = null;

  function easeInOut(t) {
    return t < 0.5 ? 2*t*t : -1 + (4-2*t)*t;
  }

  function drawPlates() {
    /* top plate */
    ctx.fillStyle = '#d97706';
    ctx.fillRect(plateX1, topY - 10, slabW, 10);
    /* bottom plate */
    ctx.fillStyle = '#2563eb';
    ctx.fillRect(plateX1, botY, slabW, 10);

    /* + charges on top */
    ctx.fillStyle = '#ef4444';
    ctx.font = 'bold 13px DM Sans, sans-serif';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    var plusXs = [110, 160, 210, 260, 310, 360, 410];
    for (var i = 0; i < plusXs.length; i++) ctx.fillText('+', plusXs[i], topY - 21);

    /* ‚àí charges on bottom */
    ctx.fillStyle = '#2563eb';
    var minXs = [110, 160, 210, 260, 310, 360, 410];
    for (var i = 0; i < minXs.length; i++) ctx.fillText('\u2212', minXs[i], botY + 21);
  }

  function drawEArrows(label, alpha, color) {
    color = color || '#2563eb';
    ctx.globalAlpha = alpha;
    for (var i = 0; i < arrowXs.length; i++) {
      var x = arrowXs[i];
      ctx.beginPath();
      ctx.moveTo(x, topY + 8);
      ctx.lineTo(x, botY - 8);
      ctx.strokeStyle = color;
      ctx.lineWidth = 1.8;
      ctx.stroke();
      /* arrowhead down */
      ctx.beginPath();
      ctx.moveTo(x, botY - 8);
      ctx.lineTo(x - 5, botY - 18);
      ctx.lineTo(x + 5, botY - 18);
      ctx.closePath();
      ctx.fillStyle = color;
      ctx.fill();
    }
    if (label) {
      ctx.font = 'bold 12px DM Sans, sans-serif';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      ctx.fillStyle = color;
      ctx.fillText(label, W / 2, (topY + botY) / 2 + 28);
    }
    ctx.globalAlpha = 1;
  }

  function drawDipoles(alpha) {
    /* small ‚Üë‚Üì dipole symbols inside slab */
    ctx.globalAlpha = alpha;
    var rows = [topY + 28, topY + 70, topY + 110];
    var cols = [130, 180, 230, 280, 330, 380, 420];
    for (var r = 0; r < rows.length; r++) {
      for (var co = 0; co < cols.length; co++) {
        var x = cols[co], y = rows[r];
        /* negative bound charge on left */
        ctx.fillStyle = '#3b82f6';
        ctx.font = '9px DM Sans, sans-serif';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillText('\u2212', x - 5, y);
        /* positive bound charge on right */
        ctx.fillStyle = '#ef4444';
        ctx.fillText('+', x + 5, y);
        /* up arrow (polarization direction) */
        ctx.beginPath();
        ctx.moveTo(x, y + 7);
        ctx.lineTo(x, y - 7);
        ctx.strokeStyle = '#7c3aed';
        ctx.lineWidth = 1;
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo(x, y - 7);
        ctx.lineTo(x - 3, y - 2);
        ctx.lineTo(x + 3, y - 2);
        ctx.closePath();
        ctx.fillStyle = '#7c3aed';
        ctx.fill();
      }
    }
    ctx.globalAlpha = 1;
  }

  function frame(ts) {
    if (!startT) startT = ts;
    var elapsed = (ts - startT) % TOTAL;

    /* determine phase */
    var phase = 0, phaseT = 0;
    for (var pi = 0; pi < PHASES.length; pi++) {
      if (elapsed >= PHASES[pi].start && elapsed < PHASES[pi].end) {
        phase  = pi;
        phaseT = (elapsed - PHASES[pi].start) / (PHASES[pi].end - PHASES[pi].start);
        break;
      }
    }
    phaseT = Math.max(0, Math.min(1, phaseT));

    /* white bg */
    ctx.fillStyle = '#ffffff';
    ctx.fillRect(0, 0, W, H);

    drawPlates();

    if (phase === 0) {
      /* air only */
      drawEArrows('E\u2080', 1, '#2563eb');

      ctx.fillStyle = '#64748b';
      ctx.font = '11px DM Sans, sans-serif';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'alphabetic';
      ctx.fillText('Air gap  (no dielectric)', W / 2, H - 10);

    } else if (phase === 1) {
      /* slab sliding in from right */
      var slideX = easeInOut(phaseT);
      var slabLeft = plateX2 - slideX * slabW;  /* moves left */

      /* slab fill ‚Äî clip to plate region */
      ctx.save();
      ctx.beginPath();
      ctx.rect(plateX1, topY, slabW, gapH);
      ctx.clip();
      ctx.fillStyle = 'rgba(196,181,253,0.3)';
      ctx.fillRect(slabLeft, topY, plateX2 - slabLeft, gapH);
      ctx.strokeStyle = '#7c3aed';
      ctx.lineWidth = 1.5;
      ctx.strokeRect(slabLeft, topY, plateX2 - slabLeft, gapH);
      ctx.restore();

      drawEArrows('E\u2080', 1, '#2563eb');

      ctx.fillStyle = '#64748b';
      ctx.font = '11px DM Sans, sans-serif';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'alphabetic';
      ctx.fillText('Inserting dielectric\u2026', W / 2, H - 10);

    } else if (phase === 2) {
      /* slab fully in */
      ctx.fillStyle = 'rgba(196,181,253,0.3)';
      ctx.fillRect(plateX1, topY, slabW, gapH);
      ctx.strokeStyle = '#7c3aed';
      ctx.lineWidth = 1.5;
      ctx.strokeRect(plateX1, topY, slabW, gapH);

      /* K label inside slab */
      ctx.fillStyle = '#7c3aed';
      ctx.font = 'bold 14px DM Sans, sans-serif';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      ctx.fillText('K', W / 2, (topY + botY) / 2 - 22);

      /* dipoles appear gradually */
      var dipAlpha = Math.min(1, phaseT * 2);
      drawDipoles(dipAlpha);

      /* weakened E arrows */
      drawEArrows('E = E\u2080 / K', Math.min(1, phaseT * 2), '#0891b2');

      ctx.fillStyle = '#64748b';
      ctx.font = '11px DM Sans, sans-serif';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'alphabetic';
      ctx.fillText('Dielectric weakens field  \u2014  C\u2019 = K\u03B5\u2080A/d', W / 2, H - 10);

    } else {
      /* phase 3: slab sliding back out to right */
      var slideX2 = easeInOut(phaseT);
      var slabLeft2 = plateX1 + slideX2 * slabW;

      ctx.save();
      ctx.beginPath();
      ctx.rect(plateX1, topY, slabW, gapH);
      ctx.clip();
      var drawW = plateX2 - slabLeft2;
      if (drawW > 0) {
        ctx.fillStyle = 'rgba(196,181,253,0.3)';
        ctx.fillRect(slabLeft2, topY, drawW, gapH);
        ctx.strokeStyle = '#7c3aed';
        ctx.lineWidth = 1.5;
        ctx.strokeRect(slabLeft2, topY, drawW, gapH);
      }
      ctx.restore();

      var remAlpha = 1 - slideX2;
      drawEArrows('E\u2080', 1, '#2563eb');

      ctx.fillStyle = '#64748b';
      ctx.font = '11px DM Sans, sans-serif';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'alphabetic';
      ctx.fillText('Removing dielectric\u2026', W / 2, H - 10);
    }

    /* plate labels */
    ctx.fillStyle = '#ef4444';
    ctx.font = 'bold 11px DM Sans, sans-serif';
    ctx.textAlign = 'right';
    ctx.textBaseline = 'middle';
    ctx.fillText('+\u03C3', plateX1 - 6, topY - 5);
    ctx.fillStyle = '#2563eb';
    ctx.fillText('\u2212\u03C3', plateX1 - 6, botY + 5);

    requestAnimationFrame(frame);
  }
  requestAnimationFrame(frame);
});
</script>

<!-- ‚îÄ‚îÄ GROUP B: Ch3 (3.1‚Äì3.4) + Ch4 (4.1‚Äì4.5) + Ch5 (5.1‚Äì5.2) ‚îÄ‚îÄ -->
<script>
// ===== GROUP B: Ch3 (3.1‚Äì3.4) + Ch4 (4.1‚Äì4.5) + Ch5 (5.1‚Äì5.2) =====

// ‚îÄ‚îÄ Fig 3.1: Wheatstone Bridge ‚îÄ‚îÄ
register3D(function() {
  var wrap = injectView3D('Fig 3.1', 300); if (!wrap) return;
  var cv = make2DCanvas(wrap, 520, 300); var ctx = cv.getContext('2d');
  var paused = false, t = 0;
  var io = new IntersectionObserver(function(e){ paused=!e[0].isIntersecting; }); io.observe(cv);
  var A=[260,50], B=[140,160], C=[380,160], D=[260,270];
  function drawRes(x1,y1,x2,y2,label,col) {
    ctx.strokeStyle='#555'; ctx.lineWidth=1.5;
    ctx.beginPath(); ctx.moveTo(x1,y1); ctx.lineTo(x2,y2); ctx.stroke();
    var mx=(x1+x2)/2, my=(y1+y2)/2, ang=Math.atan2(y2-y1,x2-x1);
    ctx.save(); ctx.translate(mx,my); ctx.rotate(ang);
    ctx.fillStyle='#fffbeb'; ctx.strokeStyle=col; ctx.lineWidth=1.5;
    ctx.fillRect(-22,-8,44,16); ctx.strokeRect(-22,-8,44,16);
    ctx.fillStyle=col; ctx.font='bold 11px sans-serif'; ctx.textAlign='center'; ctx.fillText(label,0,4);
    ctx.restore();
  }
  function draw() {
    ctx.clearRect(0,0,520,300); ctx.fillStyle='#fff'; ctx.fillRect(0,0,520,300);
    drawRes(A[0],A[1],B[0],B[1],'P','#d97706');
    drawRes(A[0],A[1],C[0],C[1],'Q','#d97706');
    drawRes(B[0],B[1],D[0],D[1],'R','#2563eb');
    drawRes(C[0],C[1],D[0],D[1],'S','#2563eb');
    // Battery at D
    ctx.strokeStyle='#555'; ctx.lineWidth=1.5;
    ctx.beginPath(); ctx.moveTo(D[0],D[1]); ctx.lineTo(D[0],D[1]+22); ctx.stroke();
    ctx.lineWidth=2.5; ctx.beginPath(); ctx.moveTo(D[0]-12,D[1]+22); ctx.lineTo(D[0]+12,D[1]+22); ctx.stroke();
    ctx.lineWidth=1.5; ctx.beginPath(); ctx.moveTo(D[0]-7,D[1]+30); ctx.lineTo(D[0]+7,D[1]+30); ctx.stroke();
    ctx.fillStyle='#555'; ctx.font='10px sans-serif'; ctx.textAlign='left'; ctx.fillText('E',D[0]+14,D[1]+32);
    // G arm B‚ÄìC
    ctx.strokeStyle='#555'; ctx.lineWidth=1.5;
    ctx.beginPath(); ctx.moveTo(B[0],B[1]); ctx.lineTo(260-20,B[1]); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(260+20,B[1]); ctx.lineTo(C[0],B[1]); ctx.stroke();
    // Galvanometer circle
    var phase = (t*0.0012)%(Math.PI*2), gI = Math.sin(phase)*18;
    ctx.strokeStyle='#d97706'; ctx.lineWidth=1.5;
    ctx.beginPath(); ctx.arc(260,B[1],20,0,Math.PI*2); ctx.stroke();
    ctx.fillStyle='#fff'; ctx.beginPath(); ctx.arc(260,B[1],20,0,Math.PI*2); ctx.fill();
    ctx.strokeStyle='#d97706'; ctx.beginPath(); ctx.arc(260,B[1],20,0,Math.PI*2); ctx.stroke();
    ctx.fillStyle='#d97706'; ctx.font='bold 12px sans-serif'; ctx.textAlign='center'; ctx.fillText('G',260,B[1]+4);
    // Pointer
    ctx.strokeStyle='#dc2626'; ctx.lineWidth=2;
    ctx.beginPath(); ctx.moveTo(260,B[1]); ctx.lineTo(260+gI,B[1]-14); ctx.stroke();
    // Node labels
    [[A,'A'],[B,'B'],[C,'C'],[D,'D']].forEach(function(p){
      ctx.fillStyle='#333'; ctx.beginPath(); ctx.arc(p[0][0],p[0][1],4,0,Math.PI*2); ctx.fill();
      ctx.fillStyle='#333'; ctx.font='bold 12px sans-serif'; ctx.textAlign='center';
      ctx.fillText(p[1], p[0][0]+(p[0][0]>270?12:p[0][0]<250?-12:0), p[0][1]+(p[0][1]>200?14:-8));
    });
    ctx.fillStyle=Math.abs(gI)<2?'#16a34a':'#dc2626';
    ctx.font='10px sans-serif'; ctx.textAlign='center';
    ctx.fillText(Math.abs(gI)<2?'‚óè Balanced: P/Q = R/S (G = 0)':'‚óè Unbalanced ‚Äî G deflects',260,294);
  }
  function loop(ts){ t=ts; draw(); if(!paused) requestAnimationFrame(loop); else setTimeout(function(){requestAnimationFrame(loop);},200); }
  requestAnimationFrame(loop);
});

// ‚îÄ‚îÄ Fig 3.2: Meter Bridge ‚îÄ‚îÄ
register3D(function() {
  var wrap = injectView3D('Fig 3.2', 280); if (!wrap) return;
  var cv = make2DCanvas(wrap, 520, 280); var ctx = cv.getContext('2d');
  var paused = false;
  var io = new IntersectionObserver(function(e){ paused=!e[0].isIntersecting; }); io.observe(cv);
  var WX1=50, WX2=470, WY=165, jockeyX=280, dir=1;
  function draw() {
    ctx.clearRect(0,0,520,280); ctx.fillStyle='#fff'; ctx.fillRect(0,0,520,280);
    ctx.strokeStyle='#b45309'; ctx.lineWidth=3;
    ctx.beginPath(); ctx.moveTo(WX1,WY); ctx.lineTo(WX2,WY); ctx.stroke();
    ctx.fillStyle='#555'; ctx.font='bold 12px sans-serif'; ctx.textAlign='center';
    ctx.fillText('A',WX1,WY+18); ctx.fillText('B',WX2,WY+18);
    // Ticks & scale
    for(var i=0;i<=5;i++){
      var tx=WX1+(WX2-WX1)*i/5;
      ctx.strokeStyle='#aaa'; ctx.lineWidth=0.5;
      ctx.beginPath(); ctx.moveTo(tx,WY); ctx.lineTo(tx,WY+10); ctx.stroke();
      ctx.fillStyle='#aaa'; ctx.font='9px sans-serif'; ctx.fillText(i*20,tx,WY+22);
    }
    // Unknown R ‚Äì left side
    ctx.strokeStyle='#555'; ctx.lineWidth=1.5;
    ctx.beginPath(); ctx.moveTo(WX1,WY); ctx.lineTo(WX1,105); ctx.lineTo(105,105); ctx.stroke();
    ctx.fillStyle='#fffbeb'; ctx.strokeStyle='#d97706'; ctx.fillRect(68,91,64,28); ctx.strokeRect(68,91,64,28);
    ctx.fillStyle='#d97706'; ctx.font='bold 13px sans-serif'; ctx.textAlign='center'; ctx.fillText('R',100,110);
    ctx.strokeStyle='#555'; ctx.lineWidth=1.5;
    ctx.beginPath(); ctx.moveTo(132,105); ctx.lineTo(jockeyX,105); ctx.stroke();
    // Known S ‚Äì right side
    ctx.strokeStyle='#555'; ctx.lineWidth=1.5;
    ctx.beginPath(); ctx.moveTo(WX2,WY); ctx.lineTo(WX2,105); ctx.lineTo(395,105); ctx.stroke();
    ctx.fillStyle='#fffbeb'; ctx.strokeStyle='#d97706'; ctx.fillRect(368,91,64,28); ctx.strokeRect(368,91,64,28);
    ctx.fillStyle='#d97706'; ctx.font='bold 13px sans-serif'; ctx.textAlign='center'; ctx.fillText('S',400,110);
    ctx.strokeStyle='#555'; ctx.lineWidth=1.5;
    ctx.beginPath(); ctx.moveTo(368,105); ctx.lineTo(jockeyX,105); ctx.stroke();
    // Galvanometer
    ctx.strokeStyle='#d97706'; ctx.lineWidth=1.5;
    ctx.beginPath(); ctx.arc(jockeyX,105,15,0,Math.PI*2); ctx.stroke();
    ctx.fillStyle='#fff'; ctx.beginPath(); ctx.arc(jockeyX,105,15,0,Math.PI*2); ctx.fill();
    ctx.strokeStyle='#d97706'; ctx.beginPath(); ctx.arc(jockeyX,105,15,0,Math.PI*2); ctx.stroke();
    ctx.fillStyle='#d97706'; ctx.font='bold 11px sans-serif'; ctx.textAlign='center'; ctx.fillText('G',jockeyX,109);
    // Jockey
    ctx.strokeStyle='#555'; ctx.lineWidth=1.5;
    ctx.beginPath(); ctx.moveTo(jockeyX,120); ctx.lineTo(jockeyX,WY); ctx.stroke();
    ctx.fillStyle='#d97706'; ctx.beginPath(); ctx.arc(jockeyX,WY,5,0,Math.PI*2); ctx.fill();
    ctx.fillStyle='#d97706'; ctx.font='9px sans-serif'; ctx.textAlign='left'; ctx.fillText('J',jockeyX+8,WY-5);
    // Battery loop
    ctx.strokeStyle='#555'; ctx.lineWidth=1.5;
    ctx.beginPath(); ctx.moveTo(WX1,WY); ctx.lineTo(WX1,238); ctx.lineTo(WX2,238); ctx.lineTo(WX2,WY); ctx.stroke();
    ctx.lineWidth=2.5; ctx.beginPath(); ctx.moveTo(244,233); ctx.lineTo(276,233); ctx.stroke();
    ctx.lineWidth=1.5; ctx.beginPath(); ctx.moveTo(250,240); ctx.lineTo(270,240); ctx.stroke();
    ctx.fillStyle='#555'; ctx.font='10px sans-serif'; ctx.textAlign='center'; ctx.fillText('E',260,255);
    // Length labels
    var lCm=((jockeyX-WX1)/(WX2-WX1)*100);
    ctx.fillStyle='#2563eb'; ctx.font='10px sans-serif';
    ctx.fillText('l='+lCm.toFixed(1)+'cm',(WX1+jockeyX)/2,WY+36);
    ctx.fillText((100-lCm).toFixed(1)+'cm',(jockeyX+WX2)/2,WY+36);
    ctx.fillStyle='#475569'; ctx.font='11px sans-serif'; ctx.textAlign='center'; ctx.fillText('R/S = l/(100‚àíl)',260,272);
  }
  function loop(){
    jockeyX+=dir*0.45;
    if(jockeyX>WX2-50||jockeyX<WX1+50) dir*=-1;
    draw();
    if(!paused) requestAnimationFrame(loop); else setTimeout(function(){requestAnimationFrame(loop);},200);
  }
  requestAnimationFrame(loop);
});

// ‚îÄ‚îÄ Fig 3.3: Potentiometer ‚îÄ‚îÄ
register3D(function() {
  var wrap = injectView3D('Fig 3.3', 260); if (!wrap) return;
  var cv = make2DCanvas(wrap, 520, 260); var ctx = cv.getContext('2d');
  var paused = false;
  var io = new IntersectionObserver(function(e){ paused=!e[0].isIntersecting; }); io.observe(cv);
  var WX1=40, WX2=480, WY=68, tick=0, activeCell=1;
  var l1px = WX1+0.62*(WX2-WX1), l2px = WX1+0.45*(WX2-WX1);
  function draw() {
    ctx.clearRect(0,0,520,260); ctx.fillStyle='#fff'; ctx.fillRect(0,0,520,260);
    var phase=(tick/280)%1, jockeyX=WX1+phase*(WX2-WX1-10);
    // Wire
    ctx.strokeStyle='#b45309'; ctx.lineWidth=3;
    ctx.beginPath(); ctx.moveTo(WX1,WY); ctx.lineTo(WX2,WY); ctx.stroke();
    ctx.fillStyle='#555'; ctx.font='bold 12px sans-serif'; ctx.textAlign='center';
    ctx.fillText('A',WX1,WY-10); ctx.fillText('B',WX2,WY-10);
    // Driver circuit top
    ctx.strokeStyle='#555'; ctx.lineWidth=1.5;
    ctx.beginPath(); ctx.moveTo(WX1,WY); ctx.lineTo(WX1,38); ctx.lineTo(WX2,38); ctx.lineTo(WX2,WY); ctx.stroke();
    ctx.lineWidth=2.5; ctx.beginPath(); ctx.moveTo(246,33); ctx.lineTo(274,33); ctx.stroke();
    ctx.lineWidth=1.5; ctx.beginPath(); ctx.moveTo(252,40); ctx.lineTo(268,40); ctx.stroke();
    ctx.fillStyle='#555'; ctx.font='bold 9px sans-serif'; ctx.textAlign='center'; ctx.fillText('E (Driver)',260,28);
    // Jockey on wire
    ctx.fillStyle='#d97706'; ctx.beginPath(); ctx.arc(jockeyX,WY,5,0,Math.PI*2); ctx.fill();
    // E1 branch (red)
    var e1active=(activeCell===1); ctx.strokeStyle=e1active?'#ef4444':'#bbb'; ctx.lineWidth=1.5;
    ctx.beginPath(); ctx.moveTo(WX1,WY); ctx.lineTo(WX1,160); ctx.lineTo(118,160); ctx.stroke();
    ctx.strokeStyle='#ef4444'; ctx.lineWidth=2.5; ctx.beginPath(); ctx.moveTo(118,156); ctx.lineTo(118,164); ctx.stroke();
    ctx.lineWidth=1.5; ctx.beginPath(); ctx.moveTo(125,158); ctx.lineTo(125,162); ctx.stroke();
    ctx.fillStyle='#ef4444'; ctx.font='bold 11px sans-serif'; ctx.textAlign='center'; ctx.fillText('E‚ÇÅ',123,148);
    ctx.strokeStyle=e1active?'#ef4444':'#bbb'; ctx.lineWidth=1.5;
    ctx.beginPath(); ctx.moveTo(125,160); ctx.lineTo(200,160); ctx.stroke();
    // E2 branch (blue)
    var e2active=(activeCell===2); ctx.strokeStyle=e2active?'#3b82f6':'#bbb'; ctx.lineWidth=1.5;
    ctx.beginPath(); ctx.moveTo(WX1,160); ctx.lineTo(WX1,200); ctx.lineTo(118,200); ctx.stroke();
    ctx.strokeStyle='#3b82f6'; ctx.lineWidth=2.5; ctx.beginPath(); ctx.moveTo(118,196); ctx.lineTo(118,204); ctx.stroke();
    ctx.lineWidth=1.5; ctx.beginPath(); ctx.moveTo(125,198); ctx.lineTo(125,202); ctx.stroke();
    ctx.fillStyle='#3b82f6'; ctx.font='bold 11px sans-serif'; ctx.textAlign='center'; ctx.fillText('E‚ÇÇ',123,190);
    ctx.strokeStyle=e2active?'#3b82f6':'#bbb'; ctx.lineWidth=1.5;
    ctx.beginPath(); ctx.moveTo(125,200); ctx.lineTo(200,200); ctx.stroke();
    // Two-way key
    ctx.fillStyle='#fffbeb'; ctx.strokeStyle='#d97706'; ctx.lineWidth=1;
    ctx.fillRect(200,148,50,64); ctx.strokeRect(200,148,50,64);
    ctx.fillStyle='#d97706'; ctx.font='8px sans-serif'; ctx.textAlign='center'; ctx.fillText('Key',225,183);
    // Galvanometer
    ctx.strokeStyle='#555'; ctx.lineWidth=1.5;
    ctx.beginPath(); ctx.moveTo(250,175); ctx.lineTo(312,175); ctx.stroke();
    ctx.strokeStyle='#d97706'; ctx.lineWidth=1.5;
    ctx.beginPath(); ctx.arc(330,175,14,0,Math.PI*2); ctx.stroke();
    ctx.fillStyle='#fff'; ctx.beginPath(); ctx.arc(330,175,14,0,Math.PI*2); ctx.fill();
    ctx.strokeStyle='#d97706'; ctx.beginPath(); ctx.arc(330,175,14,0,Math.PI*2); ctx.stroke();
    ctx.fillStyle='#d97706'; ctx.font='bold 11px sans-serif'; ctx.textAlign='center'; ctx.fillText('G',330,179);
    // G pointer deflection
    var targetL=(activeCell===1?l1px:l2px), deflect=(jockeyX-targetL)*0.07;
    ctx.strokeStyle='#dc2626'; ctx.lineWidth=1.5;
    ctx.beginPath(); ctx.moveTo(330,175); ctx.lineTo(330+deflect*5,163); ctx.stroke();
    // Wire from G to jockey
    ctx.strokeStyle='#555'; ctx.lineWidth=1.5;
    ctx.beginPath(); ctx.moveTo(344,175); ctx.lineTo(jockeyX,175); ctx.lineTo(jockeyX,WY); ctx.stroke();
    // Null markers
    ctx.setLineDash([3,3]);
    ctx.strokeStyle='#ef4444'; ctx.lineWidth=1; ctx.beginPath(); ctx.moveTo(l1px,WY); ctx.lineTo(l1px,WY+20); ctx.stroke();
    ctx.strokeStyle='#3b82f6'; ctx.lineWidth=1; ctx.beginPath(); ctx.moveTo(l2px,WY); ctx.lineTo(l2px,WY+20); ctx.stroke();
    ctx.setLineDash([]);
    ctx.fillStyle='#ef4444'; ctx.font='9px sans-serif'; ctx.textAlign='center'; ctx.fillText('l‚ÇÅ',l1px,WY+30);
    ctx.fillStyle='#3b82f6'; ctx.fillText('l‚ÇÇ',l2px,WY+30);
    var isNull=Math.abs(jockeyX-targetL)<6;
    ctx.fillStyle=isNull?'#16a34a':'#475569'; ctx.font='10px sans-serif'; ctx.textAlign='center';
    ctx.fillText(isNull?'Null! E'+activeCell+' balanced':'E‚ÇÅ/E‚ÇÇ = l‚ÇÅ/l‚ÇÇ',260,248);
  }
  function loop(){
    tick++;
    if(tick>560){tick=0; activeCell=activeCell===1?2:1;}
    draw();
    if(!paused) requestAnimationFrame(loop); else setTimeout(function(){requestAnimationFrame(loop);},200);
  }
  requestAnimationFrame(loop);
});

// ‚îÄ‚îÄ Fig 3.4: V-I Characteristics ‚îÄ‚îÄ
register3D(function() {
  var wrap = injectView3D('Fig 3.4', 290); if (!wrap) return;
  var cv = make2DCanvas(wrap, 460, 290); var ctx = cv.getContext('2d');
  var paused = false, t = 0;
  var io = new IntersectionObserver(function(e){ paused=!e[0].isIntersecting; }); io.observe(cv);
  function draw() {
    ctx.clearRect(0,0,460,290); ctx.fillStyle='#fff'; ctx.fillRect(0,0,460,290);
    // Axes
    ctx.strokeStyle='#555'; ctx.lineWidth=1.5;
    ctx.beginPath(); ctx.moveTo(60,255); ctx.lineTo(400,255); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(60,255); ctx.lineTo(60,20); ctx.stroke();
    ctx.fillStyle='#555'; ctx.beginPath(); ctx.moveTo(400,255); ctx.lineTo(393,250); ctx.lineTo(393,260); ctx.fill();
    ctx.beginPath(); ctx.moveTo(60,20); ctx.lineTo(55,27); ctx.lineTo(65,27); ctx.fill();
    ctx.fillStyle='#555'; ctx.font='bold 12px sans-serif'; ctx.textAlign='left'; ctx.fillText('V',404,259);
    ctx.fillText('I',55,17); ctx.fillText('O',46,262);
    // Grid
    ctx.strokeStyle='#eee'; ctx.lineWidth=0.5;
    for(var g=1;g<=3;g++){
      ctx.beginPath(); ctx.moveTo(60,255-g*65); ctx.lineTo(400,255-g*65); ctx.stroke();
      ctx.beginPath(); ctx.moveTo(60+g*90,255); ctx.lineTo(60+g*90,20); ctx.stroke();
    }
    var pts=Math.floor(((t*0.004)%1.1)*30);
    if(pts>30)pts=30;
    // Ohmic line
    ctx.strokeStyle='#d97706'; ctx.lineWidth=2.5;
    ctx.beginPath(); ctx.moveTo(60,255);
    for(var i=1;i<=pts;i++) ctx.lineTo(60+i*10,255-i*7.5);
    ctx.stroke();
    // Non-ohmic curve
    ctx.strokeStyle='#2563eb'; ctx.lineWidth=2.5;
    ctx.beginPath(); ctx.moveTo(60,255);
    for(var i=1;i<=pts;i++) ctx.lineTo(60+i*10,255-(i*i*0.22+i*1.2));
    ctx.stroke();
    // Moving dot
    if(pts>0){
      var di=Math.floor(pts*0.7);
      ctx.fillStyle='#d97706'; ctx.beginPath(); ctx.arc(60+di*10,255-di*7.5,5,0,Math.PI*2); ctx.fill();
      ctx.fillStyle='#2563eb'; ctx.beginPath(); ctx.arc(60+di*10,255-(di*di*0.22+di*1.2),5,0,Math.PI*2); ctx.fill();
    }
    if(pts>15){
      ctx.fillStyle='#d97706'; ctx.font='bold 11px sans-serif'; ctx.textAlign='left'; ctx.fillText('Ohmic (V=IR)',190,90);
      ctx.fillStyle='#2563eb'; ctx.font='bold 11px sans-serif'; ctx.fillText('Non-ohmic',320,38);
    }
    ctx.fillStyle='#64748b'; ctx.font='italic 10px sans-serif'; ctx.textAlign='center';
    ctx.fillText('V-I characteristics: Ohmic vs Non-ohmic',230,283);
  }
  function loop(ts){t=ts; draw(); if(!paused) requestAnimationFrame(loop); else setTimeout(function(){requestAnimationFrame(loop);},200);}
  requestAnimationFrame(loop);
});

// ‚îÄ‚îÄ Fig 4.1: Straight wire B-field ‚îÄ‚îÄ
register3D(function() {
  var wrap = injectView3D('Fig 4.1', 340); if (!wrap) return;
  var cv = make2DCanvas(wrap, 400, 340); var ctx = cv.getContext('2d');
  var paused = false, t = 0;
  var io = new IntersectionObserver(function(e){ paused=!e[0].isIntersecting; }); io.observe(cv);
  function draw() {
    ctx.clearRect(0,0,400,340); ctx.fillStyle='#fff'; ctx.fillRect(0,0,400,340);
    var cx=200, cy=170;
    // Expanding ring animation
    var ringPhase=(t*0.018)%(Math.PI*2);
    for(var k=0;k<4;k++){
      var phi=(ringPhase+k*Math.PI/2)%(Math.PI*2);
      var maxR=145, r=(phi/(Math.PI*2))*maxR+5;
      var alpha=1-r/maxR;
      ctx.strokeStyle='rgba(220,38,38,'+alpha.toFixed(2)+')';
      ctx.lineWidth=1.8;
      ctx.beginPath(); ctx.arc(cx,cy,r,0,Math.PI*2); ctx.stroke();
      // Direction arrow (counterclockwise for upward current)
      if(r>25){
        ctx.save(); ctx.translate(cx,cy-r); ctx.rotate(-Math.PI/2);
        ctx.fillStyle='rgba(220,38,38,'+alpha.toFixed(2)+')';
        ctx.beginPath(); ctx.moveTo(-5,-4); ctx.lineTo(5,0); ctx.lineTo(-5,4); ctx.fill();
        ctx.restore();
      }
    }
    // Wire
    ctx.strokeStyle='#444'; ctx.lineWidth=4;
    ctx.beginPath(); ctx.moveTo(cx,300); ctx.lineTo(cx,28); ctx.stroke();
    // Moving current markers (upward)
    for(var i=0;i<5;i++){
      var yp=300-((t*1.4+i*56)%272);
      ctx.fillStyle='#f59e0b'; ctx.beginPath(); ctx.arc(cx,yp,3.5,0,Math.PI*2); ctx.fill();
    }
    // Current arrow
    ctx.fillStyle='#444'; ctx.beginPath(); ctx.moveTo(cx-5,52); ctx.lineTo(cx,30); ctx.lineTo(cx+5,52); ctx.fill();
    ctx.fillStyle='#444'; ctx.font='bold 10px sans-serif'; ctx.textAlign='left'; ctx.fillText('I (upward)',cx+8,44);
    ctx.fillStyle='#dc2626'; ctx.font='bold 12px sans-serif'; ctx.fillText('B',cx+75,cy-55);
    ctx.fillStyle='#64748b'; ctx.font='italic 9px sans-serif'; ctx.textAlign='center';
    ctx.fillText('Right-hand thumb rule: thumb ‚Üí I, fingers curl ‚Üí B',cx,333);
  }
  function loop(){t++; draw(); if(!paused) requestAnimationFrame(loop); else setTimeout(function(){requestAnimationFrame(loop);},200);}
  requestAnimationFrame(loop);
});

// ‚îÄ‚îÄ Fig 4.2: Circular loop field ‚îÄ‚îÄ
register3D(function() {
  var wrap = injectView3D('Fig 4.2', 320); if (!wrap) return;
  var cv = make2DCanvas(wrap, 460, 320); var ctx = cv.getContext('2d');
  var paused = false, t = 0;
  var io = new IntersectionObserver(function(e){ paused=!e[0].isIntersecting; }); io.observe(cv);
  function draw() {
    ctx.clearRect(0,0,460,320); ctx.fillStyle='#fff'; ctx.fillRect(0,0,460,320);
    var cx=230, cy=160;
    // Loop (ellipse)
    ctx.strokeStyle='#d97706'; ctx.lineWidth=3;
    ctx.beginPath(); ctx.ellipse(cx,cy,120,50,0,0,Math.PI*2); ctx.stroke();
    // Current arrow (moves around loop)
    var ang=(t*0.02)%(Math.PI*2);
    var ax=cx+120*Math.cos(ang), ay=cy+50*Math.sin(ang);
    var tangAng=Math.atan2(-120*Math.sin(ang)/50, 120*Math.cos(ang)/120); // approximate tangent angle
    ctx.save(); ctx.translate(ax,ay); ctx.rotate(ang+Math.PI/2);
    ctx.fillStyle='#d97706'; ctx.beginPath(); ctx.moveTo(-6,-4); ctx.lineTo(6,0); ctx.lineTo(-6,4); ctx.fill();
    ctx.restore();
    ctx.fillStyle='#d97706'; ctx.font='bold 11px sans-serif'; ctx.textAlign='left'; ctx.fillText('I',cx+128,cy-5);
    // Axis field arrows pulsing upward
    for(var i=0;i<5;i++){
      var prog=((t*0.014)+i/5)%1;
      var y=cy+130-prog*260;
      var al=1-Math.abs(y-cy)/130;
      if(al<0||y<cy-130||y>cy+130) continue;
      ctx.strokeStyle='rgba(220,38,38,'+al.toFixed(2)+')';
      ctx.lineWidth=1.4;
      ctx.beginPath(); ctx.moveTo(cx,y+14); ctx.lineTo(cx,y); ctx.stroke();
      ctx.save(); ctx.translate(cx,y); ctx.fillStyle='rgba(220,38,38,'+al.toFixed(2)+')';
      ctx.beginPath(); ctx.moveTo(-4,5); ctx.lineTo(0,0); ctx.lineTo(4,5); ctx.fill();
      ctx.restore();
    }
    // Side field lines dashed
    ctx.strokeStyle='#dc2626'; ctx.lineWidth=1; ctx.setLineDash([4,3]);
    ctx.beginPath(); ctx.moveTo(cx+120,cy); ctx.bezierCurveTo(cx+170,cy-60,cx+150,cy-140,cx,cy-148); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(cx-120,cy); ctx.bezierCurveTo(cx-170,cy-60,cx-150,cy-140,cx,cy-148); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(cx+120,cy); ctx.bezierCurveTo(cx+170,cy+60,cx+150,cy+140,cx,cy+148); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(cx-120,cy); ctx.bezierCurveTo(cx-170,cy+60,cx-150,cy+140,cx,cy+148); ctx.stroke();
    ctx.setLineDash([]);
    ctx.fillStyle='#dc2626'; ctx.font='bold 13px sans-serif'; ctx.textAlign='center'; ctx.fillText('B',cx+8,cy-148);
    ctx.fillStyle='#64748b'; ctx.font='italic 10px sans-serif'; ctx.fillText('Field resembles a magnetic dipole at large distances',cx,313);
  }
  function loop(){t++; draw(); if(!paused) requestAnimationFrame(loop); else setTimeout(function(){requestAnimationFrame(loop);},200);}
  requestAnimationFrame(loop);
});

// ‚îÄ‚îÄ Fig 4.3: Solenoid ‚îÄ‚îÄ
register3D(function() {
  var wrap = injectView3D('Fig 4.3', 300); if (!wrap) return;
  var cv = make2DCanvas(wrap, 500, 300); var ctx = cv.getContext('2d');
  var paused = false, t = 0;
  var io = new IntersectionObserver(function(e){ paused=!e[0].isIntersecting; }); io.observe(cv);
  function draw() {
    ctx.clearRect(0,0,500,300); ctx.fillStyle='#fff'; ctx.fillRect(0,0,500,300);
    var x1=120,x2=380,y1=100,y2=220,mY=160;
    // Solenoid box
    ctx.strokeStyle='#d97706'; ctx.lineWidth=2.5; ctx.strokeRect(x1,y1,x2-x1,y2-y1);
    // Turns
    ctx.strokeStyle='#d97706'; ctx.lineWidth=1.5;
    for(var i=1;i<=7;i++){var tx=x1+(x2-x1)*i/8; ctx.beginPath(); ctx.moveTo(tx,y1); ctx.lineTo(tx,y2); ctx.stroke();}
    // Animated field lines inside
    [mY-24,mY,mY+24].forEach(function(ly,li){
      ctx.strokeStyle='#dc2626'; ctx.lineWidth=1.5;
      ctx.beginPath(); ctx.moveTo(x1+4,ly); ctx.lineTo(x2-4,ly); ctx.stroke();
      ctx.fillStyle='#dc2626'; ctx.beginPath(); ctx.moveTo(x2-15,ly-5); ctx.lineTo(x2-4,ly); ctx.lineTo(x2-15,ly+5); ctx.fill();
      var dotX=x1+4+((t*0.8+li*80)%(x2-x1-8));
      ctx.fillStyle='#ef4444'; ctx.beginPath(); ctx.arc(dotX,ly,4,0,Math.PI*2); ctx.fill();
    });
    // External field lines (dashed loops outside)
    ctx.strokeStyle='#dc2626'; ctx.lineWidth=1; ctx.setLineDash([3,3]);
    ctx.beginPath(); ctx.moveTo(x2,mY-22); ctx.bezierCurveTo(x2+55,mY-80,250,mY-140,x1,mY-22); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(x2,mY+22); ctx.bezierCurveTo(x2+55,mY+80,250,mY+140,x1,mY+22); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(x2,mY-22); ctx.bezierCurveTo(x2+90,mY-110,250,mY-175,x1,mY-22); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(x2,mY+22); ctx.bezierCurveTo(x2+90,mY+110,250,mY+175,x1,mY+22); ctx.stroke();
    ctx.setLineDash([]);
    ctx.fillStyle='#dc2626'; ctx.font='bold 16px sans-serif'; ctx.textAlign='center'; ctx.fillText('N',x2+18,mY+6);
    ctx.fillStyle='#3b82f6'; ctx.fillText('S',x1-18,mY+6);
    ctx.fillStyle='#dc2626'; ctx.font='bold 11px sans-serif'; ctx.fillText('B = Œº‚ÇÄnI  (uniform inside)',250,248);
    ctx.fillStyle='#64748b'; ctx.font='italic 10px sans-serif'; ctx.fillText('Field is uniform inside, resembles bar magnet outside',250,290);
  }
  function loop(){t++; draw(); if(!paused) requestAnimationFrame(loop); else setTimeout(function(){requestAnimationFrame(loop);},200);}
  requestAnimationFrame(loop);
});

// ‚îÄ‚îÄ Fig 4.4: Moving Coil Galvanometer ‚îÄ‚îÄ
register3D(function() {
  var wrap = injectView3D('Fig 4.4', 320); if (!wrap) return;
  var cv = make2DCanvas(wrap, 460, 320); var ctx = cv.getContext('2d');
  var paused = false, t = 0;
  var io = new IntersectionObserver(function(e){ paused=!e[0].isIntersecting; }); io.observe(cv);
  function draw() {
    ctx.clearRect(0,0,460,320); ctx.fillStyle='#fff'; ctx.fillRect(0,0,460,320);
    var cx=230, cy=170;
    // Magnets
    ctx.fillStyle='#fca5a5'; ctx.strokeStyle='#dc2626'; ctx.lineWidth=1.5;
    ctx.fillRect(40,80,50,180); ctx.strokeRect(40,80,50,180);
    ctx.fillStyle='#dc2626'; ctx.font='bold 16px sans-serif'; ctx.textAlign='center'; ctx.fillText('N',65,175);
    ctx.fillStyle='#bfdbfe'; ctx.strokeStyle='#3b82f6'; ctx.lineWidth=1.5;
    ctx.fillRect(370,80,50,180); ctx.strokeRect(370,80,50,180);
    ctx.fillStyle='#3b82f6'; ctx.font='bold 16px sans-serif'; ctx.textAlign='center'; ctx.fillText('S',395,175);
    // Iron core (ellipse)
    ctx.fillStyle='#e5e7eb'; ctx.strokeStyle='#666'; ctx.lineWidth=1.5;
    ctx.beginPath(); ctx.ellipse(cx,cy,40,60,0,0,Math.PI*2); ctx.fill(); ctx.stroke();
    ctx.fillStyle='#666'; ctx.font='8px sans-serif'; ctx.textAlign='center'; ctx.fillText('Iron Core',cx,cy+3);
    // Coil (rotating)
    var deflect=Math.sin(t*0.025)*0.5;
    ctx.save(); ctx.translate(cx,cy); ctx.rotate(deflect);
    ctx.strokeStyle='#d97706'; ctx.lineWidth=2.5; ctx.strokeRect(-88,-75,176,150);
    ctx.restore();
    // Spring
    ctx.strokeStyle='#059669'; ctx.lineWidth=1.5;
    ctx.beginPath();
    var spx=cx+Math.sin(deflect)*75;
    ctx.moveTo(spx,cy-75*Math.cos(deflect));
    for(var s=0;s<8;s++) ctx.lineTo(spx+(s%2===0?7:-7),cy-88-s*4.5);
    ctx.lineTo(spx,cy-130); ctx.stroke();
    // Pointer
    ctx.strokeStyle='#555'; ctx.lineWidth=2;
    ctx.beginPath(); ctx.moveTo(spx,cy-75*Math.cos(deflect)); ctx.lineTo(spx,cy-138); ctx.stroke();
    // Scale arc
    ctx.strokeStyle='#555'; ctx.lineWidth=1;
    ctx.beginPath(); ctx.arc(spx,cy-75*Math.cos(deflect),36,-0.8,0.8); ctx.stroke();
    // Tick marks
    for(var m=-3;m<=3;m++){
      var ma=m*0.25;
      ctx.beginPath();
      ctx.moveTo(spx+30*Math.sin(ma),cy-75*Math.cos(deflect)-30*Math.cos(ma));
      ctx.lineTo(spx+36*Math.sin(ma),cy-75*Math.cos(deflect)-36*Math.cos(ma));
      ctx.stroke();
    }
    // Radial B arrows
    ctx.strokeStyle='#dc2626'; ctx.lineWidth=1; ctx.setLineDash([3,2]);
    [140,170,200].forEach(function(y){
      ctx.beginPath(); ctx.moveTo(90,y); ctx.lineTo(140,y); ctx.stroke();
      ctx.beginPath(); ctx.moveTo(320,y); ctx.lineTo(370,y); ctx.stroke();
    });
    ctx.setLineDash([]);
    ctx.fillStyle='#475569'; ctx.font='10px sans-serif'; ctx.textAlign='center';
    ctx.fillText('œÑ = NIAB  ¬∑  Œ∏ = NIAB/k',cx,310);
  }
  function loop(){t++; draw(); if(!paused) requestAnimationFrame(loop); else setTimeout(function(){requestAnimationFrame(loop);},200);}
  requestAnimationFrame(loop);
});

// ‚îÄ‚îÄ Fig 4.5: Cyclotron ‚îÄ‚îÄ
register3D(function() {
  var wrap = injectView3D('Fig 4.5', 380); if (!wrap) return;
  var cv = make2DCanvas(wrap, 460, 380); var ctx = cv.getContext('2d');
  var paused = false, t = 0;
  var io = new IntersectionObserver(function(e){ paused=!e[0].isIntersecting; }); io.observe(cv);
  function draw() {
    ctx.clearRect(0,0,460,380); ctx.fillStyle='#fff'; ctx.fillRect(0,0,460,380);
    var cx=230, cy=210, R=125;
    // D1 (left)
    ctx.fillStyle='#fef2f2'; ctx.strokeStyle='#dc2626'; ctx.lineWidth=2;
    ctx.beginPath(); ctx.arc(cx,cy,R,Math.PI/2,3*Math.PI/2); ctx.closePath(); ctx.fill(); ctx.stroke();
    ctx.fillStyle='#dc2626'; ctx.font='bold 16px sans-serif'; ctx.textAlign='center'; ctx.fillText('D‚ÇÅ',cx-60,cy+5);
    // D2 (right)
    ctx.fillStyle='#eff6ff'; ctx.strokeStyle='#3b82f6'; ctx.lineWidth=2;
    ctx.beginPath(); ctx.arc(cx,cy,R,-Math.PI/2,Math.PI/2); ctx.closePath(); ctx.fill(); ctx.stroke();
    ctx.fillStyle='#3b82f6'; ctx.font='bold 16px sans-serif'; ctx.textAlign='center'; ctx.fillText('D‚ÇÇ',cx+60,cy+5);
    // Gap
    ctx.fillStyle='#fff'; ctx.fillRect(cx-4,cy-R-2,8,2*R+4);
    // Spiral path
    var phase=(t*0.014)%(12*Math.PI);
    ctx.strokeStyle='#d97706'; ctx.lineWidth=1.5;
    ctx.beginPath();
    for(var a=0;a<phase;a+=0.08){
      var r=7+(a/(12*Math.PI))*(R-18);
      var x=cx+r*Math.cos(a+Math.PI), y=cy+r*Math.sin(a+Math.PI);
      if(a<0.01) ctx.moveTo(x,y); else ctx.lineTo(x,y);
    }
    ctx.stroke();
    // Particle dot
    var pa=phase%(12*Math.PI), pr=7+(pa/(12*Math.PI))*(R-18);
    var px=cx+pr*Math.cos(pa+Math.PI), py=cy+pr*Math.sin(pa+Math.PI);
    ctx.fillStyle='#d97706'; ctx.beginPath(); ctx.arc(px,py,5,0,Math.PI*2); ctx.fill();
    if(t>10){t=0;}  // reset
    // Source
    ctx.fillStyle='#d97706'; ctx.beginPath(); ctx.arc(cx,cy,5,0,Math.PI*2); ctx.fill();
    ctx.fillStyle='#d97706'; ctx.font='9px sans-serif'; ctx.textAlign='center'; ctx.fillText('Source',cx,cy-10);
    // Exit beam
    ctx.strokeStyle='#d97706'; ctx.lineWidth=2;
    ctx.beginPath(); ctx.moveTo(cx,cy-R+4); ctx.lineTo(cx+55,cy-R-55); ctx.stroke();
    ctx.save(); ctx.translate(cx+55,cy-R-55); ctx.rotate(-Math.PI/4);
    ctx.fillStyle='#d97706'; ctx.beginPath(); ctx.moveTo(-8,-4); ctx.lineTo(0,0); ctx.lineTo(-8,4); ctx.fill();
    ctx.restore();
    ctx.fillStyle='#d97706'; ctx.font='10px sans-serif'; ctx.textAlign='left'; ctx.fillText('Exit beam',cx+58,cy-R-50);
    // B into page
    ctx.fillStyle='#555'; ctx.font='bold 10px sans-serif'; ctx.textAlign='left'; ctx.fillText('B (into page)',365,145);
    ctx.strokeStyle='#555'; ctx.lineWidth=1.5; ctx.beginPath(); ctx.arc(400,160,10,0,Math.PI*2); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(393,153); ctx.lineTo(407,167); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(407,153); ctx.lineTo(393,167); ctx.stroke();
    ctx.fillStyle='#475569'; ctx.font='10px sans-serif'; ctx.textAlign='center';
    ctx.fillText('f = qB/(2œÄm)  (cyclotron frequency)',cx,372);
  }
  function loop(){t++; draw(); if(!paused) requestAnimationFrame(loop); else setTimeout(function(){requestAnimationFrame(loop);},200);}
  requestAnimationFrame(loop);
});

// ‚îÄ‚îÄ Fig 5.1: Bar magnet field lines ‚îÄ‚îÄ
register3D(function() {
  var wrap = injectView3D('Fig 5.1', 300); if (!wrap) return;
  var cv = make2DCanvas(wrap, 460, 300); var ctx = cv.getContext('2d');
  var paused = false, t = 0;
  var io = new IntersectionObserver(function(e){ paused=!e[0].isIntersecting; }); io.observe(cv);
  function cbp(p0,p1,p2,p3,s){var mt=1-s;return mt*mt*mt*p0+3*mt*mt*s*p1+3*mt*s*s*p2+s*s*s*p3;}
  function draw() {
    ctx.clearRect(0,0,460,300); ctx.fillStyle='#fff'; ctx.fillRect(0,0,460,300);
    var mx=230, my=150, hw=70;
    // Bar magnet
    ctx.fillStyle='#fca5a5'; ctx.strokeStyle='#be123c'; ctx.lineWidth=1.5;
    ctx.fillRect(mx-hw,130,hw,40); ctx.strokeRect(mx-hw,130,hw,40);
    ctx.fillStyle='#bfdbfe'; ctx.strokeStyle='#3b82f6';
    ctx.fillRect(mx,130,hw,40); ctx.strokeRect(mx,130,hw,40);
    ctx.fillStyle='#be123c'; ctx.font='bold 14px sans-serif'; ctx.textAlign='center'; ctx.fillText('N',mx-hw/2,155);
    ctx.fillStyle='#3b82f6'; ctx.fillText('S',mx+hw/2,155);
    // Field curves + animated dots
    var phase=(t*0.009)%1;
    var curves=[
      [mx-hw,130, mx-hw,95, mx+hw,95, mx+hw,130,25],
      [mx-hw,130, mx-hw,60, mx+hw,60, mx+hw,130,45],
      [mx-hw,130, mx-hw,15, mx+hw,15, mx+hw,130,62],
      [mx-hw,170, mx-hw,205, mx+hw,205, mx+hw,170,25],
      [mx-hw,170, mx-hw,240, mx+hw,240, mx+hw,170,45],
      [mx-hw,170, mx-hw,285, mx+hw,285, mx+hw,170,62],
    ];
    ctx.strokeStyle='#be123c'; ctx.lineWidth=1.3;
    curves.forEach(function(c,idx){
      ctx.beginPath();
      ctx.moveTo(c[0],c[1]);
      ctx.bezierCurveTo(c[0],c[2-1<0?1:c[2]>300?299:c[2]],c[2],c[3],c[4]<curves.length?c[4]:c[4],c[5]<0?0:c[5]);
      // just draw the standard bezier curve
      ctx.moveTo(c[0],c[1]); ctx.bezierCurveTo(c[2],c[3],c[2],c[3],c[4],c[5]); // fallback won't work right
      ctx.restore();
    });
    // Draw curves properly
    var fcurves=[
      [mx-hw,130, mx-hw,92, mx+hw,92, mx+hw,130],
      [mx-hw,130, mx-hw,55, mx+hw,55, mx+hw,130],
      [mx-hw,130, mx-hw,10, mx+hw,10, mx+hw,130],
      [mx-hw,170, mx-hw,208, mx+hw,208, mx+hw,170],
      [mx-hw,170, mx-hw,245, mx+hw,245, mx+hw,170],
      [mx-hw,170, mx-hw,290, mx+hw,290, mx+hw,170],
    ];
    ctx.strokeStyle='#be123c'; ctx.lineWidth=1.3;
    fcurves.forEach(function(c,idx){
      ctx.beginPath(); ctx.moveTo(c[0],c[1]); ctx.bezierCurveTo(c[2],c[3],c[4],c[5],c[6],c[7]); ctx.stroke();
      var dp=(phase+idx*0.17)%1;
      var bx=cbp(c[0],c[2],c[4],c[6],dp), by=cbp(c[1],c[3],c[5],c[7],dp);
      ctx.fillStyle='#be123c'; ctx.beginPath(); ctx.arc(bx,by,3.5,0,Math.PI*2); ctx.fill();
    });
    // Far left/right curves
    ctx.strokeStyle='#be123c'; ctx.lineWidth=1;
    ctx.beginPath(); ctx.moveTo(mx-hw,my); ctx.bezierCurveTo(25,50,25,250,mx+hw,my); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(mx-hw,my); ctx.bezierCurveTo(435,50,435,250,mx+hw,my); ctx.stroke();
    // Internal dashed
    ctx.strokeStyle='#be123c'; ctx.lineWidth=1; ctx.setLineDash([3,2]);
    ctx.beginPath(); ctx.moveTo(mx+hw,my); ctx.lineTo(mx-hw,my); ctx.stroke(); ctx.setLineDash([]);
    ctx.fillStyle='#64748b'; ctx.font='italic 8px sans-serif'; ctx.textAlign='center'; ctx.fillText('Inside: S ‚Üí N',mx,163);
  }
  function loop(){t++; draw(); if(!paused) requestAnimationFrame(loop); else setTimeout(function(){requestAnimationFrame(loop);},200);}
  requestAnimationFrame(loop);
});

// ‚îÄ‚îÄ Fig 5.2: Bar magnet vs solenoid ‚îÄ‚îÄ
register3D(function() {
  var wrap = injectView3D('Fig 5.2', 320); if (!wrap) return;
  var cv = make2DCanvas(wrap, 520, 320); var ctx = cv.getContext('2d');
  var paused = false, t = 0;
  var io = new IntersectionObserver(function(e){ paused=!e[0].isIntersecting; }); io.observe(cv);
  function cbp(p0,p1,p2,p3,s){var mt=1-s;return mt*mt*mt*p0+3*mt*mt*s*p1+3*mt*s*s*p2+s*s*s*p3;}
  function draw() {
    ctx.clearRect(0,0,520,320); ctx.fillStyle='#fff'; ctx.fillRect(0,0,520,320);
    var phase=(t*0.009)%1;
    // ‚îÄ‚îÄ LEFT: Bar Magnet ‚îÄ‚îÄ
    var lx=130, ly=160, hw=40;
    ctx.fillStyle='#fca5a5'; ctx.strokeStyle='#be123c'; ctx.lineWidth=1.2;
    ctx.fillRect(lx-hw,ly-18,hw,36); ctx.strokeRect(lx-hw,ly-18,hw,36);
    ctx.fillStyle='#bfdbfe'; ctx.strokeStyle='#3b82f6';
    ctx.fillRect(lx,ly-18,hw,36); ctx.strokeRect(lx,ly-18,hw,36);
    ctx.fillStyle='#be123c'; ctx.font='bold 12px sans-serif'; ctx.textAlign='center'; ctx.fillText('N',lx-20,ly+4);
    ctx.fillStyle='#3b82f6'; ctx.fillText('S',lx+20,ly+4);
    // Field lines for bar magnet
    var lcurves=[
      [lx-hw,ly-18, lx-hw,ly-50, lx+hw,ly-50, lx+hw,ly-18],
      [lx-hw,ly-18, lx-hw,ly-80, lx+hw,ly-80, lx+hw,ly-18],
      [lx-hw,ly-18, lx-hw,ly-110,lx+hw,ly-110,lx+hw,ly-18],
      [lx-hw,ly+18, lx-hw,ly+50, lx+hw,ly+50, lx+hw,ly+18],
      [lx-hw,ly+18, lx-hw,ly+80, lx+hw,ly+80, lx+hw,ly+18],
      [lx-hw,ly+18, lx-hw,ly+110,lx+hw,ly+110,lx+hw,ly+18],
    ];
    ctx.strokeStyle='#be123c'; ctx.lineWidth=1;
    lcurves.forEach(function(c,i){
      ctx.beginPath(); ctx.moveTo(c[0],c[1]); ctx.bezierCurveTo(c[2],c[3],c[4],c[5],c[6],c[7]); ctx.stroke();
      var dp=(phase+i*0.17)%1, bx=cbp(c[0],c[2],c[4],c[6],dp), by=cbp(c[1],c[3],c[5],c[7],dp);
      ctx.fillStyle='#be123c'; ctx.beginPath(); ctx.arc(bx,by,2.5,0,Math.PI*2); ctx.fill();
    });
    ctx.fillStyle='#444'; ctx.font='bold 11px sans-serif'; ctx.textAlign='center'; ctx.fillText('Bar Magnet',lx,ly-120);
    // ‚îÄ‚îÄ RIGHT: Solenoid ‚îÄ‚îÄ
    var rx=390, ry=160;
    ctx.strokeStyle='#d97706'; ctx.lineWidth=2;
    ctx.strokeRect(rx-50,ry-24,100,48);
    ctx.strokeStyle='#d97706'; ctx.lineWidth=1;
    for(var si=1;si<=4;si++){var slx=rx-50+si*20; ctx.beginPath(); ctx.moveTo(slx,ry-24); ctx.lineTo(slx,ry+24); ctx.stroke();}
    ctx.fillStyle='#dc2626'; ctx.font='bold 10px sans-serif'; ctx.textAlign='center'; ctx.fillText('N',rx+62,ry+4);
    ctx.fillStyle='#3b82f6'; ctx.fillText('S',rx-62,ry+4);
    // Internal field arrow
    ctx.strokeStyle='#dc2626'; ctx.lineWidth=1.5;
    ctx.beginPath(); ctx.moveTo(rx-50,ry); ctx.lineTo(rx+50,ry); ctx.stroke();
    ctx.fillStyle='#dc2626'; ctx.beginPath(); ctx.moveTo(rx+38,ry-5); ctx.lineTo(rx+50,ry); ctx.lineTo(rx+38,ry+5); ctx.fill();
    // Field curves for solenoid (same pattern as bar magnet)
    var rcurves=[
      [rx+50,ry-15, rx+50,ry-50, rx-50,ry-50, rx-50,ry-15],
      [rx+50,ry-15, rx+50,ry-80, rx-50,ry-80, rx-50,ry-15],
      [rx+50,ry-15, rx+50,ry-115,rx-50,ry-115,rx-50,ry-15],
      [rx+50,ry+15, rx+50,ry+50, rx-50,ry+50, rx-50,ry+15],
      [rx+50,ry+15, rx+50,ry+80, rx-50,ry+80, rx-50,ry+15],
      [rx+50,ry+15, rx+50,ry+115,rx-50,ry+115,rx-50,ry+15],
    ];
    ctx.strokeStyle='#be123c'; ctx.lineWidth=1;
    rcurves.forEach(function(c,i){
      ctx.beginPath(); ctx.moveTo(c[0],c[1]); ctx.bezierCurveTo(c[2],c[3],c[4],c[5],c[6],c[7]); ctx.stroke();
      var dp=(phase+i*0.17)%1, bx=cbp(c[0],c[2],c[4],c[6],dp), by=cbp(c[1],c[3],c[5],c[7],dp);
      ctx.fillStyle='#be123c'; ctx.beginPath(); ctx.arc(bx,by,2.5,0,Math.PI*2); ctx.fill();
    });
    ctx.fillStyle='#444'; ctx.font='bold 11px sans-serif'; ctx.textAlign='center'; ctx.fillText('Solenoid',rx,ry-120);
    // Divider
    ctx.strokeStyle='#ddd'; ctx.lineWidth=1; ctx.setLineDash([4,3]);
    ctx.beginPath(); ctx.moveTo(260,40); ctx.lineTo(260,290); ctx.stroke(); ctx.setLineDash([]);
    ctx.fillStyle='#aaa'; ctx.font='bold 11px sans-serif'; ctx.textAlign='center'; ctx.fillText('vs',260,165);
    ctx.fillStyle='#64748b'; ctx.font='italic 10px sans-serif';
    ctx.fillText('Identical external field patterns ‚Äî both are magnetic dipoles',260,308);
  }
  function loop(){t++; draw(); if(!paused) requestAnimationFrame(loop); else setTimeout(function(){requestAnimationFrame(loop);},200);}
  requestAnimationFrame(loop);
});
</script>

<!-- ‚îÄ‚îÄ GROUP C: Ch6 (6.1‚Äì6.3) + Ch7 (7.1‚Äì7.4) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<script>
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   GROUP C ‚Äî Ch6: Electromagnetic Induction  (6.1 ¬∑ 6.2 ¬∑ 6.3)
             Ch7: Alternating Current        (7.2 ¬∑ 7.4)
   Canvas 2D animations via register3D / injectView3D / make2DCanvas
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

/* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
   Fig 6.1 ‚Äî AC Generator  (520 √ó 340, dark background)
   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
register3D(function () {
  var wrap = injectView3D('Fig 6.1', 340);
  if (!wrap) return;
  wrap.style.background = '#0d1117';
  var cv = make2DCanvas(wrap, 520, 340);
  var ctx = cv.getContext('2d');

  var W = cv.width, H = cv.height;
  var t = 0;
  var RAF;

  /* layout constants */
  var CX = 185, CY = 148;
  var COIL_W = 90, COIL_H = 62;
  var MAG_LEFT = 42, MAG_RIGHT = 328;
  var WAVE_X0 = 330, WAVE_Y0 = 148, WAVE_W = 170, WAVE_AMP = 52;
  var SLIP_CX = 250, SLIP_Y = 242;

  function drawHorseshoe() {
    ctx.fillStyle = '#c0392b';
    ctx.beginPath();
    ctx.roundRect(MAG_LEFT, CY - 72, 32, 144, 5);
    ctx.fill();
    ctx.fillStyle = '#fff';
    ctx.font = 'bold 16px DM Sans, sans-serif';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillText('N', MAG_LEFT + 16, CY);

    ctx.fillStyle = '#2980b9';
    ctx.beginPath();
    ctx.roundRect(MAG_RIGHT - 2, CY - 72, 32, 144, 5);
    ctx.fill();
    ctx.fillStyle = '#fff';
    ctx.fillText('S', MAG_RIGHT + 14, CY);

    ctx.strokeStyle = 'rgba(231,76,60,0.30)';
    ctx.setLineDash([6, 5]);
    ctx.lineWidth = 1.2;
    [-44, -20, 4, 28, 52].forEach(function (dy) {
      ctx.beginPath();
      ctx.moveTo(MAG_LEFT + 32, CY + dy);
      ctx.lineTo(MAG_RIGHT - 2, CY + dy);
      ctx.stroke();
    });
    ctx.setLineDash([]);
  }

  function drawCoil(angle) {
    ctx.save();
    ctx.translate(CX, CY);
    var fw = COIL_W * Math.abs(Math.cos(angle));
    var fh = COIL_H;

    ctx.strokeStyle = 'rgba(5,150,105,0.35)';
    ctx.lineWidth = 2;
    ctx.strokeRect(-fw, -fh, fw * 2, fh * 2);

    ctx.strokeStyle = '#10b981';
    ctx.lineWidth = 2.5;
    ctx.strokeRect(-fw, -fh, fw * 2, fh * 2);

    if (fw > 6) {
      ctx.fillStyle = Math.cos(angle) >= 0 ? '#34d399' : '#f87171';
      ctx.beginPath();
      ctx.arc(fw, 0, 5, 0, Math.PI * 2);
      ctx.fill();
    }

    ctx.strokeStyle = '#6b7280';
    ctx.lineWidth = 3;
    ctx.beginPath();
    ctx.moveTo(0, fh);
    ctx.lineTo(0, fh + 60);
    ctx.stroke();
    ctx.restore();

    var arX = CX + COIL_W + 18, arY = CY - COIL_H - 10;
    ctx.save();
    ctx.translate(arX, arY);
    ctx.strokeStyle = '#34d399';
    ctx.lineWidth = 1.6;
    ctx.beginPath();
    ctx.arc(0, 0, 12, -Math.PI * 0.8, Math.PI * 0.3);
    ctx.stroke();
    var ax = 12 * Math.cos(Math.PI * 0.3), ay = 12 * Math.sin(Math.PI * 0.3);
    ctx.fillStyle = '#34d399';
    ctx.beginPath();
    ctx.moveTo(ax, ay);
    ctx.lineTo(ax - 5, ay - 2);
    ctx.lineTo(ax + 2, ay - 5);
    ctx.closePath();
    ctx.fill();
    ctx.restore();
  }

  function drawSlipRings() {
    ctx.strokeStyle = '#d97706';
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.ellipse(SLIP_CX - 14, SLIP_Y, 12, 6, 0, 0, Math.PI * 2);
    ctx.stroke();
    ctx.beginPath();
    ctx.ellipse(SLIP_CX + 14, SLIP_Y, 12, 6, 0, 0, Math.PI * 2);
    ctx.stroke();

    ctx.fillStyle = '#4b5563';
    ctx.fillRect(SLIP_CX - 20, SLIP_Y + 8, 10, 18);
    ctx.fillRect(SLIP_CX + 10, SLIP_Y + 8, 10, 18);

    ctx.strokeStyle = '#6b7280';
    ctx.lineWidth = 1.5;
    ctx.beginPath();
    ctx.moveTo(SLIP_CX - 15, SLIP_Y + 26);
    ctx.lineTo(SLIP_CX - 15, SLIP_Y + 52);
    ctx.lineTo(SLIP_CX - 28, SLIP_Y + 52);
    ctx.stroke();
    ctx.beginPath();
    ctx.moveTo(SLIP_CX + 15, SLIP_Y + 26);
    ctx.lineTo(SLIP_CX + 15, SLIP_Y + 52);
    ctx.lineTo(SLIP_CX + 28, SLIP_Y + 52);
    ctx.stroke();

    ctx.strokeStyle = '#059669';
    ctx.strokeRect(SLIP_CX - 28, SLIP_Y + 44, 56, 18);
    ctx.fillStyle = '#059669';
    ctx.font = '10px DM Sans,sans-serif';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillText('R', SLIP_CX, SLIP_Y + 53);

    ctx.fillStyle = '#d97706';
    ctx.font = '9px DM Sans,sans-serif';
    ctx.textAlign = 'center';
    ctx.fillText('Slip rings', SLIP_CX, SLIP_Y - 10);
  }

  function drawSineWave(phase) {
    ctx.fillStyle = 'rgba(0,0,0,0.35)';
    ctx.beginPath();
    ctx.roundRect(WAVE_X0 - 8, WAVE_Y0 - WAVE_AMP - 18, WAVE_W + 20, WAVE_AMP * 2 + 36, 6);
    ctx.fill();

    ctx.strokeStyle = 'rgba(255,255,255,0.18)';
    ctx.lineWidth = 1;
    ctx.beginPath();
    ctx.moveTo(WAVE_X0, WAVE_Y0 - WAVE_AMP - 10);
    ctx.lineTo(WAVE_X0, WAVE_Y0 + WAVE_AMP + 10);
    ctx.stroke();
    ctx.beginPath();
    ctx.moveTo(WAVE_X0 - 4, WAVE_Y0);
    ctx.lineTo(WAVE_X0 + WAVE_W + 4, WAVE_Y0);
    ctx.stroke();

    var cycles = 1.0;
    ctx.strokeStyle = '#34d399';
    ctx.lineWidth = 2.2;
    ctx.beginPath();
    var pts = 120;
    var drawn = false;
    for (var i = 0; i <= pts; i++) {
      var frac = i / pts;
      var px = WAVE_X0 + frac * WAVE_W;
      var wavePhase = frac * cycles * Math.PI * 2;
      if (wavePhase > phase) break;
      var py = WAVE_Y0 - WAVE_AMP * Math.sin(wavePhase);
      if (!drawn) { ctx.moveTo(px, py); drawn = true; }
      else ctx.lineTo(px, py);
    }
    ctx.stroke();

    var dotFrac = Math.min(phase / (cycles * Math.PI * 2), 1);
    var dotX = WAVE_X0 + dotFrac * WAVE_W;
    var dotY = WAVE_Y0 - WAVE_AMP * Math.sin(phase);
    ctx.beginPath();
    ctx.arc(dotX, dotY, 4.5, 0, Math.PI * 2);
    ctx.fillStyle = '#6ee7b7';
    ctx.fill();

    ctx.fillStyle = '#6ee7b7';
    ctx.font = 'italic 10px DM Sans,sans-serif';
    ctx.textAlign = 'center';
    ctx.fillText('\u03b5 = \u03b5\u2080 sin(\u03c9t)', WAVE_X0 + WAVE_W / 2, WAVE_Y0 + WAVE_AMP + 14);
  }

  function frame() {
    RAF = requestAnimationFrame(frame);
    ctx.clearRect(0, 0, W, H);

    var bg = ctx.createLinearGradient(0, 0, 0, H);
    bg.addColorStop(0, '#0d1117');
    bg.addColorStop(1, '#111827');
    ctx.fillStyle = bg;
    ctx.fillRect(0, 0, W, H);

    drawHorseshoe();

    var omega = 0.6;
    var coilAngle = t * omega;
    var wavePhase = coilAngle % (Math.PI * 2);

    drawCoil(coilAngle);
    drawSlipRings();
    drawSineWave(wavePhase);

    ctx.fillStyle = '#059669';
    ctx.font = 'bold 11px DM Sans,sans-serif';
    ctx.textAlign = 'left';
    ctx.textBaseline = 'alphabetic';
    ctx.fillText('AC Generator', 12, 20);

    t += 1 / 60;
  }

  var io = new IntersectionObserver(function (entries) {
    if (entries[0].isIntersecting) { if (!RAF) frame(); }
    else { cancelAnimationFrame(RAF); RAF = null; }
  }, { threshold: 0.05 });
  io.observe(cv);
});


/* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
   Fig 6.2 ‚Äî Step-up Transformer  (520 √ó 320, light background)
   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
register3D(function () {
  var wrap = injectView3D('Fig 6.2', 320);
  if (!wrap) return;
  wrap.style.background = '#f8fafc';
  var cv = make2DCanvas(wrap, 520, 320);
  var ctx = cv.getContext('2d');
  var W = cv.width, H = cv.height;
  var t = 0;
  var RAF;

  var CORE_X = 130, CORE_Y = 55, CORE_W = 260, CORE_H = 200;
  var CORE_T = 22;
  var PRI_CX = CORE_X + CORE_T / 2;
  var SEC_CX = CORE_X + CORE_W - CORE_T / 2;
  var COIL_Y0 = CORE_Y + CORE_T + 10;
  var COIL_H2 = CORE_H - CORE_T * 2 - 20;

  function drawCore() {
    ctx.fillStyle = '#94a3b8';
    ctx.strokeStyle = '#475569';
    ctx.lineWidth = 1.2;
    ctx.beginPath();
    ctx.roundRect(CORE_X, CORE_Y, CORE_W, CORE_T, 4);
    ctx.fill(); ctx.stroke();
    ctx.beginPath();
    ctx.roundRect(CORE_X, CORE_Y + CORE_H - CORE_T, CORE_W, CORE_T, 4);
    ctx.fill(); ctx.stroke();
    ctx.beginPath();
    ctx.roundRect(CORE_X, CORE_Y, CORE_T, CORE_H, 4);
    ctx.fill(); ctx.stroke();
    ctx.beginPath();
    ctx.roundRect(CORE_X + CORE_W - CORE_T, CORE_Y, CORE_T, CORE_H, 4);
    ctx.fill(); ctx.stroke();

    ctx.fillStyle = '#475569';
    ctx.font = '10px DM Sans,sans-serif';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'alphabetic';
    ctx.fillText('Laminated Iron Core', CORE_X + CORE_W / 2, CORE_Y - 8);
  }

  function drawPrimaryCoil() {
    var nTurns = 5;
    var turnH = COIL_H2 / nTurns;
    ctx.strokeStyle = '#059669';
    ctx.lineWidth = 2.5;
    ctx.lineJoin = 'round';
    for (var i = 0; i < nTurns; i++) {
      var y = COIL_Y0 + i * turnH;
      ctx.beginPath();
      ctx.moveTo(PRI_CX - 4, y);
      ctx.bezierCurveTo(PRI_CX - 28, y, PRI_CX - 28, y + turnH, PRI_CX - 4, y + turnH);
      ctx.stroke();
    }
    ctx.beginPath();
    ctx.moveTo(PRI_CX - 4, COIL_Y0);
    ctx.lineTo(PRI_CX - 4, COIL_Y0 + COIL_H2);
    ctx.stroke();
    ctx.fillStyle = '#059669';
    ctx.font = 'bold 12px DM Sans,sans-serif';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillText('N\u2081', PRI_CX - 38, COIL_Y0 + COIL_H2 / 2);
    ctx.font = '9px DM Sans,sans-serif';
    ctx.fillText('Primary', PRI_CX - 38, COIL_Y0 + COIL_H2 / 2 + 14);
  }

  function drawSecondaryCoil() {
    var nTurns = 10;
    var turnH = COIL_H2 / nTurns;
    ctx.strokeStyle = '#dc2626';
    ctx.lineWidth = 2.2;
    ctx.lineJoin = 'round';
    for (var i = 0; i < nTurns; i++) {
      var y = COIL_Y0 + i * turnH;
      ctx.beginPath();
      ctx.moveTo(SEC_CX + 4, y);
      ctx.bezierCurveTo(SEC_CX + 28, y, SEC_CX + 28, y + turnH, SEC_CX + 4, y + turnH);
      ctx.stroke();
    }
    ctx.beginPath();
    ctx.moveTo(SEC_CX + 4, COIL_Y0);
    ctx.lineTo(SEC_CX + 4, COIL_Y0 + COIL_H2);
    ctx.stroke();
    ctx.fillStyle = '#dc2626';
    ctx.font = 'bold 12px DM Sans,sans-serif';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillText('N\u2082', SEC_CX + 38, COIL_Y0 + COIL_H2 / 2);
    ctx.font = '9px DM Sans,sans-serif';
    ctx.fillText('Secondary', SEC_CX + 38, COIL_Y0 + COIL_H2 / 2 + 14);
  }

  function drawMiniSine(cx, y0, amp, phase, color, lbl) {
    var ww = 52;
    ctx.strokeStyle = color;
    ctx.lineWidth = 1.8;
    ctx.beginPath();
    for (var i = 0; i <= 60; i++) {
      var frac = i / 60;
      var px2 = cx - ww / 2 + frac * ww;
      var py2 = y0 - amp * Math.sin(frac * Math.PI * 2 + phase);
      if (i === 0) ctx.moveTo(px2, py2); else ctx.lineTo(px2, py2);
    }
    ctx.stroke();
    ctx.fillStyle = color;
    ctx.font = 'bold 10px DM Sans,sans-serif';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'alphabetic';
    ctx.fillText(lbl, cx, y0 + amp + 14);
  }

  function drawFluxArrows(phase) {
    var arrows = [
      { x: CORE_X + CORE_T + 20,           y: CORE_Y + CORE_T / 2,            dir: 'right' },
      { x: CORE_X + CORE_T + 90,            y: CORE_Y + CORE_T / 2,            dir: 'right' },
      { x: CORE_X + CORE_W - CORE_T - 20,   y: CORE_Y + CORE_H - CORE_T / 2,  dir: 'left'  },
      { x: CORE_X + CORE_W - CORE_T - 90,   y: CORE_Y + CORE_H - CORE_T / 2,  dir: 'left'  },
      { x: CORE_X + CORE_W - CORE_T / 2,    y: CORE_Y + CORE_T + 30,           dir: 'down'  },
      { x: CORE_X + CORE_T / 2,             y: CORE_Y + CORE_H - CORE_T - 30,  dir: 'up'    },
    ];
    var pulse = 0.55 + 0.45 * Math.sin(phase);
    ctx.fillStyle = 'rgba(5,150,105,' + pulse.toFixed(2) + ')';
    arrows.forEach(function (a) {
      ctx.save();
      ctx.translate(a.x, a.y);
      var rot = { right: 0, left: Math.PI, down: Math.PI / 2, up: -Math.PI / 2 }[a.dir];
      ctx.rotate(rot);
      ctx.beginPath();
      ctx.moveTo(8, 0);
      ctx.lineTo(-4, -4);
      ctx.lineTo(-4, 4);
      ctx.closePath();
      ctx.fill();
      ctx.restore();
    });
    ctx.fillStyle = 'rgba(5,150,105,0.70)';
    ctx.font = 'italic bold 14px DM Sans,sans-serif';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillText('\u03a6', CORE_X + CORE_W / 2, CORE_Y + CORE_H / 2 + 5);
  }

  function drawConnections(phase) {
    var srcX = CORE_X - 64, srcYc = CORE_Y + CORE_H / 2;
    var wireY_top = COIL_Y0, wireY_bot = COIL_Y0 + COIL_H2;
    var priLeft = PRI_CX - 28;

    ctx.strokeStyle = '#059669';
    ctx.lineWidth = 1.5;
    ctx.beginPath();
    ctx.moveTo(priLeft, wireY_top);
    ctx.lineTo(srcX + 16, wireY_top);
    ctx.lineTo(srcX + 16, srcYc - 18);
    ctx.stroke();
    ctx.beginPath();
    ctx.moveTo(priLeft, wireY_bot);
    ctx.lineTo(srcX + 16, wireY_bot);
    ctx.lineTo(srcX + 16, srcYc + 18);
    ctx.stroke();

    ctx.beginPath();
    ctx.arc(srcX + 16, srcYc, 18, 0, Math.PI * 2);
    ctx.strokeStyle = '#059669';
    ctx.lineWidth = 1.8;
    ctx.stroke();
    ctx.strokeStyle = '#059669';
    ctx.lineWidth = 1.4;
    ctx.beginPath();
    for (var i = 0; i <= 20; i++) {
      var f = i / 20;
      var px2 = srcX + 16 - 11 + f * 22;
      var py2 = srcYc - 7 * Math.sin(f * Math.PI * 2 + phase);
      if (i === 0) ctx.moveTo(px2, py2); else ctx.lineTo(px2, py2);
    }
    ctx.stroke();
    ctx.fillStyle = '#059669';
    ctx.font = 'bold 11px DM Sans,sans-serif';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'alphabetic';
    ctx.fillText('V\u2081', srcX + 16, srcYc + 30);

    var loadX = CORE_X + CORE_W + 44;
    var secLeft = SEC_CX + 28;
    ctx.strokeStyle = '#dc2626';
    ctx.lineWidth = 1.5;
    ctx.beginPath();
    ctx.moveTo(secLeft, wireY_top);
    ctx.lineTo(loadX, wireY_top);
    ctx.lineTo(loadX, srcYc - 28);
    ctx.stroke();
    ctx.beginPath();
    ctx.moveTo(secLeft, wireY_bot);
    ctx.lineTo(loadX, wireY_bot);
    ctx.lineTo(loadX, srcYc + 28);
    ctx.stroke();

    ctx.strokeStyle = '#dc2626';
    ctx.strokeRect(loadX - 14, srcYc - 28, 28, 56);
    ctx.fillStyle = '#dc2626';
    ctx.font = 'bold 10px DM Sans,sans-serif';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillText('Load', loadX, srcYc + 5);
    ctx.font = 'bold 11px DM Sans,sans-serif';
    ctx.textBaseline = 'alphabetic';
    ctx.fillText('V\u2082', loadX, srcYc + 38);

    var wy = H - 52;
    drawMiniSine(PRI_CX - 10, wy, 14, phase, '#059669', 'V\u2081');
    drawMiniSine(SEC_CX + 10, wy, 26, phase, '#dc2626', 'V\u2082');

    ctx.fillStyle = '#334155';
    ctx.font = 'bold 11px DM Sans,sans-serif';
    ctx.textAlign = 'center';
    ctx.fillText('V\u2082/V\u2081 = N\u2082/N\u2081', W / 2, H - 10);
  }

  function frame() {
    RAF = requestAnimationFrame(frame);
    ctx.clearRect(0, 0, W, H);
    ctx.fillStyle = '#f8fafc';
    ctx.fillRect(0, 0, W, H);
    drawCore();
    drawPrimaryCoil();
    drawSecondaryCoil();
    drawFluxArrows(t * 2.5);
    drawConnections(t * 2.5);
    t += 1 / 60;
  }

  var io = new IntersectionObserver(function (entries) {
    if (entries[0].isIntersecting) { if (!RAF) frame(); }
    else { cancelAnimationFrame(RAF); RAF = null; }
  }, { threshold: 0.05 });
  io.observe(cv);
});


/* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
   Fig 6.3 ‚Äî Eddy Currents  (520 √ó 300, dark background)
   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
register3D(function () {
  var wrap = injectView3D('Fig 6.3', 300);
  if (!wrap) return;
  wrap.style.background = '#0d1117';
  var cv = make2DCanvas(wrap, 520, 300);
  var ctx = cv.getContext('2d');
  var W = cv.width, H = cv.height;
  var t = 0;
  var RAF;

  var PX = 80, PY = 105, PW = 360, PH = 155, PR = 10;

  var eddies = [
    { cx: 175, cy: 178, rx: 52, ry: 34, dir:  1 },
    { cx: 270, cy: 178, rx: 52, ry: 34, dir: -1 },
    { cx: 220, cy: 228, rx: 38, ry: 24, dir:  1 },
  ];

  var MAG_Y = 38, MAG_W = 180, MAG_H = 30, MAG_CX = W / 2;

  function drawMagnet() {
    var grad = ctx.createLinearGradient(MAG_CX - MAG_W / 2, 0, MAG_CX, 0);
    grad.addColorStop(0, '#b91c1c');
    grad.addColorStop(1, '#7f1d1d');
    ctx.fillStyle = grad;
    ctx.beginPath();
    ctx.roundRect(MAG_CX - MAG_W / 2, MAG_Y, MAG_W / 2, MAG_H, [6, 0, 0, 6]);
    ctx.fill();
    ctx.fillStyle = '#fca5a5';
    ctx.font = 'bold 14px DM Sans,sans-serif';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillText('N', MAG_CX - MAG_W / 4, MAG_Y + MAG_H / 2);

    var grad2 = ctx.createLinearGradient(MAG_CX, 0, MAG_CX + MAG_W / 2, 0);
    grad2.addColorStop(0, '#1e3a5f');
    grad2.addColorStop(1, '#2563eb');
    ctx.fillStyle = grad2;
    ctx.beginPath();
    ctx.roundRect(MAG_CX, MAG_Y, MAG_W / 2, MAG_H, [0, 6, 6, 0]);
    ctx.fill();
    ctx.fillStyle = '#93c5fd';
    ctx.fillText('S', MAG_CX + MAG_W / 4, MAG_Y + MAG_H / 2);
    ctx.textBaseline = 'alphabetic';
  }

  function drawFluxSymbols() {
    ctx.fillStyle = 'rgba(239,68,68,0.55)';
    ctx.font = '13px DM Sans,sans-serif';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    var cols = [155, 210, 265, 315];
    var rows = [135, 170, 205];
    cols.forEach(function (x) {
      rows.forEach(function (y) { ctx.fillText('\u00d7', x, y); });
    });
    ctx.fillStyle = 'rgba(239,68,68,0.75)';
    ctx.font = '9px DM Sans,sans-serif';
    ctx.textAlign = 'left';
    ctx.textBaseline = 'alphabetic';
    ctx.fillText('B (into page)', PX + PW + 8, PY + 28);
  }

  function drawMetalPlate() {
    var mg = ctx.createLinearGradient(PX, PY, PX + PW, PY + PH);
    mg.addColorStop(0,   '#374151');
    mg.addColorStop(0.4, '#4b5563');
    mg.addColorStop(1,   '#374151');
    ctx.fillStyle = mg;
    ctx.strokeStyle = '#6b7280';
    ctx.lineWidth = 1.8;
    ctx.beginPath();
    ctx.roundRect(PX, PY, PW, PH, PR);
    ctx.fill();
    ctx.stroke();
    ctx.fillStyle = '#9ca3af';
    ctx.font = '10px DM Sans,sans-serif';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'alphabetic';
    ctx.fillText('Metal Conductor Plate', W / 2, PY + PH + 14);
  }

  function drawEddyCurrents(phase) {
    eddies.forEach(function (e, idx) {
      var pulse = 0.5 + 0.5 * Math.sin(phase * 1.4 + idx * 1.1);
      ctx.strokeStyle = 'rgba(16,185,129,' + (0.5 + 0.5 * pulse).toFixed(2) + ')';
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.ellipse(e.cx, e.cy, e.rx, e.ry, 0, 0, Math.PI * 2);
      ctx.stroke();

      var arrowAngle = phase * e.dir * 1.6 + idx * 0.8;
      var ax = e.cx + e.rx * Math.cos(arrowAngle);
      var ay = e.cy + e.ry * Math.sin(arrowAngle);
      var tx = -e.rx * Math.sin(arrowAngle) * e.dir;
      var ty =  e.ry * Math.cos(arrowAngle) * e.dir;
      var tlen = Math.sqrt(tx * tx + ty * ty);
      if (tlen > 0) { tx /= tlen; ty /= tlen; }

      ctx.fillStyle = 'rgba(52,211,153,' + (0.7 + 0.3 * pulse).toFixed(2) + ')';
      ctx.save();
      ctx.translate(ax, ay);
      ctx.rotate(Math.atan2(ty, tx));
      ctx.beginPath();
      ctx.moveTo(7, 0);
      ctx.lineTo(-4, -4);
      ctx.lineTo(-4, 4);
      ctx.closePath();
      ctx.fill();
      ctx.restore();

      ctx.fillStyle = 'rgba(110,231,183,0.85)';
      ctx.font = '9px DM Sans,sans-serif';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      ctx.fillText('eddy', e.cx, e.cy + 2);
    });
  }

  function drawCounterField(phase) {
    var pulse = 0.4 + 0.6 * Math.abs(Math.sin(phase));
    ctx.fillStyle = 'rgba(99,102,241,' + pulse.toFixed(2) + ')';
    ctx.beginPath();
    ctx.arc(W / 2, PY - 8, 4, 0, Math.PI * 2);
    ctx.fill();
    ctx.fillStyle = 'rgba(99,102,241,0.70)';
    ctx.font = '8px DM Sans,sans-serif';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'alphabetic';
    ctx.fillText('Counter-field (Lenz)', W / 2, PY - 15);
  }

  function frame() {
    RAF = requestAnimationFrame(frame);
    ctx.clearRect(0, 0, W, H);
    var bg = ctx.createLinearGradient(0, 0, 0, H);
    bg.addColorStop(0, '#0d1117');
    bg.addColorStop(1, '#111827');
    ctx.fillStyle = bg;
    ctx.fillRect(0, 0, W, H);
    drawMagnet();
    drawMetalPlate();
    drawFluxSymbols();
    drawEddyCurrents(t);
    drawCounterField(t);

    ctx.fillStyle = 'rgba(110,231,183,0.65)';
    ctx.font = 'italic 10px DM Sans,sans-serif';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'alphabetic';
    ctx.fillText("Eddy currents oppose change in flux \u2014 Lenz's Law", W / 2, H - 8);

    ctx.fillStyle = '#059669';
    ctx.font = 'bold 11px DM Sans,sans-serif';
    ctx.textAlign = 'left';
    ctx.fillText('Eddy Currents in Metal Conductor', 12, 20);

    t += 1 / 60;
  }

  var io = new IntersectionObserver(function (entries) {
    if (entries[0].isIntersecting) { if (!RAF) frame(); }
    else { cancelAnimationFrame(RAF); RAF = null; }
  }, { threshold: 0.05 });
  io.observe(cv);
});


/* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
   Fig 7.2 ‚Äî Phasor Diagram for Series LCR  (520 √ó 380, dark bg)
   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
register3D(function () {
  var wrap = injectView3D('Fig 7.2', 380);
  if (!wrap) return;
  wrap.style.background = '#0d1117';
  var cv = make2DCanvas(wrap, 520, 380);
  var ctx = cv.getContext('2d');
  var W = cv.width, H = cv.height;
  var t = 0;
  var RAF;

  var OX = 175, OY = 195;
  var I_AMP  = 90;
  var VR_AMP = 90;
  var VL_AMP = 110;
  var VC_AMP = 65;
  var V_AMP  = Math.sqrt(VR_AMP * VR_AMP + (VL_AMP - VC_AMP) * (VL_AMP - VC_AMP));
  var PHI    = Math.atan2(VL_AMP - VC_AMP, VR_AMP);

  var PROJ_X = 330, PROJ_W = 155, PROJ_AMP = 42;

  function arrowLine(x1, y1, x2, y2, color, lw) {
    ctx.strokeStyle = color;
    ctx.lineWidth = lw || 2.5;
    ctx.beginPath();
    ctx.moveTo(x1, y1);
    ctx.lineTo(x2, y2);
    ctx.stroke();
    var angle = Math.atan2(y2 - y1, x2 - x1);
    ctx.fillStyle = color;
    ctx.beginPath();
    ctx.moveTo(x2, y2);
    ctx.lineTo(x2 - 10 * Math.cos(angle - 0.35), y2 - 10 * Math.sin(angle - 0.35));
    ctx.lineTo(x2 - 10 * Math.cos(angle + 0.35), y2 - 10 * Math.sin(angle + 0.35));
    ctx.closePath();
    ctx.fill();
  }

  function lbl(txt, x, y, color, size) {
    ctx.fillStyle = color;
    ctx.font = (size || 12) + 'px DM Sans,sans-serif';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillText(txt, x, y);
  }

  function drawPhasors(phase) {
    var iAngle = phase;

    /* I reference */
    arrowLine(OX, OY,
      OX + I_AMP * Math.cos(iAngle), OY - I_AMP * Math.sin(iAngle),
      'rgba(156,163,175,0.70)', 1.8);
    lbl('I',
      OX + (I_AMP + 14) * Math.cos(iAngle),
      OY - (I_AMP + 14) * Math.sin(iAngle),
      '#9ca3af', 10);

    /* V_R ‚Äî in phase with I */
    arrowLine(OX, OY,
      OX + VR_AMP * Math.cos(iAngle), OY - VR_AMP * Math.sin(iAngle),
      '#3b82f6', 2.8);
    lbl('V\u1D32',
      OX + (VR_AMP + 14) * Math.cos(iAngle),
      OY - (VR_AMP + 14) * Math.sin(iAngle),
      '#3b82f6', 11);

    /* V_L ‚Äî 90 deg ahead */
    var vlA = iAngle + Math.PI / 2;
    arrowLine(OX, OY,
      OX + VL_AMP * Math.cos(vlA), OY - VL_AMP * Math.sin(vlA),
      '#ef4444', 2.8);
    lbl('V\u029F',
      OX + (VL_AMP + 13) * Math.cos(vlA),
      OY - (VL_AMP + 13) * Math.sin(vlA),
      '#ef4444', 11);

    /* V_C ‚Äî 90 deg behind */
    var vcA = iAngle - Math.PI / 2;
    arrowLine(OX, OY,
      OX + VC_AMP * Math.cos(vcA), OY - VC_AMP * Math.sin(vcA),
      '#22c55e', 2.8);
    lbl('V\u1D9C',
      OX + (VC_AMP + 13) * Math.cos(vcA),
      OY - (VC_AMP + 13) * Math.sin(vcA),
      '#22c55e', 11);

    /* V resultant */
    var vA = iAngle + PHI;
    arrowLine(OX, OY,
      OX + V_AMP * Math.cos(vA), OY - V_AMP * Math.sin(vA),
      '#facc15', 3.2);
    lbl('V',
      OX + (V_AMP + 14) * Math.cos(vA),
      OY - (V_AMP + 14) * Math.sin(vA),
      '#facc15', 13);

    /* phase angle arc */
    ctx.strokeStyle = 'rgba(250,204,21,0.55)';
    ctx.lineWidth = 1.5;
    ctx.beginPath();
    ctx.arc(OX, OY, 28, -iAngle, -(iAngle + PHI), PHI < 0);
    ctx.stroke();
    var midA = iAngle + PHI / 2;
    lbl('\u03c6', OX + 42 * Math.cos(midA), OY - 42 * Math.sin(midA), '#facc15', 11);

    return iAngle;
  }

  function drawProjections(iAngle) {
    ctx.fillStyle = 'rgba(0,0,0,0.30)';
    ctx.beginPath();
    ctx.roundRect(PROJ_X - 4, OY - PROJ_AMP - 25, PROJ_W + 18, PROJ_AMP * 2 + 50, 5);
    ctx.fill();

    ctx.strokeStyle = 'rgba(255,255,255,0.15)';
    ctx.lineWidth = 1;
    ctx.beginPath();
    ctx.moveTo(PROJ_X, OY - PROJ_AMP - 16);
    ctx.lineTo(PROJ_X, OY + PROJ_AMP + 16);
    ctx.stroke();
    ctx.beginPath();
    ctx.moveTo(PROJ_X - 2, OY);
    ctx.lineTo(PROJ_X + PROJ_W + 6, OY);
    ctx.stroke();

    var scale = PROJ_AMP / V_AMP;
    var pairs = [
      { amp: VR_AMP, phase: 0,             color: '#3b82f6' },
      { amp: VL_AMP, phase: Math.PI / 2,   color: '#ef4444' },
      { amp: VC_AMP, phase: -Math.PI / 2,  color: '#22c55e' },
      { amp: V_AMP,  phase: PHI,           color: '#facc15' },
    ];
    pairs.forEach(function (p) {
      ctx.strokeStyle = p.color;
      ctx.lineWidth = 1.6;
      ctx.setLineDash([2, 2]);
      ctx.beginPath();
      for (var i = 0; i <= 80; i++) {
        var frac = i / 80;
        var px2 = PROJ_X + frac * PROJ_W;
        var py2 = OY - p.amp * scale * Math.sin(frac * Math.PI * 2 - iAngle + p.phase);
        if (i === 0) ctx.moveTo(px2, py2); else ctx.lineTo(px2, py2);
      }
      ctx.stroke();
      ctx.setLineDash([]);
    });

    ctx.fillStyle = 'rgba(255,255,255,0.4)';
    ctx.font = '9px DM Sans,sans-serif';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'alphabetic';
    ctx.fillText('Projections (time domain)', PROJ_X + PROJ_W / 2, OY + PROJ_AMP + 24);
  }

  function frame() {
    RAF = requestAnimationFrame(frame);
    ctx.clearRect(0, 0, W, H);
    var bg = ctx.createLinearGradient(0, 0, 0, H);
    bg.addColorStop(0, '#0d1117');
    bg.addColorStop(1, '#111827');
    ctx.fillStyle = bg;
    ctx.fillRect(0, 0, W, H);

    ctx.strokeStyle = 'rgba(255,255,255,0.12)';
    ctx.lineWidth = 1;
    ctx.setLineDash([4, 4]);
    ctx.beginPath();
    ctx.moveTo(OX - 140, OY); ctx.lineTo(OX + 140, OY);
    ctx.moveTo(OX, OY - 140); ctx.lineTo(OX, OY + 140);
    ctx.stroke();
    ctx.setLineDash([]);

    ctx.fillStyle = '#94a3b8';
    ctx.beginPath();
    ctx.arc(OX, OY, 3, 0, Math.PI * 2);
    ctx.fill();

    var iAngle = drawPhasors(t * 0.55);
    drawProjections(iAngle);

    ctx.fillStyle = '#94a3b8';
    ctx.font = '10px DM Sans,sans-serif';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'alphabetic';
    ctx.fillText('tan \u03c6 = (X\u029F \u2212 X\u1D9C) / R     |     Z = \u221a[R\u00b2 + (X\u029F \u2212 X\u1D9C)\u00b2]', W / 2, H - 10);

    ctx.fillStyle = '#0891b2';
    ctx.font = 'bold 11px DM Sans,sans-serif';
    ctx.textAlign = 'left';
    ctx.fillText('Phasor Diagram \u2014 Series LCR', 12, 20);

    t += 1 / 60;
  }

  var io = new IntersectionObserver(function (entries) {
    if (entries[0].isIntersecting) { if (!RAF) frame(); }
    else { cancelAnimationFrame(RAF); RAF = null; }
  }, { threshold: 0.05 });
  io.observe(cv);
});


/* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
   Fig 7.4 ‚Äî Power Factor: phase angle between V and I (520 √ó 300)
   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
register3D(function () {
  var wrap = injectView3D('Fig 7.4', 300);
  if (!wrap) return;
  wrap.style.background = '#f8fafc';
  var cv = make2DCanvas(wrap, 520, 300);
  var ctx = cv.getContext('2d');
  var W = cv.width, H = cv.height;
  var t = 0;
  var RAF;

  var WAVE_X0 = 42, WAVE_W = 420;
  var CY = 130;
  var V_AMP = 68;
  var I_AMP = 44;
  var PHI = Math.PI / 4;
  var OMEGA = 1.8;

  function drawGrid() {
    ctx.strokeStyle = 'rgba(0,0,0,0.06)';
    ctx.lineWidth = 1;
    for (var x = WAVE_X0; x <= WAVE_X0 + WAVE_W; x += 60) {
      ctx.beginPath();
      ctx.moveTo(x, 20); ctx.lineTo(x, H - 55);
      ctx.stroke();
    }
    [CY - V_AMP, CY, CY + V_AMP].forEach(function (y) {
      ctx.beginPath();
      ctx.moveTo(WAVE_X0, y); ctx.lineTo(WAVE_X0 + WAVE_W, y);
      ctx.stroke();
    });
  }

  function drawAxes() {
    ctx.strokeStyle = '#94a3b8';
    ctx.lineWidth = 1.2;
    ctx.beginPath();
    ctx.moveTo(WAVE_X0 - 5, CY); ctx.lineTo(WAVE_X0 + WAVE_W + 5, CY);
    ctx.stroke();
    ctx.beginPath();
    ctx.moveTo(WAVE_X0, 20); ctx.lineTo(WAVE_X0, H - 55);
    ctx.stroke();
  }

  function drawWave(phase, amp, color, dashArr) {
    ctx.strokeStyle = color;
    ctx.lineWidth = 2.4;
    ctx.setLineDash(dashArr || []);
    ctx.beginPath();
    for (var i = 0; i <= 200; i++) {
      var frac = i / 200;
      var px = WAVE_X0 + frac * WAVE_W;
      var py = CY - amp * Math.sin(frac * Math.PI * 4 - phase);
      if (i === 0) ctx.moveTo(px, py); else ctx.lineTo(px, py);
    }
    ctx.stroke();
    ctx.setLineDash([]);
  }

  function drawShading(phaseV) {
    ctx.beginPath();
    for (var i = 0; i <= 200; i++) {
      var frac = i / 200;
      var px = WAVE_X0 + frac * WAVE_W;
      var pv = CY - V_AMP * Math.sin(frac * Math.PI * 4 - phaseV);
      if (i === 0) ctx.moveTo(px, pv); else ctx.lineTo(px, pv);
    }
    for (var i = 200; i >= 0; i--) {
      var frac = i / 200;
      var px = WAVE_X0 + frac * WAVE_W;
      var pi2 = CY - I_AMP * Math.sin(frac * Math.PI * 4 - phaseV + PHI);
      ctx.lineTo(px, pi2);
    }
    ctx.closePath();
    ctx.fillStyle = 'rgba(139,92,246,0.09)';
    ctx.fill();
  }

  function drawPhaseMark(phaseV) {
    var freq = 4;
    var fracV = (phaseV + Math.PI / 2) / (Math.PI * freq);
    var fracI = (phaseV - PHI + Math.PI / 2) / (Math.PI * freq);
    fracV = ((fracV % 1) + 1) % 1;
    fracI = ((fracI % 1) + 1) % 1;
    if (fracV < 0.05) fracV += 0.5;
    if (fracI < 0.05) fracI += 0.5;

    var xV = Math.max(WAVE_X0 + 20, Math.min(WAVE_X0 + WAVE_W - 20, WAVE_X0 + fracV * WAVE_W));
    var xI = Math.max(WAVE_X0 + 20, Math.min(WAVE_X0 + WAVE_W - 20, WAVE_X0 + fracI * WAVE_W));
    var yV = CY - V_AMP;
    var yI = CY - I_AMP;

    ctx.strokeStyle = '#3b82f6';
    ctx.lineWidth = 1.2;
    ctx.setLineDash([4, 3]);
    ctx.beginPath();
    ctx.moveTo(xV, yV); ctx.lineTo(xV, CY + 20);
    ctx.stroke();
    ctx.strokeStyle = '#ef4444';
    ctx.beginPath();
    ctx.moveTo(xI, yI); ctx.lineTo(xI, CY + 20);
    ctx.stroke();
    ctx.setLineDash([]);

    if (Math.abs(xV - xI) > 4) {
      var leftX = Math.min(xV, xI), rightX = Math.max(xV, xI);
      var arrowY = CY + 22;
      ctx.strokeStyle = '#d97706';
      ctx.lineWidth = 1.4;
      ctx.beginPath();
      ctx.moveTo(leftX, arrowY); ctx.lineTo(rightX, arrowY);
      ctx.stroke();
      ctx.fillStyle = '#d97706';
      ctx.beginPath();
      ctx.moveTo(leftX, arrowY);
      ctx.lineTo(leftX + 7, arrowY - 3);
      ctx.lineTo(leftX + 7, arrowY + 3);
      ctx.closePath();
      ctx.fill();
      ctx.beginPath();
      ctx.moveTo(rightX, arrowY);
      ctx.lineTo(rightX - 7, arrowY - 3);
      ctx.lineTo(rightX - 7, arrowY + 3);
      ctx.closePath();
      ctx.fill();
      ctx.fillStyle = '#d97706';
      ctx.font = 'bold 12px DM Sans,sans-serif';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'alphabetic';
      ctx.fillText('\u03c6', (leftX + rightX) / 2, arrowY - 4);
    }
  }

  function drawLegend() {
    ctx.strokeStyle = '#3b82f6';
    ctx.lineWidth = 2.5;
    ctx.beginPath();
    ctx.moveTo(WAVE_X0, H - 42); ctx.lineTo(WAVE_X0 + 28, H - 42);
    ctx.stroke();
    ctx.fillStyle = '#3b82f6';
    ctx.font = 'bold 11px DM Sans,sans-serif';
    ctx.textAlign = 'left';
    ctx.textBaseline = 'middle';
    ctx.fillText('V (voltage)', WAVE_X0 + 32, H - 42);

    ctx.strokeStyle = '#ef4444';
    ctx.lineWidth = 2.5;
    ctx.setLineDash([6, 4]);
    ctx.beginPath();
    ctx.moveTo(WAVE_X0 + 130, H - 42); ctx.lineTo(WAVE_X0 + 158, H - 42);
    ctx.stroke();
    ctx.setLineDash([]);
    ctx.fillStyle = '#ef4444';
    ctx.fillText('I  (current, lags V)', WAVE_X0 + 162, H - 42);

    ctx.fillStyle = '#334155';
    ctx.font = 'bold 11px DM Sans,sans-serif';
    ctx.textAlign = 'right';
    ctx.fillText('P = VI cos(\u03c6)   |   Power factor = cos(\u03c6)', W - 10, H - 42);

    ctx.fillStyle = '#64748b';
    ctx.font = '9px DM Sans,sans-serif';
    ctx.textAlign = 'right';
    ctx.textBaseline = 'alphabetic';
    ctx.fillText('Inductive circuit: I lags V by \u03c6 = 45\u00b0', W - 10, H - 26);

    ctx.fillStyle = '#0891b2';
    ctx.font = 'bold 11px DM Sans,sans-serif';
    ctx.textAlign = 'left';
    ctx.fillText('Power Factor \u2014 Phase Angle Between V and I', 12, 18);
  }

  function frame() {
    RAF = requestAnimationFrame(frame);
    ctx.clearRect(0, 0, W, H);
    ctx.fillStyle = '#f8fafc';
    ctx.fillRect(0, 0, W, H);

    var phaseV = t * OMEGA;
    drawGrid();
    drawAxes();
    drawShading(phaseV);
    drawWave(phaseV, V_AMP, '#3b82f6');
    drawWave(phaseV - PHI, I_AMP, '#ef4444', [6, 4]);
    drawPhaseMark(phaseV);
    drawLegend();

    t += 1 / 60;
  }

  var io = new IntersectionObserver(function (entries) {
    if (entries[0].isIntersecting) { if (!RAF) frame(); }
    else { cancelAnimationFrame(RAF); RAF = null; }
  }, { threshold: 0.05 });
  io.observe(cv);
});
</script>

<!-- ‚îÄ‚îÄ GROUP D: Ch9 (9.1‚Äì9.7) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<script>
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   GROUP D ‚Äî Ch9 Ray Optics  (9.1 ¬∑ 9.2 ¬∑ 9.3 ¬∑ 9.4 ¬∑ 9.7)
   Canvas 2D animations via register3D / injectView3D / make2DCanvas
   White backgrounds throughout
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

/* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
   Fig 9.1 ‚Äî Concave mirror: image formation  (540 √ó 320, white bg)
   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
register3D(function () {
  var wrap = injectView3D('Fig 9.1', 320);
  if (!wrap) return;
  wrap.style.background = '#ffffff';
  var cv = make2DCanvas(wrap, 540, 320);
  var ctx = cv.getContext('2d');
  var W = cv.width, H = cv.height;

  /* ‚îÄ‚îÄ layout constants ‚îÄ‚îÄ */
  var AX_Y  = H / 2;          // principal axis y
  var MX    = W - 60;         // mirror x (right side)
  var R     = 110;            // radius of curvature
  var FC    = MX - R / 2;     // focus x
  var CC    = MX - R;         // centre of curvature x
  var RAF;

  var t = 0;

  function arrowV(x, y1, y2, col) {
    ctx.strokeStyle = col; ctx.lineWidth = 2;
    ctx.beginPath(); ctx.moveTo(x, y1); ctx.lineTo(x, y2); ctx.stroke();
    var dir = y2 < y1 ? -1 : 1;
    ctx.fillStyle = col;
    ctx.beginPath();
    ctx.moveTo(x, y2);
    ctx.lineTo(x - 5, y2 - dir * 10);
    ctx.lineTo(x + 5, y2 - dir * 10);
    ctx.closePath(); ctx.fill();
  }

  function dot(x, y, r, col) {
    ctx.beginPath(); ctx.arc(x, y, r, 0, 2 * Math.PI);
    ctx.fillStyle = col; ctx.fill();
  }

  function label(txt, x, y, col, align, base) {
    ctx.fillStyle = col || '#1c1917';
    ctx.font = '11px DM Sans, sans-serif';
    ctx.textAlign = align || 'center';
    ctx.textBaseline = base || 'middle';
    ctx.fillText(txt, x, y);
  }

  function drawMirror() {
    ctx.save();
    ctx.strokeStyle = '#334155'; ctx.lineWidth = 3;
    ctx.beginPath();
    ctx.arc(MX + R, AX_Y, R, Math.PI * 0.75, Math.PI * 1.25);
    ctx.stroke();
    ctx.restore();
    ctx.save();
    ctx.strokeStyle = '#cbd5e1'; ctx.lineWidth = 1;
    for (var i = -3; i <= 3; i++) {
      var yi = AX_Y + i * 16;
      var dx = Math.sqrt(Math.max(0, R * R - Math.pow(yi - AX_Y, 2)));
      var mx0 = MX + R - dx;
      ctx.beginPath(); ctx.moveTo(mx0, yi); ctx.lineTo(mx0 + 10, yi - 10); ctx.stroke();
    }
    ctx.restore();
  }

  function drawAxis() {
    ctx.strokeStyle = '#94a3b8'; ctx.lineWidth = 1;
    ctx.setLineDash([6, 4]);
    ctx.beginPath(); ctx.moveTo(20, AX_Y); ctx.lineTo(MX + 20, AX_Y); ctx.stroke();
    ctx.setLineDash([]);
  }

  function markPoint(x, lbl, above) {
    dot(x, AX_Y, 3, '#334155');
    label(lbl, x, above ? AX_Y - 14 : AX_Y + 14, '#334155');
  }

  function mirrorImage(u) {
    var f = R / 2;
    if (Math.abs(u - f) < 2) u = f + 2;
    return (f * u) / (u - f);
  }

  function segRay(x1, y1, x2, y2, col) {
    ctx.strokeStyle = col; ctx.lineWidth = 1.5;
    ctx.beginPath(); ctx.moveTo(x1, y1); ctx.lineTo(x2, y2); ctx.stroke();
    var ang = Math.atan2(y2 - y1, x2 - x1);
    var mx = x1 * 0.45 + x2 * 0.55, my = y1 * 0.45 + y2 * 0.55;
    ctx.fillStyle = col;
    ctx.beginPath();
    ctx.moveTo(mx + 7 * Math.cos(ang), my + 7 * Math.sin(ang));
    ctx.lineTo(mx + 7 * Math.cos(ang) - 9 * Math.cos(ang - 0.4), my + 7 * Math.sin(ang) - 9 * Math.sin(ang - 0.4));
    ctx.lineTo(mx + 7 * Math.cos(ang) - 9 * Math.cos(ang + 0.4), my + 7 * Math.sin(ang) - 9 * Math.sin(ang + 0.4));
    ctx.closePath(); ctx.fill();
  }

  function movingDot2Seg(phase, p0x, p0y, p1x, p1y, p2x, p2y, col) {
    var len1 = Math.hypot(p1x - p0x, p1y - p0y);
    var len2 = Math.hypot(p2x - p1x, p2y - p1y);
    var total = len1 + len2;
    var frac1 = len1 / total;
    var p = ((phase) % 1 + 1) % 1;
    var x, y;
    if (p < frac1) {
      var s = p / frac1;
      x = p0x + (p1x - p0x) * s; y = p0y + (p1y - p0y) * s;
    } else {
      var s2 = (p - frac1) / (1 - frac1);
      x = p1x + (p2x - p1x) * s2; y = p1y + (p2y - p1y) * s2;
    }
    dot(x, y, 4, col);
    var g = ctx.createRadialGradient(x, y, 0, x, y, 10);
    g.addColorStop(0, 'rgba(253,224,71,0.6)');
    g.addColorStop(1, 'rgba(253,224,71,0)');
    ctx.beginPath(); ctx.arc(x, y, 10, 0, 2 * Math.PI);
    ctx.fillStyle = g; ctx.fill();
  }

  function frame(ts) {
    ctx.clearRect(0, 0, W, H);
    ctx.fillStyle = '#ffffff'; ctx.fillRect(0, 0, W, H);

    t = ts / 1000;
    var u = R * (1.2 + 0.75 * (0.5 + 0.5 * Math.sin(t * 0.4)));
    var v = mirrorImage(u);
    var objX = MX - u;
    var pX = MX, pY = AX_Y;
    var objH = 55;
    var tipX = objX, tipY = AX_Y - objH;
    var imgV = Math.max(v, 1);
    var imgX = MX - imgV;
    var imgH = objH * (imgV / u);
    var imgTipX = imgX, imgTipY = AX_Y + imgH;

    /* reflection point for ray 1: where y=tipY hits arc */
    var mArcCX = MX + R;
    var dy1 = tipY - AX_Y;
    var ref1X = mArcCX - Math.sqrt(Math.max(0, R * R - dy1 * dy1));
    var ref1Y = tipY;

    /* reflection point for ray 2: line from tip toward C hits arc */
    var dx2 = CC - tipX, dy2 = AX_Y - tipY;
    var ex2 = tipX - mArcCX, ey2 = tipY - AX_Y;
    var a2 = dx2 * dx2 + dy2 * dy2;
    var b2 = 2 * (ex2 * dx2 + ey2 * dy2);
    var c2 = ex2 * ex2 + ey2 * ey2 - R * R;
    var disc2 = b2 * b2 - 4 * a2 * c2;
    var ref2X = mArcCX - R, ref2Y = AX_Y;
    if (disc2 >= 0) {
      var s2a = (-b2 - Math.sqrt(disc2)) / (2 * a2);
      var s2b = (-b2 + Math.sqrt(disc2)) / (2 * a2);
      var sU = (s2a > 0.01) ? s2a : s2b;
      if (sU > 0) { ref2X = tipX + sU * dx2; ref2Y = tipY + sU * dy2; }
    }

    drawAxis();
    drawMirror();
    markPoint(CC, 'C', false);
    markPoint(FC, 'F', false);
    markPoint(pX, 'P', false);

    var c1 = '#2563eb', c2 = '#16a34a', c3 = '#dc2626';

    segRay(tipX, tipY, ref1X, ref1Y, c1);
    segRay(ref1X, ref1Y, imgTipX, imgTipY, c1);

    segRay(tipX, tipY, ref2X, ref2Y, c2);
    segRay(ref2X, ref2Y, imgTipX, imgTipY, c2);

    segRay(tipX, tipY, pX, pY, c3);
    segRay(pX, pY, imgTipX, imgTipY, c3);

    arrowV(objX, AX_Y, tipY, '#f59e0b');
    label('Object', objX, AX_Y + 22, '#92400e');

    if (v > 0 && imgX > 20 && imgX < MX) {
      arrowV(imgTipX, AX_Y, imgTipY, '#dc2626');
      label('Image', imgTipX, AX_Y - 22, '#991b1b');
    }

    var phase = (ts / 2000) % 1;
    movingDot2Seg(phase,          tipX, tipY, ref1X, ref1Y, imgTipX, imgTipY, c1);
    movingDot2Seg((phase+0.33)%1, tipX, tipY, ref2X, ref2Y, imgTipX, imgTipY, c2);
    movingDot2Seg((phase+0.66)%1, tipX, tipY, pX,    pY,    imgTipX, imgTipY, c3);

    label('Concave Mirror ‚Äî Image Formation', W / 2, 14, '#475569', 'center', 'top');

    RAF = requestAnimationFrame(frame);
  }

  var io = new IntersectionObserver(function (entries) {
    if (entries[0].isIntersecting) { if (!RAF) RAF = requestAnimationFrame(frame); }
    else { cancelAnimationFrame(RAF); RAF = null; }
  }, { threshold: 0.05 });
  io.observe(cv);
});

/* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
   Fig 9.2 ‚Äî Convex lens: three standard rays  (540 √ó 320, white bg)
   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
register3D(function () {
  var wrap = injectView3D('Fig 9.2', 320);
  if (!wrap) return;
  wrap.style.background = '#ffffff';
  var cv = make2DCanvas(wrap, 540, 320);
  var ctx = cv.getContext('2d');
  var W = cv.width, H = cv.height;
  var AX_Y = H / 2;
  var LX = W / 2;
  var f  = 110;
  var F1X = LX - f, F2X = LX + f;
  var RAF;

  function arrowV(x, y1, y2, col) {
    ctx.strokeStyle = col; ctx.lineWidth = 2;
    ctx.beginPath(); ctx.moveTo(x, y1); ctx.lineTo(x, y2); ctx.stroke();
    var dir = y2 < y1 ? -1 : 1;
    ctx.fillStyle = col;
    ctx.beginPath();
    ctx.moveTo(x, y2);
    ctx.lineTo(x - 5, y2 - dir * 10);
    ctx.lineTo(x + 5, y2 - dir * 10);
    ctx.closePath(); ctx.fill();
  }

  function dot(x, y, r, col) {
    ctx.beginPath(); ctx.arc(x, y, r, 0, 2 * Math.PI);
    ctx.fillStyle = col; ctx.fill();
  }

  function label(txt, x, y, col, align) {
    ctx.fillStyle = col || '#1c1917';
    ctx.font = '11px DM Sans, sans-serif';
    ctx.textAlign = align || 'center';
    ctx.textBaseline = 'middle';
    ctx.fillText(txt, x, y);
  }

  function segRay(x1, y1, x2, y2, col) {
    ctx.strokeStyle = col; ctx.lineWidth = 1.5;
    ctx.beginPath(); ctx.moveTo(x1, y1); ctx.lineTo(x2, y2); ctx.stroke();
    var ang = Math.atan2(y2 - y1, x2 - x1);
    var mx = x1 * 0.45 + x2 * 0.55, my = y1 * 0.45 + y2 * 0.55;
    ctx.fillStyle = col;
    ctx.beginPath();
    ctx.moveTo(mx + 7 * Math.cos(ang), my + 7 * Math.sin(ang));
    ctx.lineTo(mx + 7 * Math.cos(ang) - 9 * Math.cos(ang - 0.4), my + 7 * Math.sin(ang) - 9 * Math.sin(ang - 0.4));
    ctx.lineTo(mx + 7 * Math.cos(ang) - 9 * Math.cos(ang + 0.4), my + 7 * Math.sin(ang) - 9 * Math.sin(ang + 0.4));
    ctx.closePath(); ctx.fill();
  }

  function movingDotPoly(phase, pts, col) {
    var segs = [], total = 0;
    for (var i = 0; i < pts.length - 1; i++) {
      var l = Math.hypot(pts[i+1].x - pts[i].x, pts[i+1].y - pts[i].y);
      segs.push(l); total += l;
    }
    var p = ((phase % 1) + 1) % 1 * total;
    var cum = 0;
    for (var j = 0; j < segs.length; j++) {
      if (p <= cum + segs[j]) {
        var s = (p - cum) / segs[j];
        var x = pts[j].x + (pts[j+1].x - pts[j].x) * s;
        var y = pts[j].y + (pts[j+1].y - pts[j].y) * s;
        dot(x, y, 4, col);
        var g = ctx.createRadialGradient(x, y, 0, x, y, 10);
        g.addColorStop(0, 'rgba(253,224,71,0.6)');
        g.addColorStop(1, 'rgba(253,224,71,0)');
        ctx.beginPath(); ctx.arc(x, y, 10, 0, 2 * Math.PI);
        ctx.fillStyle = g; ctx.fill();
        return;
      }
      cum += segs[j];
    }
  }

  function drawLens() {
    ctx.beginPath();
    ctx.moveTo(LX, AX_Y - 80);
    ctx.bezierCurveTo(LX + 30, AX_Y - 80, LX + 30, AX_Y + 80, LX, AX_Y + 80);
    ctx.bezierCurveTo(LX - 30, AX_Y + 80, LX - 30, AX_Y - 80, LX, AX_Y - 80);
    ctx.fillStyle = 'rgba(147,210,240,0.30)';
    ctx.fill();
    ctx.strokeStyle = '#0891b2'; ctx.lineWidth = 2;
    ctx.stroke();
  }

  function frame(ts) {
    ctx.clearRect(0, 0, W, H);
    ctx.fillStyle = '#ffffff'; ctx.fillRect(0, 0, W, H);

    /* principal axis */
    ctx.strokeStyle = '#94a3b8'; ctx.lineWidth = 1; ctx.setLineDash([6, 4]);
    ctx.beginPath(); ctx.moveTo(20, AX_Y); ctx.lineTo(W - 20, AX_Y); ctx.stroke();
    ctx.setLineDash([]);

    var objX = 60, objH = 65;
    var tipX = objX, tipY = AX_Y - objH;

    var u = -(LX - objX);
    var v = 1 / (1 / f + 1 / u);
    var imgX = LX + v;
    var imgH = objH * Math.abs(v / u);
    var imgTipX = imgX, imgTipY = AX_Y + imgH;

    /* Ray 1: parallel to axis, refracts through F2 */
    var r1A = {x: tipX, y: tipY};
    var r1B = {x: LX,   y: tipY};
    var r1C = {x: imgTipX, y: imgTipY};

    /* Ray 2: through optical center ‚Äî straight */
    var r2A = {x: tipX,    y: tipY};
    var r2B = {x: imgTipX, y: imgTipY};

    /* Ray 3: through F1, emerges parallel */
    var dxF = LX - tipX;
    var tL = dxF / (F1X - tipX);
    var r3Ly = tipY + tL * (AX_Y - tipY);
    var r3A = {x: tipX, y: tipY};
    var r3B = {x: LX,   y: r3Ly};
    var r3C = {x: W - 20, y: r3Ly};

    drawLens();

    dot(F1X, AX_Y, 4, '#334155'); label('F\u2081', F1X, AX_Y + 14, '#334155');
    dot(F2X, AX_Y, 4, '#334155'); label('F\u2082', F2X, AX_Y + 14, '#334155');
    dot(LX,  AX_Y, 3, '#334155'); label('O', LX,  AX_Y + 14, '#334155');

    var c1 = '#2563eb', c2 = '#16a34a', c3 = '#dc2626';

    segRay(r1A.x, r1A.y, r1B.x, r1B.y, c1);
    segRay(r1B.x, r1B.y, r1C.x, r1C.y, c1);
    segRay(r2A.x, r2A.y, r2B.x, r2B.y, c2);
    segRay(r3A.x, r3A.y, r3B.x, r3B.y, c3);
    segRay(r3B.x, r3B.y, r3C.x, r3C.y, c3);

    arrowV(objX, AX_Y, tipY, '#f59e0b');
    label('Object', objX, AX_Y + 20, '#92400e');

    if (v > 0 && imgX < W - 10) {
      arrowV(imgTipX, AX_Y, imgTipY, '#7c3aed');
      label('Image', imgTipX, AX_Y - 20, '#6d28d9');
    }

    var phase = (ts / 2200) % 1;
    movingDotPoly(phase,          [r1A, r1B, r1C], '#93c5fd');
    movingDotPoly((phase+0.33)%1, [r2A, r2B],      '#86efac');
    movingDotPoly((phase+0.66)%1, [r3A, r3B, r3C], '#fca5a5');

    label('Convex Lens \u2014 Three Standard Rays', W / 2, 14, '#475569', 'center');

    RAF = requestAnimationFrame(frame);
  }

  var io = new IntersectionObserver(function (entries) {
    if (entries[0].isIntersecting) { if (!RAF) RAF = requestAnimationFrame(frame); }
    else { cancelAnimationFrame(RAF); RAF = null; }
  }, { threshold: 0.05 });
  io.observe(cv);
});

/* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
   Fig 9.3 ‚Äî Prism refraction / dispersion  (520 √ó 340, white bg)
   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
register3D(function () {
  var wrap = injectView3D('Fig 9.3', 340);
  if (!wrap) return;
  wrap.style.background = '#ffffff';
  var cv = make2DCanvas(wrap, 520, 340);
  var ctx = cv.getContext('2d');
  var W = cv.width, H = cv.height;
  var RAF;

  var apex  = {x: 210, y: 60};
  var baseL = {x: 100, y: 280};
  var baseR = {x: 320, y: 280};

  /* entry point on left face (parametric) */
  var entryT = 0.45;
  var entX = apex.x + entryT * (baseL.x - apex.x);
  var entY = apex.y + entryT * (baseL.y - apex.y);

  /* exit point on right face */
  var exitT = 0.45;
  var exX = apex.x + exitT * (baseR.x - apex.x);
  var exY = apex.y + exitT * (baseR.y - apex.y);

  /* outward normal of right face */
  var rfDx = baseR.x - apex.x, rfDy = baseR.y - apex.y;
  var rfLen = Math.hypot(rfDx, rfDy);
  var rfNxOut = rfDy / rfLen, rfNyOut = -rfDx / rfLen;
  var baseAngle = Math.atan2(rfNyOut, rfNxOut);

  var spectrum = [
    {col: '#8b00ff', dev: 28, lbl: 'V'},
    {col: '#4b0082', dev: 24, lbl: 'I'},
    {col: '#0000ff', dev: 20, lbl: 'B'},
    {col: '#00aa00', dev: 16, lbl: 'G'},
    {col: '#cccc00', dev: 12, lbl: 'Y'},
    {col: '#ff7700', dev:  8, lbl: 'O'},
    {col: '#ff2200', dev:  4, lbl: 'R'},
  ];
  var devMid = (spectrum[0].dev + spectrum[spectrum.length-1].dev) / 2;
  var SPAN = 100;

  function drawPrism() {
    ctx.beginPath();
    ctx.moveTo(apex.x, apex.y);
    ctx.lineTo(baseL.x, baseL.y);
    ctx.lineTo(baseR.x, baseR.y);
    ctx.closePath();
    ctx.fillStyle = 'rgba(147,210,240,0.22)';
    ctx.fill();
    ctx.strokeStyle = '#334155'; ctx.lineWidth = 2;
    ctx.stroke();
  }

  function frame(ts) {
    ctx.clearRect(0, 0, W, H);
    ctx.fillStyle = '#ffffff'; ctx.fillRect(0, 0, W, H);

    var period = 2600;
    var tp = (ts % period) / period;
    var fanProg = tp < 0.65 ? tp / 0.65 : 1.0;

    drawPrism();

    /* incident ray */
    var incStartX = entX - 90, incStartY = entY - 45;
    var incAng = Math.atan2(entY - incStartY, entX - incStartX);
    ctx.strokeStyle = '#555'; ctx.lineWidth = 2.5;
    ctx.beginPath(); ctx.moveTo(incStartX, incStartY); ctx.lineTo(entX, entY); ctx.stroke();
    ctx.fillStyle = '#555';
    ctx.beginPath();
    ctx.moveTo(entX, entY);
    ctx.lineTo(entX - 10 * Math.cos(incAng - 0.35), entY - 10 * Math.sin(incAng - 0.35));
    ctx.lineTo(entX - 10 * Math.cos(incAng + 0.35), entY - 10 * Math.sin(incAng + 0.35));
    ctx.closePath(); ctx.fill();

    /* internal refracted ray */
    ctx.strokeStyle = 'rgba(100,150,255,0.55)'; ctx.lineWidth = 1.5;
    ctx.beginPath(); ctx.moveTo(entX, entY); ctx.lineTo(exX, exY); ctx.stroke();

    /* emergent spectrum */
    for (var i = 0; i < spectrum.length; i++) {
      var sp = spectrum[i];
      var devRad = sp.dev * Math.PI / 180;
      var ang = baseAngle + devRad - (devMid * Math.PI / 180);
      var endX = exX + SPAN * fanProg * Math.cos(ang);
      var endY = exY + SPAN * fanProg * Math.sin(ang);
      ctx.strokeStyle = sp.col; ctx.lineWidth = 2;
      ctx.beginPath(); ctx.moveTo(exX, exY); ctx.lineTo(endX, endY); ctx.stroke();
      if (fanProg > 0.88) {
        ctx.fillStyle = sp.col;
        ctx.font = 'bold 10px DM Sans, sans-serif';
        ctx.textAlign = 'left'; ctx.textBaseline = 'middle';
        ctx.fillText(sp.lbl, endX + 4, endY);
      }
    }

    /* dashed deviation continuation */
    ctx.strokeStyle = '#94a3b8'; ctx.lineWidth = 1; ctx.setLineDash([4, 3]);
    ctx.beginPath();
    ctx.moveTo(entX, entY);
    ctx.lineTo(entX + 160 * Math.cos(incAng), entY + 160 * Math.sin(incAng));
    ctx.stroke();
    ctx.setLineDash([]);

    /* labels */
    ctx.fillStyle = '#475569'; ctx.font = '10px DM Sans, sans-serif';
    ctx.textAlign = 'left'; ctx.textBaseline = 'middle';
    ctx.fillText('\u03b4 \u2014 angle of deviation', exX + 8, exY + 38);
    ctx.fillText('Thin prism: \u03b4 = (\u03bc\u22121)A', exX - 10, exY + 52);

    ctx.fillStyle = '#334155'; ctx.font = '11px DM Sans, sans-serif';
    ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
    ctx.fillText('A', apex.x, apex.y - 12);

    ctx.fillStyle = '#6d28d9'; ctx.font = '10px DM Sans, sans-serif';
    ctx.textAlign = 'left';
    ctx.fillText('VIBGYOR \u2014 violet bends most', 340, 20);

    /* moving dot along incident + internal ray */
    var dotPhase = ((ts / 1800) % 1 + 1) % 1;
    var totLen = Math.hypot(entX - incStartX, entY - incStartY) + Math.hypot(exX - entX, exY - entY);
    var seg1 = Math.hypot(entX - incStartX, entY - incStartY) / totLen;
    var dp = dotPhase;
    var dX, dY;
    if (dp < seg1) {
      var s = dp / seg1;
      dX = incStartX + (entX - incStartX) * s; dY = incStartY + (entY - incStartY) * s;
    } else {
      var s2 = (dp - seg1) / (1 - seg1);
      dX = entX + (exX - entX) * s2; dY = entY + (exY - entY) * s2;
    }
    ctx.beginPath(); ctx.arc(dX, dY, 4, 0, 2 * Math.PI);
    ctx.fillStyle = '#fbbf24'; ctx.fill();

    RAF = requestAnimationFrame(frame);
  }

  var io = new IntersectionObserver(function (entries) {
    if (entries[0].isIntersecting) { if (!RAF) RAF = requestAnimationFrame(frame); }
    else { cancelAnimationFrame(RAF); RAF = null; }
  }, { threshold: 0.05 });
  io.observe(cv);
});

/* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
   Fig 9.4 ‚Äî Total Internal Reflection  (520 √ó 320, white bg)
   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
register3D(function () {
  var wrap = injectView3D('Fig 9.4', 320);
  if (!wrap) return;
  wrap.style.background = '#ffffff';
  var cv = make2DCanvas(wrap, 520, 320);
  var ctx = cv.getContext('2d');
  var W = cv.width, H = cv.height;
  var RAF;
  var IFACE_Y = H / 2 + 10;
  var SRC_X = W / 2;
  var SRC_Y = IFACE_Y + 75;
  var RAY_LEN = 110;
  var CASE_DUR = 2200;

  function lbl(txt, x, y, col, align, base, size) {
    ctx.fillStyle = col || '#1c1917';
    ctx.font = (size || 11) + 'px DM Sans, sans-serif';
    ctx.textAlign = align || 'center';
    ctx.textBaseline = base || 'middle';
    ctx.fillText(txt, x, y);
  }

  function drawArrow(x1, y1, x2, y2, col, lw) {
    ctx.strokeStyle = col; ctx.lineWidth = lw || 2;
    ctx.beginPath(); ctx.moveTo(x1, y1); ctx.lineTo(x2, y2); ctx.stroke();
    var ang = Math.atan2(y2 - y1, x2 - x1);
    ctx.fillStyle = col;
    ctx.beginPath();
    ctx.moveTo(x2, y2);
    ctx.lineTo(x2 - 10 * Math.cos(ang - 0.35), y2 - 10 * Math.sin(ang - 0.35));
    ctx.lineTo(x2 - 10 * Math.cos(ang + 0.35), y2 - 10 * Math.sin(ang + 0.35));
    ctx.closePath(); ctx.fill();
  }

  function drawScene(caseIdx, prog) {
    ctx.clearRect(0, 0, W, H);
    ctx.fillStyle = '#ffffff'; ctx.fillRect(0, 0, W, H);

    /* denser medium fill */
    ctx.fillStyle = 'rgba(147,210,240,0.22)';
    ctx.fillRect(0, IFACE_Y, W, H - IFACE_Y);

    /* interface */
    ctx.strokeStyle = '#334155'; ctx.lineWidth = 1.5;
    ctx.beginPath(); ctx.moveTo(0, IFACE_Y); ctx.lineTo(W, IFACE_Y); ctx.stroke();

    /* normal */
    ctx.strokeStyle = '#94a3b8'; ctx.lineWidth = 1; ctx.setLineDash([5, 4]);
    ctx.beginPath(); ctx.moveTo(SRC_X, IFACE_Y - 65); ctx.lineTo(SRC_X, IFACE_Y + 85); ctx.stroke();
    ctx.setLineDash([]);

    lbl('Rarer medium (air) \u03bc\u2081 = 1.0', W / 2, IFACE_Y - 22, '#64748b', 'center', 'middle', 10);
    lbl('Denser medium (glass) \u03bc\u2082 = 1.5', W / 2, IFACE_Y + 14, '#0369a1', 'center', 'middle', 10);

    var incAng, refrAng, isTIR, isCritical;
    if (caseIdx === 0) {
      incAng = 28 * Math.PI / 180;
      refrAng = Math.asin(Math.min(1, 1.5 * Math.sin(incAng)));
      isTIR = false; isCritical = false;
    } else if (caseIdx === 1) {
      incAng = Math.asin(1 / 1.5);
      refrAng = Math.PI / 2;
      isTIR = false; isCritical = true;
    } else {
      incAng = 55 * Math.PI / 180;
      isTIR = true; isCritical = false;
    }

    /* incident ray: source up to interface, tilted left of normal */
    var hitX = SRC_X - Math.sin(incAng) * (SRC_Y - IFACE_Y);
    var iEx = SRC_X + (hitX - SRC_X) * prog;
    var iEy = SRC_Y + (IFACE_Y - SRC_Y) * prog;
    drawArrow(SRC_X, SRC_Y, iEx, iEy, '#f59e0b');

    if (prog >= 1) {
      if (!isTIR) {
        var rEndX, rEndY;
        if (isCritical) {
          rEndX = hitX + RAY_LEN; rEndY = IFACE_Y;
        } else {
          rEndX = hitX - Math.sin(refrAng) * RAY_LEN;
          rEndY = IFACE_Y - Math.cos(refrAng) * RAY_LEN;
        }
        drawArrow(hitX, IFACE_Y, rEndX, rEndY, '#2563eb');
      } else {
        var rflEndX = hitX + Math.sin(incAng) * RAY_LEN;
        var rflEndY = IFACE_Y + Math.cos(incAng) * RAY_LEN;
        drawArrow(hitX, IFACE_Y, rflEndX, rflEndY, '#dc2626');
      }
    }

    /* angle arc */
    ctx.strokeStyle = '#94a3b8'; ctx.lineWidth = 1;
    ctx.beginPath();
    ctx.arc(hitX, IFACE_Y, 28, -Math.PI / 2 - incAng, -Math.PI / 2);
    ctx.stroke();
    lbl('\u03b8', hitX - 20, IFACE_Y - 16, '#334155', 'center', 'middle', 11);

    var caseLabels = [
      '\u03b8 < \u03b8\u2091 : refraction (Snell\'s law)',
      '\u03b8 = \u03b8\u2091 : critical angle \u2014 ray grazes interface',
      '\u03b8 > \u03b8\u2091 : Total Internal Reflection (TIR)'
    ];
    var caseColors = ['#2563eb', '#16a34a', '#dc2626'];
    lbl(caseLabels[caseIdx], W / 2, H - 24, caseColors[caseIdx], 'center', 'middle', 11);
    lbl('sin(\u03b8\u2091) = 1/n', W - 85, 18, '#475569', 'center', 'middle', 11);
  }

  function frame(ts) {
    var cycleT = ts % (CASE_DUR * 3);
    var caseIdx = Math.floor(cycleT / CASE_DUR);
    var prog = Math.min(1, (cycleT % CASE_DUR) / (CASE_DUR * 0.4));
    drawScene(caseIdx, prog);
    RAF = requestAnimationFrame(frame);
  }

  var io = new IntersectionObserver(function (entries) {
    if (entries[0].isIntersecting) { if (!RAF) RAF = requestAnimationFrame(frame); }
    else { cancelAnimationFrame(RAF); RAF = null; }
  }, { threshold: 0.05 });
  io.observe(cv);
});

/* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
   Fig 9.7 ‚Äî Refraction at convex spherical surface  (520 √ó 300, white bg)
   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
register3D(function () {
  var wrap = injectView3D('Fig 9.7', 300);
  if (!wrap) return;
  wrap.style.background = '#ffffff';
  var cv = make2DCanvas(wrap, 520, 300);
  var ctx = cv.getContext('2d');
  var W = cv.width, H = cv.height;
  var AX_Y = H / 2;
  var PX = 260, PY = AX_Y;
  var R  = 80;
  var mu1 = 1.0, mu2 = 1.5;
  var RAF;

  function lbl(txt, x, y, col, align, base, size) {
    ctx.fillStyle = col || '#1c1917';
    ctx.font = (size || 11) + 'px DM Sans, sans-serif';
    ctx.textAlign  = align || 'center';
    ctx.textBaseline = base || 'middle';
    ctx.fillText(txt, x, y);
  }

  function dot(x, y, r, col) {
    ctx.beginPath(); ctx.arc(x, y, r, 0, 2 * Math.PI);
    ctx.fillStyle = col; ctx.fill();
  }

  function drawArrow(x1, y1, x2, y2, col, lw) {
    ctx.strokeStyle = col; ctx.lineWidth = lw || 1.8;
    ctx.beginPath(); ctx.moveTo(x1, y1); ctx.lineTo(x2, y2); ctx.stroke();
    var ang = Math.atan2(y2 - y1, x2 - x1);
    var mx = x1 * 0.5 + x2 * 0.5, my = y1 * 0.5 + y2 * 0.5;
    ctx.fillStyle = col;
    ctx.beginPath();
    ctx.moveTo(mx + 7 * Math.cos(ang), my + 7 * Math.sin(ang));
    ctx.lineTo(mx + 7 * Math.cos(ang) - 9 * Math.cos(ang - 0.4), my + 7 * Math.sin(ang) - 9 * Math.sin(ang - 0.4));
    ctx.lineTo(mx + 7 * Math.cos(ang) - 9 * Math.cos(ang + 0.4), my + 7 * Math.sin(ang) - 9 * Math.sin(ang + 0.4));
    ctx.closePath(); ctx.fill();
  }

  function arrowV(x, y1, y2, col) {
    ctx.strokeStyle = col; ctx.lineWidth = 2;
    ctx.beginPath(); ctx.moveTo(x, y1); ctx.lineTo(x, y2); ctx.stroke();
    var dir = y2 < y1 ? -1 : 1;
    ctx.fillStyle = col;
    ctx.beginPath();
    ctx.moveTo(x, y2);
    ctx.lineTo(x - 5, y2 - dir * 10);
    ctx.lineTo(x + 5, y2 - dir * 10);
    ctx.closePath(); ctx.fill();
  }

  function imagePos(u) {
    var u_s = -u;
    var rhs = (mu2 - mu1) / R + mu1 / u_s;
    if (Math.abs(rhs) < 1e-6) return null;
    return mu2 / rhs;
  }

  function frame(ts) {
    ctx.clearRect(0, 0, W, H);
    ctx.fillStyle = '#ffffff'; ctx.fillRect(0, 0, W, H);

    var t = ts / 1000;

    /* denser medium (right) */
    ctx.fillStyle = 'rgba(147,210,240,0.18)';
    ctx.fillRect(PX, 0, W - PX, H);

    /* principal axis */
    ctx.strokeStyle = '#94a3b8'; ctx.lineWidth = 1; ctx.setLineDash([5, 4]);
    ctx.beginPath(); ctx.moveTo(20, AX_Y); ctx.lineTo(W - 20, AX_Y); ctx.stroke();
    ctx.setLineDash([]);

    /* convex spherical surface (convex toward left) */
    var arcCX = PX + R;
    ctx.strokeStyle = '#334155'; ctx.lineWidth = 2.5;
    ctx.beginPath();
    ctx.arc(arcCX, AX_Y, R, Math.PI * 0.65, Math.PI * 1.35);
    ctx.stroke();

    /* oscillating object */
    var u = R * (1.5 + 1.5 * (0.5 + 0.5 * Math.sin(t * 0.45)));
    var v = imagePos(u);
    var objX = PX - u;
    var objH = 48;
    var tipX = objX, tipY = AX_Y - objH;

    var cx = PX + R;
    dot(cx, AX_Y, 3, '#334155'); lbl('C', cx, AX_Y + 14, '#334155');
    dot(PX, PY,   3, '#334155'); lbl('P', PX, PY  + 14,  '#334155');

    /* entry point on arc */
    var entY = tipY * 0.28;
    var dyArc = entY - AX_Y;
    var arcEntX = arcCX - Math.sqrt(Math.max(0, R * R - dyArc * dyArc));
    var arcEntY = entY;

    /* incident segment */
    drawArrow(tipX, tipY, arcEntX, arcEntY, '#2563eb');

    var imgX = (v !== null && v > 0) ? PX + v : null;
    var imgH = (imgX !== null) ? objH * (mu1 / mu2) * (v / u) : null;
    var imgTipX = imgX, imgTipY = AX_Y - (imgH || 0);

    /* refracted segment */
    if (imgX !== null && imgX < W - 10) {
      drawArrow(arcEntX, arcEntY, imgTipX, imgTipY, '#16a34a');
    }

    /* object arrow */
    arrowV(objX, AX_Y, tipY, '#f59e0b');
    lbl('O', objX, AX_Y + 18, '#92400e');

    if (imgX !== null && imgX < W - 10) {
      arrowV(imgTipX, AX_Y, imgTipY, '#7c3aed');
      lbl('I', imgTipX, AX_Y + 18, '#6d28d9');
    }

    lbl('\u03bc\u2081 = 1.0', PX - 75, 22, '#334155', 'center', 'middle', 11);
    lbl('\u03bc\u2082 = 1.5', PX + 75, 22, '#0369a1', 'center', 'middle', 11);
    lbl('\u03bc\u2082/v \u2212 \u03bc\u2081/u = (\u03bc\u2082\u2212\u03bc\u2081)/R', W / 2, H - 14, '#475569', 'center', 'middle', 11);

    /* animated moving dot */
    var phase = ((ts / 1800) % 1 + 1) % 1;
    var pts = [{x: tipX, y: tipY}, {x: arcEntX, y: arcEntY}];
    if (imgX !== null && imgX < W - 10) pts.push({x: imgTipX, y: imgTipY});
    var totLen = 0, segLens = [];
    for (var i = 0; i < pts.length - 1; i++) {
      var sl = Math.hypot(pts[i+1].x - pts[i].x, pts[i+1].y - pts[i].y);
      segLens.push(sl); totLen += sl;
    }
    var traveled = phase * totLen, cum = 0;
    for (var j = 0; j < segLens.length; j++) {
      if (traveled <= cum + segLens[j]) {
        var s = (traveled - cum) / segLens[j];
        var dX = pts[j].x + (pts[j+1].x - pts[j].x) * s;
        var dY = pts[j].y + (pts[j+1].y - pts[j].y) * s;
        dot(dX, dY, 4, '#fbbf24');
        var g = ctx.createRadialGradient(dX, dY, 0, dX, dY, 10);
        g.addColorStop(0, 'rgba(251,191,36,0.55)');
        g.addColorStop(1, 'rgba(251,191,36,0)');
        ctx.beginPath(); ctx.arc(dX, dY, 10, 0, 2 * Math.PI);
        ctx.fillStyle = g; ctx.fill();
        break;
      }
      cum += segLens[j];
    }

    RAF = requestAnimationFrame(frame);
  }

  var io = new IntersectionObserver(function (entries) {
    if (entries[0].isIntersecting) { if (!RAF) RAF = requestAnimationFrame(frame); }
    else { cancelAnimationFrame(RAF); RAF = null; }
  }, { threshold: 0.05 });
  io.observe(cv);
});
</script>

<!-- ‚îÄ‚îÄ GROUP E: Ch10 (10.1‚Äì10.2) + Ch11 (11.1) + Ch12 (12.1‚Äì12.2) + Ch13 (13.2) ‚îÄ‚îÄ -->
<script>
// ‚îÄ‚îÄ GROUP E: Ch10 (10.1, 10.2) + Ch11 (11.1) + Ch12 (12.1, 12.2) + Ch13 (13.2) ‚îÄ‚îÄ

// ‚îÄ‚îÄ Fig 10.1: Young's Double Slit Experiment ‚îÄ‚îÄ
register3D(function() {
  var wrap = injectView3D("Fig 10.1", 360); if (!wrap) return;
  var W=560, H=360, cv=make2DCanvas(wrap,W,H), ctx=cv.getContext('2d');
  var barrierX=180, slitY1=H/2-55, slitY2=H/2+55, screenX=W-60, sourceX=30, t=0, NUM_ARCS=12;
  function pathDiff(sy){
    var d1=Math.sqrt((screenX-barrierX)*(screenX-barrierX)+(sy-slitY1)*(sy-slitY1));
    var d2=Math.sqrt((screenX-barrierX)*(screenX-barrierX)+(sy-slitY2)*(sy-slitY2));
    return Math.abs(d1-d2);
  }
  var paused=false; var io=new IntersectionObserver(function(e){paused=!e[0].isIntersecting;}); io.observe(cv);
  function draw(){
    if(paused){requestAnimationFrame(draw);return;}
    t+=0.04; ctx.fillStyle='#0d0d18'; ctx.fillRect(0,0,W,H);
    // Source glow
    var sg=ctx.createRadialGradient(sourceX,H/2,2,sourceX,H/2,28);
    sg.addColorStop(0,'rgba(255,255,180,0.9)'); sg.addColorStop(1,'rgba(255,255,180,0)');
    ctx.fillStyle=sg; ctx.beginPath(); ctx.arc(sourceX,H/2,28,0,Math.PI*2); ctx.fill();
    ctx.fillStyle='#ffffc0'; ctx.beginPath(); ctx.arc(sourceX,H/2,5,0,Math.PI*2); ctx.fill();
    // Plane waves left of barrier
    for(var i=0;i<6;i++){
      var ph=((t*0.7)+i/6)%1, x=sourceX+ph*(barrierX-sourceX-10);
      ctx.globalAlpha=(1-ph)*0.6; ctx.strokeStyle='rgba(255,240,100,0.5)'; ctx.lineWidth=1.5;
      ctx.beginPath(); ctx.moveTo(x,10); ctx.lineTo(x,H-10); ctx.stroke();
    }
    ctx.globalAlpha=1;
    // Barrier
    ctx.fillStyle='#4a3f6b';
    ctx.fillRect(barrierX-6,0,12,slitY1-14);
    ctx.fillRect(barrierX-6,slitY1+14,12,slitY2-slitY1-28);
    ctx.fillRect(barrierX-6,slitY2+14,12,H-slitY2-14);
    ctx.fillStyle='#a78bfa'; ctx.font='bold 11px monospace'; ctx.textAlign='right';
    ctx.fillText('S\u2081',barrierX-10,slitY1+4); ctx.fillText('S\u2082',barrierX-10,slitY2+4);
    // Circular arcs from each slit
    var maxR=Math.sqrt((screenX-barrierX)*(screenX-barrierX)+H*H);
    [{y:slitY1,c:'rgba(120,200,255,'},{y:slitY2,c:'rgba(200,130,255,'}].forEach(function(s){
      ctx.save(); ctx.beginPath(); ctx.rect(barrierX+3,0,screenX-barrierX-3,H); ctx.clip();
      for(var i=0;i<NUM_ARCS;i++){
        var ph=((t+i/NUM_ARCS))%1, r=ph*maxR, a=(1-ph)*0.55;
        ctx.beginPath(); ctx.arc(barrierX+2,s.y,r,-Math.PI/2,Math.PI/2);
        ctx.strokeStyle=s.c+a+')'; ctx.lineWidth=1.4; ctx.stroke();
      }
      ctx.restore();
    });
    // Screen
    ctx.fillStyle='#2a2550'; ctx.fillRect(screenX,0,8,H);
    // Interference fringes
    var lambda=28;
    for(var py=0;py<H;py++){
      var order=pathDiff(py)/lambda, intens=Math.pow((Math.cos(Math.PI*2*order-t*0.3)+1)/2,3);
      ctx.fillStyle='rgb('+Math.round(255*intens)+','+Math.round(220*intens)+','+Math.round(255*intens)+')';
      ctx.fillRect(screenX+2,py,5,1);
    }
    ctx.fillStyle='#facc15'; ctx.font='bold 11px sans-serif'; ctx.textAlign='center';
    ctx.fillText('\u03b2 = \u03bbD/d  (fringe width)',W/2+40,H-14);
    ctx.fillStyle='#94a3b8'; ctx.font='10px sans-serif';
    ctx.fillText('Screen',screenX+4,14); ctx.fillText('Barrier',barrierX,14);
    requestAnimationFrame(draw);
  }
  draw();
});

// ‚îÄ‚îÄ Fig 10.2: Single Slit Diffraction ‚îÄ‚îÄ
register3D(function() {
  var wrap = injectView3D("Fig 10.2", 320); if (!wrap) return;
  var W=540, H=320, cv=make2DCanvas(wrap,W,H), ctx=cv.getContext('2d');
  var slitX=150, slitY=H/2, slitH=18, t=0, buildUp=0;
  var paused=false; var io=new IntersectionObserver(function(e){paused=!e[0].isIntersecting;}); io.observe(cv);
  function intensityAt(y){var beta=Math.PI*((y-slitY)/220)*12; if(Math.abs(beta)<0.001)return 1; var v=Math.sin(beta)/beta; return v*v;}
  function draw(){
    if(paused){requestAnimationFrame(draw);return;}
    t+=0.025; if(buildUp<1)buildUp=Math.min(1,buildUp+0.004);
    ctx.fillStyle='#0d0d18'; ctx.fillRect(0,0,W,H);
    ctx.fillStyle='#3d3560';
    ctx.fillRect(slitX-5,0,10,slitY-slitH); ctx.fillRect(slitX-5,slitY+slitH,10,H-slitY-slitH);
    // Huygens wavelets
    var rb=W-100, maxR=Math.sqrt((rb-slitX)*(rb-slitX)+H*H);
    ctx.save(); ctx.beginPath(); ctx.rect(slitX+3,0,rb-slitX-3,H); ctx.clip();
    for(var si=0;si<7;si++){
      var sy=slitY-slitH+(2*slitH)*si/6, sx=slitX+2;
      for(var ai=0;ai<8;ai++){
        var ph=((t*0.6)+si*0.13+ai/8)%1, r=ph*maxR, a=(1-ph)*0.35*buildUp;
        ctx.beginPath(); ctx.arc(sx,sy,r,-Math.PI*0.6,Math.PI*0.6);
        ctx.strokeStyle='rgba(140,200,255,'+a+')'; ctx.lineWidth=1; ctx.stroke();
      }
      ctx.beginPath(); ctx.arc(sx,sy,2,0,Math.PI*2); ctx.fillStyle='rgba(200,230,255,0.7)'; ctx.fill();
    }
    ctx.restore();
    // Intensity pattern
    var patX=W-95, patW=80;
    ctx.fillStyle='rgba(30,25,60,0.8)'; ctx.fillRect(patX,10,patW,H-20);
    for(var py=10;py<H-10;py++){
      var intens=intensityAt(py)*buildUp*(0.85+0.15*Math.sin(t*2+py*0.05));
      ctx.fillStyle='rgba('+Math.round(240*intens)+','+Math.round(180*intens)+','+Math.round(255*intens)+','+Math.min(1,intens+0.05)+')';
      ctx.fillRect(patX,py,patW,1);
    }
    ctx.fillStyle='#facc15'; ctx.font='9px sans-serif'; ctx.textAlign='right'; ctx.fillText('Central max',patX-4,slitY+3);
    ctx.fillStyle='#facc15'; ctx.font='bold 11px sans-serif'; ctx.textAlign='center';
    ctx.fillText('Central max width = 2\u03bbD/a',W/2,H-10);
    requestAnimationFrame(draw);
  }
  draw();
});

// ‚îÄ‚îÄ Fig 11.1: Photoelectric Effect ‚îÄ‚îÄ
register3D(function() {
  var wrap = injectView3D("Fig 11.1", 320); if (!wrap) return;
  var W=540, H=320, cv=make2DCanvas(wrap,W,H), ctx=cv.getContext('2d');
  var t=0, PHASE_DUR=180, electrons=[], photons=[], needle=0;
  var tubeX1=110, tubeX2=420, tubeY1=65, tubeY2=H-85;
  var paused=false; var io=new IntersectionObserver(function(e){paused=!e[0].isIntersecting;}); io.observe(cv);
  function draw(){
    if(paused){requestAnimationFrame(draw);return;}
    t++;
    var hiFreq=Math.floor(t/PHASE_DUR)%2===1, tP=t%PHASE_DUR;
    ctx.fillStyle='#0d0d18'; ctx.fillRect(0,0,W,H);
    // Tube
    ctx.strokeStyle='rgba(140,180,255,0.3)'; ctx.lineWidth=2; ctx.strokeRect(tubeX1,tubeY1,tubeX2-tubeX1,tubeY2-tubeY1);
    ctx.fillStyle='rgba(20,15,50,0.5)'; ctx.fillRect(tubeX1,tubeY1,tubeX2-tubeX1,tubeY2-tubeY1);
    ctx.fillStyle='#4f4f6f';
    ctx.fillRect(tubeX1+5,tubeY1+30,15,tubeY2-tubeY1-60); ctx.fillRect(tubeX2-20,tubeY1+30,15,tubeY2-tubeY1-60);
    ctx.font='bold 11px sans-serif'; ctx.textAlign='center';
    ctx.fillStyle='#818cf8'; ctx.fillText('C',tubeX1+13,tubeY1+(tubeY2-tubeY1)/2+4);
    ctx.fillStyle='#fbbf24'; ctx.fillText('A',tubeX2-13,tubeY1+(tubeY2-tubeY1)/2+4);
    // Spawn photons
    if(tP%18===0) photons.push({x:32,y:tubeY1+(tubeY2-tubeY1)*0.2+Math.random()*(tubeY2-tubeY1)*0.6,
      vx:2.5+Math.random(),col:hiFreq?'#a855f7':'#f97316',hi:hiFreq});
    photons=photons.filter(function(p){return p.x<tubeX2;});
    photons.forEach(function(p){
      ctx.strokeStyle=p.col; ctx.lineWidth=1.5;
      ctx.beginPath(); var sx=p.x; ctx.moveTo(sx,p.y);
      for(var i=0;i<6;i++){var nx=sx+8,ny=p.y+(i%2?4:-4);ctx.lineTo(nx,ny);sx=nx;}
      ctx.stroke();
      ctx.fillStyle=p.col; ctx.beginPath(); ctx.moveTo(sx+5,p.y); ctx.lineTo(sx-2,p.y-3); ctx.lineTo(sx-2,p.y+3); ctx.fill();
      p.x+=p.vx;
      if(p.x>=tubeX1+20&&p.x<tubeX1+25&&p.hi) electrons.push({x:tubeX1+22,y:(tubeY1+tubeY2)/2-25+Math.random()*50,vx:1.5+Math.random()*1.5,vy:(Math.random()-0.5)*2,life:1.0});
      if(p.x>=tubeX1+20) p.x=tubeX2+10;
    });
    electrons=electrons.filter(function(e){return e.x<tubeX2-22&&e.life>0.05;});
    electrons.forEach(function(e){
      e.x+=e.vx; e.y+=e.vy; e.life-=0.008;
      ctx.globalAlpha=Math.min(1,e.life*3);
      ctx.beginPath(); ctx.arc(e.x,e.y,3,0,Math.PI*2); ctx.fillStyle='#60a5fa'; ctx.fill();
      ctx.globalAlpha=1;
    });
    // Galvanometer
    var gX=W/2-36, gY=tubeY2+30;
    ctx.strokeStyle='#94a3b8'; ctx.lineWidth=1.5; ctx.beginPath(); ctx.arc(gX,gY,13,0,Math.PI*2); ctx.stroke();
    ctx.fillStyle='#94a3b8'; ctx.font='bold 10px sans-serif'; ctx.textAlign='center'; ctx.fillText('G',gX,gY+4);
    var tgt=hiFreq?(0.45+Math.sin(t*0.3)*0.07*(electrons.length>0?1:0)):0;
    needle+=(tgt-needle)*0.08;
    ctx.save(); ctx.translate(gX,gY); ctx.rotate(-Math.PI/2+needle*Math.PI);
    ctx.strokeStyle='#ef4444'; ctx.lineWidth=1.5; ctx.beginPath(); ctx.moveTo(0,0); ctx.lineTo(10,0); ctx.stroke(); ctx.restore();
    ctx.font='9px sans-serif'; ctx.fillStyle=hiFreq?'#4ade80':'#94a3b8'; ctx.textAlign='center'; ctx.fillText(hiFreq?'I > 0':'I = 0',gX,gY+25);
    ctx.fillStyle=hiFreq?'#c084fc':'#f97316'; ctx.font='bold 10px sans-serif'; ctx.textAlign='left';
    ctx.fillText(hiFreq?'\u03bd > \u03bd\u2080: electrons emitted':'\u03bd < \u03bd\u2080: no emission',8,H-16);
    ctx.fillStyle='#facc15'; ctx.font='bold 11px sans-serif'; ctx.textAlign='center';
    ctx.fillText('KE_max = h\u03bd \u2212 \u03c6  (\u03c6 = work function)',W/2,tubeY1-10);
    requestAnimationFrame(draw);
  }
  draw();
});

// ‚îÄ‚îÄ Fig 12.1: Bohr Model ‚Äî Energy Levels & Spectral Series (Canvas 2D) ‚îÄ‚îÄ
register3D(function() {
  var wrap = injectView3D("Fig 12.1", 420); if (!wrap) return;
  var W=600, H=420, cv=make2DCanvas(wrap,W,H), ctx=cv.getContext('2d');
  wrap.style.background='#060612';

  // Energy levels: n=1..6 (n=6 represents n=‚àû)
  var LEVELS = [
    {n:1, eV:-13.6, label:'n=1', y:0},
    {n:2, eV:-3.4,  label:'n=2', y:0},
    {n:3, eV:-1.51, label:'n=3', y:0},
    {n:4, eV:-0.85, label:'n=4', y:0},
    {n:5, eV:-0.54, label:'n=5', y:0},
    {n:6, eV:0,     label:'n=‚àû (0 eV)', y:0}
  ];
  var minEV=-14, maxEV=0.5;
  var lvLeft=140, lvRight=W-20, topY=30, botY=H-60;
  function evToY(ev){ return topY + (maxEV - ev)/(maxEV - minEV)*(botY - topY); }
  LEVELS.forEach(function(l){ l.y = evToY(l.eV); });

  // Spectral series config
  var SERIES = [
    {name:'Lyman (UV)',    to:1, col:'#a78bfa', region:'UV',      xBand:[lvLeft+10, lvLeft+75]},
    {name:'Balmer (Vis.)', to:2, col:'#f87171', region:'Visible', xBand:[lvLeft+80, lvLeft+155]},
    {name:'Paschen (IR)',  to:3, col:'#34d399', region:'IR',      xBand:[lvLeft+160,lvLeft+235]}
  ];

  // Animation state
  var transitions = [
    {from:5,to:0,ser:0},{from:4,to:0,ser:0},{from:3,to:0,ser:0}, // Lyman n=6,5,4 ‚Üí 1
    {from:5,to:1,ser:1},{from:4,to:1,ser:1},{from:3,to:1,ser:1}, // Balmer n=6,5,4 ‚Üí 2
    {from:5,to:2,ser:2},{from:4,to:2,ser:2}                      // Paschen n=6,5 ‚Üí 3
  ];
  var tIdx=0, phase='wait', phTimer=0, eY=0, eTarget=0, eCur=0;
  var photons=[];

  function startNext(){
    var tr=transitions[tIdx];
    eCur=LEVELS[tr.from].y; eTarget=LEVELS[tr.to].y;
    eY=eCur; phase='fall'; phTimer=0;
  }
  startNext();

  var paused=false;
  var io=new IntersectionObserver(function(e){paused=!e[0].isIntersecting;}); io.observe(cv);

  function draw(){
    if(paused){requestAnimationFrame(draw);return;}
    ctx.clearRect(0,0,W,H);
    ctx.fillStyle='#060612'; ctx.fillRect(0,0,W,H);

    // Title
    ctx.fillStyle='#f1f5f9'; ctx.font='bold 13px sans-serif'; ctx.textAlign='center';
    ctx.fillText('Bohr Model: Energy Levels & Spectral Series',W/2,18);

    // Formula top-right
    ctx.fillStyle='#94a3b8'; ctx.font='11px monospace'; ctx.textAlign='right';
    ctx.fillText('E‚Çô = ‚àí13.6/n¬≤ eV',W-8,18);

    // Series column headers
    SERIES.forEach(function(s,i){
      var mx=(s.xBand[0]+s.xBand[1])/2;
      ctx.fillStyle=s.col; ctx.font='bold 10px sans-serif'; ctx.textAlign='center';
      ctx.fillText(s.name, mx, topY-4);
      // Subtle column bg
      ctx.fillStyle='rgba(255,255,255,0.03)';
      ctx.fillRect(s.xBand[0],topY,s.xBand[1]-s.xBand[0],botY-topY);
    });

    // Draw energy levels
    LEVELS.forEach(function(l){
      // Dashed line across columns
      ctx.setLineDash([4,4]);
      ctx.strokeStyle='rgba(148,163,184,0.25)'; ctx.lineWidth=1;
      ctx.beginPath(); ctx.moveTo(lvLeft,l.y); ctx.lineTo(lvRight,l.y); ctx.stroke();
      ctx.setLineDash([]);
      // Solid level marker
      ctx.strokeStyle='#94a3b8'; ctx.lineWidth=1.5;
      ctx.beginPath(); ctx.moveTo(lvLeft-10,l.y); ctx.lineTo(lvLeft,l.y); ctx.stroke();
      // n label left
      ctx.fillStyle='#e2e8f0'; ctx.font='11px monospace'; ctx.textAlign='right';
      ctx.fillText(l.label, lvLeft-14, l.y+4);
      // eV label far left
      ctx.fillStyle='#64748b'; ctx.font='10px monospace'; ctx.textAlign='right';
      ctx.fillText(l.eV.toFixed(2)+' eV', lvLeft-60, l.y+4);
    });

    // Left axis
    ctx.strokeStyle='#475569'; ctx.lineWidth=1.5; ctx.setLineDash([]);
    ctx.beginPath(); ctx.moveTo(lvLeft-12,topY-10); ctx.lineTo(lvLeft-12,botY+10); ctx.stroke();
    ctx.fillStyle='#94a3b8'; ctx.font='10px sans-serif'; ctx.textAlign='center';
    ctx.save(); ctx.translate(lvLeft-55,H/2); ctx.rotate(-Math.PI/2);
    ctx.fillText('Energy (eV)',0,0); ctx.restore();

    // Draw photons (expanding arcs)
    photons.forEach(function(p,i){
      p.r += 2.5; p.alpha -= 0.018;
      if(p.alpha<=0){photons.splice(i,1);return;}
      ctx.beginPath();
      ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
      ctx.strokeStyle=p.col+''+Math.round(p.alpha*255).toString(16).padStart(2,'0');
      ctx.lineWidth=2;
      ctx.stroke();
    });

    // Transition arrows (static, for context)
    transitions.forEach(function(tr,i){
      var s=SERIES[tr.ser];
      var xc=(s.xBand[0]+s.xBand[1])/2 + (i%3-1)*8;
      var y0=LEVELS[tr.from].y, y1=LEVELS[tr.to].y;
      ctx.strokeStyle=s.col+'55'; ctx.lineWidth=1; ctx.setLineDash([2,3]);
      ctx.beginPath(); ctx.moveTo(xc,y0); ctx.lineTo(xc,y1); ctx.stroke();
      ctx.setLineDash([]);
    });

    // Animate electron transition
    phTimer++;
    var tr=transitions[tIdx];
    var s=SERIES[tr.ser];
    var ex=(s.xBand[0]+s.xBand[1])/2;

    if(phase==='wait'){
      if(phTimer>60){ phase='fall'; phTimer=0; }
    } else if(phase==='fall'){
      eY += (eTarget-eCur)*0.06;
      var done=Math.abs(eY-eTarget)<0.8;
      if(done){ eY=eTarget; phase='flash'; phTimer=0;
        photons.push({x:ex,y:eY,r:5,alpha:0.9,col:s.col}); }
    } else if(phase==='flash'){
      if(phTimer>50){
        tIdx=(tIdx+1)%transitions.length;
        startNext();
        phase='wait'; phTimer=0;
      }
    }

    // Draw electron dot
    var grad=ctx.createRadialGradient(ex,eY,0,ex,eY,9);
    grad.addColorStop(0,'#ffffff'); grad.addColorStop(0.4,s.col); grad.addColorStop(1,'transparent');
    ctx.beginPath(); ctx.arc(ex,eY,9,0,Math.PI*2);
    ctx.fillStyle=grad; ctx.fill();

    // Legend bottom
    var lx=lvLeft+10, ly=H-28;
    ctx.font='10px sans-serif'; ctx.textAlign='left';
    SERIES.forEach(function(s2){
      ctx.fillStyle=s2.col;
      ctx.fillRect(lx,ly-8,12,8); lx+=16;
      ctx.fillStyle='#94a3b8';
      ctx.fillText(s2.name+' (‚Üín='+s2.to+')',lx,ly); lx+=ctx.measureText(s2.name+' (‚Üín='+s2.to+')').width+14;
    });
    ctx.fillStyle='#64748b'; ctx.textAlign='right';
    ctx.fillText('ŒîE = hŒΩ',W-8,H-12);

    requestAnimationFrame(draw);
  }
  draw();
});

// ‚îÄ‚îÄ Fig 12.2: Rutherford Scattering ‚îÄ‚îÄ
register3D(function() {
  var wrap = injectView3D("Fig 12.2", 340); if (!wrap) return;
  var W=540, H=340, cv=make2DCanvas(wrap,W,H), ctx=cv.getContext('2d');
  var nucX=350, nucY=H/2, t=0, LOOP=300;
  var paused=false; var io=new IntersectionObserver(function(e){paused=!e[0].isIntersecting;}); io.observe(cv);
  function computePath(b,steps){
    var pts=[];
    if(Math.abs(b)<1){
      for(var i=0;i<steps;i++){var f=i/steps,x=f<0.5?-160+f*2*(nucX-50):nucX-50-(f-0.5)*2*(nucX-50+160);pts.push([x,nucY]);}
    } else {
      var sign=b>0?1:-1,ab=Math.abs(b);
      for(var i=0;i<steps;i++){
        var f=i/steps,rawX=-160+f*700,rawY=nucY+b;
        var rX=rawX-nucX,dist=Math.sqrt(rX*rX+ab*ab);
        var push=(2200/(dist*dist+20))*sign;
        pts.push([rawX+160,rawY+push*(rX<0?-1:1)]);
      }
    }
    return pts;
  }
  var PARAMS=[{b:0,col:'#f87171'},{b:28,col:'#4ade80'},{b:58,col:'#22d3ee'},{b:95,col:'#a3e635'},{b:130,col:'#6ee7b7'},{b:-58,col:'#86efac'}];
  var paths=PARAMS.map(function(p,i){return{p:p,pts:computePath(p.b,LOOP),off:(i*50)%LOOP};});
  function draw(){
    if(paused){requestAnimationFrame(draw);return;}
    t=(t+1)%LOOP; ctx.fillStyle='#0d0d18'; ctx.fillRect(0,0,W,H);
    // Nucleus
    var nG=ctx.createRadialGradient(nucX-5,nucY-5,2,nucX,nucY,22);
    nG.addColorStop(0,'#fde68a'); nG.addColorStop(0.5,'#f59e0b'); nG.addColorStop(1,'#92400e');
    ctx.beginPath(); ctx.arc(nucX,nucY,22,0,Math.PI*2); ctx.fillStyle=nG; ctx.fill();
    ctx.strokeStyle='#fbbf24'; ctx.lineWidth=1.5; ctx.stroke();
    ctx.fillStyle='#fde68a'; ctx.font='bold 10px sans-serif'; ctx.textAlign='center'; ctx.fillText('Au',nucX,nucY+4);
    // Paths + particles
    paths.forEach(function(path){
      var pts=path.pts, pos=pts[(t+path.off)%LOOP]; if(!pos)return;
      ctx.save(); ctx.beginPath(); ctx.moveTo(pts[0][0],pts[0][1]);
      for(var i=1;i<pts.length;i++) ctx.lineTo(pts[i][0],pts[i][1]);
      ctx.strokeStyle='rgba(100,200,100,0.1)'; ctx.lineWidth=1; ctx.stroke(); ctx.restore();
      ctx.fillStyle=path.p.col; ctx.beginPath(); ctx.arc(pos[0],pos[1],4.5,0,Math.PI*2); ctx.fill();
    });
    ctx.fillStyle='#4ade80'; ctx.font='bold 10px sans-serif'; ctx.textAlign='left'; ctx.fillText('\u03b1 particles \u2192',10,H/2+4);
    ctx.fillStyle='#facc15'; ctx.font='bold 9px sans-serif'; ctx.textAlign='center';
    ctx.fillText('Most pass through; few scatter; very few bounce back (small dense nucleus!)',W/2,H-10);
    requestAnimationFrame(draw);
  }
  draw();
});

// ‚îÄ‚îÄ Fig 13.2: Nuclear Fission ‚îÄ‚îÄ
register3D(function() {
  var wrap = injectView3D("Fig 13.2", 360); if (!wrap) return;
  var W=560, H=360, cv=make2DCanvas(wrap,W,H), ctx=cv.getContext('2d');
  var TOTAL=340, t=0, nucX=200, nucY=H/2;
  var paused=false; var io=new IntersectionObserver(function(e){paused=!e[0].isIntersecting;}); io.observe(cv);
  function drawNeutron(x,y,a){
    ctx.globalAlpha=Math.max(0,Math.min(1,a));
    ctx.beginPath(); ctx.arc(x,y,5,0,Math.PI*2); ctx.fillStyle='#f1f5f9'; ctx.fill();
    ctx.strokeStyle='#94a3b8'; ctx.lineWidth=1; ctx.stroke(); ctx.globalAlpha=1;
  }
  function drawNuc(cx,cy,r,c1,c2,lbl){
    var g=ctx.createRadialGradient(cx-r*.25,cy-r*.25,r*.1,cx,cy,r);
    g.addColorStop(0,c1); g.addColorStop(1,c2);
    ctx.beginPath(); ctx.arc(cx,cy,r,0,Math.PI*2); ctx.fillStyle=g; ctx.fill();
    ctx.fillStyle='#f5f0ff'; ctx.font='9px monospace'; ctx.textAlign='center'; ctx.fillText(lbl,cx,cy+4);
  }
  function draw(){
    if(paused){requestAnimationFrame(draw);return;}
    var ph=t%TOTAL; t++;
    ctx.fillStyle='#0d0d18'; ctx.fillRect(0,0,W,H);
    if(ph<60){
      var prog=ph/60, nx=30+prog*(nucX-54);
      drawNuc(nucX,nucY,32,'#c084fc','#4c1d95','\u2089\u2082U\u00b2\u00b3\u2075'); drawNeutron(nx,nucY,1);
    } else if(ph<110){
      var wt=(ph-60)/50, w=wt*14;
      var g2=ctx.createRadialGradient(nucX,nucY,2,nucX,nucY,32+w);
      g2.addColorStop(0,'#f0abfc'); g2.addColorStop(0.5,'#9333ea'); g2.addColorStop(1,'#4c1d95');
      ctx.beginPath(); ctx.arc(nucX,nucY,32+w*.5,0,Math.PI*2); ctx.fillStyle=g2; ctx.fill();
      ctx.fillStyle='#f5f0ff'; ctx.font='9px monospace'; ctx.textAlign='center'; ctx.fillText('\u2089\u2082U\u00b2\u00b3\u2076*',nucX,nucY+4);
    } else if(ph<170){
      var st=(ph-110)/60, ex=32+st*28, ey=32-st*10;
      var sg=ctx.createRadialGradient(nucX,nucY,2,nucX,nucY,ex);
      sg.addColorStop(0,'#f0abfc'); sg.addColorStop(1,'#4c1d95');
      ctx.save(); ctx.translate(nucX,nucY); ctx.scale(ex/32,ey/32); ctx.beginPath(); ctx.arc(0,0,32,0,Math.PI*2); ctx.restore();
      ctx.fillStyle=sg; ctx.fill();
      ctx.fillStyle='#f5f0ff'; ctx.font='9px sans-serif'; ctx.textAlign='center'; ctx.fillText('Deforming\u2026',nucX,nucY+ex+12);
      if(st>0.7){ctx.globalAlpha=(st-0.7)/0.3*0.8;var fg=ctx.createRadialGradient(nucX,nucY,0,nucX,nucY,50);fg.addColorStop(0,'rgba(255,220,0,0.9)');fg.addColorStop(1,'rgba(255,80,0,0)');ctx.beginPath();ctx.arc(nucX,nucY,50,0,Math.PI*2);ctx.fillStyle=fg;ctx.fill();ctx.globalAlpha=1;}
    } else if(ph<250){
      var ft=(ph-170)/80;
      drawNuc(nucX+ft*110,nucY-ft*65,18,'#86efac','#15803d','\u2076\u2086Ba\u00b9\u2074\u00b9');
      drawNuc(nucX+ft*90,nucY+ft*55,14,'#93c5fd','#1d4ed8','\u00b3\u2086Kr\u2079\u00b2');
      [-35,5,45].forEach(function(ang){var rad=ang*Math.PI/180;drawNeutron(nucX+Math.cos(rad)*ft*145,nucY+Math.sin(rad)*ft*110,ft);});
      if(ft>0.3){ctx.globalAlpha=(ft-0.3)/0.7*0.7;var fg2=ctx.createRadialGradient(nucX,nucY,0,nucX,nucY,20+ft*80);fg2.addColorStop(0,'rgba(255,220,0,0.9)');fg2.addColorStop(1,'rgba(255,80,0,0)');ctx.beginPath();ctx.arc(nucX,nucY,20+ft*80,0,Math.PI*2);ctx.fillStyle=fg2;ctx.fill();ctx.globalAlpha=1;}
    } else if(ph<320){
      var ct=(ph-250)/70;
      drawNuc(nucX+110,nucY-65,18,'#86efac','#15803d','\u2076\u2086Ba');
      drawNuc(nucX+90,nucY+55,14,'#93c5fd','#1d4ed8','\u00b3\u2086Kr');
      ctx.globalAlpha=ct;
      drawNuc(W-90,H/2-82,18,'#c084fc','#4c1d95','\u2089\u2082U');
      drawNuc(W-90,H/2+68,18,'#c084fc','#4c1d95','\u2089\u2082U');
      ctx.globalAlpha=1;
      [{sx:nucX+95,sy:nucY-20,ex:W-90-20,ey:H/2-82},{sx:nucX+88,sy:nucY+15,ex:W-90-20,ey:H/2+68}].forEach(function(c){
        drawNeutron(c.sx+ct*(c.ex-c.sx),c.sy+ct*(c.ey-c.sy),ct);
      });
    }
    ctx.fillStyle='#facc15'; ctx.font='bold 9px sans-serif'; ctx.textAlign='center';
    ctx.fillText('\u00b2\u00b3\u2075U + n \u2192 \u00b9\u2074\u00b9Ba + \u2079\u00b2Kr + 3n + \u22481 GeV/mol',W/2,H-10);
    requestAnimationFrame(draw);
  }
  draw();
});
</script>

<!-- ‚îÄ‚îÄ GROUP F: Ch14 (14.1‚Äì14.3 + 14.7 + 14.9) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<script>
/* ================================================================
   GROUP F: Ch14 Semiconductor Electronics
   Figures: 14.1, 14.2, 14.3, 14.7, 14.9
   Canvas 2D animations via register3D / injectView3D / make2DCanvas
================================================================ */

/* ----------------------------------------------------------------
   Fig 14.1 - p-n Junction Formation
   560x300, dark bg #0d0d18
---------------------------------------------------------------- */
register3D(function () {
  var wrap = injectView3D('Fig 14.1', 300);
  var cv   = make2DCanvas(wrap, 560, 300);
  var ctx  = cv.getContext('2d');
  var W = 560, H = 300;

  var jx    = W / 2;
  var depW  = 40;

  var numHoles = 14, numElectrons = 14;

  function makeParticles() {
    var holes = [], electrons = [];
    for (var i = 0; i < numHoles; i++) {
      holes.push({
        x:  20 + Math.random() * (jx - depW - 30),
        y:  40 + Math.random() * (H - 80),
        vx: 0.6 + Math.random() * 0.4,
        state: 'drift', flash: 0
      });
    }
    for (var i = 0; i < numElectrons; i++) {
      electrons.push({
        x:  jx + depW + 10 + Math.random() * (W - jx - depW - 30),
        y:  40 + Math.random() * (H - 80),
        vx: 0.6 + Math.random() * 0.4,
        state: 'drift', flash: 0
      });
    }
    return { holes: holes, electrons: electrons };
  }

  var parts = makeParticles();
  var ionPhase   = 0;
  var fieldPhase = 0;
  var tick = 0;
  var CYCLE = 300;

  function reset() {
    parts      = makeParticles();
    ionPhase   = 0;
    fieldPhase = 0;
    tick       = 0;
  }

  function drawBg() {
    ctx.fillStyle = '#0d0d18';
    ctx.fillRect(0, 0, W, H);

    ctx.fillStyle = 'rgba(220,80,120,0.10)';
    ctx.fillRect(0, 0, jx - depW, H);

    ctx.fillStyle = 'rgba(60,140,220,0.10)';
    ctx.fillRect(jx + depW, 0, W - jx - depW, H);

    ctx.fillStyle = 'rgba(10,10,30,0.55)';
    ctx.fillRect(jx - depW, 0, depW * 2, H);

    ctx.fillStyle = 'rgba(255,180,200,0.85)';
    ctx.font = 'bold 13px monospace';
    ctx.textAlign = 'center';
    ctx.fillText('p-type', jx / 2, 22);

    ctx.fillStyle = 'rgba(120,180,255,0.85)';
    ctx.fillText('n-type', (jx + W) / 2, 22);

    ctx.fillStyle = 'rgba(200,200,255,0.55)';
    ctx.font = '10px monospace';
    ctx.fillText('Depletion', jx, 18);
    ctx.fillText('Region', jx, 30);

    ctx.strokeStyle = 'rgba(255,255,255,0.18)';
    ctx.lineWidth = 1;
    ctx.setLineDash([4, 3]);
    ctx.beginPath(); ctx.moveTo(jx - depW, 0); ctx.lineTo(jx - depW, H); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(jx + depW, 0); ctx.lineTo(jx + depW, H); ctx.stroke();
    ctx.setLineDash([]);
  }

  function drawHole(x, y, a) {
    ctx.save();
    ctx.globalAlpha = a;
    ctx.beginPath();
    ctx.arc(x, y, 7, 0, Math.PI * 2);
    ctx.fillStyle = '#ff4488';
    ctx.fill();
    ctx.fillStyle = '#fff';
    ctx.font = 'bold 11px sans-serif';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillText('+', x, y + 1);
    ctx.restore();
  }

  function drawElectron(x, y, a) {
    ctx.save();
    ctx.globalAlpha = a;
    ctx.beginPath();
    ctx.arc(x, y, 7, 0, Math.PI * 2);
    ctx.fillStyle = '#3399ff';
    ctx.fill();
    ctx.fillStyle = '#fff';
    ctx.font = 'bold 12px sans-serif';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillText('\u2212', x, y);
    ctx.restore();
  }

  function drawIons() {
    if (ionPhase <= 0) return;
    var alpha = Math.min(ionPhase, 1);
    var posP = [
      {x: jx - depW + 10, y: H * 0.28},
      {x: jx - depW + 10, y: H * 0.50},
      {x: jx - depW + 10, y: H * 0.72},
      {x: jx - depW + 22, y: H * 0.39},
      {x: jx - depW + 22, y: H * 0.62}
    ];
    ctx.save();
    ctx.globalAlpha = alpha;
    posP.forEach(function(p) {
      ctx.beginPath();
      ctx.arc(p.x, p.y, 8, 0, Math.PI * 2);
      ctx.strokeStyle = '#ff4488';
      ctx.lineWidth = 1.5;
      ctx.stroke();
      ctx.fillStyle = '#ff4488';
      ctx.font = '11px sans-serif';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      ctx.fillText('\u229b', p.x, p.y + 1);
    });
    var posN = [
      {x: jx + depW - 10, y: H * 0.28},
      {x: jx + depW - 10, y: H * 0.50},
      {x: jx + depW - 10, y: H * 0.72},
      {x: jx + depW - 22, y: H * 0.39},
      {x: jx + depW - 22, y: H * 0.62}
    ];
    posN.forEach(function(p) {
      ctx.beginPath();
      ctx.arc(p.x, p.y, 8, 0, Math.PI * 2);
      ctx.strokeStyle = '#3399ff';
      ctx.lineWidth = 1.5;
      ctx.stroke();
      ctx.fillStyle = '#3399ff';
      ctx.font = '11px sans-serif';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      ctx.fillText('\u2295', p.x, p.y + 1);
    });
    ctx.restore();
  }

  function drawFieldArrow() {
    if (fieldPhase <= 0) return;
    var alpha = Math.min(fieldPhase, 1);
    var y0 = H - 36;
    var x0 = jx + 55, x1 = jx - 55;
    ctx.save();
    ctx.globalAlpha = alpha;
    ctx.strokeStyle = '#ffd700';
    ctx.fillStyle  = '#ffd700';
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.moveTo(x0, y0);
    ctx.lineTo(x1 + 10, y0);
    ctx.stroke();
    ctx.beginPath();
    ctx.moveTo(x1, y0);
    ctx.lineTo(x1 + 12, y0 - 5);
    ctx.lineTo(x1 + 12, y0 + 5);
    ctx.closePath();
    ctx.fill();
    ctx.fillStyle = '#ffd700';
    ctx.font = '11px monospace';
    ctx.textAlign = 'center';
    ctx.fillText('Built-in E-field: n\u2192p', jx, y0 - 8);
    ctx.font = '10px monospace';
    ctx.fillStyle = 'rgba(255,210,100,0.8)';
    ctx.fillText('V\u2080 (contact potential)', jx, y0 + 16);
    ctx.restore();
  }

  function frame14_1() {
    tick++;
    if (tick > CYCLE) reset();
    var progress = tick / CYCLE;
    drawBg();

    parts.holes.forEach(function(h) {
      if (h.state === 'drift') {
        h.x += h.vx;
        if (h.x >= jx - depW - 2) {
          h.state = 'recombine';
          h.flash = 18;
        }
      }
      if (h.state === 'recombine') {
        h.flash--;
        if (h.flash > 0) {
          ctx.save();
          ctx.globalAlpha = h.flash / 18;
          ctx.beginPath();
          ctx.arc(h.x, h.y, 10, 0, Math.PI * 2);
          ctx.fillStyle = '#ffffaa';
          ctx.fill();
          ctx.restore();
        } else {
          h.state = 'done';
        }
      }
      if (h.state === 'drift') drawHole(h.x, h.y, 1);
    });

    parts.electrons.forEach(function(e) {
      if (e.state === 'drift') {
        e.x -= e.vx;
        if (e.x <= jx + depW + 2) {
          e.state = 'recombine';
          e.flash = 18;
        }
      }
      if (e.state === 'recombine') {
        e.flash--;
        if (e.flash > 0) {
          ctx.save();
          ctx.globalAlpha = e.flash / 18;
          ctx.beginPath();
          ctx.arc(e.x, e.y, 10, 0, Math.PI * 2);
          ctx.fillStyle = '#aaddff';
          ctx.fill();
          ctx.restore();
        } else {
          e.state = 'done';
        }
      }
      if (e.state === 'drift') drawElectron(e.x, e.y, 1);
    });

    if (progress > 0.40) ionPhase   += 0.015;
    if (progress > 0.55) fieldPhase += 0.015;
    drawIons();
    drawFieldArrow();
    requestAnimationFrame(frame14_1);
  }
  requestAnimationFrame(frame14_1);
});

/* ----------------------------------------------------------------
   Fig 14.2 - Forward Bias
   560x300, dark bg
---------------------------------------------------------------- */
register3D(function () {
  var wrap = injectView3D('Fig 14.2', 300);
  var cv   = make2DCanvas(wrap, 560, 300);
  var ctx  = cv.getContext('2d');
  var W = 560, H = 300;
  var jx   = W / 2;
  var depW = 16;

  var NCAR = 18;
  function mkHole() {
    return {
      x:  10 + Math.random() * (jx - depW - 40),
      y:  50 + Math.random() * (H - 110),
      vx: 1.0 + Math.random() * 0.8,
      done: false
    };
  }
  function mkElec() {
    return {
      x:  jx + depW + 30 + Math.random() * (W - jx - depW - 50),
      y:  50 + Math.random() * (H - 110),
      vx: 1.0 + Math.random() * 0.8,
      done: false
    };
  }
  var holes = [], elecs = [];
  for (var i = 0; i < NCAR; i++) { holes.push(mkHole()); elecs.push(mkElec()); }
  var sparks = [];

  function drawBg14_2() {
    ctx.fillStyle = '#0d0d18';
    ctx.fillRect(0, 0, W, H);
    ctx.fillStyle = 'rgba(220,80,120,0.10)';
    ctx.fillRect(0, 0, jx - depW, H);
    ctx.fillStyle = 'rgba(60,140,220,0.10)';
    ctx.fillRect(jx + depW, 0, W - jx - depW, H);
    ctx.fillStyle = 'rgba(10,10,30,0.45)';
    ctx.fillRect(jx - depW, 0, depW * 2, H);

    ctx.fillStyle = 'rgba(255,180,200,0.75)';
    ctx.font = 'bold 13px monospace';
    ctx.textAlign = 'center';
    ctx.fillText('p', jx / 2, 22);
    ctx.fillStyle = 'rgba(120,180,255,0.75)';
    ctx.fillText('n', (jx + W) / 2, 22);

    ctx.strokeStyle = '#ff4488';
    ctx.lineWidth = 2.5;
    ctx.fillStyle = '#ff4488';
    ctx.beginPath(); ctx.moveTo(18, H - 40); ctx.lineTo(18, H - 20); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(10, H - 30); ctx.lineTo(26, H - 30); ctx.stroke();
    ctx.font = '10px monospace'; ctx.textAlign = 'center';
    ctx.fillText('+', 18, H - 46);

    ctx.strokeStyle = '#3399ff';
    ctx.fillStyle = '#3399ff';
    ctx.lineWidth = 2.5;
    ctx.beginPath(); ctx.moveTo(W - 26, H - 30); ctx.lineTo(W - 10, H - 30); ctx.stroke();
    ctx.fillText('\u2212', W - 18, H - 46);

    ctx.strokeStyle = 'rgba(255,255,255,0.25)';
    ctx.lineWidth = 1.5;
    ctx.setLineDash([5,4]);
    ctx.beginPath();
    ctx.moveTo(18, H-20); ctx.lineTo(18, H-8); ctx.lineTo(W-18, H-8); ctx.lineTo(W-18, H-20);
    ctx.stroke();
    ctx.setLineDash([]);

    ctx.fillStyle = '#aaffaa';
    ctx.font = 'bold 12px monospace';
    ctx.textAlign = 'center';
    ctx.fillText('Forward Bias:  I large,  V_D \u2248 0.7V (Si)', W / 2, H - 14);
  }

  function drawCarrier14_2(x, y, isHole) {
    ctx.save();
    ctx.beginPath();
    ctx.arc(x, y, 7, 0, Math.PI * 2);
    ctx.fillStyle = isHole ? '#ff4488' : '#3399ff';
    ctx.fill();
    ctx.fillStyle = '#fff';
    ctx.font = 'bold 12px sans-serif';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillText(isHole ? '+' : '\u2212', x, isHole ? y + 1 : y);
    ctx.restore();
  }

  function drawCurrentArrow14_2() {
    var y0 = H - 60;
    var x0 = 50, x1 = W - 50;
    ctx.save();
    ctx.strokeStyle = '#ffaa00';
    ctx.fillStyle  = '#ffaa00';
    ctx.lineWidth = 2.5;
    ctx.beginPath();
    ctx.moveTo(x0, y0); ctx.lineTo(x1 - 12, y0); ctx.stroke();
    ctx.beginPath();
    ctx.moveTo(x1, y0); ctx.lineTo(x1 - 14, y0 - 6); ctx.lineTo(x1 - 14, y0 + 6); ctx.closePath();
    ctx.fill();
    ctx.fillStyle = '#ffaa00';
    ctx.font = '11px monospace';
    ctx.textAlign = 'center';
    ctx.fillText('I (conventional \u2192)', W / 2, y0 - 8);
    ctx.restore();
  }

  function frame14_2() {
    drawBg14_2();
    holes.forEach(function(h, idx) {
      if (!h.done) {
        h.x += h.vx;
        if (h.x >= jx + depW + 5) {
          sparks.push({ x: jx, y: h.y, life: 16 });
          h.done = true;
        } else {
          drawCarrier14_2(h.x, h.y, true);
        }
      } else {
        if (Math.random() < 0.03) holes[idx] = mkHole();
      }
    });
    elecs.forEach(function(e, idx) {
      if (!e.done) {
        e.x -= e.vx;
        if (e.x <= jx - depW - 5) {
          sparks.push({ x: jx, y: e.y, life: 16 });
          e.done = true;
        } else {
          drawCarrier14_2(e.x, e.y, false);
        }
      } else {
        if (Math.random() < 0.03) elecs[idx] = mkElec();
      }
    });
    for (var i = sparks.length - 1; i >= 0; i--) {
      var s = sparks[i];
      ctx.save();
      ctx.globalAlpha = s.life / 16;
      for (var k = 0; k < 5; k++) {
        var angle = (k / 5) * Math.PI * 2;
        var r = (16 - s.life) * 2.5;
        ctx.beginPath();
        ctx.arc(s.x + Math.cos(angle) * r, s.y + Math.sin(angle) * r, 2, 0, Math.PI * 2);
        ctx.fillStyle = '#ffee44';
        ctx.fill();
      }
      ctx.restore();
      s.life--;
      if (s.life <= 0) sparks.splice(i, 1);
    }
    drawCurrentArrow14_2();
    requestAnimationFrame(frame14_2);
  }
  requestAnimationFrame(frame14_2);
});

/* ----------------------------------------------------------------
   Fig 14.3 - Reverse Bias
   560x300, dark bg
---------------------------------------------------------------- */
register3D(function () {
  var wrap = injectView3D('Fig 14.3', 300);
  var cv   = make2DCanvas(wrap, 560, 300);
  var ctx  = cv.getContext('2d');
  var W = 560, H = 300;
  var jx    = W / 2;
  var DEP_MIN = 40, DEP_MAX = 90;
  var depW  = DEP_MIN;
  var depDir = 1;

  var minority = [
    { x: jx - DEP_MIN - 10, y: H * 0.35, vx:  0.18, side: 'p' },
    { x: jx + DEP_MIN + 10, y: H * 0.62, vx: -0.18, side: 'n' }
  ];

  function drawBg14_3() {
    ctx.fillStyle = '#0d0d18';
    ctx.fillRect(0, 0, W, H);
    ctx.fillStyle = 'rgba(220,80,120,0.10)';
    ctx.fillRect(0, 0, jx - depW, H);
    ctx.fillStyle = 'rgba(60,140,220,0.10)';
    ctx.fillRect(jx + depW, 0, W - jx - depW, H);
    ctx.fillStyle = 'rgba(5,5,25,0.7)';
    ctx.fillRect(jx - depW, 0, depW * 2, H);

    ctx.fillStyle = 'rgba(255,180,200,0.75)';
    ctx.font = 'bold 13px monospace';
    ctx.textAlign = 'center';
    ctx.fillText('p', jx / 2, 22);
    ctx.fillStyle = 'rgba(120,180,255,0.75)';
    ctx.fillText('n', (jx + W) / 2, 22);

    ctx.fillStyle = 'rgba(200,200,255,0.45)';
    ctx.font = '10px monospace';
    ctx.fillText('Wide Depletion Region', jx, H / 2 - 8);

    ctx.strokeStyle = 'rgba(255,255,100,0.40)';
    ctx.lineWidth = 1;
    ctx.setLineDash([3, 3]);
    ctx.beginPath(); ctx.moveTo(jx - depW, 10); ctx.lineTo(jx - depW, H - 20); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(jx + depW, 10); ctx.lineTo(jx + depW, H - 20); ctx.stroke();
    ctx.setLineDash([]);

    ctx.fillStyle = '#aaaaff';
    ctx.font = '10px monospace'; ctx.textAlign = 'center';
    ctx.strokeStyle = '#aaaaff';
    ctx.lineWidth = 2;
    ctx.beginPath(); ctx.moveTo(22, H - 38); ctx.lineTo(34, H - 38); ctx.stroke();
    ctx.fillText('\u2212', 28, H - 46);

    ctx.strokeStyle = '#ffaaaa';
    ctx.fillStyle = '#ffaaaa';
    ctx.beginPath(); ctx.moveTo(W - 34, H - 48); ctx.lineTo(W - 22, H - 48); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(W - 28, H - 52); ctx.lineTo(W - 28, H - 44); ctx.stroke();
    ctx.fillText('+', W - 28, H - 40);

    ctx.strokeStyle = 'rgba(255,255,255,0.20)';
    ctx.lineWidth = 1.5;
    ctx.setLineDash([5,4]);
    ctx.beginPath();
    ctx.moveTo(28, H-32); ctx.lineTo(28, H-8); ctx.lineTo(W-28, H-8); ctx.lineTo(W-28, H-38);
    ctx.stroke();
    ctx.setLineDash([]);

    ctx.fillStyle = '#ffaaaa';
    ctx.font = 'bold 12px monospace';
    ctx.textAlign = 'center';
    ctx.fillText('Reverse Bias:  I \u2248 0  (leakage only)', W / 2, H - 14);
  }

  function drawEField14_3() {
    var y0 = 40;
    var x0 = jx + 70, x1 = jx - 70;
    ctx.save();
    ctx.strokeStyle = '#ff6666';
    ctx.fillStyle  = '#ff6666';
    ctx.lineWidth = 2;
    ctx.beginPath(); ctx.moveTo(x0, y0); ctx.lineTo(x1 + 12, y0); ctx.stroke();
    ctx.beginPath();
    ctx.moveTo(x1, y0); ctx.lineTo(x1 + 14, y0 - 6); ctx.lineTo(x1 + 14, y0 + 6); ctx.closePath();
    ctx.fill();
    ctx.fillStyle = '#ff6666';
    ctx.font = '10px monospace'; ctx.textAlign = 'center';
    ctx.fillText('External E-field (n\u2192p)', jx, y0 - 10);
    ctx.restore();
  }

  function frame14_3() {
    depW += depDir * 0.18;
    if (depW >= DEP_MAX) depDir = -1;
    if (depW <= DEP_MIN) depDir =  1;
    drawBg14_3();
    drawEField14_3();
    minority.forEach(function(m) {
      m.x += m.vx;
      if (m.side === 'p' && m.x < 20) { m.x = 20; m.vx *= -1; }
      if (m.side === 'p' && m.x > jx - depW - 5) { m.x = jx - depW - 5; m.vx *= -1; }
      if (m.side === 'n' && m.x > W - 20) { m.x = W - 20; m.vx *= -1; }
      if (m.side === 'n' && m.x < jx + depW + 5) { m.x = jx + depW + 5; m.vx *= -1; }
      ctx.save();
      ctx.globalAlpha = 0.55;
      ctx.beginPath();
      ctx.arc(m.x, m.y, 4, 0, Math.PI * 2);
      ctx.fillStyle = m.side === 'p' ? '#3399ff' : '#ff4488';
      ctx.fill();
      ctx.fillStyle = '#fff';
      ctx.font = '8px sans-serif';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      ctx.fillText(m.side === 'p' ? '\u2212' : '+', m.x, m.y);
      ctx.restore();
    });
    requestAnimationFrame(frame14_3);
  }
  requestAnimationFrame(frame14_3);
});

/* ----------------------------------------------------------------
   Fig 14.7 - Common Emitter NPN Amplifier
   560x340, dark bg
---------------------------------------------------------------- */
register3D(function () {
  var wrap = injectView3D('Fig 14.7', 340);
  var cv   = make2DCanvas(wrap, 560, 340);
  var ctx  = cv.getContext('2d');
  var W = 560, H = 340;

  var tx = 250, ty = H / 2;
  var BL = 36;
  var tick14_7 = 0;

  function drawTransistor14_7() {
    ctx.strokeStyle = '#dddddd';
    ctx.lineWidth   = 2.5;
    ctx.beginPath();
    ctx.moveTo(tx, ty - BL); ctx.lineTo(tx, ty + BL);
    ctx.stroke();
    ctx.beginPath();
    ctx.moveTo(tx - 30, ty); ctx.lineTo(tx, ty);
    ctx.stroke();
    ctx.beginPath();
    ctx.moveTo(tx, ty - BL * 0.55);
    ctx.lineTo(tx + 45, ty - BL * 1.4);
    ctx.stroke();
    ctx.beginPath();
    ctx.moveTo(tx, ty + BL * 0.55);
    ctx.lineTo(tx + 45, ty + BL * 1.4);
    ctx.stroke();
    var ex = tx + 45, ey = ty + BL * 1.4;
    var dx = ex - tx, dy = ey - (ty + BL * 0.55);
    var len = Math.sqrt(dx*dx + dy*dy);
    var ux = dx/len, uy = dy/len;
    ctx.save();
    ctx.fillStyle = '#dddddd';
    ctx.beginPath();
    ctx.moveTo(ex, ey);
    ctx.lineTo(ex - ux*14 - uy*6, ey - uy*14 + ux*6);
    ctx.lineTo(ex - ux*14 + uy*6, ey - uy*14 - ux*6);
    ctx.closePath();
    ctx.fill();
    ctx.restore();
    ctx.fillStyle = '#aaddff';
    ctx.font = '11px monospace';
    ctx.textAlign = 'left';
    ctx.fillText('B', tx - 58, ty + 4);
    ctx.fillText('C', tx + 52, ty - BL * 1.4 + 4);
    ctx.fillText('E', tx + 52, ty + BL * 1.4 + 4);
    ctx.fillStyle = '#ffffff';
    ctx.font = 'bold 13px monospace';
    ctx.textAlign = 'center';
    ctx.fillText('NPN', tx, ty - BL - 14);
  }

  function drawSine14_7(cx0, cy0, amp, freq, phaseOff, color, width) {
    var pts = 120;
    ctx.beginPath();
    ctx.strokeStyle = color;
    ctx.lineWidth = 2;
    for (var i = 0; i <= pts; i++) {
      var t  = i / pts;
      var px = cx0 + t * width;
      var py = cy0 - amp * Math.sin(freq * t * Math.PI * 2 + phaseOff);
      if (i === 0) ctx.moveTo(px, py);
      else          ctx.lineTo(px, py);
    }
    ctx.stroke();
  }

  function drawCircuit14_7() {
    var collX = tx + 45, collY = ty - BL * 1.4;
    ctx.strokeStyle = 'rgba(255,255,255,0.30)';
    ctx.lineWidth = 1.5;
    ctx.beginPath();
    ctx.moveTo(collX, collY); ctx.lineTo(collX, 30);
    ctx.stroke();
    ctx.fillStyle = '#ffddaa';
    ctx.font = '11px monospace'; ctx.textAlign = 'center';
    ctx.fillText('Vcc', collX, 22);
    ctx.fillStyle = 'rgba(200,200,200,0.75)';
    ctx.fillText('Rc', collX + 14, (collY + 30) / 2);

    ctx.strokeStyle = 'rgba(255,255,255,0.30)';
    ctx.lineWidth = 1.5;
    var bx = tx - 30;
    ctx.beginPath();
    ctx.moveTo(bx, ty); ctx.lineTo(100, ty);
    ctx.stroke();
    ctx.fillText('Rb', (bx + 100) / 2, ty - 9);

    var emX = tx + 45, emY = ty + BL * 1.4;
    ctx.beginPath();
    ctx.moveTo(emX, emY); ctx.lineTo(emX, H - 40);
    ctx.stroke();
    ctx.strokeStyle = 'rgba(255,255,255,0.50)';
    ctx.lineWidth = 2;
    for (var g = 0; g < 3; g++) {
      var gw = 20 - g * 5;
      ctx.beginPath();
      ctx.moveTo(emX - gw, H - 40 + g * 5);
      ctx.lineTo(emX + gw, H - 40 + g * 5);
      ctx.stroke();
    }

    ctx.strokeStyle = 'rgba(255,255,255,0.30)';
    ctx.lineWidth = 1.5;
    ctx.beginPath();
    ctx.moveTo(collX, collY); ctx.lineTo(W - 30, collY);
    ctx.stroke();
    ctx.beginPath();
    ctx.moveTo(W - 30, collY); ctx.lineTo(W - 30, H / 2);
    ctx.stroke();
  }

  function drawCurrentArrows14_7() {
    ctx.save();
    ctx.strokeStyle = '#88ff88';
    ctx.fillStyle   = '#88ff88';
    ctx.lineWidth = 1.5;
    ctx.beginPath();
    ctx.moveTo(130, ty); ctx.lineTo(tx - 32, ty);
    ctx.stroke();
    ctx.beginPath();
    ctx.moveTo(tx - 32, ty);
    ctx.lineTo(tx - 42, ty - 5);
    ctx.lineTo(tx - 42, ty + 5);
    ctx.closePath(); ctx.fill();
    ctx.font = '9px monospace'; ctx.textAlign = 'center';
    ctx.fillText('Ib (small)', 165, ty - 10);
    ctx.restore();

    ctx.save();
    ctx.strokeStyle = '#ffbb44';
    ctx.fillStyle   = '#ffbb44';
    ctx.lineWidth = 2;
    var cx2 = tx + 45, cy2 = ty - BL * 1.4;
    ctx.beginPath();
    ctx.moveTo(cx2, 30); ctx.lineTo(cx2, cy2 + 14);
    ctx.stroke();
    ctx.beginPath();
    ctx.moveTo(cx2, cy2);
    ctx.lineTo(cx2 - 6, cy2 + 16);
    ctx.lineTo(cx2 + 6, cy2 + 16);
    ctx.closePath(); ctx.fill();
    ctx.font = '9px monospace'; ctx.textAlign = 'left';
    ctx.fillText('Ic (large)', cx2 + 8, (30 + cy2) / 2);
    ctx.restore();
  }

  function frame14_7() {
    tick14_7++;
    ctx.fillStyle = '#0d0d18';
    ctx.fillRect(0, 0, W, H);
    var phase = tick14_7 * 0.05;

    ctx.save();
    ctx.fillStyle = 'rgba(100,220,100,0.12)';
    ctx.fillRect(6, ty - 55, 88, 110);
    ctx.restore();
    drawSine14_7(8, ty, 35, 1.5, phase, '#44ff88', 86);
    ctx.fillStyle = '#44ff88';
    ctx.font = '10px monospace'; ctx.textAlign = 'center';
    ctx.fillText('Vin', 50, ty - 60);

    var outX = tx + 45 + 10;
    ctx.save();
    ctx.fillStyle = 'rgba(255,165,0,0.08)';
    ctx.fillRect(outX, ty - 95, 110, 190);
    ctx.restore();
    drawSine14_7(outX, ty, 75, 1.5, phase + Math.PI, '#ffaa00', 108);
    ctx.fillStyle = '#ffaa00';
    ctx.font = '10px monospace'; ctx.textAlign = 'center';
    ctx.fillText('Vout (inverted)', outX + 54, ty - 100);

    drawCircuit14_7();
    drawTransistor14_7();
    drawCurrentArrows14_7();

    ctx.fillStyle = '#ccccff';
    ctx.font = '11px monospace';
    ctx.textAlign = 'center';
    ctx.fillText('Av = \u2212\u03b2 \u00d7 Rc / Rin        Phase reversal: 180\u00b0', W / 2, H - 12);
    requestAnimationFrame(frame14_7);
  }
  requestAnimationFrame(frame14_7);
});

/* ----------------------------------------------------------------
   Fig 14.9 - Logic Gates: AND, OR, NOT, NAND, NOR, XOR
   560x480, dark bg
---------------------------------------------------------------- */
register3D(function () {
  var wrap = injectView3D('Fig 14.9', 480);
  var cv   = make2DCanvas(wrap, 560, 480);
  var ctx  = cv.getContext('2d');
  var W = 560, H = 480;

  var GATE_COLS = 2, GATE_ROWS = 3;
  var CW = W / GATE_COLS, CH = H / GATE_ROWS;

  var GATES = [
    { name: 'AND',  fn: function(a,b){ return a & b; } },
    { name: 'OR',   fn: function(a,b){ return a | b; } },
    { name: 'NOT',  fn: function(a,b){ return 1 - a; } },
    { name: 'NAND', fn: function(a,b){ return 1 - (a & b); } },
    { name: 'NOR',  fn: function(a,b){ return 1 - (a | b); } },
    { name: 'XOR',  fn: function(a,b){ return a ^ b; } }
  ];

  var tick14_9 = 0;
  var INPUT_CYCLE = 70;
  var combos = [[0,0],[0,1],[1,0],[1,1]];

  function indicator14_9(x, y, val) {
    ctx.save();
    ctx.beginPath();
    ctx.arc(x, y, 7, 0, Math.PI * 2);
    ctx.fillStyle = val ? '#22ee55' : '#cc2222';
    ctx.fill();
    ctx.strokeStyle = val ? '#aaffaa' : '#ffaaaa';
    ctx.lineWidth = 1.5;
    ctx.stroke();
    ctx.fillStyle = '#fff';
    ctx.font = 'bold 9px monospace';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillText(val ? '1' : '0', x, y);
    ctx.restore();
  }

  function drawGateShape(name, cx, cy, GW, GH, out) {
    ctx.strokeStyle = '#aaaaff';
    ctx.fillStyle = 'rgba(80,80,180,0.35)';
    ctx.lineWidth = 2;

    if (name === 'AND' || name === 'NAND') {
      var lxA = cx - GW/2;
      ctx.beginPath();
      ctx.moveTo(lxA, cy - GH/2);
      ctx.lineTo(cx - 4, cy - GH/2);
      ctx.arc(cx - 4, cy, GH/2, -Math.PI/2, Math.PI/2);
      ctx.lineTo(lxA, cy + GH/2);
      ctx.closePath();
      ctx.fill(); ctx.stroke();
      if (name === 'NAND') {
        ctx.beginPath();
        ctx.arc(cx + GW/2 - 2, cy, 6, 0, Math.PI * 2);
        ctx.fillStyle = out ? '#22ee55' : '#cc2222';
        ctx.fill(); ctx.stroke();
      }
    } else if (name === 'OR' || name === 'NOR' || name === 'XOR') {
      if (name === 'XOR') {
        var lxX = cx - GW/2;
        ctx.beginPath();
        ctx.moveTo(lxX - 6, cy - GH/2);
        ctx.quadraticCurveTo(cx - GW*0.2, cy, lxX - 6, cy + GH/2);
        ctx.stroke();
      }
      var lxO = cx - GW/2;
      ctx.beginPath();
      ctx.moveTo(lxO, cy - GH/2);
      ctx.quadraticCurveTo(cx - GW*0.1, cy, lxO, cy + GH/2);
      ctx.quadraticCurveTo(cx + GW*0.3, cy + GH/2, cx + GW/2, cy);
      ctx.quadraticCurveTo(cx + GW*0.3, cy - GH/2, lxO, cy - GH/2);
      ctx.closePath();
      ctx.fill(); ctx.stroke();
      if (name === 'NOR') {
        ctx.beginPath();
        ctx.arc(cx + GW/2 - 2, cy, 6, 0, Math.PI * 2);
        ctx.fillStyle = out ? '#22ee55' : '#cc2222';
        ctx.fill(); ctx.stroke();
      }
    } else if (name === 'NOT') {
      var lxN = cx - GW/2;
      ctx.beginPath();
      ctx.moveTo(lxN, cy - GH/2);
      ctx.lineTo(lxN, cy + GH/2);
      ctx.lineTo(cx + GW/2 - 10, cy);
      ctx.closePath();
      ctx.fill(); ctx.stroke();
      ctx.beginPath();
      ctx.arc(cx + GW/2 - 4, cy, 6, 0, Math.PI * 2);
      ctx.fillStyle = out ? '#22ee55' : '#cc2222';
      ctx.fill(); ctx.stroke();
    }
  }

  function drawGateCell14_9(col, row, gate, A, B, comboIdx) {
    var ox = col * CW, oy = row * CH;
    var cx = ox + CW / 2, cy = oy + CH / 2 - 14;
    var isNOT = (gate.name === 'NOT');
    var out = gate.fn(A, B);
    var GW = 70, GH = 48;

    ctx.fillStyle = 'rgba(255,255,255,0.04)';
    ctx.strokeStyle = 'rgba(255,255,255,0.10)';
    ctx.lineWidth = 1;
    ctx.fillRect(ox + 3, oy + 3, CW - 6, CH - 6);
    ctx.strokeRect(ox + 3, oy + 3, CW - 6, CH - 6);

    ctx.fillStyle = '#ffee88';
    ctx.font = 'bold 13px monospace';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'alphabetic';
    ctx.fillText(gate.name, cx, oy + 18);

    var hasBubble = (gate.name === 'NAND' || gate.name === 'NOR' || gate.name === 'NOT');
    var wireOutEnd = cx + GW/2 + (hasBubble ? 14 : 8);
    var wireInStart = cx - GW/2 - 22;

    if (!isNOT) {
      ctx.strokeStyle = A ? '#22ee55' : '#cc2222';
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.moveTo(wireInStart, cy - 12); ctx.lineTo(cx - GW/2, cy - 12);
      ctx.stroke();
      ctx.strokeStyle = B ? '#22ee55' : '#cc2222';
      ctx.beginPath();
      ctx.moveTo(wireInStart, cy + 12); ctx.lineTo(cx - GW/2, cy + 12);
      ctx.stroke();
    } else {
      ctx.strokeStyle = A ? '#22ee55' : '#cc2222';
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.moveTo(wireInStart, cy); ctx.lineTo(cx - GW/2, cy);
      ctx.stroke();
    }

    ctx.strokeStyle = out ? '#22ee55' : '#cc2222';
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.moveTo(wireOutEnd, cy); ctx.lineTo(wireOutEnd + 22, cy);
    ctx.stroke();

    drawGateShape(gate.name, cx, cy, GW, GH, out);

    if (!isNOT) {
      indicator14_9(wireInStart - 9, cy - 12, A);
      indicator14_9(wireInStart - 9, cy + 12, B);
    } else {
      indicator14_9(wireInStart - 9, cy, A);
    }
    indicator14_9(wireOutEnd + 30, cy, out);

    // Mini truth table
    var ttx = ox + CW - 52, tty = oy + CH - 64;
    ctx.font = '8px monospace';
    ctx.textAlign = 'left';
    ctx.textBaseline = 'alphabetic';
    var ttRows;
    if (isNOT) {
      ttRows = [['A','Q'],['0','1'],['1','0']];
    } else {
      ttRows = [
        ['A','B','Q'],
        ['0','0', String(gate.fn(0,0))],
        ['0','1', String(gate.fn(0,1))],
        ['1','0', String(gate.fn(1,0))],
        ['1','1', String(gate.fn(1,1))]
      ];
    }
    ttRows.forEach(function(rowData, ri) {
      var isHeader = (ri === 0);
      var activeRI = isNOT ? (A + 1) : (comboIdx + 1);
      var isActive = (!isHeader && ri === activeRI);
      if (isActive) {
        ctx.fillStyle = 'rgba(255,210,0,0.22)';
        ctx.fillRect(ttx - 2, tty + ri * 11 - 9, isNOT ? 30 : 42, 12);
      }
      ctx.fillStyle = isHeader ? '#ffee88' : (isActive ? '#ffd700' : '#aaaaaa');
      ctx.fillText(rowData.join(' '), ttx, tty + ri * 11);
    });
  }

  function frame14_9() {
    tick14_9++;
    ctx.fillStyle = '#0d0d18';
    ctx.fillRect(0, 0, W, H);

    var comboIdx = Math.floor(tick14_9 / INPUT_CYCLE) % 4;
    var A = combos[comboIdx][0];
    var B = combos[comboIdx][1];

    GATES.forEach(function(gate, idx) {
      var col = idx % GATE_COLS;
      var row = Math.floor(idx / GATE_COLS);
      drawGateCell14_9(col, row, gate, A, B, comboIdx);
    });

    ctx.fillStyle = '#888899';
    ctx.font = '10px monospace';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'alphabetic';
    ctx.fillText('Inputs cycling:  A=' + A + '  B=' + B + '  (combo ' + (comboIdx+1) + '/4)', W/2, H - 6);

    requestAnimationFrame(frame14_9);
  }
  requestAnimationFrame(frame14_9);
});
</script>

<script src="diagrams.js"></script>

<footer class="site-footer">Released under the <a href="https://github.com/dineshvaradharajan/cbse-prep/blob/main/LICENSE" target="_blank">MIT License</a> &middot; &copy; 2026 Dinesh Varadharajan &middot; Built for CBSE XII revision</footer>
</body>
</html>
